$(window).on("load",function(){"use strict";var A,B,C,D,E,G,H,I,K,M,O,P,Q,T,U,V,W,X,Z;O={cLengthOfPrefixes:3,cPrefixOption:"opt_",legalLocalStorageKeys:[],isServerReset:!1,Utilities:{programVersion:{key:"int_utlProgramVersion",value:160926},timestampDaily:{key:"int_utlTimestampDaily",value:0},timestampWeekly:{key:"int_utlTimestampWeekly",value:0},APITokens:{key:"obj_utlAPITokens",value:[]},APICache:{key:"obj_utlAPICache",value:{}},AuditReport:{key:"obj_utlAuditReport",value:{}},CustomCatalog:{key:"obj_utlCustomCatalog",value:[]},BackupPins:{key:"obj_utlBackupPins",value:[]},BackupPinsWvW:{key:"obj_utlBackupPinsWvW",value:[]},StoredPins:{key:"obj_utlStoredPins",value:[]},StoredPinsWvW:{key:"obj_utlStoredPinsWvW",value:[]},StoredWeapons:{key:"obj_utlStoredWeapons",value:[]},StoredWeaponsWvW:{key:"obj_utlStoredWeaponsWvW",value:[]}},enforceProgramVersion:function(){var e=O.Utilities.programVersion.value,t=parseInt(localStorage[O.Utilities.programVersion.key]);if(isFinite(t)&&t!==e){var n=I.ModeCurrent===I.ModeEnum.Overlay?15:30;I.clear(),I.greet(I.cSiteName+" was updated since your last visit.<br />This version: "+e+"<br />Your version: "+t+"<br />Would you like to see the <a class='urlUpdates' href='"+U.URL_META.News+"'>changes</a>?<br />",n),U.convertExternalLink(".urlUpdates")}localStorage[O.Utilities.programVersion.key]=O.Utilities.programVersion.value},Options:{enu_Language:"en",enu_Server:"1008",bol_showSecondHand:!0,bol_hideChecked:!1,bol_expandWB:!0,bol_collapseChains:!0,int_setClock:0,int_setDimming:0,int_setPredictor:0,bol_alignPanelRight:!0,bol_ignoreTouch:!1,bol_showPanel:!0,bol_showMap:!0,bol_showHUD:!0,bol_showDashboard:!0,bol_showTimeline:!0,bol_opaqueTimeline:!1,bol_condenseTimelineHeader:!0,bol_hideHUD:!0,int_setFloor:1,int_setInitialZoom:3,int_setInitialZoomWvW:4,bol_showCoordinatesBar:!0,bol_showZoneBorders:!1,bol_showZoneGateways:!1,bol_showPersonalPaths:!0,bol_showChainPaths:!0,bol_tourPrediction:!0,bol_showWorldCompletion:!1,bol_showZoneOverview:!0,bol_displaySectors:!0,bol_displayWaypoints:!0,bol_displayPOIs:!0,bol_displayVistas:!0,bol_displayChallenges:!0,bol_displayHearts:!0,bol_displayEvents:!1,bol_showWorldCompletionWvW:!1,bol_showZoneOverviewWvW:!0,bol_displaySectorsWvW:!0,bol_displayWaypointsWvW:!0,bol_displayPOIsWvW:!0,bol_displayVistasWvW:!0,bol_displayChallengesWvW:!0,str_colorPersonalPath:"#ffffff",int_secWvWRefresh:10,int_numLogEntries:128,bol_showLog:!0,bol_opaqueLog:!1,bol_maximizeLog:!1,bol_logRedHome:!0,bol_logBlueHome:!0,bol_logGreenHome:!0,bol_logCenter:!0,bol_logNarrate:!1,bol_narrateRedHome:!0,bol_narrateBlueHome:!0,bol_narrateGreenHome:!0,bol_narrateCenter:!0,bol_narrateClaimed:!1,bol_narrateRuins:!1,bol_narrateCamp:!0,bol_narrateTower:!0,bol_narrateKeep:!0,bol_narrateCastle:!0,bol_showLeaderboard:!0,bol_opaqueLeaderboard:!1,bol_condenseLeaderboard:!1,bol_showDestructibles:!1,bol_showObjectiveLabels:!0,bol_showSecondaries:!1,int_setFollow:1,bol_displayCharacter:!0,int_setFollowWvW:2,bol_displayCharacterWvW:!0,int_msecGPSRefresh:50,int_setAlarm:0,int_setVolume:75,bol_alertArrival:!0,bol_alertAtStart:!0,bol_alertAtEnd:!0,bol_alertChecked:!1,int_alertSubscribedFirst:1,int_alertSubscribedSecond:15,bol_alertAutosubscribe:!0,bol_alertUnsubscribe:!0,bol_alertDaylight:!1,bol_showRarity:!1,bol_condenseBank:!1,bol_refreshPrices:!0,int_numTradingCalculators:25,int_numTradingResults:50,int_secTradingRefresh:60,int_minStopwatchAlert:5,str_textStopwatchAlert:"Alert, alert, alert!",int_sizeStopwatchFont:64,int_sizeNotepadFont:12,int_sizeNotepadHeight:400,bol_clearChainChecklistOnReset:!0,bol_clearPersonalChecklistOnReset:!0,bol_use24Hour:!0,bol_detectDST:!0,bol_useSiteTag:!0},OptionRange:{},LanguageCode:{en:"en-US",de:"de-DE",es:"es-ES",fr:"fr-FR",cs:"cs-CZ",it:"it-IT",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",zh:"zh-CN"},VoiceCode:{en:"Google US English",de:"Google Deutsch",es:"Google español",fr:"Google français",cs:"native",it:"Google italiano",pl:"Google polski",pt:"Google português do Brasil",ru:"Google русский",zh:"Google 國語（臺灣）"},OptionEnum:{Language:{Default:"en",English:"en",German:"de",Spanish:"es",French:"fr",Czech:"cs",Italian:"it",Polish:"pl",Portuguese:"pt",Russian:"ru",Mandarin:"zh"},Server:{AnvilRock:"1001",BorlisPass:"1002",YaksBend:"1003",HengeofDenravi:"1004",Maguuma:"1005",SorrowsFurnace:"1006",GateofMadness:"1007",JadeQuarry:"1008",FortAspenwood:"1009",EhmryBay:"1010",StormbluffIsle:"1011",Darkhaven:"1012",SanctumofRall:"1013",CrystalDesert:"1014",IsleofJanthir:"1015",SeaofSorrows:"1016",TarnishedCoast:"1017",NorthernShiverpeaks:"1018",Blackgate:"1019",FergusonsCrossing:"1020",Dragonbrand:"1021",Kaineng:"1022",DevonasRest:"1023",EredonTerrace:"1024",FissureofWoe:"2001",Desolation:"2002",Gandara:"2003",Blacktide:"2004",RingofFire:"2005",Underworld:"2006",FarShiverpeaks:"2007",WhitesideRidge:"2008",RuinsofSurmia:"2009",SeafarersRest:"2010",Vabbi:"2011",PikenSquare:"2012",AuroraGlade:"2013",GunnarsHold:"2014",JadeSea:"2101",FortRanik:"2102",AuguryRock:"2103",VizunahSquare:"2104",Arborstone:"2105",Kodash:"2201",Riverside:"2202",ElonaReach:"2203",AbaddonsMouth:"2204",DrakkarLake:"2205",MillersSound:"2206",Dzagonur:"2207",BaruchBay:"2301"}},IntEnum:{Predictor:{Auto:0,Min:1,MinAvg:2,Avg:3},Clock:{Compact:0,Full:1,Bar:2,None:3},Alarm:{Off:0,Checklist:1,Subscription:2},Follow:{Off:0,Character:1,Zone:2}},validateEnum:function(e,t){var n,a=O.OptionEnum[U.getVariableSuffix(e)];for(n in a)if(a[n]===t)return t;return O.Options[e]},initializeLegalLocalStorageKeys:function(){var e;for(e in O.Utilities)O.legalLocalStorageKeys.push(O.Utilities[e].key);for(e in O.Options)O.legalLocalStorageKeys.push(e);for(e in X.Checklists)O.legalLocalStorageKeys.push(X.Checklists[e].key);for(e in X.Collectibles)O.legalLocalStorageKeys.push(X.Collectibles[e].key);for(e in X.Textlists)O.legalLocalStorageKeys.push(X.Textlists[e].key)},cleanLocalStorage:function(){var e,t,n,a;for(e=0;e<localStorage.length;e++){n=localStorage.key(e);for(t in O.legalLocalStorageKeys)if(n===O.legalLocalStorageKeys[t]){a=!0;break}a!==!0?localStorage.removeItem(n):a=!1}},convertLocalStorageDataType:function(e){var t=e.toLowerCase();return"true"===t?!0:"false"===t?!1:isFinite(t)?t%0===0?parseInt(t):parseFloat(t):e},initializeTimestamp:function(e){var t=T.getUNIXSeconds(),n=parseInt(localStorage[e.key]);void 0===localStorage[e.key]||isFinite(n)===!1||n>t?(e.value=t,localStorage[e.key]=e.value):e.value=n},updateResetTimestamp:function(e){e.value=T.getUNIXSeconds(),localStorage[e.key]=e.value},checkResetTimestamps:function(){var e=T.getUNIXSeconds(),t=T.getTimeSinceMidnight(),n=T.getSecondsSinceWeekstart(t),a=e-t,i=n>T.cWEEKLY_RESET_SECONDS?e-(n-T.cWEEKLY_RESET_SECONDS):e-T.cSECONDS_IN_WEEK+(T.cWEEKLY_RESET_SECONDS-n),r=0===t,o=n===T.cWEEKLY_RESET_SECONDS;(O.Utilities.timestampDaily.value<a||r)&&(O.clearDailySensitiveOptions(r),O.updateResetTimestamp(O.Utilities.timestampDaily)),(O.Utilities.timestampWeekly.value<i||o)&&(O.clearWeeklySensitiveOptions(o),O.updateResetTimestamp(O.Utilities.timestampWeekly))},getIndexOfSelectedRadioButton:function(e){var t=$("fieldset[name="+e+"] input:radio[name="+e+"]");return t.index(t.filter(":checked"))},initializeOptions:function(){O.initializeLegalLocalStorageKeys();var e,t,n,a;for(e in O.Options)a=$("#"+O.cPrefixOption+e),t=a.attr("type"),n=U.getVariablePrefix(e),"radio"===t?O.OptionRange[e]=[0,$("fieldset[name="+e+"] input").length-1]:("number"===t||"range"===t)&&(O.OptionRange[e]=[a.prop("min"),a.prop("max")]),I.isProgramEmbedded?void 0!==U.Args[e]&&n!==U.TypeEnum.isString&&(O.Options[e]=O.convertLocalStorageDataType(U.sanitizeURLOptionsValue(e,U.Args[e]))):(void 0!==U.Args[e]&&n!==U.TypeEnum.isString&&(localStorage[e]=U.sanitizeURLOptionsValue(e,U.Args[e])),void 0===localStorage[e]?localStorage[e]=O.Options[e]:O.Options[e]=O.convertLocalStorageDataType(localStorage[e])),O.setInputValue(a,O.Options[e]),"radio"===t?$("fieldset[name="+e+"]").change(function(){var e=$(this).attr("name");O.Options[e]=O.getIndexOfSelectedRadioButton(e),localStorage[e]=O.Options[e]}):a.change(function(){var e=$(this).attr("id").slice(O.cPrefixOption.length);O.Options[e]=O.getInputValue($(this),e),localStorage[e]=O.Options[e]}).click(function(){$(this).select()});I.isTouchEnabled=void 0!==window.ontouchstart&&O.Options.bol_ignoreTouch===!1,O.bindOptionsInputs(),U.initializeAPIURLs()},setInputValue:function(e,t){var n=$(e),a=n.attr("type");"checkbox"===a?n.prop("checked",t):"number"===a||"range"===a?n.val(t):"radio"===a?$("input:radio[name="+n.attr("name")+"]:eq("+t+")").prop("checked",!0):n.val(t)},getInputValue:function(e,t){var n,a=$(e),i=a.attr("type");if("checkbox"===i)n=a.prop("checked");else if("number"===i||"range"===i){var n=a.val(),r=parseInt(n);n=!isFinite(n)||r<O.OptionRange[t][0]||r>O.OptionRange[t][1]?O.OptionRange[t][0]:r,a.val(n)}else if("text"===i){n=a.val();var o=a.attr("maxlength");n.length>o&&(n=n.substring(0,o))}else n=a.val();return n},mimicInput:function(e,t){var n=$(e);O.setInputValue(n,O.Options[t]);var a=$("#"+O.cPrefixOption+t);return n.change(function(){var e=O.getInputValue($(this),t);O.setInputValue(a,e),a.trigger("change")}),a.change(function(){O.setInputValue(n,O.Options[t])}),n},clearDailySensitiveOptions:function(e){O.isServerReset=!0;var t=5,n=e?"Daily Reset!":"Daily Timestamp Expired!";I.greet(n,t),T.getDaily({aIsReset:!0});var a,i;if(O.Options.bol_clearChainChecklistOnReset){for(a in C.Chains)i=C.Chains[a],$("#chnCheck_"+i.nexus).removeClass("chnChecked"),$("#chnBar_"+i.nexus).removeClass("chnFaded"),X.getChecklistItem(X.Checklists.Chain,i.nexus)!==X.ChecklistEnum.Disabled&&$("#chnBar_"+i.nexus).show();X.clearChecklist(X.Checklists.Chain,X.ChecklistJob.UncheckTheChecked)}O.Options.bol_clearPersonalChecklistOnReset&&X.clearCustomChecklistDaily();var r=1e4;I.isSectionLoaded_Daily&&setTimeout(function(){G.generateAndInitializeDailies()},r),I.write("",t)},clearWeeklySensitiveOptions:function(e){var t=5,n=e?"Weekly Reset!":"Weekly Timestamp Expired!";I.greet(n,t),O.Options.bol_clearPersonalChecklistOnReset&&X.clearCustomChecklistWeekly()},bindOptionsInputs:function(){var e;for(e in O.Enact)!function(e){var t,n=O.cPrefixOption+e,a=$("#"+n).attr("type");t="radio"===a?"fieldset[name="+e+"]":"#"+n,$(t).change(function(){O.Enact[e]()})}(e);$("#opt_bol_showWorldCompletion").change(function(){O.Options.bol_showWorldCompletion===!0&&M.isMappingIconsGenerated===!1&&location.reload(),$("#mapOptionsCompletion label input").each(function(){X.setCheckboxEnumState($(this),X.boolToChecklistEnum(O.Options.bol_showWorldCompletion))})}),$("#opt_bol_showWorldCompletionWvW").change(function(){O.Options.bol_showWorldCompletionWvW===!0&&W.isMappingIconsGenerated===!1&&location.reload(),$("#wvwOptionsCompletion label input").each(function(){X.setCheckboxEnumState($(this),X.boolToChecklistEnum(O.Options.bol_showWorldCompletionWvW))})}),$("#opt_bol_displayEvents").change(function(){O.Options.bol_displayEvents===!0&&M.isEventIconsGenerated===!1&&location.reload(),M.isEventIconsGenerated&&M.refreshCurrentZone()}),$("#mapOptionsCompletion label input").each(function(){$(this).change(function(){M.isAPIRetrieved_MAPFLOOR&&M.refreshCurrentZone()})}),$("#wvwOptionsCompletion label input").each(function(){$(this).change(function(){W.isAPIRetrieved_MAPFLOOR&&W.refreshCurrentZone()})}),O.Enact.bol_showSecondHand(),O.Enact.int_setAlarm(),O.Enact.bol_detectDST(),O.Enact.bol_useSiteTag(),O.Enact.bol_alignPanelRight(!0),O.Enact.bol_showPanel(),O.Enact.bol_showTimeline(),I.ModeCurrent!==I.ModeEnum.Simple&I.ModeCurrent!==I.ModeEnum.Tile&&(O.Enact.int_setClock(),O.Enact.int_setDimming(),O.Enact.bol_showMap()),$("#optRestoreAllChains").click(function(){var e,t=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";for(var n in C.Chains)e=C.Chains[n],$("#chnCheck_"+e.nexus).removeClass("chnChecked"),$("#chnBar_"+e.nexus).show().removeClass("chnFaded").css({display:t}),$(".chnSlot_"+e.nexus).each(function(){$(this).show().css({display:t}).removeClass("chnFaded").find(".chnCheck").removeClass("chnChecked"),$(this).hasClass("tmlIcon")&&$(this).css({display:"inline-block"})});for(X.clearChecklist(X.Checklists.Chain),n=0;n<T.cNUM_TIMEFRAMES_IN_HOUR;n++){K.checkoffChainIcon(T.getStandardChain(n).nexus);var a=T.getHardcoreChain(n);a&&K.checkoffChainIcon(a.nexus)}}),$("#optChainsExpand").click(function(){$(".chnDetails").show()}),$("#optChainsCollapse").click(function(){$(".chnDetails").hide(),I.scrollToElement("#plateChains")}),$("#optClearLocalStorage").click(function(){confirm(I.cSiteName+" Reset: This is will clear all options and everything you have written in this website. Continue?")&&(localStorage.clear(),location.reload())}),$("#optPrintLocalStorage").click(function(){var e,t=[];for(e=0;e<localStorage.length;e++){var n=U.escapeHTML(localStorage.key(e));t.push(n)}t.sort();var a="";for(e in t){var i=U.escapeHTML(localStorage.getItem(t[e]));a+=t[e]+": "+i+"<br />"}I.print(a,!0)})},Enact:{bol_showSecondHand:function(){$("#clkSecondHand").toggle(O.Options.bol_showSecondHand)},int_setAlarm:function(){var e="img/ui/placeholder.png";switch(O.Options.int_setAlarm){case O.IntEnum.Alarm.Checklist:e="img/ui/check.png";break;case O.IntEnum.Alarm.Subscription:e="img/ui/subscription.png"}O.Options.int_setAlarm===O.IntEnum.Alarm.Off?(D.stopSpeech(),$("#optAlarmSpeaker").attr("src","img/ui/mute.png")):(D.verifyNativeTTS(),$("#optAlarmSpeaker").attr("src","img/ui/speaker.png")),$("#optAlarmIcon").attr("src",e)},int_setVolume:function(){D.isSpeaking()===!1&&D.speak(D.getWord("alarm"))},bol_logNarrate:function(){O.Options.bol_logNarrate?D.verifyNativeTTS():D.stopSpeech()},bol_hideChecked:function(){$(".chnBar").each(function(){X.hideCheckedChainBar(U.getSubintegerFromHTMLID($(this)))})},bol_expandWB:function(){var e=I.ModeCurrent===I.ModeEnum.Tile?C.RegularChains:C.CurrentChains;for(var t in e)if(C.isChainRegular(e[t])){var n=$("#chnDetails_"+e[t].nexus);O.Options.bol_expandWB?n.show("fast"):n.hide("fast")}},bol_use24Hour:function(){C.initializeTimetableHTML(),C.updateChainsTimeHTML(),K.updateDigitalClockMinutely(),H.updateTimelineHeader(),H.updateTimelineSegments()},bol_detectDST:function(){T.checkDST()},int_setClock:function(){K.setClock()},int_setDimming:function(){switch(O.Options.int_setDimming){case 1:$("#paneClockBackground").css({opacity:1});break;case 2:$("#paneClockBackground").css({opacity:0})}},int_setFloor:function(){M.changeFloor(O.Options.int_setFloor)},int_setInitialZoom:function(){M.Map.setZoom(O.Options.int_setInitialZoom)},int_setInitialZoomWvW:function(){W.Map.setZoom(O.Options.int_setInitialZoomWvW)},bol_showZoneBorders:function(){P.drawZoneBorders()},bol_showZoneGateways:function(){P.drawZoneGateways()},bol_showPersonalPaths:function(){M.isMapInitialized&&M.drawPersonalPath(),W.isMapInitialized&&W.drawPersonalPath()},str_colorPersonalPath:function(){M.isMapInitialized&&M.drawPersonalPath(),W.isMapInitialized&&W.drawPersonalPath()},bol_showChainPaths:function(){M.toggleLayerArray(P.LayerArray.ChainPath,O.Options.bol_showChainPaths)},int_setFollow:function(){O.Options.int_setFollow!==O.IntEnum.Follow.Off&&(M.GPSPreviousZoneID="",P.updateCharacter(0))},int_setFollowWvW:function(){O.Options.int_setFollowWvW!==O.IntEnum.Follow.Off&&(W.GPSPreviousZoneID="",P.updateCharacter(0))},bol_displayCharacter:function(){O.Options.bol_displayCharacter?(P.tickGPS(),P.updateCharacter(0)):(M.movePin(M.Pin.Character),M.movePin(M.Pin.Camera))},bol_displayCharacterWvW:function(){O.Options.bol_displayCharacterWvW?(P.tickGPS(),P.updateCharacter(0)):(W.movePin(W.Pin.Character),W.movePin(W.Pin.Camera))},bol_showPanel:function(){O.Options.bol_showMap&&I.isMapEnabled&&($("#panelApp").toggle(O.Options.bol_showPanel),$("#mapExpandButton, #wvwExpandButton").toggle(!O.Options.bol_showPanel),M.refreshMap(),W.isMapInitialized&&W.refreshMap(),A.isAccountInitialized&&A.adjustAccountPanel())},bol_alignPanelRight:function(e){I.isMapEnabled&&(O.Options.bol_alignPanelRight?e!==!0&&($("#panelApp").insertAfter("#panelMap"),$(".paneApp").css({right:"0px",borderLeft:"1px solid #444",borderRight:"none",boxShadow:"-5px 0px 5px #223"}),$(".mapExpandButton").css({right:0,left:"auto"}),$("#itemExpandButton").css({right:"auto",left:"auto","margin-left":"-16px"})):($("#panelApp").insertBefore("#panelMap"),$(".paneApp").css({right:"auto",borderLeft:"none",borderRight:"1px solid #444",boxShadow:"5px 0px 5px #223"}),$(".mapExpandButton").css({right:"auto",left:0}),$("#itemExpandButton").css({right:"auto",left:"auto","margin-left":I.cPANEL_WIDTH-16+"px"})))},bol_showMap:function(){I.isMapEnabled&&($("#panelMap").toggle(O.Options.bol_showMap),M.refreshMap())},bol_showHUD:function(){$("#hudOuter").toggle(O.Options.bol_showHUD),$("#hudBoxes").toggle(O.Options.bol_showHUD)},bol_showCoordinatesBar:function(){M.toggleCoordinatesBar()},bol_hideHUD:function(){O.Options.bol_hideHUD===!1&&$("#hudBoxes").show()},bol_showTimeline:function(){if(O.Options.bol_showTimeline){if(H.isTimelineGenerated)return void H.toggleTimeline(!0);H.generateTimeline(),O.Enact.bol_opaqueTimeline()}else H.toggleTimeline(!1)},bol_opaqueTimeline:function(){I.toggleHUDOpacity("#itemTimeline","tml",O.Options.bol_opaqueTimeline)},bol_condenseTimelineHeader:function(e){H.minutesInTimelineSpacing=O.Options.bol_condenseTimelineHeader?T.cMINUTES_IN_TIMEFRAME:T.cMINUTES_IN_MINIFRAME,H.updateTimelineHeader(),e!==!0&&H.updateTimelineSegments()},bol_refreshPrices:function(){O.Options.bol_refreshPrices&&E.isTradingCalculatorsInitialized?E.loopRefresh():E.cancelLoopRefresh()},bol_useSiteTag:function(){I.siteTagCurrent=O.Options.bol_useSiteTag?I.siteTagDefault:""},bol_showLog:function(){W.toggleLog()},bol_opaqueLog:function(){W.opaqueLog()},bol_maximizeLog:function(){W.toggleLogHeight()},bol_showLeaderboard:function(){W.toggleLeaderboard()},bol_opaqueLeaderboard:function(){W.opaqueLeaderboard()},bol_condenseLeaderboard:function(){W.toggleLeaderboardWidth(!0)},bol_showSecondaries:function(){W.toggleSecondaries(!0)},bol_showDestructibles:function(){W.toggleWalls(!0)},bol_showObjectiveLabels:function(){W.toggleObjectiveLabels()}}},X={Checklists:{Chain:{key:"str_chlChain",value:""},ChainSubscription:{key:"str_chlChainSubscription",value:""},JP:{key:"str_chlJP",value:""},Chest:{key:"str_chlChest",value:""},ResourceRich:{key:"str_chlResourceRich",value:""},ResourcePermanent:{key:"str_chlResourcePermanent",value:""},ResourceRegular:{key:"str_chlResourceRegular",value:""},ResourceHotspot:{key:"str_chlResourceHotspot",value:""},Dungeon:{key:"str_chlDungeon",value:"",money:0},CustomDaily:{key:"str_chlCustomDaily",value:""},CustomWeekly:{key:"str_chlCustomWeekly",value:""},TradingOverwrite:{key:"str_chlTradingOverwrite",value:""},TradingNotify:{key:"str_chlTradingNotify",value:""}},Collectibles:{NoxiousPods:{key:"str_chlNoxiousPods",urlkey:"noxiouspods",value:""},CrystallizedCaches:{key:"str_chlCrystallizedCaches",urlkey:"crystallizedcaches",value:""},ExaltedChests:{key:"str_chlExaltedChests",urlkey:"exaltedchests",value:""},AirshipCargo:{key:"str_chlAirshipCargo",urlkey:"airshipcargo",value:""},BuriedChests:{key:"str_chlBuriedChests",urlkey:"chests",value:""},BanditChests:{key:"str_chlBanditChests",urlkey:"banditchests",value:""},MatrixCubeKey:{key:"str_chlMatrixCubeKey",urlkey:"matrixcubekey",value:""},SkrittBurglar:{key:"str_chlSkrittBurglar",urlkey:"skrittburglar",value:""},PaperScraps:{key:"str_chlPaperScraps",urlkey:"paperscraps",value:""},TigerSpirit:{key:"str_chlTigerSpirit",urlkey:"tigerspirit",value:""},ItzelTotems:{key:"str_chlItzelTotems",urlkey:"itzeltotems",value:""},PriorySeals:{key:"str_chlPriorySeals",urlkey:"prioryseals",value:""},AuricTablets:{key:"str_chlAuricTablets",urlkey:"aurictablets",value:""},ExaltedMasks:{key:"str_chlExaltedMasks",urlkey:"exaltedmasks",value:""},MursaatTokens:{key:"str_chlMursaatTokens",urlkey:"mursaattokens",value:""},MursaatTablets:{key:"str_chlMursaatTablets",urlkey:"mursaattablets",value:""},CamiJournals:{key:"str_chlCamiJournals",urlkey:"camijournals",value:""},BloodstoneCreatures:{key:"str_chlBloodstoneCreatures",urlkey:"creatures",value:""},BloodstoneSlivers:{key:"str_chlBloodstoneSlivers",urlkey:"slivers",value:""},LionsArchExterminator:{key:"str_chlLionsArchExterminator",urlkey:"lionsarchexterminator",value:""},CoinProspect:{key:"str_chlCoinProspect",urlkey:"coinprospect",value:""},CoinUplands:{key:"str_chlCoinUplands",urlkey:"coinuplands",value:""},CoinChallenger:{key:"str_chlCoinChallenger",urlkey:"coinchallenger",value:""},LostBadges:{key:"str_chlLostBadges",urlkey:"lostbadges",value:""},GoldenLostBadges:{key:"str_chlGoldenLostBadges",urlkey:"goldenlostbadges",value:""},DiveMaster:{key:"str_chlDiveMaster",urlkey:"divemaster",value:""},SpeedyReader:{key:"str_chlSpeedyReader",urlkey:"speedyreader",value:""},CleaningUp:{key:"str_chlCleaningUp",urlkey:"cleaningup",value:""},HistoryBuff:{key:"str_chlHistoryBuff",urlkey:"historybuff",value:""},Strongboxes:{key:"str_chlStrongboxes",urlkey:"strongboxes",value:""},MasteryInsight:{key:"str_chlMasteryInsight",urlkey:"masteryinsight",value:""},HeroChallenge:{key:"str_chlHeroChallenge",urlkey:"herochallenge",value:""},RangerPets:{key:"str_chlRangerPets",urlkey:"pets",value:""}},ChecklistEnum:{Unchecked:"0",Checked:"1",Disabled:"2",Unfound:"0",Tracked:"1",Found:"2"},ChecklistJob:{UncheckAll:0,CheckAll:1,UncheckTheChecked:2},Textlists:{CustomTextDaily:{key:"str_txlCustomTextDaily",value:[],valueDefault:[]},CustomTextWeekly:{key:"str_txlCustomTextWeekly",value:[],valueDefault:[]},NotepadText:{key:"str_txlNotepadText",value:[],valueDefault:[]},TradingItem:{key:"str_txlTradingItem",value:[]},TradingName:{key:"str_txlTradingName",value:[]},TradingBuy:{key:"str_txlTradingBuy",value:[]},TradingSell:{key:"str_txlTradingSell",value:[]},TradingQuantity:{key:"str_txlTradingQuantity",value:[]},NotifyBuyLow:{key:"str_txlNotifyBuyLow",value:[]},NotifyBuyHigh:{key:"str_txlNotifyBuyHigh",value:[]},NotifySellLow:{key:"str_txlNotifySellLow",value:[]},NotifySellHigh:{key:"str_txlNotifySellHigh",value:[]},ExchangeUnit:{key:"str_txlExchangeUnit",value:[]}},boolToChecklistEnum:function(e){return e?X.ChecklistEnum.Checked:X.ChecklistEnum.Unchecked},initializeChecklist:function(e,t,n,a){var i,r,o,s=localStorage[e.key];if(e.length=t,n){X.clearChecklist(e),r=n.split(",");for(i in r)o=parseInt(r[i]),isFinite(o)&&X.setChecklistItem(e,o-1,X.ChecklistEnum.Checked)}else if(void 0===s)X.clearChecklist(e,a);else if(s.length>t)localStorage[e.key]=s.substring(0,t);else if(s.length<t){var c=U.repeatChar(X.ChecklistEnum.Unchecked,t-s.length);localStorage[e.key]=s+c}e.value=localStorage[e.key]},setChecklistItem:function(e,t,n){t=parseInt(t);var a=""+n;if(1===a.length&&e.value[t]!==a&&t>=0&&t<e.value.length){var i=U.replaceCharAt(e.value,t,a);localStorage[e.key]=i,e.value=i}},trackChecklistItem:function(e,t){t=parseInt(t);var n=e.value.charAt(t);switch(n){case X.ChecklistEnum.Unfound:n=X.ChecklistEnum.Tracked;break;case X.ChecklistEnum.Tracked:n=X.ChecklistEnum.Found;break;case X.ChecklistEnum.Found:n=X.ChecklistEnum.Unfound;break;default:n=X.ChecklistEnum.Unfound}var a=U.replaceCharAt(e.value,t,n);return localStorage[e.key]=a,e.value=a,n},getChecklistItem:function(e,t,n){var a=e.value.charAt(t);return void 0===n?a:n===U.TypeEnum.isInteger?parseInt(a):n===U.TypeEnum.isBoolean?U.intToBool(parseInt(a)):a},isChecked:function(e,t){var n=U.getSubintegerFromHTMLID(t);return X.getChecklistItem(e,n)===X.ChecklistEnum.Checked?!0:!1},getCheckedIndexes:function(e){var t,n="",a=e.value;for(t=0;t<a.length;t++)a[t]===X.ChecklistEnum.Checked&&(n+=t+1+",");return n=n.slice(0,-1)},clearChecklist:function(e,t){var n,a="",i="";switch(t){case X.ChecklistJob.CheckAll:for(n=0;n<e.length;n++)a+=X.ChecklistEnum.Checked;break;case X.ChecklistJob.UncheckTheChecked:for(i=void 0!==localStorage[e.key]?localStorage[e.key]:e.value,n=0;n<i.length;n++)a+=i[n]===X.ChecklistEnum.Checked?X.ChecklistEnum.Unchecked:i[n];break;default:for(n=0;n<e.length;n++)a+=X.ChecklistEnum.Unchecked}e.value=a,localStorage[e.key]=a},countChecklist:function(e,t){return U.countOccurrence(e.value,t)},getCheckboxEnumState:function(e){return e.prop("disabled")===!0?X.ChecklistEnum.Disabled:e.prop("checked")===!0?X.ChecklistEnum.Checked:X.ChecklistEnum.Unchecked},setCheckboxEnumState:function(e,t){switch(t){case X.ChecklistEnum.Disabled:e.prop("disabled",!0),e.prop("checked",!1);break;case X.ChecklistEnum.Checked:e.prop("checked",!0);break;default:e.prop("checked",!1)}e.trigger("change")},setFieldsetState:function(e,t){$("fieldset[name='"+e+"'] input:eq("+t+")").trigger("click")},triggerCheckbox:function(e,t){var n=X.getCheckboxEnumState(e);t===X.ChecklistEnum.Checked&&n===X.ChecklistEnum.Unchecked||t===X.ChecklistEnum.Unchecked&&n===X.ChecklistEnum.Checked?e.trigger("click"):t===X.ChecklistEnum.Disabled&&n!==X.ChecklistEnum.Disabled&&e.trigger("dblclick")},triggerCheckboxEnumState:function(e,t,n){var a=X.getChecklistItem(e,t);X.triggerCheckbox(n,a)},styleCheckbox:function(e,t,n){var a=X.getChecklistItem(e,t);switch(a){case X.ChecklistEnum.Disabled:n.parent().removeClass("chlCheckboxChecked").addClass("chlCheckboxDisabled");break;case X.ChecklistEnum.Checked:n.parent().removeClass("chlCheckboxDisabled").addClass("chlCheckboxChecked");break;default:n.parent().removeClass("chlCheckboxDisabled").removeClass("chlCheckboxChecked")}},initializeCheckboxlist:function(e,t,n){X.initializeChecklist(e,t.length,null,n),t.each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(e,t,n)}),X.triggerCheckboxEnumState(e,t,$(this))})},initializeTextlist:function(e,t,n,a,i){t.each(function(){var t=$(this).val();e.value.push(t),e.valueDefault&&e.valueDefault.push(t)});var r;if(void 0===localStorage[e.key])localStorage[e.key]=e.value.join(I.cTextDelimiterChar);else{var o=localStorage[e.key].split(I.cTextDelimiterChar);for(r=0;r<e.value.length;r++)e.value[r]=o[r]?o[r]:"";localStorage[e.key]=e.value.join(I.cTextDelimiterChar)}var s=function(){t.each(function(t){e.value[t]=$(this).val().replace(I.cTextDelimiterRegex,"")}),localStorage[e.key]=e.value.join(I.cTextDelimiterChar)};t.each(function(t){$(this).attr("maxlength",a),$(this).val(e.value[t]),$(this).change(function(){n&&I.write(n+" #"+(t+1)+" updated."),s()})}),i&&i.click(function(){confirm("Reset texts to default?")&&t.each(function(t){$(this).val(e.valueDefault[t]).trigger("change")})})},initializeChainChecklist:function(e){var t=$("#chnBar_"+e.nexus),n=$("#chnCheck_"+e.nexus),a=$("#chnTime_"+e.nexus);X.reapplyChainBarState(e.nexus,t,n,a),C.isChainRegular(e)&&a.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=$(".chnSlot_"+e).find("time");X.getChecklistItem(X.Checklists.ChainSubscription,e)===X.ChecklistEnum.Checked?($(this).removeClass("chnTimeSubscribed"),t.removeClass("chnTimeSubscribed"),X.setChecklistItem(X.Checklists.ChainSubscription,e,X.ChecklistEnum.Unchecked)):($(this).addClass("chnTimeSubscribed"),t.addClass("chnTimeSubscribed"),X.setChecklistItem(X.Checklists.ChainSubscription,e,X.ChecklistEnum.Checked),O.Options.int_setAlarm!==O.IntEnum.Alarm.Subscription&&X.setFieldsetState("int_setAlarm",O.IntEnum.Alarm.Subscription))}),n.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=$("#chnBar_"+e),n=$(".chnSlot_"+e),a=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";switch(X.getChecklistItem(X.Checklists.Chain,e)){case X.ChecklistEnum.Unchecked:t.addClass("chnFaded"),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).hide("fast"),$(this).addClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Checked),n.addClass("chnFaded").find(".chnCheck").addClass("chnChecked");break;case X.ChecklistEnum.Checked:t.removeClass("chnFaded").show("fast").css({display:a}),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).show("fast").css({display:a}),$(this).removeClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Unchecked),n.show("fast").each(function(){$(this).css({display:a}).removeClass("chnFaded").find(".chnCheck").removeClass("chnChecked"),$(this).hasClass("tmlIcon")&&$(this).css({display:"inline-block"})});break;case X.ChecklistEnum.Disabled:t.removeClass("chnFaded").show("fast").css({display:a}),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).show("fast").css({display:a}),$(this).removeClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Unchecked),n.hide().removeClass("chnFaded").find(".chnCheck").removeClass("chnChecked")}X.hideCheckedChainBar(e),K.checkoffChainIcon(e)}),$("#chnDelete_"+e.nexus).click(function(){var e=U.getSubintegerFromHTMLID($(this));$("#chnBar_"+e).hide("slow"),$(".chnSlot_"+e).hide("slow"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Disabled),K.checkoffChainIcon(e)})},reapplyChainBarState:function(e,t,n,a){switch(X.getChecklistItem(X.Checklists.Chain,e)){case X.ChecklistEnum.Unchecked:break;case X.ChecklistEnum.Checked:t.addClass("chnFaded"),n.addClass("chnChecked"),O.Options.bol_hideChecked&&t.hide();break;case X.ChecklistEnum.Disabled:t.hide()}C.isChainRegular(C.Chains[e])&&X.getChecklistItem(X.Checklists.ChainSubscription,e)===X.ChecklistEnum.Checked&&a.addClass("chnTimeSubscribed")},reapplyChainIconState:function(e,t,n){switch(X.getChecklistItem(X.Checklists.Chain,e.nexus)){case X.ChecklistEnum.Unchecked:t.removeClass("chnFaded");break;case X.ChecklistEnum.Checked:t.addClass("chnFaded");break;case X.ChecklistEnum.Disabled:n?t.hide():t.addClass("chnFaded")}},hideCheckedChainBar:function(e){var t=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";X.getChecklistItem(X.Checklists.Chain,e)===X.ChecklistEnum.Checked&&(O.Options.bol_hideChecked?($("#chnBar_"+e).hide("fast"),$(".chnSlot_"+e).hide("fast")):($("#chnBar_"+e).show("fast").css({display:t}),$(".chnSlot_"+e).each(function(){$(this).show("fast").css({display:t}),$(this).hasClass("tmlIcon")&&$(this).css({display:"inline-block"})})))},getChainChecklistState:function(e){return X.getChecklistItem(X.Checklists.Chain,e.nexus)},initializePersonalChecklist:function(){T.isChecklistCountdownsStarted=!0,T.updateChecklistCountdowns(),$("#chlDungeon, #chlCustomWeekly").hide();var e=$("#chlCustomTabs button"),t=$("#chlCustom"),n=$("#chlDungeon"),a=$("#chlCustomDaily"),i=$("#chlCustomWeekly"),r=$("#chlCountdownToDaily").hide(),o=$("#chlCountdownToWeekly").hide();$("#chlDungeonButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),t.hide(),n.show().css({opacity:.5}).animate({opacity:1},400),r.show(),o.hide()}),$("#chlCustomDailyButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),n.hide(),t.show(),i.hide(),a.show().css({opacity:.5}).animate({opacity:1},400),r.show(),o.hide()}).trigger("click"),$("#chlCustomWeeklyButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),n.hide(),t.show(),a.hide(),i.show().css({opacity:.5}).animate({opacity:1},400),r.hide(),o.show()}),X.initializeDungeonChecklist(),X.initializeCustomChecklist()},initializeDungeonChecklist:function(){X.initializeChecklist(X.Checklists.Dungeon,$("#chlDungeon input").length),$("#chlDungeon .chlDungeonBar").each(function(){$(this).prepend("<ins class='chl_dungeon chl_"+$(this).data("name").toLowerCase()+"'></ins>")});var e=function(){var e=X.Checklists.Dungeon.money,t=~~(e/E.Exchange.COPPER_IN_GOLD),n=~~(e/E.Exchange.SILVER_IN_GOLD)%E.Exchange.COPPER_IN_SILVER,a=e%E.Exchange.COPPER_IN_SILVER;$("#chlDungeonCalculator_Gold").text(t),$("#chlDungeonCalculator_Silver").text(n),$("#chlDungeonCalculator_Copper").text(a)};$("#chlDungeon input").each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(X.Checklists.Dungeon,t,n),X.styleCheckbox(X.Checklists.Dungeon,t,$(this));var a=$("#chlDungeonCalculator"),i=X.Checklists.Dungeon.money,r=$(this).data("money");switch($(this).data("mode")){case"E":r+=a.data("moneyaddexp")}switch(n){case X.ChecklistEnum.Disabled:X.Checklists.Dungeon.money=i-r;break;case X.ChecklistEnum.Checked:X.Checklists.Dungeon.money=i+r;break;default:X.Checklists.Dungeon.money=i-r
}e()})}),$("#chlDungeon label").each(function(e){$(this).dblclick(function(){var t=$(this).find("input:first-child");t.prop("disabled")===!1?(t.prop("checked")===!0&&X.triggerCheckbox(t,X.ChecklistEnum.Unchecked),t.prop("disabled",!0).prop("checked",!1)):t.prop("disabled",!1),X.setChecklistItem(X.Checklists.Dungeon,e,X.getCheckboxEnumState(t)),X.styleCheckbox(X.Checklists.Dungeon,e,t)})}),$("#chlDungeon input").each(function(e){X.triggerCheckboxEnumState(X.Checklists.Dungeon,e,$(this))}),$("#chlDungeonUncheck").click(function(){X.clearChecklist(X.Checklists.Dungeon,X.ChecklistJob.UncheckTheChecked),$("#chlDungeon input").each(function(e){$(this).prop("checked")===!0&&$(this).trigger("click"),X.styleCheckbox(X.Checklists.Dungeon,e,$(this))})})},initializeCustomChecklist:function(){for(var e=12,t="<li><label><input type='checkbox' />"+I.Symbol.Filler+"</label><input type='text' /></li>",n=0;e>n;n++)$("#chlCustomListDaily").append(t),$("#chlCustomListWeekly").append(t);var a=function(e){for(var t=$(e).attr("data-samples").split(I.cTextDelimiterChar),n=0;n<t.length;n++)$(e+" input[type='text']:eq("+n+")").val(t[n])};a("#chlCustomListDaily"),a("#chlCustomListWeekly");var i=function(e,t,n){var a=$("#chlCustomList"+n+" input:checkbox");X.initializeChecklist(e,a.length),a.each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(e,t,n),X.styleCheckbox(e,t,$(this)),n===X.ChecklistEnum.Checked?$(this).parent().next().addClass("chlCustomTextChecked"):$(this).parent().next().removeClass("chlCustomTextChecked")}),X.triggerCheckboxEnumState(e,t,$(this))}),$("#chlCustomUncheck"+n).click(function(){X.clearChecklist(e,X.ChecklistJob.UncheckTheChecked),$("#chlCustomList"+n+" input:checkbox").each(function(t){$(this).prop("checked")&&$(this).trigger("click"),X.styleCheckbox(e,t,$(this))})});var i=$("#chlCustomList"+n+" input:text"),r=$("#chlCustomRestore"+n);X.initializeTextlist(t,i,"Custom checklist item",48,r)};i(X.Checklists.CustomDaily,X.Textlists.CustomTextDaily,"Daily"),i(X.Checklists.CustomWeekly,X.Textlists.CustomTextWeekly,"Weekly")},clearCustomChecklistDaily:function(){$("#chlDungeonUncheck").trigger("click"),$("#chlCustomUncheckDaily").trigger("click"),X.clearChecklist(X.Checklists.Dungeon,X.ChecklistJob.UncheckTheChecked),X.clearChecklist(X.Checklists.CustomDaily,X.ChecklistJob.UncheckTheChecked)},clearCustomChecklistWeekly:function(){$("#chlCustomUncheckWeekly").trigger("click"),X.clearChecklist(X.Checklists.CustomWeekly,X.ChecklistJob.UncheckTheChecked)},initializeNotepad:function(){$("#chlNotepadButtons button").each(function(e){$(this).click(function(){$("#chlNotepadSheets textarea").hide().eq(e).show().css({opacity:.5}).animate({opacity:1},400),$("#chlNotepadButtons button").removeClass("btnFocused"),$(this).addClass("btnFocused")})}).first().click();var e=$("#chlNotepadSheets textarea"),t=$("#chlNotepadRestore");X.initializeTextlist(X.Textlists.NotepadText,e,"Notepad sheet",4096,t),e.css("height",O.Options.int_sizeNotepadHeight),e.css("font-size",O.Options.int_sizeNotepadFont),e.first().show()}},U={URL_META:{News:"http://forum.renaka.com/topic/5500046/",Overlay:"http://forum.renaka.com/topic/5546166/"},APIKey:null,APIKeyLength:72,ServerIDLength:4,URL_API:{Daily:"https://api.guildwars2.com/v2/achievements/daily",Tomorrow:"https://api.guildwars2.com/v2/achievements/daily/tomorrow",Fractal:"https://api.guildwars2.com/v2/achievements/categories/88",LangKey:"",TilesTyria:"https://tiles.guildwars2.com/1/1/{z}/{x}/{y}.jpg",TilesMists:"https://tiles.guildwars2.com/2/1/{z}/{x}/{y}.jpg",MapFloorTyria:"https://api.guildwars2.com/v1/map_floor.json?continent_id=1&floor=1",MapFloorMists:"https://api.guildwars2.com/v1/map_floor.json?continent_id=2&floor=1",MapsList:"https://api.guildwars2.com/v1/maps.json",EventDetails:"https://api.guildwars2.com/v1/event_details.json",ItemListing:"https://api.guildwars2.com/v2/commerce/listings/",ItemPrices:"https://api.guildwars2.com/v2/commerce/prices/",ItemDatabase:"https://api.guildwars2.com/v2/items",ItemRender:"https://render.guildwars2.com/file/",CoinPrice:"https://api.guildwars2.com/v2/commerce/exchange/gems?quantity=",GemPrice:"https://api.guildwars2.com/v2/commerce/exchange/coins?quantity=",Match:"https://api.guildwars2.com/v2/wvw/matches?world=",Matches:"https://api.guildwars2.com/v2/wvw/matches/",GuildDetails:"https://api.guildwars2.com/v1/guild_details.json?guild_id=",MatchFallback:"https://api.guildwars2.com/v1/wvw/match_details.json?match_id=",MatchesFallback:"https://api.guildwars2.com/v1/wvw/matches.json",Worlds:"https://api.guildwars2.com/v2/worlds",Prefix:"https://api.guildwars2.com/v2/",Prefix1:"https://api.guildwars2.com/v1/",TextToSpeech:"http://code.responsivevoice.org/getvoice.php?tl=",TextToSpeechNative:"bin/tts/mespeak.js"},PageLimit:200,URL_IMG:{Placeholder:"img/ui/placeholder.png",Sector:"img/map/scope.png",Waypoint:"img/map/waypoint.png",WaypointOver:"img/map/waypoint_h.png",Landmark:"img/map/landmark.png",LandmarkOver:"img/map/landmark_h.png",Vista:"img/map/vista.png",Challenge:"img/map/challenge.png",Heart:"img/map/heart.png"},URL_DATA:{Account:"data/account.js",WvW:"data/wvw.js",Itinerary:"data/itinerary.js",Materials:"data/materials.js",Skins:"data/skins.js",Outfits:"data/outfits.js",Dyes:"data/dyes.js",Minis:"data/minis.js",Finishers:"data/finishers.js",Catalog:"data/catalog.js",Cleanup:"data/cleanup.js",Ascended:"data/ascended.js",Recipes:"data/recipes.js",Prices:"cache/prices.js",Unscheduled:"data/chains-add.js",Daily:"data/daily.js",DryTop:"data/drytop.js",Resource:"data/resource.js",JP:"data/jp.js",Collectible:"data/collectible.js",Guild:"data/guild.js"},initializeAPIURLs:function(){var e=D.getPartiallySupportedLanguage();U.URL_API.LangKey="?lang="+e;var t="&lang="+e;U.URL_API.Worlds+=U.URL_API.LangKey+"&ids=",U.URL_API.MapFloorTyria+=t,U.URL_API.MapFloorMists+=t,U.URL_API.TextToSpeech+=e+"&sv=&vn=&pitch=0.5&rate=0.4"},fetchPaginated:function(e,t){var n,a=t||{},i=50,r=0,o=e+"&page_size="+U.PageLimit,s=void 0!==a.aWantCache?a.aWantCache:!1,c=[],l=[],u=function(){r===n&&(c.forEach(function(e){e&&(l=l.concat(e))}),a.aCallback(l))};$.ajax({dataType:"json",url:o,cache:s,success:function(e,t,d){if(r++,n=parseInt(d.getResponseHeader("X-Page-Total")),n>i){for(var p=[],h=1;n>h;h++)p.push(h);Z.scrapeAPIArray(p,o+"&page=",{aIsStandard:!1,aCooldown:60,aCallback:function(t){l=l.concat(e),t.forEach(function(e){l=l.concat(e)}),a.aCallback(l)}})}else if(n>1){c=Array(n),c[0]=e;for(var h=1;n>h;h++)!function(e){$.ajax({dataType:"json",url:o+"&page="+e,cache:s,success:function(t){c[e]=t,r++,u()},error:function(){n--,u()}})}(h)}else 1===n?(c[0]=e,u()):a.aCallback(null)},error:function(e,t){a.aError?a.aError():a.aPermission&&A.printError(a.aPermission,t)}})},getDivider:function(e){return-1!==e.indexOf("?")?"&":"?"},getAPI:function(e,t){var n=void 0===t?"":"/"+t,a=U.URL_API.Prefix+e+n,i=-1!==a.indexOf("?")?U.URL_API.LangKey.replace("?","&"):U.URL_API.LangKey;return a+i},getAPIAchievement:function(e){return U.getAPI("achievements",e)},getAPIItem:function(e){return U.getAPI("items",e)},getAPISkin:function(e){return U.getAPI("skins",e)},getAPIRecipe:function(e){return U.getAPI("recipes",e)},getAPIMaterial:function(e){return U.getAPI("materials",e)},getAPIMini:function(e){return U.getAPI("minis",e)},getAPISkill:function(e){return U.getAPI("skills",e)},getAPITrait:function(e){return U.getAPI("traits",e)},getAPISpecialization:function(e){return U.getAPI("specializations",e)},getAPIPrice:function(e){return U.URL_API.ItemPrices+e},getAPIListings:function(e){return U.URL_API.ItemListing+e},getDatabaseURL:function(e,t){return"test/"+e+"_"+t+I.cJSON},getItemsDatabaseURL:function(e){return"test/items_"+e+I.cJSON},getDataScriptURL:function(e){return"data/"+e.toLowerCase()+".js"},getRecordHeader:function(e){return window["GW2T_"+e.toUpperCase()+"_HEADERS"]},getRecordMetadata:function(e){return window["GW2T_"+e.toUpperCase()+"_METADATA"]},getRecordBlacklist:function(e){return window["GW2T_"+e.toUpperCase()+"_BLACKLIST"]},getRecordData:function(e){return window["GW2T_"+e.toUpperCase()+"_DATA"]},Args:{},KeyEnum:{Page:"page",Section:"section",Article:"article",Mode:"mode",Go:"go",Draw:"draw",Fragment:"fragment"},TypeEnum:{isObject:"obj",isAssoc:"asc",isArray:"arr",isString:"str",isEnum:"enu",isInteger:"int",isFloat:"flt",isBoolean:"bol"},CaseEnum:{Original:-1,None:0,Lower:1,Sentence:2,Title:3,Every:4,All:5},isEnumWithin:function(e,t){for(var n in t)if(t[n].toLowerCase()===e.toLowerCase())return!0;return!1},getURLArguments:function(){var e=window.location,t=e.search.substr(1).split("&");if(""===t)return{};for(var n={},a=0;a<t.length;++a){var i=t[a].split("=");2===i.length&&(n[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")))}return e.hash.length&&(n[U.KeyEnum.Fragment]=e.hash.substr(1)),n},enforceURLArgumentsFirst:function(){U.Args=U.getURLArguments(),I.ArticleCurrent=U.Args[U.KeyEnum.Article],U.Args[U.KeyEnum.Article]=null,U.enforceURLArgumentsSpecial();var e,t=U.Args[U.KeyEnum.Mode];if(t)for(e in I.ModeEnum)if(I.ModeEnum[e].toLowerCase()===t.toLowerCase()){I.ModeCurrent=I.ModeEnum[e];break}null===I.ModeCurrent&&(I.ModeCurrent=I.ModeEnum.Website)},enforceURLArgumentsLast:function(){U.openPageFromURL()},enforceURLArgumentsSpecial:function(){var e,t,n,a=function(e){$("body").hide(),document.location=e},i=U.Args[U.KeyEnum.Page],r=U.Args[U.KeyEnum.Fragment];if(r&&r.length===U.APIKeyLength&&(U.APIKey=U.stripToAlphanumericDash(r).toUpperCase(),void 0===i&&(U.Args[U.KeyEnum.Page]=I.SpecialPageEnum.Account)),i)if(i=i.toLowerCase(),"a"===i)U.Args[U.KeyEnum.Page]=I.SpecialPageEnum.Account;else if("audit"===i)U.Args[U.KeyEnum.Page]=I.SpecialPageEnum.Account,U.Args[U.KeyEnum.Section]=I.SectionEnum.Account.Characters,I.ArticleCurrent=I.SpecialPageEnum.Audit;else if(U.isEnumWithin(i,I.PageEnum)===!1)if("navi"===i||"overlay"===i)a(U.URL_META.Overlay);else if("m"===i||"mobile"===i)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Mobile;else if("s"===i||"simple"===i)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Simple;else if("t"===i||"tile"===i)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Tile;else{for(e in I.SectionEnum){n=I.SectionEnum[e];for(t in n)if(t.toLowerCase()===i)return void 0!==U.Args[U.KeyEnum.Section]&&(I.ArticleCurrent=U.Args[U.KeyEnum.Section]),U.Args[U.KeyEnum.Page]=e,void(U.Args[U.KeyEnum.Section]=t)}for(e in M.Zones)if(-1!==i.indexOf(e))return void(U.Args[U.KeyEnum.Go]=e);if(isNaN(i)===!1&&i.length===U.ServerIDLength)for(var e in O.OptionEnum.Server)if(O.OptionEnum.Server[e]===i)return U.Args.enu_Server=i,void(U.Args[U.KeyEnum.Page]=I.SpecialPageEnum.WvW)}void 0!==U.Args[U.KeyEnum.Page]&&(I.PageInitial=U.Args[U.KeyEnum.Page].toLowerCase());for(e in X.Collectibles)if(n=X.Collectibles[e].urlkey,n===i||void 0!==U.Args[n])return U.Args[U.KeyEnum.Page]=I.PageEnum.Map,U.Args[U.KeyEnum.Section]=I.SectionEnum.Map.Collectible,void(I.ArticleCurrent=n)},verifyArticle:function(e,t){return I.ArticleCurrent&&I.ArticleCurrent.toLowerCase()===e.toLowerCase()?(I.ArticleCurrent=null,t&&t(),!0):void 0},sanitizeURLOptionsValue:function(e,t){var n=e.substring(0,O.cLengthOfPrefixes),a=t.toLowerCase();switch(n){case U.TypeEnum.isBoolean:return"true"===a||"false"===a?a:""+O.Options[e];case U.TypeEnum.isInteger:if(isFinite(a)){var i=parseInt(a);if(i>=O.OptionRange[e][0]&&i<=O.OptionRange[e][1])return""+i}return""+O.Options[e];case U.TypeEnum.isFloat:if(isFinite(a)){var r=parseFloat(a);if(r>=O.OptionRange[e][0]&&r<=O.OptionRange[e][1])return""+r}return""+O.Options[e];case U.TypeEnum.isEnum:return O.validateEnum(e,t);case U.TypeEnum.isString:return U.escapeHTML(t)}return"null"},sortObjects:function(e,t){var n=t||{},a=n.aKeyName?n.aKeyName:D.getNameKey();e.sort(n.aIsDescending?function(e,t){var i=n.aIsNumbers&&"string"==typeof e[a]?U.stripToNumbers(e[a]):e[a],r=n.aIsNumbers&&"string"==typeof t[a]?U.stripToNumbers(t[a]):t[a];return r>i?1:i>r?-1:0}:function(e,t){var i=n.aIsNumbers&&"string"==typeof e[a]?U.stripToNumbers(e[a]):e[a],r=n.aIsNumbers&&"string"==typeof t[a]?U.stripToNumbers(t[a]):t[a];return i>r?1:r>i?-1:0})},sortAscending:function(e){e.sort(function(e,t){return e-t})},sortDescending:function(e){e.sort(function(e,t){return t-e})},convertArrayToAssoc:function(e,t){for(var n,a={},i=t||"id",r=0;r<e.length;r++)n=e[r],a[n[i]]=n;return a},convertAssocToArray:function(e){var t=[];for(var n in e)t.push(n);return t},getExistAssoc:function(e){for(var t,n={},a=0;a<e.length;a++)t=e[a],n[t]=!0;return n},getDifference:function(e,t){return e.concat(t).filter(function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})},getUnique:function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},getUnion:function(e,t){return U.getUnique(e.concat(t))},getObjectLength:function(e){var t=0;for(var n in e)t++;return t},intToBool:function(e){return e>0?!0:!1},boolToInt:function(e){return e?1:0},stringToBool:function(e){return"true"===e.toLowerCase()?!0:!1},boolToString:function(e){return e?"true":"false"},randomBool:function(){return Math.random()>.5?!0:!1},isInteger:function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},objToBool:function(e){return e?!0:!1},convertRGBToHex:function(e){for(var t,n="",a=0;a<e.length;a++)t=parseInt(e[a]),n+=(t<T.cBASE_16?"0":"")+t.toString(T.cBASE_16);return"#"+n},convertHexToRGB:function(e){var t="string"==typeof e&&"#"===e.charAt(0)?e.substring(1,e.length):e,n=parseInt(t,16),a=n>>16&255,i=n>>8&255,r=255&n;return[a,i,r]},convertRGBToHSL:function(e){var t,n,a=e[0]/255,i=e[1]/255,r=e[2]/255,o=Math.max(a,i,r),s=Math.min(a,i,r),c=(o+s)/2;if(o===s)t=n=0;else{var l=o-s;switch(n=c>.5?l/(2-o-s):l/(o+s),o){case a:t=(i-r)/l+(r>i?6:0);break;case i:t=(r-a)/l+2;break;case r:t=(a-i)/l+4}t/=6}return[360*t,100*n,100*c]},sortRGBs:function(e){for(var t=[],n=[],a=[],i=0;i<e.length;i++)a[i]=[U.convertRGBToHSL(e[i]),i],t.push(i);for(var r=[],i=0;i<a.length;i++){for(var o=!1,s=0;s<r.length;s++)if(r[s][0][0]>a[i][0][0]){r.splice(s,0,a[i]),n.splice(s,0,i),o=!0;break}o||(r.push(a[i]),n.push(i))}for(var c=[],i=0;i<r.length;i++)c[i]=e[r[i][1]];return{oRGBs:c,oIndexes:n}},convertRatioToPercent:function(e,t){if(void 0===e||isFinite(e)===!1)return"0%";void 0===t&&(t=0);var n=0>e?"−":"";return n+Math.abs(100*e).toFixed(t)+"%"},formatPercentage:function(e,t,n){return e===parseInt(e)?void 0!==n?e.toFixed(n).toLocaleString()+"%":e.toLocaleString()+"%":e.toFixed(void 0===t?2:t).toLocaleString()+"%"},formatJSON:function(e){return JSON.stringify(e,null,"	")},escapeJSON:function(e){return U.escapeHTML(U.formatJSON(e))},lineJSON:function(e,t){var n=JSON.stringify(e,null,1);return t===!1&&(n=U.stripJSONQuotations(n)),n.replace(/[\r\n]/g,"").replace(/  +/g," ").replace(/ }/g,"}").replace(/{ /g,"{").replace(/ \]/g,"]").replace(/\[ /g,"[")},compressToJS:function(e){return U.stripJSONQuotations(JSON.stringify(e))},stripToAlphanumeric:function(e){return e.replace(/\W/g,"")},stripToAlphanumericDash:function(e){return e.replace(/[^a-zA-Z0-9\-]/g,"")},stripToNumbers:function(e){return parseInt(e.replace(/[^0-9]/g,""))},stripToColorString:function(e){return e.replace(/[^a-zA-Z0-9#]/g,"")},stripToVariable:function(e){return e.replace(/ /g,"_").replace(/[0-9\u0021-\u002f\u003a-\u0040\u005b-\u005e\u0060\u007b-\u007e]/g,"")},stripJSONQuotations:function(e){return e.replace(/\"([^(\")"]+)\":/g,"$1:")},stripToSentence:function(e){return e.replace(/[^\w\s\'\"\:\,]/gi,"")},stripToCalculation:function(e){return e.replace(/[^0-9.()\-+/*]/gi,"")},toFirstUpperCase:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},toCase:function(e,t){var n,a=[];if(void 0===t||t===U.CaseEnum.None)return e;switch((t===U.CaseEnum.Title||t===U.CaseEnum.Every)&&(a=e.split(" ")),t){case U.CaseEnum.Lower:return e.toLowerCase();case U.CaseEnum.Sentence:return U.toFirstUpperCase(e);case U.CaseEnum.Title:if(a.length>1){for(a[0]=U.toFirstUpperCase(a[0]),n=1;n<a.length;n++)2!==a[n].length&&(a[n]=U.toFirstUpperCase(a[n]));return a.join(" ")}return U.toFirstUpperCase(e);case U.CaseEnum.Every:if(a.length>1){for(n in a)a[n]=U.toFirstUpperCase(a[n]);return a.join(" ")}return U.toFirstUpperCase(e);case U.CaseEnum.All:return e.toUpperCase()}return e},truncateString:function(e,t,n){return n=n||"",e.length>t?e.substring(0,t)+n:e},highlightSubstring:function(e,t,n){for(var a,i=n||"u",r=e.replace(/{{|}}/g,""),o=t.split(" "),s=0;s<o.length;s++)a=o[s],a.length&&(r=r.replace(RegExp(U.escapeRegEx(a),"gi"),"{{$&}}"));return r=r.replace(/{{/g,"<"+i+">"),r=r.replace(/}}/g,"</"+i+">")},escapeHTML:function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):void 0===e?"undefined":"null"},escapeRegEx:function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},replaceCharAt:function(e,t,n){return e.substr(0,t)+n+e.substr(t+n.length)},repeatChar:function(e,t){return Array(t+1).join(e)},countOccurrence:function(e,t){return e.split(t).length-1},updateAddressBar:function(e){history.replaceState("",null,e),K.reapplyFilters()},updateQueryString:function(e){if(""!==I.PageCurrent){var t=I.SectionCurrent[I.PageCurrent],n=I.ArticleCurrent,a=U.Args[U.KeyEnum.Go],i="?"+U.KeyEnum.Page+"="+I.PageCurrent,r="",o="",s="",c="";e=void 0===e?"":"&"+e;var l=I.PageCurrent;I.ModeCurrent!==I.ModeEnum.Website&&(c="&mode="+I.ModeCurrent),t&&(r="&"+U.KeyEnum.Section+"="+t,l=t),n&&(o="&"+U.KeyEnum.Article+"="+n),a&&(s="&"+U.KeyEnum.Go+"="+a),U.updateAddressBar(i+r+o+s+c+e),U.updateTitle(l),U.updateLanguageLinks(i+r+c)}},updateTitle:function(e){document.title=I.cSiteName+"/"+e},updateLanguageLinks:function(e){$(".linkLanguage").each(function(){var t=$(this).attr("data-lang"),n="";n=void 0===e?I.ModeCurrent===I.ModeEnum.Website?"?enu_Language="+t:"?enu_Language="+t+"&mode="+I.ModeCurrent:e+"&enu_Language="+t,$(this).attr("href","./"+n)})},openSectionFromURL:function(e){var t=$.extend({aPrefix:I.cHeaderPrefix+I.PageCurrent+"_",aSection:null,aInitialSection:null,aButton:null},e);setTimeout(function(){var e=U.Args[U.KeyEnum.Section]?""+U.Args[U.KeyEnum.Section]:null;if(e){U.Args[U.KeyEnum.Section]=null,e=U.stripToAlphanumeric(e);var n=$(null);"string"==typeof t.aButton?void 0!==t.aSection&&t.aSection.toLowerCase()===e.toLowerCase()&&(n=$(t.aButton)):(n=$(t.aPrefix+U.toFirstUpperCase(e)),n.length||(n=$(t.aPrefix+e.toUpperCase())),I.PageCurrent===I.PageEnum.Chains&&$("#headerChains_Scheduled").trigger("click")),n.trigger("click")}else"string"==typeof t.aInitialSection&&$(t.aPrefix+t.aInitialSection).trigger("click")},0)},openPageFromURL:function(){if(void 0!==U.Args[U.KeyEnum.Page]){var e=U.stripToAlphanumeric(U.Args[U.KeyEnum.Page]);for(var t in I.PageEnum)if(e.toLowerCase()===I.PageEnum[t].toLowerCase())return void $(I.cMenuPrefix+I.PageEnum[t]).trigger("click");switch(e=e.toLowerCase()){case"account":$("#mapAccountButton").trigger("click");break;case"wvw":$("#mapSwitchButton").trigger("click")}}},convertExternalLink:function(e){$(e).each(function(){$(this).attr("href",I.cSiteURL+"out/?u="+U.encodeURL($(this).attr("href"))).attr("target","_blank")})},convertExternalURL:function(e){return I.cSiteURL+"out/?u="+U.encodeURL(e)},convertExternalAnchor:function(e){return" href='"+I.cSiteURL+"out/?u="+U.encodeURL(e)+"' target='_blank' "},convertPrivateAnchor:function(e){return" href='"+e+"' target='_blank' "},convertExternalString:function(e){return e.replace(/href='/g,"target='_blank' href='"+I.cSiteURL+"out/?u=")},openExternalURL:function(e){window.open(I.cSiteURL+"out/?u="+U.encodeURL(e),"_blank")},openPrivateURL:function(e){window.open(e,"_blank")},getVariableSuffix:function(e){var t=e.indexOf("_");return e.substring(t+1,e.length)},getVariablePrefix:function(e){var t=e.indexOf("_");return e.substring(0,t)},getSubstringFromHTMLID:function(e){return U.getVariableSuffix(e.attr("id"))},getSubintegerFromHTMLID:function(e){return parseInt(U.getVariableSuffix(e.attr("id")))},getPageSrc:function(e){return"page/"+e.toLowerCase()+".html"},encodeURL:function(e){return encodeURI(e).replace(/'/g,"%27")},getWikiLinkDefault:function(e){return e=e.replace(/ /g,"_"),"http://wiki.guildwars2.com/wiki/"+U.encodeURL(e)},getWikiLinkLanguage:function(e){return e=e.replace(/ /g,"_"),"http://wiki-"+D.getFullySupportedLanguage()+".guildwars2.com/wiki/"+U.encodeURL(e)},getWikiSearchDefault:function(e){return e=e.replace(/ /g,"+"),"http://wiki.guildwars2.com/index.php?title=Special%3ASearch&search="+U.encodeURL(e)},getWikiSearchLanguage:function(e){return e=e.replace(/ /g,"_"),"http://wiki-"+D.getFullySupportedLanguage()+".guildwars2.com/index.php?title=Special%3ASearch&search="+U.encodeURL(e)},getWikiItemDefault:function(e){return D.isLanguageFullySupported()===!0&&D.isLanguageDefault()===!1?U.getWikiSearchDefault(""+e.id):U.getWikiLinkDefault(e.name)},getGW2OfficialLink:function(e){return"https://www.guildwars2.com/"+D.getFullySupportedLanguage()+"/"+e},getYouTubeLink:function(e){return"http://www.youtube.com/results?search_query="+U.encodeURL(e+" "+I.cGameNick)},getTradingSearchLink:function(e){return"https://www.gw2tp.com/search?name="+U.encodeURL(e)},getTradingItemLink:function(e,t){return"http://www.gw2spidy.com/item/"+U.encodeURL(e)+"?name="+U.stripToSentence(t).replace(/ /g,"_")},getGuildBannerURL:function(e){if(e){var t=U.escapeHTML(e.split(" ").join("-").toLowerCase());return"http://guilds.gw2w2w.com/guilds/"+t+"/128.svg"}return"img/ui/placeholder.png"},getChatlinkFromPoiID:function(e){for(var t=String.fromCharCode(4),n=0;4>n;n++)t+=String.fromCharCode(e>>8*n&255);return I.cChatcodePrefix+btoa(t)+I.cChatcodeSuffix},getChatlinkFromItemID:function(e){var t="";try{t=I.cChatcodePrefix+btoa(String.fromCharCode(2)+String.fromCharCode(1)+String.fromCharCode(e%256)+String.fromCharCode(Math.floor(e/256))+String.fromCharCode(0)+String.fromCharCode(0))+I.cChatcodeSuffix}catch(n){}return t},getGameIDFromChatlink:function(e,t){var n=function(e){for(var t=window.atob(e),n=Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n},a=null;"string"==typeof e&&0===e.indexOf(I.cChatcodePrefix)&&e.indexOf(I.cChatcodeSuffix===e.length-1)&&(e=e.substring(2,e.length-1));try{var i=n(e),a=i[2]<<8|i[1],r=null;switch(i[0]){case 2:r="item",a=i[3]<<8|i[2],a=(i.length>4?i[4]<<16:0)|a;break;case 4:r="location";break;case 6:r="skill";break;case 8:r="trait";break;case 9:r="recipe";break;case 10:r="skin";break;case 11:r="outfit"}}catch(o){I.write("Invalid chatlink to decode.")}return void 0===t?a:a+" ("+r+")"}},Z={cCommandPrefix:"/",APICacheFiles:[],APICacheArrayOfIDs:null,APICacheArrayOfObjects:null,APICacheConsole:null,DatabaseCache:{},DatabaseLanguages:["en","de","es","fr","zh"],loadAPICache:function(){var e=localStorage[O.Utilities.APICache.key];if(e)try{return Z.APICacheConsole=JSON.parse(e),!0}catch(t){I.print("Error loading API cache object.")}return!1},saveAPICache:function(){return Z.APICacheConsole?(localStorage[O.Utilities.APICache.key]=JSON.stringify(Z.APICacheConsole),!0):(I.print("Error saving cache object."),!1)},interpretCommand:function(e,t,n,a){0===e.indexOf(Z.cCommandPrefix)?Z.parseCommand(e,t):0===e.indexOf(I.cChatcodePrefix)?I.print(U.getGameIDFromChatlink(e,!0)):t.parsePersonalPath(e)===!1&&t.goToArguments(e,n,a)},parseCommand:function(e,t){var n=t||M,a=e.substring(1,e.length).split(" "),i=e.substring(e.indexOf(" ")+1,e.length),r=a[0].toLowerCase(),o={clear:{usage:"Clears the console screen.",f:function(){I.clear()}},speak:{usage:"Speaks the given text. <em>Parameters: str_text</em>",f:function(){D.speak(i)}},gps:{usage:"Prints GPS location information (overlay only).",f:function(){I.print("Position: "+U.formatJSON(GPSPositionArray)+"<br />Direction: "+U.formatJSON(GPSDirectionArray)+"<br />Camera: "+U.formatJSON(GPSCameraArray))}},identity:{usage:"Prints GPS general information (overlay only).",f:function(){I.prettyJSON(GPSIdentityJSON)}},agent:{usage:"Prints browser's navigator object.",f:function(){var e,t,n="";for(var a in window.navigator)e=window.navigator[a],t="string"==typeof e||"number"==typeof e?e:U.formatJSON(e),n+=U.escapeHTML(a+": "+t)+"<br />";I.print(n)}},lock:{usage:"Map cannot be moved.",f:function(){n.Map.dragging.disable(),n.Map.scrollWheelZoom.disable(),I.write("Map locked.")}},unlock:{usage:"Map can be moved.",f:function(){n.Map.dragging.enable(),n.Map.scrollWheelZoom.enable(),I.write("Map unlocked.")}},nct:{usage:"Disables the map's context menu.",f:function(){n.Map.off("contextmenu"),I.write("Map context menu disabled.")}},link:{usage:"Prints a coordinates URL of the current map view.",f:function(){I.print(I.cSiteURL+n.convertLCtoGC(n.Map.getCenter()),!0)}},dart:{usage:"Draws personal pins at random map coordinates. <em>Parameters: int_quantity</em>",f:function(){n.drawRandom(a[1])}},nodes:{usage:"Sorts and prints a list coordinates. <em>Parameters: arr_coordinates</em>",f:function(){P.printNodes(P.sortCoordinates(M.parseCoordinatesMulti(a[1])))}},needles:{usage:"Numbers and prints a list of coordinates. <em>Parameters: arr_coordinates</em>",f:function(){P.printNodes(M.parseCoordinatesMulti(a[1]),!0)}},latlngs:{usage:"Converts an array of LatLng's to standard coordinates. <em>Parameters: arr_latlngs</em>",f:function(){n.convertLatLngs(JSON.parse(i))}},jsonparse:{usage:"Converts a JSON string into an object for testing. <em>Parameters: str_json</em>",f:function(){try{Z.APICacheConsole=JSON.parse(i),I.print("Parse JSON successful.")}catch(e){I.print("Parse JSON failed.")}}},api:{usage:"Prints the output of an API URL &quot;"+U.URL_API.Prefix+"&quot;. <em>Parameters: str_apiurlsuffix, int_limit (optional), str_querystring (optional)</em>",f:function(){Z.printAPI(a[1],a[2],a[3])}},apicache:{usage:"Prints the cache of the previous console API call as an associative array. <em>Parameters: bol_wantoutputasfile (optional)</em>",f:function(){Z.printAPICache(U.TypeEnum.isAssoc,{aFileName:"true"===a[1]})}},apicachearray:{usage:"...as an array.",f:function(){Z.printAPICache(U.TypeEnum.isArray,!1)}},apicacheobject:{usage:"...as an object.",f:function(){Z.printAPICache(U.TypeEnum.isObject,!1)}},apicacheids:{usage:"...as IDs.",f:function(){Z.printAPICache(U.TypeEnum.isInteger,!1)}},acc:{usage:"Prints the output of an account API URL &quot;"+U.URL_API.Prefix+"&quot;. Token must be initialized from the account page. <em>Parameters: str_apiurlsuffix</em>. Type &quot;acc&quot; alone to see list of URL suffixes. Please replace spaces in character's name with &quot;%20&quot;",f:function(){A.printAccount(a[1])}},daily:{usage:"Prints today's and tomorrow's daily achievements.",f:function(){Z.printDaily()}},item:{usage:"Prints an item's information. <em>Parameters: int_itemid</em>",f:function(){Z.scrapeAPIArrayMultilingual([parseInt(a[1])],"items",function(e){I.clear();for(var t in e)for(var n in e[t])Q.printItemInfo(e[t][n],!1)})}},items:{usage:"Prints the highest numbered item IDs in the API. <em>Parameters: int_offset</em>",f:function(){Z.printItemsAPI(a[1])}},events:{usage:"Prints the event names of the current zone, dynamic events option must be enabled.",f:function(){P.printZoneEvents()}},help:{usage:"Prints this help message.",f:function(){I.write("Available console commands:<br />");var e="";for(var t in o)e+="<b>"+t+"</b> - "+o[t].usage+"<br />";e+="<br />The console also accepts: coordinates, array of coordinates, zone names, and chatcodes.<br />",I.print(e)}},test:{usage:"Test function for debugging.",f:function(){}},updatedb:{usage:"Prints an updated database of items.",f:function(){Z.updateItemsDatabase()}},updatesubdb:{usage:"Prints an updated subset database of items used by an account page's section. <em>Parameters: str_section</em>",f:function(){Z.updateItemsSubdatabase(a[1])}},collate:{usage:"Executes a function to update and categorize an unlockables record. <em>Parameters: str_section</em>",f:function(){Z.executeCollate(a[1])}}};void 0!==o[r]&&o[r].f()},createFile:function(e,t){var n=new Blob([e],{type:"text/plain;charset=UTF-8"}),a=window.URL.createObjectURL(n);Z.APICacheFiles.push(a);var i=t||"",r=t?"<input class='cslFilename cssInputText' type='text' value='"+t+"' /> ":"";return I.print(r+"<a href='"+a+"' download='"+i+"'>"+a+"</a>"),a},freeFiles:function(){for(var e=0;e<Z.APICacheFiles.length;e++)Z.APICacheFiles[e]&&window.URL.revokeObjectURL(Z.APICacheFiles[e]);Z.APICacheFiles=null,Z.APICacheFiles=[]},printAPI:function(e,t,n){I.print("Gathering elements...");var a="v1",i=Number.POSITIVE_INFINITY,r=null,o=256,s=void 0===n?"":n,c=0,l=U.URL_API.Prefix+e,u=function(){I.clear(),Z.APICacheArrayOfObjects.length>0&&Z.APICacheArrayOfObjects[0].id&&U.sortObjects(Z.APICacheArrayOfObjects,{aKeyName:"id",aIsNumbers:!0}),Z.printAPICache(U.TypeEnum.isArray)},d=function(e){var t="string"==typeof e?JSON.parse(e):e;t.icon&&I.print("<img class='cssRight' src='"+U.escapeHTML(t.icon)+"' />")},p=function(t){var n=void 0===t.length?0:t.length;if(Array.isArray(t))if(n>o)I.print("Array is too big for one simultaneous request, requesting in batches with wait in between..."),Z.scrapeAPIArray(t,e,{aQueryStr:s});else{I.print("Retrieved array:<br />"+U.escapeJSON(t)),Z.APICacheArrayOfIDs=t,Z.APICacheArrayOfObjects=[];for(var a=n,r=0;n>r&&r!==i;r++)!function(e){$.getJSON(l+"/"+t[e]+s,function(t){I.print("Retrieved an element: "+e),Z.APICacheArrayOfObjects.push(t)}).done(function(){(c===a-1||c===i-1)&&u(),c++}).fail(function(){a--,(c===a-1||c===i-1)&&u(),I.print("Unable to retrieve API array element at: "+U.escapeHTML(l+"/"+t[e]))})}(r)}else d(t),I.prettyJSON(t)};if(void 0!==t&&e!==a)if(U.isInteger(t))i=t;else if("string"==typeof t&&"["===t.charAt(0))try{r=JSON.parse(t),Array.isArray(r)&&p(r)}catch(h){I.print("Error parsing custom array.")}else s=t;e===a&&(l=U.URL_API.Prefix1+t),r||$.get(l+s,function(e){p(e)}).fail(function(){I.print("Unable to retrieve API at: "+U.escapeHTML(l))})},printAPICache:function(e,t){var n,a=t||{},i="",r=void 0!==a.aFileName&&a.aFileName!==!1,o=void 0===a.aWantQuotes?r:a.aWantQuotes,s=a.aCustomCache||Z.APICacheArrayOfObjects,c=e;if(void 0===c||c===U.TypeEnum.isAssoc||c===U.TypeEnum.isArray)if(s){var l,u=s.length,d=r?"\r\n":"<br />",p=r?'"':"&quot;";i+=(c===U.TypeEnum.isAssoc?"{":"[")+d;for(var h=0;u>h;h++)n=s[h],l=n.icon&&!r?"<img src='"+n.icon+"' />":"",i+=l+(c===U.TypeEnum.isAssoc?p+n.id+p+": ":"")+U.lineJSON(n,o)+(h===u-1?"":",")+d;i+=c===U.TypeEnum.isAssoc?"}":"]"}else i="API Objects Array is empty.";else c===U.TypeEnum.isObject?i=s?r?U.lineJSON(s):U.escapeJSON(s):"API Objects Array is empty.":c===U.TypeEnum.isInteger&&(i=Z.APICacheArrayOfIDs?r?U.lineJSON(Z.APICacheArrayOfIDs):U.escapeJSON(Z.APICacheArrayOfIDs):"API IDs Array is empty.");r?Z.createFile(i,"string"==typeof a.aFileName?a.aFileName:"apicache"):I.print(i)},printUnlockables:function(e,t){var n,a,i="",r=U.getObjectLength(e),o=0;for(var s in e){if(n=e[s],a=n.length,t)i+=s+": ["+n+"]";else{i+=s+": [\r\n";for(var c=0;a>c;c++)i+="	"+U.lineJSON(n[c],!1)+(c===a-1?"":",")+"\r\n";i+="]"}i+=(o===r-1?"":",")+"\r\n",o++}Z.createFile(i)},printItemsAPI:function(e){if(U.isInteger(e)===!1)return void I.write("Invalid reverse index.");if(I.write("Retrieving items..."),e=parseInt(e),0===E.ItemsArray.length)$.get(U.URL_API.ItemDatabase,function(e){E.ItemsArray=e}).done(function(){Z.printItemsAPI(e)}).fail(function(){I.write("Unable to retrieve API items database.")});else{var t=0,n=0;if(0<e){I.clear();for(var a=0;e>a;a++)n=E.ItemsArray.length-e-1-a,t=E.ItemsArray[n],Q.getItem(t,function(e){I.print("<img class='cssLeft' src='"+e.icon+"' />"+U.escapeJSON(e))}).fail(function(){I.write("Unable to retrieve item: "+n)})}else n=E.ItemsArray.length+e-1,t=E.ItemsArray[n],Q.getItem(t,function(e){I.print("<img class='cssLeft' src='"+e.icon+"' />"+U.escapeJSON(e))}).fail(function(){I.write("Unable to retrieve item: "+n)})}},scrapeAPIArray:function(e,t,n){var a=n||{},i=a.aQueryStr||"",r=a.aIsStandard===!1?"":"/",o=a.aIsStandard===!1?"":U.URL_API.Prefix,s=[],c=[],l=[],u=0,d=3,p=500,h=(a.aCooldown||30)*T.cMSECONDS_IN_SECOND,g=0,m=0,f=a.aCacheArray||Array(e.length);if(0===e.length)return void a.aCallback(null,null);var C=function(){if(A.setProgressBar(m,g),m===g)if(I.print(c.length>0?"WARNING - Failed to retrieve some IDs: "+c:"All IDs successfully retrieved."),0!==a.aRetryCount&&c.length>0){var e=(a.aRetryCount||d)-1;
I.print("Retrying "+e+" times to fetch failed IDs..."),Z.scrapeAPIArray(c,t,{aRetryCount:e,aCacheArray:f,aFailedIndexes:l,aIsStandard:a.aIsStandard,aWantSort:a.aWantSort,aCooldown:a.aCooldown,aIterator:a.aIterator,aCallback:a.aCallback})}else f.length>0&&f[0].id&&a.aWantSort!==!1&&U.sortObjects(f,{aKeyName:"id",aIsNumbers:!0}),Z.APICacheArrayOfObjects=f,a.aCallback?a.aCallback(f,c):I.print("Scrape completed. Enter /apicache to print the results.")},v=function(){for(var e=0,t=u;t<s.length;t++){if(e===p)return void S();b(s[t],a.aFailedIndexes?a.aFailedIndexes[u]:u),u++,e++}},b=function(e,n){$.getJSON(o+t+r+e+i,function(e){f[n]=e,a.aIterator&&a.aIterator(e),m++,C()}).fail(function(){c.push(e),l.push(n),g--,C()})},S=function(){var e=U.convertRatioToPercent(u/s.length),t=Math.ceil((s.length-u)/p)*~~(h/T.cMSECONDS_IN_SECOND);I.print(D.getWordCapital("cooldown")+"... "+u+" / "+s.length+" ("+e+") "+T.formatTimeLetter(t,!0)+" "+D.getWord("remaining")+"."),setTimeout(function(){v()},h)};void 0===a.aRetryCount&&(Z.APICacheArrayOfIDs=e,Z.APICacheArrayOfObjects=[]),s=e,g=s.length,v()},scrapeAPIArrayMultilingual:function(e,t,n,a){var i=a||{};Z.DatabaseCache[t]={};var r=Z.DatabaseCache[t],o=0,s=function(){o<Z.DatabaseLanguages.length?(!function(n){i.aQueryStr="?lang="+n,i.aCallback=function(e){r[n]={},e.forEach(function(e){r[n][e.id]=e}),s()},Z.scrapeAPIArray(e,t,i)}(Z.DatabaseLanguages[o]),o++):n(r)};e?s():$.getJSON(U.getAPI(t),function(t){e=t,s()})},fetchAPIMultilingual:function(e,t){var n={},a=0,i=Z.DatabaseLanguages.length,r=function(){i>a?(!function(t){var o=e+U.getDivider(e)+"lang="+t;$.getJSON(o,function(e){n[t]=e,r(),A.setProgressBar(a,i)}).fail(function(){I.print("Error retrieving "+U.escapeHTML(o)+". Fetch aborted.")})}(Z.DatabaseLanguages[a]),a++):t(n)};r()},processDye:function(e,t){for(var n=Z.DatabaseCache.items[O.OptionEnum.Language.Default],a=n[e.item],i=["cloth","leather","metal"],r=[],o=0;o<i.length;o++){var s=i[o];r.push(U.convertRGBToHex(e[s].rgb))}var c={};return c.u=e.id,e.item?(c.i=e.item,c.n=a.name):c.n=e.name,c.c=r,c.h=e.categories[0],c.m=e.categories[1],c.l=a.chat_link,Z.DatabaseLanguages.forEach(function(n){c[n]=t[n][e.id].name}),c},printDaily:function(e){var t=0,n=0,a={},i=function(){if(n===t){void 0===e&&I.print("TODAY'S DAILIES");for(var i in a){I.print(i);for(var r in a[i]){var o=a[i][r];I.prettyJSON(o)}}void 0===e&&(I.print("<br />"),I.print("TOMORROW'S DAILIES"),Z.printDaily(!0))}},r=e?U.URL_API.Tomorrow:U.URL_API.Daily;$.getJSON(r+U.URL_API.LangKey,function(e){for(var r in e)n+=e[r].length;for(var r in e){a[r]=[];for(var o in e[r]){var s=e[r][o];!function(e,n){$.getJSON(U.getAPIAchievement(n.id),function(t){t.level=n.level,e.push(t)}).always(function(){t++,i()})}(a[r],s)}}})},loadMultilingualDatabase:function(e,t){var n=e.toLowerCase(),a={},i=!0;if(Z.DatabaseLanguages.forEach(function(e){void 0===Z.DatabaseCache[e]&&(i=!1)}),i)return void t(Z.DatabaseCache[n]);var r=function(){var e=!0;Z.DatabaseLanguages.forEach(function(t){void 0===a[t]&&(e=!1)}),e&&(Z.DatabaseCache[n]=a,t(Z.DatabaseCache[n]))};Z.DatabaseLanguages.forEach(function(e){$.getJSON(U.getDatabaseURL(n,e),function(t){a[e]=t,r()})})},getItemsDatabase:function(e){var t=O.OptionEnum.Language.Default;$.getJSON(U.getItemsDatabaseURL(t),function(n){Z.DatabaseCache.items={},Z.DatabaseCache.items[t]=n,e(n)})},loadItemsDatabase:function(e){Z.loadMultilingualDatabase("items",e)},updateItemsSubdatabase:function(e){var t=U.getDataScriptURL(e.toLowerCase());I.print("Loading items database..."),Z.loadItemsDatabase(function(n){I.print("Loading section record..."),$.getScript(t,function(){Z.freeFiles();var t=U.getRecordData(e),a=[];for(var i in t)for(var r=t[i],o=0;o<r.length;o++)a.push(r[o].i);for(var i in n){Z.APICacheArrayOfObjects=null,Z.APICacheArrayOfObjects=[];for(var s=n[i],o=0;o<a.length;o++){var c=a[o];Z.APICacheArrayOfObjects.push(s[c])}U.sortObjects(Z.APICacheArrayOfObjects,{aKeyName:"id"});var l=e.toLowerCase()+"_"+i+I.cJSON;Z.printAPICache(U.TypeEnum.isAssoc,{aWantQuotes:!0,aFileName:l})}}).fail(function(){I.print("Error retrieving script: "+t)})})},updateItemsDatabase:function(){var e,t,n=0,a=function(){if(n>=Z.DatabaseLanguages.length)return I.print("Items database of all languages updated."),void(t&&Z.printAPICache(U.TypeEnum.isAssoc,{aCustomCache:t}));var i=Z.DatabaseLanguages[n];$.getJSON(U.getItemsDatabaseURL(i),function(r){var o=[],s=[];for(var c in r)o.push(r[c]),s.push(parseInt(c));var l=U.getDifference(e,s);l.length?Z.scrapeAPIArray(l,"items",{aQueryStr:"?lang="+i,aCallback:function(e){for(var r=0;r<e.length;r++)o.push(e[r]);i===O.OptionEnum.Language.Default&&(t=e),U.sortObjects(o,{aKeyName:"id"}),Z.APICacheArrayOfObjects=o,i===O.OptionEnum.Language.English&&(Z.APICacheArrayOfObjects[0].name+=I.Symbol.Unicode),Z.printAPICache(U.TypeEnum.isAssoc,{aWantQuotes:!0,aFileName:"items_"+i+I.cJSON}),n++,a()}}):(I.print("Database &quot;"+i+"&quot; is up-to-date. No difference found in IDs list."),n++,a())})};I.print("Retrieving item indexes..."),$.getJSON(U.URL_API.ItemDatabase,function(t){I.print("Looking for difference..."),e=t,a()})},getNewAPIEntries:function(e,t,n){var a,i,r,o,s=e,c=e.toLowerCase(),l=Array.isArray(t),u=function(){var e,t,s=[];for(var u in i){e=i[u];for(var d=0;d<e.length;d++)t=e[d],s.push(l?t.i:t.u)}o=A.flattenUnlocks(o);var p=U.getDifference(o,s),h=void 0===r?p:p.filter(function(e){return void 0===r[e]?e:void 0});return 0===h.length?void I.print("No difference found between stored "+c+" record and post-blacklisted API array."):void(l?n({oRecord:i,oBlacklist:r,oEntries:h,oNewIDs:h}):Z.scrapeAPIArray(h,a,{aCallback:function(e){n({oRecord:i,oBlacklist:r,oEntries:e,oNewIDs:h})}}))};$.getScript(U.getDataScriptURL(s),function(){i=U.getRecordData(s),r=U.getRecordBlacklist(s),l?(o=t,u()):(a=t.toLowerCase(),$.getJSON(U.getAPI(a),function(e){o=e,u()}))})},printRecordEntry:function(e,t){var n,a,i,r,o,s,c,l,u,d,p=t||{};for(var h in e){if(n=e[h],c=n.icon?"<img src='"+n.icon+"' />":"",l=$("<div style='margin-bottom:24px'><span>"+c+U.escapeHTML(U.lineJSON(n))+"</span></div>").appendTo("#cslContent"),u=$("<div></div>").appendTo(l),i=n[p.aItemIDsKey]){r=Array.isArray(i)?i:[i];for(var g=0;g<r.length;g++)o=r[g],s=p.aItemDB?p.aItemDB[o].name:n.name,a=U.lineJSON(n.oRecordEntry||{u:n.id,i:o,n:s,p:{gem:null}},!1),d=$("<aside>&nbsp;<a"+U.convertExternalAnchor(U.getWikiLinkDefault(s))+">"+s+"</a></aside>").appendTo(u),$("<input class='cssInputText' type='text' />").prependTo(d).val(a),$("<input class='cssInputText' type='text' />").prependTo(d).val(o)}l.find(".cssInputText").click(function(){$(this).select()})}},executeCollate:function(e){var t,n="collate",a=function(){I.print("Collate function not found, available functions:");for(var e in Z)-1!==e.indexOf(n)&&(t=e.substring(e.indexOf(n)+n.length,e.length).toLowerCase(),I.print(t))};if(e){var i=n+U.toFirstUpperCase(e);Z[i]?Z[i]():a()}else a()},collateSearch:function(){I.print("Loading items database..."),Z.loadItemsDatabase(function(){Z.DatabaseLanguages.forEach(function(e){var t,n=[],a=[],i=Z.DatabaseCache.items[e];for(var r in i)t=i[r],t.name&&a.push({i:t.id,n:t.name.toLowerCase(),l:t.name.length});U.sortObjects(a,{aKeyName:"l"});for(var r=0;r<a.length;r++)t=a[r],n.push([t.i,t.n]);var o=U.compressToJS(n,!1);Z.createFile(o,"search_"+e+I.cJSON)})})},collateMaterials:function(){var e="Materials";$.getScript(U.getDataScriptURL(e),function(){var t,n,a={},i=U.getRecordHeader(e),r=U.getRecordMetadata(e).CategoryAssoc;for(var o in i)a[o]=[];$.getJSON(U.getAPIMaterial(),function(i){Z.scrapeAPIArray(i,e.toLowerCase(),{aCallback:function(e){for(var i in e)n=e[i],t=r[n.id],a[t]=n.items;Z.printUnlockables(a,!0)}})})})},collateSkins:function(){var e,t,n,a,i,r="Skins",o={},s=function(e,t){e.i=t.id,void 0===i[e.u].oAssocItems&&(i[e.u].oAssocItems=[]),i[e.u].oAssocItems.push(t.id),Q.isTradeable(t)?(void 0===e.t&&(e.t=[]),e.t.push(t.id)):e.p={gem:null}},c=function(){var n,a,r;for(var c in e)if(n=e[c],a=null,n.default_skin?a=n.default_skin:n.details&&n.details.skins&&(a=n.details.skins),a){r=Array.isArray(a)?a:[a];for(var l=0;l<r.length;l++)o[r[l]]&&s(o[r[l]],n)}Z.printUnlockables(t),I.print("<br />"),i?(I.print("New skins added:"),Z.printRecordEntry(i,{aItemDB:e,aItemIDsKey:"oAssocItems"})):I.print("No new skins added. Skins database is up to date.")};Z.getNewAPIEntries(r,r,function(r){t=r.oRecord,n=r.oBlacklist,a=r.oEntries;var s,l,u=!1;i={};for(var d=0;d<a.length;d++)if(l=a[d],i[l.id]=l,""===l.name||void 0===l.type)u=!0,n[l.id]=l.name;else{s="","Armor"===l.type&&l.details&&l.details.type&&l.details.weight_class?s=l.type+"_"+l.details.weight_class+"_"+l.details.type:"Weapon"===l.type&&l.details&&l.details.type?s=l.type+"_"+l.details.type:"Back"===l.type&&(s=l.type);var p={u:l.id,i:null,n:l.name};t[s]?(t[s].push(p),o[l.id]=p):(I.print("Warning uncategorizable skin:"),I.prettyJSON(l))}u&&I.prettyJSON(n),Z.getItemsDatabase(function(t){e=t,c()})})},collateUnlockables:function(e){var t=e;Z.getNewAPIEntries(t,t,function(e){Z.printRecordEntry(e.oEntries,{aItemIDsKey:"item_id"})})},collateOutfits:function(){Z.collateUnlockables("Outfits")},collateMinis:function(){Z.collateUnlockables("Minis")},collateFinishers:function(){Z.collateUnlockables("Finishers")},collateDyes:function(){var e,t,n="Dyes";I.print("Loading items database..."),Z.getItemsDatabase(function(){I.print("Looking for difference..."),Z.getNewAPIEntries(n,"colors",function(n){e=n.oRecord,t=n.oEntries,I.print("Downloading color translations..."),Z.scrapeAPIArrayMultilingual(n.oNewIDs,"colors",function(e){I.clear(),t.forEach(function(t){var n=Z.processDye(t,e);I.print(U.lineJSON(n,!1)+",")})})})})},collateRecipes:function(){var e,t,n=["Tailor","Leatherworker","Armorsmith","Artificer","Huntsman","Weaponsmith","Scribe","Chef","Jeweler"],a=["Refinement","Component","UpgradeComponent","LegendaryComponent","Insignia","Inscription","Potion","Consumable","Bag","Bulk","GuildDecoration","GuildConsumable","GuildConsumableWvw","Seasoning","IngredientCooking","Snack","Dessert","Soup","Meal","Feast","Dye","Amulet","Ring","Earring","Backpack","Helm","Shoulders","Coat","Gloves","Leggings","Boots","Scepter","Focus","Staff","Trident","Pistol","Torch","Warhorn","LongBow","ShortBow","Rifle","Speargun","Axe","Mace","Sword","Dagger","Shield","Greatsword","Hammer","Harpoon"],i={},r={},o={};n.forEach(function(e){a.forEach(function(t){i[e+"_"+t]=[]})}),Z.getItemsDatabase(function(n){for(var a in n)e=n[a],e.details&&"CraftingRecipe"===e.details.unlock_type&&(Q.isTradeable(e)&&(o[e.details.recipe_id]=e.id),r[e.details.recipe_id]=e.id);$.getJSON("test/recipes.json",function(e){var a,s,c,l,u,d;for(var p in e){a=e[p],u=a.type,d=a.output_item_id;for(var h=0;h<a.disciplines.length;h++)c=a.disciplines[h],s=c+"_"+a.type,("RefinementObsidian"===a.type||"RefinementEctoplasm"===a.type)&&(s=c+"_Refinement"),n[d]&&i[s]&&(l=[],a.ingredients.forEach(function(e){l.push([e.item_id,e.count])}),t={u:a.id,i:d,n:n[d].name,r:l},r[a.id]&&(t.s=r[a.id]),o[a.id]&&(t.t=o[a.id]),i[s].push(t))}var g={};for(var p in i)i[p].length&&(g[p]=i[p]);Z.printUnlockables(g)})})},collateCleanup:function(){var e="Cleanup",t={},n=function(e){var t=e.name.toLowerCase(),n=e.description?e.description.toLowerCase():"";if(-1!==n.indexOf("decoration")&&("Gizmo"===e.type||"Consumable"===e.type||"Trophy"===e.type))return"Decoration";if(-1!==n.indexOf("value as part of a collection"))return"Collection";if(-1!==t.indexOf("recipe"))return"Recipe";if("Rare"===e.rarity&&e.level&&e.level>Q.ItemLimit.EctoSalvageLevel&&("Weapon"===e.type||"Armor"===e.type||"Trinket"===e.type||"Back"===e.type)&&-1===e.flags.indexOf("NoSalvage"))return"Rare";if("Container"===e.type)return"Ascended"===e.rarity?"ContainerAscended":-1!==t.indexOf("weapon")||-1!==t.indexOf("armor")||-1!==t.indexOf("skin")?"ContainerGear":"Rare"!==e.rarity&&"Exotic"!==e.rarity||-1===t.indexOf("gear")&&-1===n.indexOf("weapon")&&-1===n.indexOf("armor")&&-1===n.indexOf("gear")&&-1===n.indexOf("skin")?"Container":"ContainerGear";if("Trophy"===e.type){if(-1!==n.indexOf("salvage item"))return"Salvage";if("Junk"===e.rarity)return"Junk";if((-1!==n.indexOf("event item")||-1!==n.indexOf("task item")||e.vendor_value>0&&-1===e.flags.indexOf("NoSell"))&&"Legendary"!==e.rarity)return"Collection"}return"Gizmo"===e.type&&-1!==n.indexOf("combine")&&-1===n.indexOf("tier")?"Combine":"Consumable"===e.type?"Food"===e.details.type||"Utility"===e.details.type?"Food":"Transmutation"===e.details.type?"Skin":"Consumable":null};$.getScript(U.getDataScriptURL(e),function(){var a=U.getRecordHeader(e);for(var i in a)t[i]=[];$.getScript(U.getDataScriptURL("Catalog"),function(){var e,a,i={},r=U.getRecordData("Catalog");for(var o in r){e=r[o];for(var s=0;s<e.length;s++)a=e[s].i,i[a]=!0}Z.getItemsDatabase(function(e){var a,r;for(var o in e)a=e[o],i[a.id]||(r=n(a),r&&t[r].push(a.id));Z.printUnlockables(t,!0)})})})},collateAscended:function(){var e=function(e){return"Weapon"===e.type||"Trinket"===e.type?e.details.type:"Armor"===e.type?e.details.weight_class+e.details.type:"Back"===e.type?e.type:null},t=[];Z.getItemsDatabase(function(n){var a,i,r,o,s="",c="";for(var l in n)a=n[l],r=a.type,"Ascended"===a.rarity&&(e(a)||"Container"===r)&&-1===a.name.indexOf("Recipe")&&t.push(a.id);Z.getNewAPIEntries("ascended",t,function(t){for(var r in t.oEntries)a=n[t.oEntries[r]],i=U.escapeHTML(a.name),s+="&quot;"+a.id+"&quot;: &quot;<a"+U.convertExternalAnchor(U.getWikiLinkDefault(i))+"'>"+i+"</a>&quot;,<br />",c+="{i: "+a.id+", n: &quot;"+i+"&quot;},<br />",o=e(a),o&&t.oRecord[o].push({i:a.id,n:a.name});Z.printUnlockables(t.oRecord),I.print(""),I.print(s),I.print(c)})})},collatePrices:function(){var e,t,n,a=["materials","skins","dyes","minis","finishers","recipes"],i=0,r={},o=0,s=a.length,c=function(){var t=U.getRecordBlacklist("prices");for(var n in e)Q.isTradeable(e[n])===!1&&void 0===t[n]&&(t[n]=1);var a,i=U.getRecordMetadata("ascended").CompositeIngredients;for(var n in i)for(var o=0;o<i[n].length;o++)a=i[n][o][0],void 0===t[a]&&(r[a]=!0);var s=[];for(var n in r)void 0===t[n]&&s.push(parseInt(n));I.print("Fetching prices..."),Z.scrapeAPIArray(s,"commerce/prices",{aCallback:function(e,n){n.forEach(function(e){t[e]=1});var a={};e.forEach(function(e){var t=e.buys.unit_price,n=e.sells.unit_price||t;a[e.id]=[t,n]});var i="var GW2T_PRICES_DATA = "+U.lineJSON(a).replace(/ /g,"")+";\r\n";i+="var GW2T_PRICES_BLACKLIST = "+U.lineJSON(t).replace(/ /g,"")+";",Z.createFile(i,"prices.js")}})},l=function(){I.print("Loading prices data..."),$.getScript(U.URL_DATA.Ascended,function(){$.getScript(U.URL_DATA.Prices,function(){c()})})},u=function(e){var r=a[i];i++,$.getScript(U.getDataScriptURL(r),function(){t=U.getRecordData(r);for(var a in t)n=t[a],n.forEach(function(t){e(t)});o++,o===s&&l()})};I.print("Loading items database..."),Z.getItemsDatabase(function(t){e=t,u(function(t){Q.isTradeable(e[t])&&(r[t]=!0)}),u(function(t){void 0===t.p&&Q.isTradeable(e[t.i])&&(r[t.i]=!0)}),u(function(t){Q.isTradeable(e[t.i])&&(r[t.i]=!0)}),u(function(t){Q.isTradeable(e[t.i])&&(r[t.i]=!0)}),u(function(t){Q.isTradeable(e[t.i])&&(r[t.i]=!0)}),u(function(e){e.t&&(r[e.t]=!0)})})},collateEvents:function(){var e=function(e,t){var n=[];for(var a in e.events)e.events[a].id=a,n.push(e.events[a]);Z.printAPICache(U.TypeEnum.isAssoc,{aCustomCache:n,aFileName:"events_"+t+I.cJSON})};Z.fetchAPIMultilingual(U.URL_API.EventDetails,function(t){for(var n in t)e(t[n],n)})}},A={TokenCurrent:null,CharIndexCurrent:null,isAccountInitialized:!1,Metadata:{},Currency:{},Equipment:{},Attribute:{},Data:{Account:{},Characters:[],CharacterNames:null,Guilds:{},Vaults:null,Wallet:{},Specializations:{},Traits:{}},Possessions:null,Tally:null,URL:{Account:"account",Achievements:"account/achievements",Shared:"account/inventory",Bank:"account/bank",Dyes:"account/dyes",Finishers:"account/finishers",Materials:"account/materials",Minis:"account/minis",Outfits:"account/outfits",Skins:"account/skins",Wallet:"account/wallet",Characters:"characters",Transactions:"commerce/transactions",CurrentBuys:"commerce/transactions/current/buys",CurrentSells:"commerce/transactions/current/sells",HistoryBuys:"commerce/transactions/history/buys",HistorySells:"commerce/transactions/history/sells",Stats:"pvp/stats",Games:"pvp/games",Standings:"pvp/standings",TokenInfo:"tokeninfo",GuildLog:"log",GuildMembers:"members",GuildPermission:"permission",GuildRanks:"ranks",GuildStash:"stash",GuildTeams:"teams",GuildTreasury:"treasury",GuildUpgrades:"upgrades"},Permissions:{},PermissionEnum:{Account:"account",Builds:"builds",Characters:"characters",Guilds:"guilds",Inventories:"inventories",Progression:"progression",PvP:"pvp",TradingPost:"tradingpost",Wallet:"wallet",Unlocks:"unlocks"},DishCurrent:null,getURL:function(e,t){var n=t?"guild/"+t+"/"+e:e;return"https://api.guildwars2.com/v2/"+n+U.getDivider(n)+"access_token="+A.TokenCurrent},getTransactions:function(e,t){var n=t||{};n.aPermission=A.PermissionEnum.TradingPost,U.fetchPaginated(A.getURL(e),n)},setProgressBar:function(e,t){var n=document.getElementById("accProgress"),a=document.getElementById("accProgressCount");n&&(n.style.width=e/t*T.cPERCENT_100+"%",a.innerHTML=e+" / "+t,e===t&&A.resetProgressBar())},resetProgressBar:function(e){var t=$("#accProgress"),n=$("#accProgressCount");e||void 0===e?t.css({opacity:1}).animate({opacity:0},800,function(){$(this).css({width:"0px",opacity:1})}):t.css({width:"0px",opacity:1}),n.empty()},initializeAccount:function(){D.addDictionary(GW2T_ACCOUNT_DICTIONARY),A.Metadata=GW2T_ACCOUNT_METADATA,A.Currency=GW2T_CURRENCY_DATA,A.Equipment=GW2T_EQUIPMENT_DATA,A.Attribute=GW2T_ATTRIBUTE_DATA;var e=$("#accContent");e.find("section").addClass("accPlatter"),e.find("article").addClass("accDishContainer jsScrollable").each(function(){var e=$(this).attr("data-section");$(this).is(":empty")?$(this).html("<div class='accDishPadding'></div><div id='accDish_"+e+"' class='accDish cntComposition'></div>"):($(this).wrapInner("<div id='accDish_"+e+"' class='accDish cntComposition'></div>"),$(this).prepend("<div class='accDishPadding'></div>")),I.bindScrollbar($(this))}),$("#accContent").show(),U.convertExternalLink($("#accHelp").find(".jsExternal").find("a")),A.generateMenu(),$("#accToggle").click(function(){$("#accMenu").slideToggle("fast",function(){A.adjustAccountPanel()})}),$("#accExpand").click(function(){$("#opt_bol_showPanel").trigger("click")}),$("#accClose").click(function(){$("#mapAccountButton").trigger("click")}),A.initializeTokens(),I.qTip.init($("#panelAccount").find("a, label, button, kbd, img")),D.translateElements();var t=$("#accConsole").onEnterKey(function(){var e=$(this).val(),t=e.charAt(0)===Z.cCommandPrefix?e:Z.cCommandPrefix+e;Z.parseCommand(t,M)});I.bindInputBarText(t,'Enter "help" for commands...'),Q.bindItemSearch("#accSearch",{aCallback:function(e){Q.printItemInfo(e)}}),Q.initializeItemContextMenu(),D.isLanguageDefault()===!1&&$("#accDirectory var").each(function(){var e=$(this).text().toLowerCase();$(this).html(D.getWordCapital(e))}),setTimeout(function(){A.adjustAccountPanel()},1e3),A.isAccountInitialized=!0},generateMenu:function(){var e=$("#accMenu");$("#accContent").find(".accDishMain").each(function(){var t=$(this).attr("data-section"),n=t.toLowerCase(),a=$("<aside id='accMenu_"+t+"' class='accMenuTab accMenuClick curClick'><span><img class='accMenuIcon accMenuIconMain' src='img/account/menu/"+n+I.cPNG+"' title='<dfn>"+D.getWordCapital(n)+"</dfn>' /><var class='accMenuTitle'>"+D.getPhraseOriginal(t)+"</var></span><span class='accMenuSubtab' style='display:none;'></span></aside>");e.append(a),function(e,t){var n=$("#accPlatter"+t);A.createDishMenu(t),e.click(function(){$(".accMenuTab").find(".accMenuIcon").removeClass("accMenuButtonFocused"),$(".accPlatter").hide(),$(this).data("iscurrentaccounttab")&&$(this).hasClass("accMenuTabFocused")===!1?(n.show(),$(this).find(".accMenuCurrent").trigger("click")):($(this).data("iscurrentaccounttab",null),A.DishCurrent=$("#accDish_"+t),$(".accDishMenu").hide(),$("#accDishMenu_"+t).show(),n.find(".accDishContainer").hide(),n.find(".accDishMain").show(),$(this).find(".accMenuIconMain").addClass("accMenuButtonFocused"),n.fadeIn(400),A.adjustAccountPanel(),I.PageCurrent=I.SpecialPageEnum.Account,I.SectionCurrent[I.SpecialPageEnum.Account]=t===I.SectionEnum.Account.Manager?"":t,U.updateQueryString(),A.generateDish(t)),$(".accMenuTab").removeClass("accMenuTabFocused").find(".accMenuSubtab").hide(),$(this).addClass("accMenuTabFocused").find(".accMenuSubtab").show(),A.resetProgressBar(!1)});var a=n.find(".accDishContainer");if(a.length){var i=e.find(".accMenuSubtab");i.append("<img src='img/ui/view.png' />"),a.each(function(){if($(this).hasClass("accDishMain")===!1){var t=$(this).attr("data-section"),a=t.toLowerCase(),r=$("<img id='accMenu_"+t+"' class='accMenuButton accMenuIcon accMenuClick' title='<dfn>"+D.getWordCapital(a)+"</dfn>' src='img/account/menu/"+a+I.cPNG+"' />");i.append(r),A.createDishMenu(t),$(this).attr("data-islead")&&$("<span class='accMenuTabDivider'></span>").insertBefore(r),function(a,i){a.click(function(a){$(".accMenuTab").find(".accMenuIcon").removeClass("accMenuButtonFocused"),$(".accPlatter").hide(),$(".accMenuTab").removeClass("accMenuTabFocused").find(".accMenuSubtab").hide(),n.show();var r=$(this).parents(".accMenuTab").data("iscurrentaccounttab",t);r.find(".accMenuCurrent").removeClass("accMenuCurrent"),$(this).addClass("accMenuCurrent"),A.DishCurrent=$("#accDish_"+t),r.hasClass("accMenuTabFocused")===!1&&r.addClass("accMenuTabFocused").find(".accMenuSubtab").show(),$(".accDishMenu").hide(),$("#accDishMenu_"+t).show(),a.stopPropagation(),i.parent().find(".accDishContainer").hide(),i.fadeIn(200),A.adjustAccountPanel(),e.find(".accMenuIcon").removeClass("accMenuButtonFocused"),$(this).addClass("accMenuButtonFocused"),I.PageCurrent=I.SpecialPageEnum.Account,I.SectionCurrent[I.SpecialPageEnum.Account]=t,U.updateQueryString(),A.generateDish(t)})}(r,$(this))}}),I.qTip.init(".accMenuButton")}}(a,t)}),$("#accPlatterManager").show(),U.openSectionFromURL({aPrefix:"#accMenu_",aInitialSection:I.SectionEnum.Account.Manager})},adjustAccountPanel:function(){var e=O.Options.bol_alignPanelRight?{left:"0px",right:"auto"}:{left:"auto",right:"0px"};$("#accOverhead").css({width:$("#accContent").width()-8+"px"}).css(e),A.DishCurrent&&(A.DishCurrent.parent().find(".accDishPadding").css({height:$("#accOverhead").height()+"px"}),A.adjustAccountScrollbar())},adjustAccountScrollbar:function(){I.updateScrollbar(A.DishCurrent.parent())},initializeTokens:function(){var e,t=64,n=localStorage[O.Utilities.APITokens.key];try{n=JSON.parse(n)}catch(a){}void 0===n&&(n=[],n.push(A.createToken("Example Key Name","EXAMPLE-API-KEY-PLEASE-REPLACE-WITH-YOUR-OWN-HERE")));var i=!0;if(U.APIKey)for(var r=0;r<n.length;r++)e=n[r],U.APIKey===e.key?(e.isUsed=!0,i=!1):delete e.isUsed;else i=!1;U.APIKey&&i&&n.push(A.createToken("URL API Key",U.APIKey,!0));for(var r=0;r<n.length;r++)e=n[r],A.insertTokenRow(e.name,e.key,e.isUsed);A.saveTokens(),A.loadToken(),$("#accManagerPrint").click(function(){var e=localStorage[O.Utilities.APITokens.key];try{e=JSON.parse(e),I.prettyJSON(e)}catch(t){}}),$("#accTokenNew").click(function(){O.Utilities.APITokens.value.length<t?(A.insertTokenRow("",""),A.saveTokens(),I.qTip.init($("#accManager").find("button"))):I.write("API tokens limit reached.")}),I.qTip.init($("#accManager").find("button"))},createToken:function(e,t,n){var a={name:e,key:t};return n&&(a.isUsed=!0),a},saveTokens:function(){var e=[];$(".accToken").each(function(){var t=U.escapeHTML($(this).find(".accTokenName").val()),n=U.stripToAlphanumericDash($(this).find(".accTokenKey").val()),a=A.createToken(t,n,$(this).find(".accTokenUse").hasClass("btnFocused"));e.push(a)});var t=O.Utilities.APITokens;t.value=e,localStorage[t.key]=JSON.stringify(t.value)},loadToken:function(){if(null!==A.TokenCurrent){for(var e in A.Permissions)A.Permissions[e]=null;A.Data.CharacterNames=null,A.Data.Vaults=null,$("#accMenu_Characters").data("iscurrentaccounttab",null),$(".accDishMenu").empty(),$.getJSON(A.getURL(A.URL.TokenInfo),function(e){for(var t in e.permissions){var n=e.permissions[t];A.Permissions[n]=!0}}).fail(function(e,t){A.printError(A.PermissionEnum.Account,t)})}},printError:function(e,t){I.write("error"===t?"Unable to retrieve response. ArenaNet API server may be down.":"Unable to access data for this key from ArenaNet API server."),I.write(A.TokenCurrent),e&&(I.write("Requested permission: "+e,10),$("#accMenu_Manager").trigger("click")),I.ArticleCurrent=null},checkPermission:function(e){return A.Permissions[e]?!0:(A.printError(e),!1)},printAccount:function(e){if(e)I.print("Loading "+e+"..."),$.ajax({dataType:"json",url:A.getURL(e),cache:!1,success:function(e){I.prettyJSON(e)},error:function(e,t){A.printError(null,t)}});else{I.print("Available account API URL suffixes:");for(var t in A.URL)I.print(A.URL[t])}},insertTokenRow:function(e,t,n){var a=$("<div class='accToken'></div>").appendTo("#accManager"),i=$("<img class='accTokenLink curClick' src='img/ui/link.png' title='Get private <dfn>shareable link</dfn>.' />").appendTo(a),r=$("<input class='accTokenKey' type='text' value='"+t+"' maxlength='128' />").appendTo(a),o=$("<input class='accTokenName' type='text' value='"+e+"' maxlength='64' />").appendTo(a),s=$("<div class='accTokenButtons'></div>").appendTo(a),c=$("<button class='accTokenUse' title='<dfn>Use</dfn> this key.'><img src='img/ui/check.png' /></button>").appendTo(s),l=$("<button class='accTokenDelete' title='<dfn>Delete</dfn> this key.'><img src='img/ui/default.png' /></button>").appendTo(s),u=$("<span class='btnSwap'></span>").appendTo(s),d=$("<button class='btnSwapUp'></button>").appendTo(u),p=$("<button class='btnSwapDown'></button>").appendTo(u),h=function(){I.updateClipboard(i[0],"http://gw2timer.com#"+U.escapeHTML(U.stripToAlphanumericDash(r.val())))};n===!0&&(A.TokenCurrent=U.stripToAlphanumericDash(t),o.addClass("accTokenNameUsed"),c.addClass("btnFocused")),c.click(function(){var e=r.val();e.length>0?($(".accTokenName").removeClass("accTokenNameUsed"),$(".accTokenUse").removeClass("btnFocused"),o.addClass("accTokenNameUsed"),c.addClass("btnFocused").find("img"),A.TokenCurrent=U.stripToAlphanumericDash(e),A.loadToken(),A.saveTokens()):I.write("Please enter a valid API key.")}),r.change(function(){c.trigger("click"),h()}),I.bindClipboard(i),h(),l.click(function(){var e=r.val();O.Utilities.APITokens.value.length>1?(e.length>0?confirm("Delete this API token?")&&(a.remove(),A.saveTokens()):(a.remove(),A.saveTokens()),I.qTip.hide()):I.write("Must have at least one API token.")}),$([o,r]).each(function(){$(this).click(function(){$(this).select()}).change(function(){A.saveTokens()})}),$([i,s]).each(function(){$(this).hover(function(){o.addClass("accTokenHovered"),r.addClass("accTokenHovered")},function(){o.removeClass("accTokenHovered"),r.removeClass("accTokenHovered")})}),$([d,p]).each(function(){$(this).click(function(){$(this).hasClass("btnSwapUp")?a.prev().hasClass("accToken")&&a.insertBefore(a.prev()):a.next().hasClass("accToken")&&a.insertAfter(a.next()),A.saveTokens()})})},getCurrentCharacter:function(){try{return A.Data.Characters[A.CharIndexCurrent]}catch(e){}return null},getDishName:function(e){return $(e).parents(".accDishContainer").attr("data-section")},reinitializeDish:function(e){return e.is(":empty")===!1&&e.data("token")===A.TokenCurrent?!1:(e.empty().data("token",A.TokenCurrent),!0)},generateDish:function(e){var t="serve"+e;V[t]&&V[t]()},regenerateDish:function(e){A.wipeDish(e),A.generateDish(e)},wipeDish:function(e){$("#accDish_"+e).empty(),$("#accDishMenu_"+e).empty()},createDishMenu:function(e){$("<aside id='accDishMenu_"+U.toFirstUpperCase(e)+"' class='accDishMenu'></aside>").appendTo("#accDishMenuContainer")},getDishMenu:function(e){return $("#accDishMenu_"+U.toFirstUpperCase(e))},assignAccountUpgrades:function(e,t){var n=A.Currency.AuditUpgrades[e];n.purchased=t-n.starting,n.totalgem=n.gem*n.purchased,n.totalowned=n.starting+n.purchased},initializeAccountUpgrades:function(){var e=A.Currency.AuditUpgrades;for(var t in e)e[t].purchased=0,e[t].totalgem=0,e[t].totalowned=e[t].starting},getAccountUpgradesGem:function(){var e=A.Currency.AuditUpgrades,t=0;for(var n in e)t+=e[n].totalgem;return t},initializeGuilds:function(e){var t=A.Data.Account.guilds;if(void 0===t||null===t||t.length<=0)return void e();for(var n=0,a=0;a<t.length;a++)void 0===A.Data.Guilds[t[a]]?$.getJSON(U.URL_API.GuildDetails+t[a],function(a){A.Data.Guilds[a.guild_id]=a,A.Data.Guilds[a.guild_id].oTag="["+a.tag+"]",n++,n===t.length&&e()}):(n++,n===t.length&&e())},initializeVault:function(e){A.initializeGuilds(function(){var t=A.Data.Account.guilds;A.Data.Vaults={};var n=0,a=t.length,i=function(){n===a&&(0===n&&(A.Data.Vaults=null,I.print("Unable to access any guild bank for this account.<br />Requires API key from account of guild leader.")),e(A.Data.Vaults))};t.forEach(function(e){$.getJSON(A.getURL(A.URL.GuildStash,e),function(t){A.Data.Vaults[e]=t,n++,i()}).fail(function(){a--,i()})})})},initializePossessions:function(e,t){if(A.Possessions&&!t||A.Possessions&&t&&A.Data.Vaults)return void e();A.Possessions={};var n=function(e,t,n,a){void 0===A.Possessions[e]&&(A.Possessions[e]={oCount:0,oAudit:{}});var i=A.Possessions[e].oAudit,r=function(e){void 0===i[e]&&(i[e]=[0,0]),a||(i[e][0]+=n),i[e][1]+=n};A.Possessions[e].oCount+=n;var o=isNaN(t)===!1?"Characters":U.toFirstUpperCase(t);r(o),isNaN(t)===!1&&r(t)},a=function(e,t){e.upgrades&&e.upgrades.forEach(function(e){n(e,t,1,!0)}),e.infusions&&e.infusions.forEach(function(e){n(e,t,1)})},i=function(t,i,r,o){A.Tally={Characters:[0,0],Shared:[0,0],Bank:[0,0],Materials:[0,0],Vault:[0,0]};var s=A.Currency.AuditUpgrades.BagSlot,c=0,l=A.Currency.AuditUpgrades.CraftingLicense,u=0;A.Data.Characters.forEach(function(e){if(e.equipment&&e.equipment.forEach(function(t){n(t.id,e.oCharIndex,1,!0),a(t,e.oCharIndex)}),e.bags&&(c+=e.bags.length-A.Currency.AuditUpgrades.BagSlot.starting,e.bags.forEach(function(t){t&&(A.Tally.Characters[1]+=t.size,n(t.id,e.oCharIndex,1),t.inventory.forEach(function(t){t&&(A.Tally.Characters[0]+=1,n(t.id,e.oCharIndex,t.count,t.binding),a(t,e.oCharIndex))}))})),e.crafting){var t=0;e.crafting.forEach(function(e){e.active&&t++}),t>u+l.starting&&u++}}),A.assignAccountUpgrades("CraftingLicense",u+l.starting),s.purchased=c,s.totalgem=s.gem*c,s.totalowned=A.Data.Characters.length*s.starting+c,A.assignAccountUpgrades("SharedSlot",t.length),A.Tally.Shared[1]=t.length,t.forEach(function(e){e&&(A.Tally.Shared[0]+=1,n(e.id,"Shared",e.count,e.binding))}),A.assignAccountUpgrades("BankTab",~~(i.length/A.Metadata.Bank.NumSlotsPerTab)),A.Tally.Bank[1]=i.length,i.forEach(function(e){e&&(A.Tally.Bank[0]+=1,n(e.id,"Bank",e.count,e.binding),a(e,"Bank"))});var d=0;if(A.Tally.Materials[1]=r.length,r.forEach(function(e){e&&e.count>0&&(A.Tally.Materials[0]+=1,n(e.id,"Materials",e.count),e.count>d&&(d=e.count))}),A.assignAccountUpgrades("StorageExpander",Math.ceil(d/Q.ItemLimit.StackSize)),o)for(var p in o)o[p].forEach(function(e){e.inventory.forEach(function(e){e&&(A.Tally.Vault[0]+=1,n(e.id,"Vault",e.count))}),A.Tally.Vault[1]+=e.size});e()};$.getJSON(A.getURL(A.URL.Shared),function(e){$.getJSON(A.getURL(A.URL.Bank),function(n){$.getJSON(A.getURL(A.URL.Materials),function(a){t?A.initializeVault(function(t){i(e,n,a,t)}):i(e,n,a)})})}).fail(function(e,t){A.printError(A.PermissionEnum.Inventories,t)})},formatPossessionLocations:function(e){var t="",n=e.oAudit;for(var a in n)"Characters"!==a&&(n[a][0]>0||n[a][1]>0)&&(isNaN(a)?t+=D.getWordCapital(a):A.Data.Characters[a]&&(t+=A.Data.Characters[a].oCharName),t+=" ("+n[a][1]+"), ");return t=t.substring(0,t.length-2)},iterateRecord:function(e,t){var n,a;for(var i in e){n=e[i];for(var r=0;r<n.length;r++)a=n[r],t(a,i)}},flattenRecord:function(e){var t={};return A.iterateRecord(e,function(e){t[e.i]=e}),t},flattenUnlocks:function(e){var t=[];return e.length&&isNaN(e[0])&&e[0].id?(e.forEach(function(e){t.push(e.id)}),e=t,t):e},generateAudit:function(){var e=100,t=$("#audExecute"),n=$("#audExecuteAlternate").hide();
I.suspendElement(t);var a,i,r=$("#accAudit").empty(),o=$("#audWantVaults").prop("checked"),s=$("#audWantTransactions").prop("checked"),c=A.Currency.AuditPayments;E.Paylist={};var l,u,d,p,h,g,m,f,C={},v={},b={Ascended:{},Catalog:{},Skins:{},Outfits:{},Dyes:{},Minis:{},Finishers:{},Recipes:{}},S={Skins:{},Outfits:{},Dyes:{},Minis:{},Finishers:{}},y=function(){I.suspendElement(t,!1),n.show()},k=function(e){var t={},n=void 0===e?0:e;for(var a in c)t[a]=n;return t},_=function(){for(var e in A.Currency.AuditCategories)A.Currency.AuditCategories[e]=k();A.Currency.AuditCategoriesCharacters={}},P=function(e,t,n,a,i){var r=A.Currency.AuditCategories[e];isNaN(e)===!1&&(void 0===A.Currency.AuditCategoriesCharacters[e]&&(A.Currency.AuditCategoriesCharacters[e]=k()),r=A.Currency.AuditCategoriesCharacters[e]);var o=void 0===n?1:n;if(E.isPriceObject(t))a===!0?(r.coin_appraisedbuy+=t.oPriceBuy*o,r.coin_appraisedsell+=t.oPriceSell*o):(r.coin_liquidbuy+=t.oPriceBuyTaxed*o,r.coin_liquidsell+=t.oPriceSellTaxed*o,r.coin_appraisedbuy+=t.oPriceBuy*o,r.coin_appraisedsell+=t.oPriceSell*o);else for(var s in t)void 0!==r[s]&&t[s]>0&&(r[s]+=t[s]*o);if(i){var c=parseInt(i);void 0===v[e]&&(v[e]={});var l=v[e];if(void 0===l[c])if(l[c]=[0,0],E.isPriceObject(t))l[c][1]=W("coin_appraisedsell",t.oPriceSell);else for(var s in t)void 0!==r[s]&&t[s]>0&&(l[c][1]=W(s,t[s]));l[c][0]+=o}},L=function(){var e,t;for(var n in A.Data.Wallet)e=A.Data.Wallet[n],"1"===n?P("Wallet",E.createPricePlain(e),1):A.Currency.AuditWallet[n]&&(t={},t[A.Currency.AuditWallet[n].payment]=e,P("Wallet",t,1,!0))},M=function(){var e,t,n,a,i=g.LegendaryInclusion;A.Tally.Legendary={count:0,price:E.createPrice()};for(var r in A.Possessions)if(e=E.Paylist[r]){for(var o in A.Possessions[r].oAudit)t=A.Currency.AuditCategories[o],n=A.Possessions[r].oAudit[o],isNaN(o)===!1&&(void 0===A.Currency.AuditCategoriesCharacters[o]&&(A.Currency.AuditCategoriesCharacters[o]=k()),t=A.Currency.AuditCategoriesCharacters[o]),t&&(E.isPriceObject(e)?n[1]===n[0]?P(o,e,n[1],!1,r):(P(o,e,n[0],!1,r),P(o,e,n[1]-n[0],!0,r)):P(o,e,n[1],!1,r));i[r]&&(a=A.Possessions[r].oCount,A.Tally.Legendary.count+=a,A.Tally.Legendary.price=E.addPrice(A.Tally.Legendary.price,E.recountPrice(e,a)))}},w=function(e,t){var n,a,i="i";if("Recipes"===e){S.Recipes=[],a={},i="t",A.Data.Characters.forEach(function(e){if(e.recipes)for(var t=0;t<e.recipes.length;t++)void 0===a[e.recipes[t]]&&(S.Recipes.push(e.recipes[t]),a[e.recipes[t]]=!0)});var r,o=U.getRecordData("recipes");A.iterateRecord(o,function(t){if(a[t.u]&&1!==a[t.u]&&t.p){a[t.u]=1;for(var i in t.p)n={},n[i]=t.p[i],r="coin"===i?E.createPriceBound(t.p[i]):n,P(e,r,1,!0,t.s)}})}if(S[e]=A.flattenUnlocks(S[e]),A.Tally[e]=[S[e].length,0],void 0===a&&(a=U.getExistAssoc(S[e]),"Skins"===e))for(var s in g.SkinsExclusion)a[s]=!1;var c,l={};A.iterateRecord(b[e],function(r){A.Tally[e][1]+=1,c=r[i],c&&(n=E.Paylist[c],n&&a[r.u]&&1!==a[r.u]&&void 0===l[c]&&(t===!1&&void 0===A.Possessions[c]||t!==!1)&&(a[r.u]=1,P(e,n,1,!0,c),l[r.i]=!0))})},N=function(){var e;m&&(A.Tally.Buying=[m.length,m.length],m.forEach(function(e){P("Buying",E.createPricePlain(e.price),e.quantity,!1,e.item_id)})),f&&(A.Tally.Selling=[f.length,f.length],f.forEach(function(t){e=E.Paylist[t.item_id],e&&P("Selling",e,t.quantity,!1,t.item_id)}))},x=function(e,t){var n={};for(var a in e)n[a]=e[a]+t[a];return n},W=function(e,t,n){var a=e,i=n||"oPriceSell";if(-1!==a.indexOf("coin"))return t;if("gem"===a)return E.convertGemToCoin(t);var r=c[a].conversion;if(0===r)return 0;if(isNaN(r)===!1)return t*r;if(Array.isArray(r)){var o=r[0],s=r[1],l=E.Paylist[s];if(l&&l[i])return Math.floor(t*(l[i]/o))}return 0},R=function(e){return $("<div class='audTitleContainer'><aside class='audTitle'>"+e+"</aside></div>")},H=function(e){var t=$("<div class='audTable'></div>").appendTo(r);return R(e).insertBefore(t),t},G=function(e,t,n){var a=A.Tally[n],i="";a&&(i="<span class='audTableTally'>"+a[0]+" / "+a[1]+" ("+U.convertRatioToPercent(a[0]/a[1])+")</span>");var r=$("<div class='audTableColumn'></div>").appendTo(e),o=$("<div class='audTableCell audTableHeaderHorizontal'>"+t+i+"</div>").appendTo(r);return n&&"Wallet"!==n&&o.click(function(){X(n)}).addClass("audTableHeaderView curZoom").attr("id","audViewHeader_"+n),r},z=function(e,t){var n,a,i,r=$("<div class='audTableHeaderVertical audTableColumn'></div>").appendTo(e);for(var o in c)(t||!c[o].ishidden)&&(n=c[o],a=A.Currency.AuditWallet[n.id],i=1===n.id?D.getPhraseOriginal(n.header):D.getObjectName(a),r.append("<div class='audTableCell'>"+i+"&nbsp;<ins class='acc_wallet acc_wallet_"+n.id+"'></ins></div>"));r.prepend("<div class='audTableCell audTableHeaderCorner'></div>")},F=function(e){var t,n=k(Number.NEGATIVE_INFINITY);for(var a in e){t=e[a];for(var i in t)t[i]>n[i]&&(n[i]=t[i])}return n},j=function(e,t,n,a,i){var r,o,s,l;for(var u in t)(i||!c[u].ishidden)&&(r=t[u],o=-1!==u.indexOf("coin")||n?"coin":u,s="",a&&(s="<samp class='audTableCellBar'><s style='background:url(img/background/bargraph.png), linear-gradient(to right, black 0%, "+c[u].color+" 100%);width:"+(a[u]>0?r/a[u]*T.cPERCENT_100:0)+"%'></s></samp>"),l=n?"<span class='cssLeft'>"+(c[u].isappraised?I.Symbol.Approx:I.Symbol.ArrowRight)+"</span>":"",e.append("<div class='audTableCell'>"+l+E.PaymentFormat[o](r)+s+"</div>"))},K=function(e,t,n,a){j(e,t,n,a,!0)},q=function(e,t){var n=k();for(var a in t)n[a]=W(a,t[a]);K(e,n,!0)},X=function(e){var t=$("#audView").empty(),n=B.createBank(t),a=n.find(".bnkBank"),i=isNaN(e)===!1?A.Data.Characters[e].oCharPreface:D.getWordCapital(e),r=B.createBankTab(a,{aTitle:i}),o=r.find(".bnkTabSlots"),s=0,c=0;for(var l in v[e])c++;var u=function(){B.tallyBank(n)};for(var l in v[e])!function(e,t,n){Q.getItem(t,function(a){B.styleBankSlot(e,{aItem:a,aPrice:n[1],aSlotMeta:{count:n[0]}});var i=E.Paylist[t];i&&E.isPriceObject(i)===!1&&B.updateSlotPayment(e,i,n[0],"bnkSlotPriceSell"),s++,A.setProgressBar(s,c),s===c&&u()})}(B.createBankSlot(o),l,v[e][l]);B.createBankMenu(a,{aWantClear:!0,aReloadElement:$("#audViewHeader_"+e)}),I.scrollToElement("#audViewTitle",{aSpeed:"fast"})},V=function(){I.clear();var a=H(D.getPhraseOriginal("Audit Categories")),i=H(D.getPhraseOriginal("Sum &amp; Conversion")),o=H(D.getPhraseOriginal("Audit Characters"));z(a);var s,l=A.Currency.AuditCategories,u=F(l);for(var d in l)"Vault"===d&&null===A.Data.Vaults||"Buying"===d&&void 0===m||"Selling"===d&&void 0===f||(s=G(a,D.getWordCapital(d.toLowerCase()),d),j(s,l[d],!1,u));z(i,!0);var p=G(i,D.getPhraseOriginal("Account Sum")),h=G(i,D.getPhraseOriginal("Account Sum")),g=k();for(var d in l)g=x(g,l[d]);K(p,g),q(h,g);var C=l.Wallet,b=G(i,D.getPhraseOriginal("Wallet")),T=G(i,D.getPhraseOriginal("Wallet"));K(b,C),q(T,C);var S=k(e),y=G(i,D.getPhraseOriginal("Conversion")),_=G(i,D.getPhraseOriginal("Conversion"));K(y,S),q(_,S),z(o);var P,L=A.Currency.AuditCategoriesCharacters,M=F(L);for(var d in L)P=G(o,A.Data.Characters[d].oCharIcons,d),j(P,L[d],!1,M);o.addClass("audTableHorizontal"),I.bindScrollbar(o,!0),I.qTip.init(o.find(".chrPreface")),R("View Audit").attr("id","audViewTitle").appendTo(r),$("<div id='audView'></div>").appendTo(r);var w=$("<div id='audUpgrades'></div>").appendTo(r),N=A.getAccountUpgradesGem(),Z=B.createBank(w),X=Z.find(".bnkBank"),V=B.createBankTab(X,{aTitle:D.getPhraseTitle("Account Upgrades")}),J=V.find(".bnkTabSlots");for(var d in A.Currency.AuditUpgrades)!function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aGem:t.gem,aSlotMeta:{count:t.purchased}})})}(B.createBankSlot(J),A.Currency.AuditUpgrades[d]);E.getCoinFromGem(C.gem,function(e){var t=g.coin_appraisedbuy,n=g.coin_appraisedsell,a=g.coin_appraisedbuy,i=g.coin_appraisedsell,o=g.coin_liquidbuy+e,s=g.coin_liquidsell+e,l=g.coin_liquidbuy,u=g.coin_liquidsell;for(var d in c)-1===d.indexOf("coin")&&(t+=W(d,g[d],"oPriceBuy"),n+=W(d,g[d],"oPriceSell"),-1===d.indexOf("gem")&&(a+=W(d,g[d],"oPriceBuy"),i+=W(d,g[d],"oPriceSell"))),c[d].isliquid&&(o+=W(d,C[d],"oPriceBuyTaxed"),s+=W(d,C[d],"oPriceSellTaxed"));var p=g.gem,h=p+N,m=W("gem",N);t+=m,n+=m;var f=$("<div id='audSummaryContainer'></div>").prependTo(r),v=$("<div id='audSummary'></div>").prependTo(f).hide();v.append("<div id='audSummaryName'><var id='audAccountName'>"+U.escapeHTML(A.Data.Account.name)+"</var></div>"),v.append("<div id='audSummaryValues'><div class='audSummarySubtitle'>― "+D.getWordCapital("appraised")+" ―</div><div id='audSummaryAppraised' class='audSummaryCoin curHelp'></div><div class='audSummaryMoney'>"+I.Symbol.Approx+" "+E.formatGemToMoney(h+E.convertCoinToGem(i))+"</div><div class='audSummarySubtitle'>― "+D.getWordCapital("liquid")+" ―</div><div id='audSummaryLiquid' class='audSummaryCoin curHelp'></div><div class='audSummaryMoney'>"+I.Symbol.Approx+" "+E.formatGemToMoney(C.gem+E.convertCoinToGem(u))+"</div></div>");var b={};try{b=JSON.parse(localStorage[O.Utilities.AuditReport.key])}catch(T){}var S=" "+D.getWordCapital("previous")+": ",y=b.totalappraisedsell>0?S+E.formatCoinStringColored(b.totalappraisedsell):"",k=b.totalappraisedbuy>0?S+E.formatCoinStringColored(b.totalappraisedbuy):"",_=b.totalliquidsell>0?S+E.formatCoinStringColored(b.totalliquidsell):"",P=b.totalliquidbuy>0?S+E.formatCoinStringColored(b.totalliquidbuy):"",L="<dfn>"+D.getPhraseOriginal("Appraised Summary")+":</dfn> <br />"+D.getPhraseOriginal("Appraised Sell")+": "+E.formatCoinStringColored(n)+y+"<br />"+D.getPhraseOriginal("Appraised Buy")+": "+E.formatCoinStringColored(t)+k+"<br /><br /><dfn>"+D.getPhraseOriginal("Appraised Summary Exclude Gems")+":</dfn> <br />"+D.getPhraseOriginal("Appraised Sell")+": "+E.formatCoinStringColored(i)+"<br />"+D.getPhraseOriginal("Appraised Buy")+": "+E.formatCoinStringColored(a)+"<br /><br /><dfn>"+D.getWordCapital("Info")+":</dfn> <br />"+D.getPhraseOriginal("Legendary Equipment")+": "+E.formatCoinStringColored(A.Tally.Legendary.price.oPriceSell)+" ("+A.Tally.Legendary.count+" "+D.getWord("legendary")+")<br />"+D.getPhraseOriginal("Ascended Equipment")+": "+E.formatCoinStringColored(A.Tally.Ascended.price.oPriceSell)+" ("+A.Tally.Ascended.armorcount+" "+D.getWord("armor")+", "+A.Tally.Ascended.weaponcount+" "+D.getWord("weapons")+")<br />"+D.getPhraseOriginal("Gem Categories Sum")+": "+E.formatGemToMoney(p)+" "+I.Symbol.ArrowRight+" "+E.formatGemString(p,!0)+" "+I.Symbol.ArrowLeft+" "+E.formatGemToCoin(g.gem)+"<br />"+D.getPhraseOriginal("Gem Account Upgrades")+": "+E.formatGemToMoney(N)+" "+I.Symbol.ArrowRight+" "+E.formatGemString(N,!0)+" "+I.Symbol.ArrowLeft+" "+E.formatCoinStringColored(m)+"<br />",M="<dfn>"+D.getPhraseOriginal("Liquid Summary")+":</dfn> <br />"+D.getPhraseOriginal("Liquid Sell")+": "+E.formatCoinStringColored(s)+_+"<br />"+D.getPhraseOriginal("Liquid Buy")+": "+E.formatCoinStringColored(o)+P+"<br /><br /><dfn>"+D.getPhraseOriginal("Liquid Summary Exclude Gems")+":</dfn> <br />"+D.getPhraseOriginal("Liquid Sell")+": "+E.formatCoinStringColored(u)+"<br />"+D.getPhraseOriginal("Liquid Buy")+": "+E.formatCoinStringColored(l)+"<br />",w=$("#audSummaryAppraised").attr("title",L).click(function(e){e.which===I.ClickEnum.Left&&I.print(L)}),x=$("#audSummaryLiquid").attr("title",M).click(function(e){e.which===I.ClickEnum.Left&&I.print(M)});I.qTip.init(w),I.qTip.init(x),b={totalappraisedsell:n,totalappraisedbuy:t,totalliquidsell:s,totalliquidbuy:o},localStorage[O.Utilities.AuditReport.key]=JSON.stringify(b),v.show("slow",function(){I.animateNumber(n,function(e){w[0].innerHTML=E.formatCoinString(e,{aWantBig:!0})},3e3,"easeInOutQuart"),I.animateNumber(s,function(e){x[0].innerHTML=E.formatCoinString(e,{aWantBig:!0})},3e3,"easeInOutQuart")})});var Y=$("<div id='audDebug'></div>").appendTo(r);$("<button class='audDebugButton'>Print Possessions</button>").appendTo(Y).click(function(){I.prettyJSON(A.Possessions)}),$("<button class='audDebugButton'>Print Paylist</button>").appendTo(Y).click(function(){I.prettyJSON(E.Paylist)}),$("<button class='audDebugButton'>Print View</button>").appendTo(Y).click(function(){I.prettyJSON(v)}),I.scrollToElement("#accAuditCenter",{aSpeed:"fast"}),I.suspendElement(t,!1),n.show()},J=function(){_(),L(),M(),w("Skins",!1),w("Outfits"),w("Dyes"),w("Minis"),w("Finishers"),w("Recipes"),N(),V()},Y=function(e){var t,n=E.createPrice();return e.forEach(function(e){e&&(t=E.Paylist[e[0]],t&&E.isPriceObject(t)&&(n=E.addPrice(n,E.recountPrice(t,e[1]))))}),E.createPriceBound(n)},et=function(){u=U.getRecordHeader("ascended"),l=U.getRecordData("ascended"),p=g.AscendedIngredients,h=g.CompositeIngredients;var e,t={};for(var n in u)e=u[n].type,d="Armor"===e||"Weapon"===e?p[n].concat(p[e]):p[n],t[n]=Y(d);A.Tally.Ascended={armorcount:0,weaponcount:0,price:E.createPrice()};var a;A.iterateRecord(l,function(n,i){e=u[i].type,"Ring"!==e&&"Accessory"!==e&&"Amulet"!==e&&(E.Paylist[n.i]=t[i],A.Possessions[n.i]&&(a=A.Possessions[n.i].oCount,"Armor"===e?A.Tally.Ascended.armorcount+=a:"Weapon"===e&&(A.Tally.Ascended.weaponcount+=a),A.Tally.Ascended.price=E.addPrice(A.Tally.Ascended.price,E.recountPrice(t[i],a))))});for(var n in h)E.Paylist[n]=Y(h[n])},tt=function(e,t){var n=b[e];A.iterateRecord(n,function(e){if(e.p)for(var n in e.p)(c[n]||e.p.coin)&&(E.Paylist[e.i]=e.p.coin?E.createPriceBound(e.p.coin):e.p);else t&&e.u&&E.Paylist[e.u]&&(E.Paylist[e.i]=E.createPriceBound(E.Paylist[e.u]))})},nt=function(){I.print(D.getPhraseOriginal("Loading trading price")+"..."),Z.scrapeAPIArray(U.convertAssocToArray(C),"commerce/prices",{aCallback:function(e){var t=g.BoundPayments;for(var n in a)E.Paylist[n]=E.processPrice(a[n]);e&&e.forEach(function(e){E.Paylist[e.id]=E.processPrice(e)});for(var n in t)if(t[n].coin)E.Paylist[n]=E.createPricePlain(t[n].coin);else for(var i in t[n])E.Paylist[n]={},E.Paylist[n][i]=t[n][i];for(var n in g.JunkValue)E.Paylist[n]=E.createPricePlain(g.JunkValue[n]);tt("Ascended",!0),et(),tt("Catalog",!0),tt("Skins"),tt("Outfits"),tt("Minis"),tt("Finishers"),J()}})},at=function(){I.print(D.getPhraseOriginal("Loading info price")+"..."),$.getScript(U.URL_DATA.Prices,function(){a=U.getRecordData("prices"),i=U.getRecordBlacklist("prices");for(var e in A.Possessions)void 0===a[e]&&void 0===i[e]&&(C[e]=!0);var t;for(var e in c)t=c[e].conversion,Array.isArray(t)&&c[e].isbound!==!0&&(C[t[1]]=!0);return g=U.getRecordMetadata("ascended"),g.PriorityTradeable.forEach(function(e){C[e]=!0}),s===!1?void nt():(I.print(D.getPhraseOriginal("Loading buying transactions")+"..."),void A.getTransactions(A.URL.CurrentBuys,{aCallback:function(e){I.print(D.getPhraseOriginal("Loading selling transactions")+"..."),A.getTransactions(A.URL.CurrentSells,{aCallback:function(t){e&&e.length&&(m=e,e.forEach(function(e){C[e.item_id]=!0})),t&&t.length&&(f=t,t.forEach(function(e){C[e.item_id]=!0})),nt()},aError:function(){nt()}})},aError:function(){nt()}}))})},it=function(){var e=0,t=U.getObjectLength(b);for(var n in b)I.print(D.getPhraseOriginal("Loading info "+n.toLowerCase())+"..."),function(n){$.getScript(U.URL_DATA[n],function(){b[n]=U.getRecordData(n)}).done(function(){e++,e===t&&at()}).fail(function(){I.print("Failed to load "+n+" record file. Auditing aborted."),y()})}(n)},rt=function(){var e=0,t=U.getObjectLength(S);for(var n in S)I.print(D.getPhraseOriginal("Loading account "+n.toLowerCase())+"..."),function(n){$.getJSON(A.getURL(A.URL[n]),function(e){S[n]=e}).done(function(){e++,e===t&&it()}).fail(function(){I.print("Failed to retrieve "+n+" account unlocks. Auditing aborted.<br />Please check account permissions."),y()})}(n)};I.clear(),I.print(D.getPhraseOriginal("Loading account bank materials inventory")+"..."),A.initializePossessions(function(){rt()},o)}},V={bindSortableList:function(e){var t=$(e).find("li").first();t.click(function(){V.toggleSortableHeader($(this)),V.sortList($(this).parent(),$(this).data("isdescending"))})},toggleSortableHeader:function(e){var t=$(e),n=t.data("isdescending");void 0===n&&(n=!1),t.data("isdescending",!n);var a=n?I.Symbol.TriUp:I.Symbol.TriDown;t.find(".chrHeaderToggle").html(a)},sortList:function(e,t){var n=$(e),a=[];n.find("li").slice(1).each(function(){a.push({item:$(this),value:parseFloat($(this).attr("data-value"))})}),U.sortObjects(a,{aKeyName:"value",aIsDescending:t});for(var i=0;i<a.length;i++)a[i].item.appendTo(n)},sortCharacters:function(e,t){var n=[];$("."+e).each(function(){n.push({index:U.getSubintegerFromHTMLID($(this).parent()),value:parseInt($(this).attr("data-value"))})}),U.sortObjects(n,{aKeyName:"value",aIsDescending:t});for(var a=0;a<n.length;a++){var i=n[a].index;$("#chrSelection_"+i).appendTo("#chrSelection"),$("#chrUsage_"+i).appendTo("#chrUsage"),$("#chrSeniority_"+i).appendTo("#chrSeniority")}},serveAudit:function(){$("#accAuditContainer").show("fast"),$("#accAuditTop").append("<label><input id='audWantTransactions' type='checkbox' />"+D.getPhraseOriginal("Include current trading transactions")+".</label><br /><label><input id='audWantVaults' type='checkbox' />"+D.getPhraseOriginal("Include guilds vault")+".</label>");var e=$("#accAuditCenter"),t=$("<button id='audExecute'>"+D.getPhraseOriginal("Audit Account")+"</button>").appendTo(e).click(function(){A.generateAudit()});$("<button id='audHelp'>"+D.getWordCapital("help")+"</button>").appendTo(e).click(function(){I.isConsoleShown()===!1&&I.help($("#accHelpAudit").html())});var n=$("<button id='audExecuteAlternate' title='<dfn>Audit</dfn> account using all options.<br />gw2timer.com/audit'> <img src='img/ui/stats.png' /></button>").insertAfter("#chrAccountReload").click(function(){$(this).hide(),$("#audWantTransactions").prop("checked",!0),$("#audWantVaults").prop("checked",!0),t.trigger("click")});I.qTip.init("#audExecuteAlternate"),U.verifyArticle(I.SpecialPageEnum.Audit,function(){n.trigger("click")})},serveCharacters:function(e){var t=$("#accDish_Characters");if(A.reinitializeDish(t)!==!1){var n=$("#accMenu_Characters").find(".accMenuSubtab"),a=function(){I.suspendElement(n,!1),V.generateCharactersStatistics(),V.createHeroMenu(),e&&$("#accMenu_"+e).trigger("click")};A.Possessions=null,t.html("<div id='chrSummary'></div><div id='chrStatistics' class='cssStats'><ul id='chrSelection'></ul><ul id='chrUsage' class='chrStats'></ul><ul id='chrSeniority' class='chrStats'></ul><ul id='chrGuilds' class='chrStats'></ul></div><div id='accAuditContainer'><div id='audSeparatorTop' class='accSeparator'></div><div id='accAuditTop' class='accComposition'></div><div id='accAuditCenter'></div><div id='accAudit'></div></div>"),$(".chrWallet").remove(),$(".chrStats").hide(),I.suspendElement(n),t.prepend(I.cThrobber),$.getJSON(A.getURL(A.URL.Characters),function(e){A.adjustAccountScrollbar(),I.removeThrobber(t);var n=0,i=e.length,r=0,o=i;A.initializeAccountUpgrades(),A.assignAccountUpgrades("CharacterSlot",i),A.Data.CharacterNames=e,A.CharIndexCurrent=null,A.Data.Characters=null,A.Data.Characters=Array(i),A.Data.CharacterNames.forEach(function(e){$("#chrSelection").append("<li id='chrSelection_"+n+"' class='chrSelection curClick'></li>"),$("#chrUsage").append("<li id='chrUsage_"+n+"'></li>"),$("#chrSeniority").append("<li id='chrSeniority_"+n+"'></li>"),function(t){$.ajax({dataType:"json",url:A.getURL(A.URL.Characters+"/"+U.encodeURL(e)),cache:!0,success:function(e){A.Data.Characters[t]=e,A.Data.Characters[t].oCharIndex=t,A.Data.Characters[t].oCharName=U.escapeHTML(e.name),V.generateCharactersSelection(e),r++,A.setProgressBar(r,o),r===o&&a()},error:function(){o--,r===o&&a(),I.write("Error retrieving data for character: "+U.escapeHTML(e))}})}(n),n++})}).fail(function(e,n){I.removeThrobber(t),A.printError(A.PermissionEnum.Characters,n)})}},generateCharactersSelection:function(e){var t=e.profession.toLowerCase();if(e.oCharElite=t,e.oCharProfession=t,e.oCharColor=A.Metadata.Profession[t].color,e.oCharIsLowLevel=e.level<A.Metadata.ProfLevel.Max,e.specializations&&e.specializations.pve)for(var n=e.specializations.pve,a=0;a<n.length;a++)if(n[a]){var i=n[a].id;if(void 0!==A.Metadata.ProfElite[i]){t=A.Metadata.ProfElite[i],e.oCharElite=t;break}}var r="",o="";e.crafting&&e.crafting.length>0&&(e.oCharCraft={},e.crafting.forEach(function(t){var n=t.rating<A.Metadata.CraftingRank.Master?"accTrivial":"",a="<b class='"+n+"'><ins class='acc_craft acc_craft_"+t.discipline.toLowerCase()+"'></ins><sup class='chrCraftingRating'>"+t.rating+"</sup></b> ";t.active&&(r+=a,e.oCharCraft[t.discipline]=t.rating),o+=a+" "}));var s=A.Metadata.Race[e.race.toLowerCase()+"_"+e.gender.toLowerCase()]||1,c=A.Metadata.Profession[e.profession.toLowerCase()].weight,l=e.oCharIsLowLevel?"accTrivial":"";e.oCharPortrait="img/account/characters/"+e.race.toLowerCase()+"_"+e.gender.toLowerCase()+I.cPNG,$("#chrSelection_"+e.oCharIndex).append("<img class='chrPortrait' src='"+e.oCharPortrait+"' /><var id='chrName_"+e.oCharIndex+"' class='chrName' data-value='"+s+"'>"+e.oCharName+"</var><span class='chrCommitment' data-value='"+c+"'><var class='chrProfession "+l+"'><ins class='chrProfessionIcon acc_prof acc_prof_"+t+"'></ins><sup>"+e.level+"</sup></var><var class='chrCrafting'>"+r+"</var></span><img class='chrProceed' src='img/ui/view.png' />").click(function(){var e=U.getSubintegerFromHTMLID($(this));A.CharIndexCurrent===e?(A.CharIndexCurrent=null,$(this).find(".chrProceed").animate({rotation:0},{duration:200,queue:!1}),$(this).removeClass("chrSelected")):(A.CharIndexCurrent=e,$(".chrProceed").animate({rotation:0},{duration:200,queue:!1}),$(this).find(".chrProceed").animate({rotation:T.cCIRCLE_RIGHT_DEGREE},{duration:200,queue:!1}),$(".chrSelection").removeClass("chrSelected"),$(this).addClass("chrSelected"),$("#accMenu_Hero").trigger("click"),A.adjustAccountScrollbar())}).dblclick(function(){var e=U.getSubintegerFromHTMLID($(this));I.prettyJSON(A.Data.Characters[e])});var u="<img class='chrPrefaceIcon' src='"+e.oCharPortrait+"' /><ins class='acc_prof acc_prof_"+e.oCharElite+" "+l+"'></ins>";e.oCharPreface="<span class='chrPreface'>"+u+e.oCharName+"</span>",e.oCharIcons="<span class='chrPreface' title='"+e.oCharName+"'>"+u+"</span>",I.qTip.init($("#chrSelection_"+e.oCharIndex).find(".chrCommitment").attr("title",o))},generateCharactersStatistics:function(){var e=new Date,t=e.getTime(),n=D.getWord("h"),a=D.getWord("d"),i=D.getWord("y"),r=0,o=0,s=0,c=0,l=0,u=function(e){for(var t,n,a=A.Metadata.WvWRank,i=a.Ranks,r="",o="",s="",c=i.length,l=0;c>l;l++)if(i[l]>e){t=(l-1)%a.RanksPerModifier,n=~~((l-1)/a.RanksPerModifier),r=D.orderModifier(D.getObjectTranslation(a.Titles[t]),D.getObjectTranslation(a.Modifiers[n])),c>l&&(t=l%a.RanksPerModifier,n=~~(l/a.RanksPerModifier),s=D.orderModifier(D.getObjectTranslation(a.Titles[t]),D.getObjectTranslation(a.Modifiers[n])),o=e+" + "+(i[l]-e)+'<img src="img/account/summary/worldabilitypoint.png" /> = '+s);break}return e<i[c-1]||(r=D.orderModifier(D.getObjectTranslation(a.Titles[a.Titles.length-1]),D.getObjectTranslation(a.Modifiers[a.Modifiers.length-1]))),"<var id='chrAccountWvWRank' title='"+o+"'>"+r+"</var>"};A.Data.Characters.forEach(function(e){r<e.age&&(r=e.age),o<e.deaths&&(o=e.deaths),e.oCharLifetime=~~((t-new Date(e.created).getTime())/T.cMSECONDS_IN_SECOND),s<e.oCharLifetime&&(s=e.oCharLifetime)}),A.Data.Characters.forEach(function(e){var t="<abbr>"+e.oCharName+"</abbr>";c+=e.age,l+=e.deaths;var u=Math.round(e.age/T.cSECONDS_IN_HOUR),d=e.age/r*T.cPERCENT_100,p=e.deaths/o*T.cPERCENT_100,h="<var class='chrAge' title='"+T.formatTimeLetter(e.age)+"' data-value='"+u+"'>"+u+n+"</var><span class='chrHoverName'>"+t+I.getBar(d,!0)+I.getBar(p)+"</span><var class='chrDeaths' title='"+T.parseRatio(e.deaths/u,3)+"x / 1"+n+"' data-value='"+e.deaths+"'>"+e.deaths+"x</var>";$("#chrUsage_"+e.oCharIndex).append(h);var g=new Date(e.created).toLocaleString(),m=~~(e.oCharLifetime/T.cSECONDS_IN_YEAR),f=~~(e.oCharLifetime/T.cSECONDS_IN_DAY),C=e.oCharLifetime/s*T.cPERCENT_100,v=~~(e.oCharLifetime%T.cSECONDS_IN_YEAR/T.cSECONDS_IN_DAY),b=T.cDAYS_IN_YEAR-v,S=v/T.cDAYS_IN_YEAR*T.cPERCENT_100,y="<var class='chrLifetime' data-value='"+e.oCharLifetime+"'>"+f+a+" ("+m+i+")</var><span class='chrHoverName'>"+t+I.getBar(C,!0)+I.getBar(S)+"</span><var class='chrBirthday' data-value='"+v+"'>"+b+a+"</var><var class='chrBirthdate'>"+g+"</var>";$("#chrSeniority_"+e.oCharIndex).append(y)}),$(".chrStats li").hover(function(){$("#chrSelection_"+U.getSubstringFromHTMLID($(this))).css({outline:"1px solid red"})},function(){$("#chrSelection_"+U.getSubstringFromHTMLID($(this))).css({outline:"none"})});var d=" <b class='chrHeaderToggle'>"+I.Symbol.TriDown+"</b>";$("#chrSelection").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrName'>"+A.Data.Characters.length+" "+D.getWordCapital("characters")+d+"</var><var class='chrHeaderRight curClick' data-classifier='chrCommitment'>"+D.getWordCapital("profession")+d+"</var></li>"),$("#chrUsage").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrAge'>"+D.getWordCapital("age")+d+"</var><var class='chrHeaderRight curClick' data-classifier='chrDeaths'>"+D.getWordCapital("deaths")+d+"</var></li>"),$("#chrSeniority").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrLifetime'>"+D.getWordCapital("lifetime")+d+"</var><var class='chrHeaderRight curClick' data-classifier='chrBirthday'>"+D.getWordCapital("birthday")+d+"</var></li>"),$(".chrHeaderLeft, .chrHeaderRight").click(function(){V.toggleSortableHeader($(this)),V.sortCharacters($(this).attr("data-classifier"),$(this).data("isdescending"))}),$.getJSON(A.getURL(A.URL.Account),function(e){A.Data.Account=e;var a=U.escapeHTML(e.name.split(".")[0]),i=U.convertPrivateAnchor("https://forum-en.guildwars2.com/members/"+e.name.replace(/[\s\.]/g,"-")+"/showposts"),r=Math.round(c/T.cSECONDS_IN_HOUR),o=new Date(e.created),s=~~((t-o.getTime())/T.cMSECONDS_IN_SECOND),d=T.formatTimeLetter(s).trim(),p=T.parseRatio(c/s*T.cHOURS_IN_DAY,2),h=e.commander?"":"accTrivial",g=e.wvw_rank?" "+u(e.wvw_rank):"",m=e.access?"":"accTrivial",f="<span id='chrAccountMisc'><dfn><a id='chrAccountLink' title='"+U.escapeHTML(e.id)+"'"+i+">"+U.escapeHTML(e.name)+"</a></dfn><br />"+o.toLocaleString()+"<br /><img class='"+h+"' src='img/account/summary/commander.png' /><img class='"+m+"' src='img/account/summary/access_hot.png' /> <img src='img/account/summary/fractal.png' />"+(e.fractal_level||"?")+" <img src='img/account/summary/worldabilitypoint.png' />"+(e.wvw_rank||"?")+" <img src='img/account/summary/daily.png' />"+(e.daily_ap||"?")+" <img src='img/account/summary/monthly.png' />"+(e.monthly_ap||"?")+"</span><br />",C="<var id='chrAccountName'>"+a+"</var>"+f+"<var id='chrAccountServer'></var>"+g+"<br /><var id='chrAccountAge' title='"+p+n+" / "+T.cHOURS_IN_DAY+n+"<br />"+T.formatTimeLetter(c)+" / "+d+"'>"+r+n+"</var> / <var id='chrAccountDeaths' title='"+T.parseRatio(l/r,3)+"x / 1"+n+"'>"+l+"x</var> &nbsp; <var id='chrAccountLifetime'>"+d+"</var> &nbsp; <button id='chrAccountReload' title='<dfn>Reload</dfn> characters data (statistics, equipment, inventory).'><img src='img/ui/refresh.png' /></button>";$("#chrSummary").append(C),I.qTip.init("#chrSummary var, #chrAccountReload"),$("#chrAccountReload").click(function(){$(".accCharDependent").each(function(){A.wipeDish($(this).attr("data-section"))}),I.qTip.hide(),A.regenerateDish("Characters")}),$.getJSON(U.URL_API.Worlds+e.world,function(e){Array.isArray(e)&&e.length>0&&$("#chrAccountServer").text(e[0].name)}),A.initializeGuilds(function(){var t=e.guilds;A.Data.Characters.forEach(function(e){if(e.guild){var t="<sup class='chrTag'>["+A.Data.Guilds[e.guild].tag+"]</sup>";$("#chrName_"+e.oCharIndex).append(t)}});var n="<li class='chrHeader'><var class='chrHeaderLeft'>"+D.getWordCapital("guilds")+"</var></li>";$("#chrGuilds").append(n);for(var a in t){var i=A.Data.Guilds[t[a]],r=U.getGuildBannerURL(i.guild_name),o="<li class='chrGuild'><span class='chrGuildHover'><img class='chrGuildBanner' src='"+r+"' /><img class='chrGuildBanner chrGuildBannerLarge' src='"+r+"' /></span><var class='chrGuildName'>"+i.guild_name+" ["+i.tag+"]</var></li>";$("#chrGuilds").append(o)}}),V.initializeWallet(),$("#chrSummary").show("fast")}),I.qTip.init("#accPlatterCharacters var"),$(".chrStats").show("fast")},initializeWallet:function(){var e=function(e,t){var n=$("<ul id='chrWallet_"+t+"' class='chrStats chrWallet'></ul>").insertBefore("#chrGuilds"),a="";switch(t){case"General":a=D.getModifiedWord("currencies","general",U.CaseEnum.Every);break;case"Dungeon":a=D.getModifiedWord("tokens","dungeon",U.CaseEnum.Every);break;case"Map":a=D.getModifiedWord("tokens","map",U.CaseEnum.Every)}var i=" <b class='chrHeaderToggle'>"+I.Symbol.TriDown+"</b>";n.append("<li class='chrHeader'><var class='chrHeaderLeft curClick'>"+a+i+"</var></li>"),V.bindSortableList(n);for(var r,o,s,c,l,u=0;u<e.length;u++)r=e[u],s=A.Data.Wallet[r.id],s=void 0===s||null===s?0:s,c=r.coefficient,r.value="gem"===c?E.convertGemToCoin(s):void 0===c?s:s*c,r.payment&&(A.Currency.AuditWallet[r.id]=r);for(var d=T.getMinMax(e,"value").oMax,u=0;u<e.length;u++){switch(r=e[u],s=A.Data.Wallet[r.id],s=void 0===s||null===s?0:s,l=s.toLocaleString(),o=r.value,r.id){case 1:l=E.formatCoinStringColored(s);break;case 2:l=E.formatKarmaString(s,!0);break;case 3:l=E.formatLaurelString(s,!0);break;case 4:l=E.formatGemString(s,!0)}var p=o/d*T.cPERCENT_100,h=U.getWikiLinkDefault(D.getObjectDefaultName(r));n.append("<li data-value='"+o+"'><var class='chrWalletAmount'>"+l+"</var><ins class='acc_wallet acc_wallet_"+r.id+"'></ins><var class='chrWalletCurrency'><a class='chrWalletLink'"+U.convertExternalAnchor(h)+">"+D.getObjectName(r)+"</a></var>"+I.getBar(p)+"</li>")}};$.getJSON(A.getURL(A.URL.Wallet),function(t){E.updateExchangeRatios(function(){A.Data.Wallet=null,A.Data.Wallet={};for(var n=0;n<t.length;n++){var a=t[n];A.Data.Wallet[a.id]=parseInt(a.value)}var i=A.Currency.Wallet;for(var n in i)e(i[n],n);V.serveAudit()})})},requireCharacters:function(e){return $("#accDish_Characters").is(":empty")?(V.serveCharacters(e),$("#accMenu_Characters").trigger("click"),!0):!1},serveHero:function(){if(!V.requireCharacters("Hero")){if(!A.Data.Characters[0].equipment)return void A.printError(A.PermissionEnum.Builds);var e=$("#eqpContainer_"+A.CharIndexCurrent),t=$(".eqpContainer");null!==A.CharIndexCurrent?(V.generateHero(),t.hide(),e.show()):(A.Data.Characters.forEach(function(e){V.generateHero(e)}),t.show())}},createHeroMenu:function(){var e=A.getDishMenu("Hero"),t=$("<div class='eqpSelectContainer'></div>").appendTo(e);A.Data.Characters.forEach(function(e){var n=$("<span class='eqpSelect curClick' title='"+e.oCharName+" ("+e.level+")' style='border-left: 2px solid "+e.oCharColor+"'><img class='eqpSelectPortrait' src='"+e.oCharPortrait+"' /><img class='eqpSelectProfession' src='img/account/classes/"+e.oCharElite+".png' /></span>").appendTo(t);e.oCharIsLowLevel&&n.addClass("accTrivial"),function(e){n.click(function(){var t=$("#eqpContainer_"+e);t.is(":visible")?I.scrollToElement(t,{aContainer:$("#accDish_Hero").parent(),aOffset:-($("#accOverhead").height()+32),aSpeed:"fast"}):($("#chrSelection_"+A.CharIndexCurrent).trigger("click"),$("#chrSelection_"+e).trigger("click")),A.adjustAccountScrollbar()})}(e.oCharIndex)}),I.qTip.init(t.find(".eqpSelect"))},generateHero:function(e){var t=e||A.getCurrentCharacter();if(void 0!==t&&null!==t&&Array.isArray(t.equipment)!==!1&&!$("#eqpContainer_"+t.oCharIndex).length){var n=$("#accDish_Hero"),a=$("<div id='eqpContainer_"+t.oCharIndex+"' class='eqpContainer'></div>").appendTo(n);$("<div class='eqpCharSeparator'><img class='eqpCharPortrait' src='"+t.oCharPortrait+"' /><img class='eqpCharProfession' src='img/account/classes/"+t.oCharElite+".png' /><span class='eqpCharName'>"+t.oCharName+"</span></div>").appendTo(a);var i=$("<div class='eqpSubcontainer eqpSubcontainer_"+t.profession+"'></div>").appendTo(a),r=$("<div class='eqpLeft eqpColumn'></div>").appendTo(i),o=$("<div class='eqpRight eqpColumn'></div>").appendTo(i),s=$("<div class='eqpBuild eqpColumn'></div>").appendTo(i),c=A.Equipment,l=c.ColumnLeft,u=c.ColumnRight,d=c.BriefRight,p=c.ToggleableSlots,h=c.GatheringCharges,g=$("<div class='eqpAttrWindow'><aside class='eqpAttrHeader'><span class='eqpAttrTitle'>"+D.getWordCapital("attributes")+"</span></aside><aside class='eqpAttrContent'></aside></div>").appendTo(s),m=new A.Attribute.Base,f=t.equipment.length,C=0,v=function(e){return"<aside class='eqpRow eqp"+e+"'><span class='eqpSlotOuter'><span class='eqpSlot eqpSlot_"+e+"' style='background-image:url(\"img/account/equipment/"+e.toLowerCase()+".png\")'></span></span><span class='eqpBrief eqpBrief_"+e+"'></span></aside>"
},b=function(e){return"<aside class='eqpCell eqp"+e+"'><span class='eqpSlot eqpSlot_"+e+"' style='background-image:url(\"img/account/equipment/"+e.toLowerCase()+".png\")'></span></aside>"},T=function(e){var t="",n=e.oItem.level<A.Metadata.ProfLevel.Max?" ("+e.oItem.level+")":"";return t="<span class='eqpBriefName "+Q.getRarityClass(e.oItem.rarity)+"'>"+e.oItem.name+n+"</span><br />",e.oInfusions.forEach(function(e){t+="<span class='"+Q.getRarityClass(e.rarity)+"'><img src='"+e.icon+"' /> "+e.name+"</span><br />"}),e.oUpgrades.forEach(function(e){t+="<span class='"+Q.getRarityClass(e.rarity)+"'><img src='"+e.icon+"' /> "+e.name+"</span><br />"}),t},S=function(){var e=g.find(".eqpAttrContent"),n=Q.calculateAttributes(m,t);for(var a in n)e.append("<span class='eqpAttrBlock eqpAttr_"+a+"' title='<dfn>"+D.getString(a)+"</dfn>'><img src='img/account/attributes/"+a.toLowerCase()+".png' /><var class='eqpAttrSum'>"+n[a]+"</var><var class='eqpAttrBonus'>+"+m[a]+"</var></span>");e.find(".eqpAttr_Power").after("<span class='eqpAttrBlock eqpAttr_Profession'><img src='img/account/attributes/"+t.oCharElite.toLowerCase()+".png' /><var>0%</var></span>"),I.qTip.init(e.find("span"))},y=function(){var e=t.specializations,n=t.skills;if(void 0!==e){var i=$("<div class='spzWindow'><aside class='spzSwitchContainer'><span class='spzSwitchWrapper'><img class='spzBuildIcon' src='img/account/menu/build.png' /><img src='img/ui/view.png' /><img class='spzSwitch curClick' data-assoc='PVE' src='img/ui/pages/map.png' /><img class='spzSwitch curClick' data-assoc='WVW' src='img/ui/pages/wvw.png' /><img class='spzSwitch curClick' data-assoc='PVP' src='img/account/menu/pvp.png' /></span></aside><div class='spzContainer'><div class='spzPanel spzPanel_PVE'></div><div class='spzPanel spzPanel_WVW'></div><div class='spzPanel spzPanel_PVP'></div></div><div class='sklContainer'><div class='sklPanel sklPanel_PVE'></div><div class='sklPanel sklPanel_WVW'></div><div class='sklPanel sklPanel_PVP'></div></div></div>").appendTo(s);i.find(".spzSwitch").each(function(){$(this).click(function(){i.find(".spzSwitch").removeClass("spzSwitchFocused"),$(this).addClass("spzSwitchFocused");var t=$(this).attr("data-assoc"),a=t.toLowerCase(),r=i.find(".spzPanel_"+t),o=i.find(".sklPanel_"+t);i.find(".spzPanel").hide(),i.find(".sklPanel").hide(),r.show(),o.show(),V.generateTraits(e[a],r),V.generateSkills(n[a],o)})}),a.one("mouseover",function(){i.find(".spzSwitch:first").trigger("click")})}},k=function(){A.setProgressBar(C,f),f===C&&(S(),y())};l.forEach(function(e){r.append(v(e))}),r.find(".eqpWeaponA2").after("<aside class='eqpSwap'><img class='eqpSwapIcon' src='img/account/equipment/swap.png' /></aside>"),r.find(".eqpWeaponA1").after("<span class='eqpSwapOuter eqpSwapA'><img class='eqpSwapIcon' src='img/account/equipment/swapa.png' /></span>"),r.find(".eqpWeaponB1").after("<span class='eqpSwapOuter eqpSwapB'><img class='eqpSwapIcon' src='img/account/equipment/swapb.png' /></span>"),u.forEach(function(e){o.append(b(e))}),o.prepend("<aside class='eqpSepTrinket'></aside>");var E=$("<aside class='eqpBriefRight'></aside>").prependTo(o);d.forEach(function(e){E.append("<span class='eqpBrief eqpBrief_"+e+"' style='display:none;'></span>")}),o.find(".eqpRing2").after("<aside class='eqpSepGathering'><span class='eqpSepInner'></span></aside>"),o.find(".eqpPick").after("<aside class='eqpSepUnderwater'><span class='eqpSepInner'></span></aside>"),o.find(".eqpWeaponAquaticA").after("<aside class='eqpSwapAquatic eqpCell'><img class='eqpSwapIcon' src='img/account/equipment/swap.png' /></aside>"),o.find(".eqpWeaponAquaticA").after("<span class='eqpSwapAquaticOuter eqpSwapAquaticA'><img class='eqpSwapIcon' src='img/account/equipment/swapaquatica.png' /></span>"),o.find(".eqpWeaponAquaticB").after("<span class='eqpSwapAquaticOuter eqpSwapAquaticB'><img class='eqpSwapIcon' src='img/account/equipment/swapaquaticb.png' /></span>"),o.append("<img class='eqpAquaticBackground' src='img/account/equipment/aquatic.png' />");var _=Q.countRuneSets(t);for(var P in t.equipment)!function(e){Q.getItem(e.id,function(n){var a=$("#eqpContainer_"+t.oCharIndex),r=a.find(".eqpSlot_"+e.slot),o=e.skin?"img/ui/placeholder.png":n.icon,s=$("<img class='eqpIcon' src='"+o+"' />").appendTo(r);Q.scanItem(n,{aElement:r,aItemMeta:e,aRuneSets:_,aWantAttr:!0,aCallback:function(t){a.find(".eqpBrief_"+e.slot).append(T(t)).show();var r=null;t.oSkin&&(r=t.oSkin.name,s.attr("src",t.oSkin.icon)),A.Equipment.AttributableSlots[e.slot]&&Q.sumAttributeObject(m,t.oAttr),p[e.slot]&&i.find(".eqpSlot_"+e.slot).prepend("<img class='eqpCheckbox' src='img/ui/checkbox.png' />"),"Gathering"===n.type&&n.rarity!==Q.RarityEnum.Rare&&(s.attr("src",t.oItem.icon),i.find(".eqpSlot_"+e.slot).prepend("<span class='eqpCharges'>"+h[n.details.type]+"</span>")),Q.bindItemSlotBehavior(s,{aItem:t.oItem,aSearch:r,aWantClick:!0}),C++,k()}})})}(t.equipment[P]);if(0===t.equipment.length&&k(),A.Metadata.Profession[t.oCharProfession].isswappable===!1){var L=[".eqpSwap",".eqpSwapB",".eqpWeaponB1",".eqpWeaponB2"],M=[".eqpSwapAquatic",".eqpSwapAquaticB",".eqpWeaponAquaticB"];L.forEach(function(e){i.find(e).css({visibility:"hidden"})}),M.forEach(function(e){i.find(e).hide()}),o.find(".eqpAquaticBackground").addClass("eqpAquaticBackgroundSingle"),o.find(".eqpHelmAquatic").addClass("eqpHelmAquaticSingle")}}},generateTraits:function(e,t){if(void 0!==e&&t.is(":empty")!==!1){var n=function(e,n){var i=$("<aside class='spzLine'><span class='spzLineBackground'></span><span class='spzLineForeground'></span><span class='spzLineContent'><span class='spzSpecSide'><var class='spzSpecSideIcon'></var></span><span class='spzSpecColumn'><var class='spzSpecName'></var></span><span class='spzColumn'><var class='spzMinor spzMinor_10' data-tier='0'><em class='spzCon_01'></em></var></span><span class='spzColumn'><var class='spzMajor_10'><em class='spzCon_10L'></em><em class='spzCon_10R'></em></var><br /><var class='spzMajor_11'><em class='spzCon_11L'></em><em class='spzCon_11R'></em></var><br /><var class='spzMajor_12'><em class='spzCon_12L'></em><em class='spzCon_12R'></em></var><br /></span><span class='spzColumn'><var class='spzMinor spzMinor_20' data-tier='1'></var></var></span><span class='spzColumn'><var class='spzMajor_20'><em class='spzCon_20L'></em><em class='spzCon_20R'></em></var><br /><var class='spzMajor_21'><em class='spzCon_21L'></em><em class='spzCon_21R'></em></var><br /><var class='spzMajor_22'><em class='spzCon_22L'></em><em class='spzCon_22R'></em></var><br /></span><span class='spzColumn'><var class='spzMinor spzMinor_30' data-tier='2'></var></span><span class='spzColumn'><var class='spzMajor_30'><em class='spzCon_30L'></em></var><br /><var class='spzMajor_31'><em class='spzCon_31L'></em></var><br /><var class='spzMajor_32'><em class='spzCon_32L'></em></var><br /></span></span></aside>").appendTo(t);i.find("img").attr("src","img/ui/placeholder.png");var r=function(e){var t=A.Data.Traits[e],r=i.find(".spz"+t.slot+"_"+t.tier+t.order);r.css({backgroundImage:"url("+t.icon+")"});var o="",s="",c=r.attr("data-tier");(a[e]||n[c])&&(r.find("em").show(),o="spzActive","Major"===t.slot&&(s="<span class='spzMajorName'>"+t.name+"</span>")),r.append(s+"<mark class='"+o+"'>"+I.Symbol.Filler+"</mark>"),Q.analyzeSkillTrait(t,{aElement:r})},o=function(){var t=A.Data.Specializations[e];i.css({backgroundImage:"url("+t.background+")"}),i.find(".spzSpecName").text(t.name),t.elite&&i.find(".spzLineBackground").addClass("spzLineBackgroundElite");for(var n=t.minor_traits.concat(t.major_traits),a=0;a<n.length;a++){var o=n[a];A.Data.Traits[o]?r(o):!function(e){$.getJSON(U.getAPITrait(e),function(t){A.Data.Traits[e]=t,r(e)})}(o)}};A.Data.Specializations[e]?o():$.getJSON(U.getAPISpecialization(e),function(t){A.Data.Specializations[e]=t,o()})},a={};e.forEach(function(e){e&&(e.traits&&e.traits.forEach(function(e){e&&(a[e]=!0)}),n(e.id,e.traits))})}},generateSkills:function(e,t){if(void 0!==e&&t.is(":empty")!==!1){var n=$("<div class='sklBar'></div>").appendTo(t),a=function(e,t){e?$.getJSON(U.getAPISkill(e),function(e){t.find(".sklSlotIcon").css({backgroundImage:"url("+e.icon+")"});for(var n=0;n<e.flags.length;n++)if("GroundTargeted"===e.flags[n]){t.append("<span class='sklSlotTarget'></span>");break}Q.analyzeSkillTrait(e,{aElement:t})}):t.find(".sklSlotSelect, .sklSlotForeground").hide()},i=function(e,t){return $("<aside class='sklSlot sklSlot_"+e+"'><span class='sklSlotSelect'></span><span class='sklSlotLocked'></span><span class='sklSlotIcon'></span><span class='sklSlotForeground'></span><span class='sklSlotHotkey'>"+t+"</span></aside>").appendTo(n)},r=i("heal","6");i("utilities0","7"),i("utilities1","8"),i("utilities2","9");var o=i("elite","0");a(e.heal,r);for(var s=0;s<e.utilities.length;s++)a(e.utilities[s],n.find(".sklSlot_utilities"+s));a(e.elite,o)}},serveEquipment:function(){if(!V.requireCharacters("Equipment")){if(!A.Data.Characters[0].equipment)return void A.printError(A.PermissionEnum.Builds);var e=$("#accDish_Equipment");if(A.reinitializeDish(e)!==!1){var t,n,a,i,r=B.createBank(e).find(".bnkBank"),o=0,s=0;A.Data.Characters.forEach(function(e){o+=e.equipment.length}),A.Data.Characters.forEach(function(e){n=B.createBankTab(r,{aTitle:e.oCharPreface}),a=n.find(".bnkTabSlots");for(var c=0;c<e.equipment.length;c++)t=e.equipment[c],i=B.createBankSlot(a),t&&!function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){s++,A.setProgressBar(s,o)}})})}(i,t)}),B.createBankMenu(r)}}},serveCleanup:function(){B.generateCatalog("Cleanup",{aIsCollection:!1,aIsLookup:!0,aWantGem:!1,aWantDefaultHelp:!1})},serveAscended:function(){B.generateCatalog("Ascended",{aWantGem:!1,aWantDefaultHelp:!1})},serveInventory:function(){if(!V.requireCharacters("Inventory")){if(!A.Data.Characters[0].bags)return void A.printError(A.PermissionEnum.Inventories);var e=$("#accDish_Inventory");if(A.reinitializeDish(e)!==!1){var t,n,a,i,r,o,s=B.createBank(e),c=s.find(".bnkBank").append(I.cThrobber),l=0,u=0,d=0,p=0,h=0,g=0,m=function(e,n){var r=0,s=0;a=e.find(".bnkTabSlots");for(var c=0;c<n.bags.length;c++)if(o=n.bags[c])for(var l=0;l<o.inventory.length;l++)t=o.inventory[l],t&&r++;for(var c=0;c<n.bags.length;c++)if(o=n.bags[c])for(var l=0;l<o.inventory.length;l++)i=B.createBankSlot(a),t=o.inventory[l],t?(i.data("count",t.count),function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){s++,A.setProgressBar(s,r)}})})}(i,t)):B.styleBankSlot(i)};$.getJSON(A.getURL(A.URL.Shared),function(e){c.empty();var a=B.createBankTab(c,{aTitle:D.getPhraseOriginal("Shared Inventory")});l=0,u=e.length,h=e.length,d=0;for(var f=0;f<e.length;f++)i=B.createBankSlot(a.find(".bnkTabSlots"),"bnkSlotShared"),t=e[f],t&&(i.data("count",t.count),l++,p++,d+=t.count,g+=t.count,function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aSlotMeta:t})})}(i,t));B.updateTabTally(a,l,u,d);for(var f=0;f<A.Data.Characters.length;f++){l=0,u=0,d=0,r=A.Data.Characters[f],n=B.createBankTab(c,{aTitle:r.oCharPreface,aIsCollapsed:!0}),B.createInventorySidebar(n,r.bags),function(e,t){e.one("click",function(){m(e,t)})}(n,r);for(var C=0;C<r.bags.length;C++)if(o=r.bags[C]){for(var v=0;v<o.inventory.length;v++)t=o.inventory[v],t&&(l++,p++,t.count&&(d+=t.count,g+=t.count));u+=o.inventory.length,h+=o.inventory.length}B.updateTabTally(n,l,u,d)}B.updateBankTally(s,p,h,g),B.createBankMenu(c)})}}},serveCatalog:function(){B.generateCatalog("Catalog",{aIsCustomCatalog:!0})},serveRecipes:function(){if(!V.requireCharacters("Recipes")){if(!A.Data.Characters[0].recipes)return void A.printError(A.PermissionEnum.Inventories);var e=$("#accDish_Recipes");if(A.reinitializeDish(e)!==!1){var t=B.createBank(e,{aIsCollection:!0,aWantGem:!1}),n=t.find(".bnkBank").append(I.cThrobber);$.getScript(U.URL_DATA.Recipes).done(function(){var e,t,a,i,r={},o=GW2T_RECIPES_METADATA,s=GW2T_RECIPES_DATA,c={},l={};for(var u in s){e=u.split("_")[0];for(var d=0;d<s[u].length;d++)t=s[u][d],void 0===c[t.u]?c[t.u]={oItemID:t.i,oDisciplines:[e]}:c[t.u].oDisciplines.push(e)}var p=[];A.Data.Characters.forEach(function(t){p=U.getUnion(p,t.recipes);for(var n=0;n<t.recipes.length;n++)if(a=t.recipes[n],c[a]){i=c[a].oItemID;for(var r=c[a].oDisciplines,o="",s=0;s<r.length;s++)e=r[s],t.oCharCraft&&t.oCharCraft[e]&&(o+="<ins class='acc_craft acc_craft_"+e.toLowerCase()+"'></ins>");o.length&&(void 0===l[i]&&(l[i]=[]),l[i].push(t.oCharName+o))}});var h=D.getPhrase("crafted by",U.CaseEnum.Sentence)+": ";for(var u in s)for(var d=0;d<s[u].length;d++){var t=s[u][d];l[t.i]&&(t.oComment="<var class='itmColor_reminder'>"+h+l[t.i].join(", ")+"</var>")}var g,m=D.getFullySupportedLanguage();for(var u in o.Disciplines)for(var d in o.Types)g=u+"_"+d,r[g]={},r[g]["name_"+m]=o.Disciplines[u][m]+" "+o.Types[d][m];B.generateUnlockables(n,{aHeaders:r,aRecord:s,aUnlockeds:p,aIsCollapsed:!0,aHelpMessage:$("#accHelpRecipes").html(),aTabIterator:function(e){var t=e.split("_")[0],a=D.getObjectName(r[e]),i="<ins class='bnkTabIcon acc_craft acc_craft_"+t.toLowerCase()+"'></ins><ins class='bnkTabIcon acc_recipes acc_recipes_"+e.toLowerCase()+"'></ins>",o=B.createBankTab(n,{aTitle:a,aIcon:i,aIsCollapsed:!0});return o}});var f=$("#accDishMenu_Recipes").find(".bnkSearch .bnkSearchInput").first();Q.bindItemSearch(f,{aFillerText:null,aCallback:function(e){var t="&quot;<a"+U.convertExternalAnchor(U.getWikiLinkLanguage(e.name))+">"+e.name+"</a>&quot;";if(l[e.id]){var n=l[e.id].join(", ");I.write(t+" was learned and can be crafted by:<br /><br />"+n)}else I.write("None of your characters have learned how to craft "+t)}})})}}},serveBank:function(){var e=$("#accDish_Bank");if(A.reinitializeDish(e)!==!1){var t,n,a,i,r,o=B.createBank(e),s=o.find(".bnkBank").append(I.cThrobber);$.getJSON(A.getURL(A.URL.Bank),function(e){s.empty();for(var c=0,l=0,u=0,d=0;d<e.length;d++)e[d]&&l++;for(var d=0;d<e.length;d++)0!==d&&r%A.Metadata.Bank.NumSlotsPerTab!==0||r===e.length||(n=B.createBankTab(s),a=n.find(".bnkTabSlots")),r=d+1,i=B.createBankSlot(a),t=e[d],t?(i.data("count",t.count),c+=t.count,function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){u++,A.setProgressBar(u,l)}})})}(i,t)):B.styleBankSlot(i);B.tallyBank(o),s.append("<div class='bnkTabSeparator'><var class='bnkTabLocked'>"+I.Symbol.Filler+"</var></div>"),B.createBankMenu(s)}).fail(function(t,n){A.printError(A.PermissionEnum.Inventories,n),e.empty()})}},serveVault:function(){var e=$("#accDish_Vault");if(A.reinitializeDish(e)!==!1){var t,n,a,i,r,o,s=B.createBank(e),c=s.find(".bnkBank").append(I.cThrobber),l=[],u={0:D.getString("GuildStash"),1:D.getString("TreasureTrove"),2:D.getString("DeepCave")},d=function(){c.empty();var e=0,d=0,p=0;for(var h in A.Data.Vaults){r=A.Data.Vaults[h];var g={},m=0;r.forEach(function(e){e.inventory.forEach(function(e){e&&(d++,void 0===g[e.id]&&(g[e.id]=!0,m++))})}),r.oGuildID=h,r.oUniqueCount=m,l.push(r)}U.sortObjects(l,{aKeyName:"oUniqueCount",aIsDescending:!0});for(var h in l){r=l[h],t=A.Data.Guilds[r.oGuildID];for(var f=0;f<r.length;f++)o=r[f],n=B.createBankTab(c,{aTitle:t.oTag+" "+u[f]}),a=n.find(".bnkTabSlots"),o.inventory.forEach(function(t){i=B.createBankSlot(a),t?(i.data("count",t.count),e+=t.count,function(e,t){Q.getItem(t.id,function(n){B.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){p++,A.setProgressBar(p,d)}})})}(i,t)):B.styleBankSlot(i)})}B.tallyBank(s),B.createBankMenu(c,{aHelpMessage:$("#accHelpVault").html()})};$.getJSON(A.getURL(A.URL.Account),function(e){A.Data.Account=e,A.initializeVault(function(e){e?d():c.empty()})}).fail(function(e,t){c.empty(),A.printError(A.PermissionEnum.Account,t)})}},serveMaterials:function(){var e="Materials",t=$("#accDish_"+e);if(A.reinitializeDish(t)!==!1){var n=B.createBank(t,{aIsCollection:!1,aWantGem:!1}),a=n.find(".bnkBank").append(I.cThrobber),i=function(t){var n,i={};for(var r in t)n=t[r],n.count>0&&(i[n.id]={oCount:n.count});B.generateUnlockables(a,{aHeaders:U.getRecordHeader(e),aRecord:U.getRecordData(e),aUnlockeds:i,aWantSearchHighlight:!1,aWantDefaultHelp:!1})};$.getScript(U.URL_DATA.Materials).done(function(){$.getJSON(A.getURL(A.URL.Materials),function(t){Q.loadItemsSubdatabase(e.toLowerCase(),function(){i(t)})}).fail(function(e,n){A.printError(A.PermissionEnum.Inventories,n),t.empty()})})}},serveWardrobe:function(){var e=$("#accDish_Wardrobe");if(A.reinitializeDish(e)!==!1){var t,n,a,i=D.getWordCapital("gallery"),r=function(e,a){var r=t[a].set||a,o=n[r],s=$("<aside class='bnkTabHover'></aside>").prependTo(e.find(".bnkTabSeparator"));if("string"==typeof o)$("<button class='bnkTabHoverButton'>"+i+"</button>").click(function(e){e.stopPropagation(),U.openExternalURL(o)}).appendTo(s);else{var c=0;for(var l in o)c++,function(e){$("<button class='bnkTabHoverButton'><img src='img/account/characters/"+l.toLowerCase()+".png' /></button>").click(function(t){t.stopPropagation(),U.openExternalURL(e)}).appendTo(s)}(o[l]),c%2===0&&s.append("<br />")}},o=B.createBank(e,{aIsCollection:!0}),s=o.find(".bnkBank").append(I.cThrobber),c=function(e){n=GW2T_SKINS_GALLERIES,t=GW2T_SKINS_HEADERS,a=GW2T_SKINS_DATA,B.generateUnlockables(s,{aHeaders:t,aRecord:a,aUnlockeds:e,aIsCollapsed:!0,aHelpMessage:$("#accHelpWardrobe").html(),aTabIterator:function(e){var n=D.getObjectName(t[e]),a="<ins class='bnkTabIcon acc_wardrobe acc_wardrobe_"+e.toLowerCase()+"'></ins>",i=B.createBankTab(s,{aTitle:n,aIcon:a,aIsCollapsed:!0});return r(i,e),i}})};$.getScript(U.URL_DATA.Skins).done(function(){$.getJSON(A.getURL(A.URL.Skins),function(e){c(e)}).fail(function(t,n){A.printError(A.PermissionEnum.Unlocks,n),e.empty()})})}},serveUnlockables:function(e){var t=e,n=$("#accDish_"+t);if(A.reinitializeDish(n)!==!1){var a=B.createBank(n,{aIsCollection:!0}),i=a.find(".bnkBank").append(I.cThrobber),r=function(e){B.generateUnlockables(i,{aHeaders:U.getRecordHeader(t),aRecord:U.getRecordData(t),aUnlockeds:e})};$.getScript(U.URL_DATA[t]).done(function(){$.getJSON(A.getURL(A.URL[t]),function(e){Q.loadItemsSubdatabase(t.toLowerCase(),function(){r(e)})}).fail(function(e,t){A.printError(A.PermissionEnum.Unlocks,t),n.empty()})})}},serveOutfits:function(){V.serveUnlockables("Outfits")},serveMinis:function(){V.serveUnlockables("Minis")},serveFinishers:function(){V.serveUnlockables("Finishers")},serveDyes:function(){var e=$("#accDish_Dyes");if(A.reinitializeDish(e)!==!1){var t=B.createBank(e,{aClass:"bnkBankDyes",aIsCollection:!0,aWantGem:!1}),n=t.find(".bnkBank").append(I.cThrobber);$.getScript(U.URL_DATA.Dyes).done(function(){$.getJSON(A.getURL(A.URL.Dyes),function(e){B.generateUnlockables(n,{aHeaders:GW2T_DYES_HEADERS,aRecord:GW2T_DYES_DATA,aUnlockeds:e,aHelpMessage:$("#accHelpDyes").html(),aWantDefaultHelp:!1,aWantSearchHighlight:!1,aIsDyes:!0})}).fail(function(t,n){A.printError(A.PermissionEnum.Unlocks,n),e.empty()})})}},generateExchange:function(){var e=$("#accTrading"),t=100,n=200,a=$("#exgGoldSamples"),i=$("#exgGemSamples"),r=function(e){e.find("tr").each(function(e){$(this).css({opacity:0}).delay(e*(t/2)).animate({opacity:1},t)})},o=function(){setTimeout(function(){e.find(".cssBlur").removeClass("cssBlur")},n)},s=function(){a.empty().html(I.cThrobber),i.empty().html(I.cThrobber),E.updateExchangeRatios(function(){a.empty(),A.Metadata.Exchange.GoldSamples.forEach(function(e){a.prepend("<tr><td>"+e.toLocaleString()+"<img class='exgUnit' src='img/account/trading/gold_small.png' /></td><td>"+E.formatCoinToGem(e*E.Exchange.COPPER_IN_GOLD)+"</td><td>"+E.formatGemToMoney(E.convertCoinToGem(e*E.Exchange.COPPER_IN_GOLD))+"</td></tr>")}),r(a),i.empty(),A.Metadata.Exchange.GemSamples.forEach(function(e){i.prepend("<tr><td>"+e.toLocaleString()+"<img class='exgUnit' src='img/account/trading/gem_small.png' /></td><td>"+E.formatGemToCoin(e)+"</td><td>"+E.formatGemToMoney(e)+"</td></tr>")}),r(i)})};I.loadImg(e),$("#exgGoldTitle").text(D.getPhraseOriginal("Get Coin")),$("#exgGemTitle").text(D.getPhraseOriginal("Get Gem")),s();var c=$("#exgGoldCustom"),l=$("#exgGemCustom"),u=c.find(".exgCustomInput"),d=l.find(".exgCustomInput"),p=c.find(".exgCustomOutput0"),h=c.find(".exgCustomOutput1"),g=l.find(".exgCustomOutput0"),m=l.find(".exgCustomOutput1");u.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){var e=parseInt($(this).val());e>0&&E.updateGemInCoin(function(){p.html(E.formatCoinToGem(e*E.Exchange.COPPER_IN_GOLD)).addClass("cssBlur"),h.html(E.formatGemToMoney(E.convertCoinToGem(e*E.Exchange.COPPER_IN_GOLD))).addClass("cssBlur"),o()})})).trigger("input"),d.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){var e=parseInt($(this).val());e>0&&E.updateGemInCoin(function(){g.html(E.formatGemToCoin(e)).addClass("cssBlur"),m.html(E.formatGemToMoney(e)).addClass("cssBlur"),o()})})).trigger("input");var f=$("#exgItemSearch"),C=$("#exgItemQuantity"),v=$("#exgItemPriceType"),b=function(e){var t;e?(t=e,f.data("price",e)):t=f.data("price");var n=T.parseQuantity(C.val()),a=n*t,i=a>E.Exchange.COPPER_IN_GOLD?Math.ceil(a/E.Exchange.COPPER_IN_GOLD):1;u.val(i).trigger("input")};Q.bindItemSearch(f,{aCallback:function(e){E.getPrice(e.id,function(e){var t=v.prop("checked")?e.oPriceSell:e.oPriceBuy;b(t)})}}),C.change(function(){b()}),$("#exgReload").click(function(){u.trigger("input"),d.trigger("input"),s()})},generateRecent:function(){$("#trsRecentTitle").text(D.getPhraseOriginal("Recent"));var e,t,n,a=$("#trsRecentTable"),i=$("#trsRecentReload"),r=20,o=D.getWordCapital("bought"),s=D.getWordCapital("sold"),c=function(){var c=(new Date).getTime();a.empty(),i.removeClass("jsSuspended"),A.adjustAccountScrollbar();for(var l=0;l<e.length;l++)e[l].isBought=!0;n=e.concat(t),U.sortObjects(n,{aKeyName:"purchased",aIsDescending:!0}),n=n.slice(0,r),n.forEach(function(e){var t=$("<tr></tr>").appendTo(a);!function(e){Q.getItem(e.item_id,function(n){var a=new Date(e.purchased).toLocaleString(),i=e.isBought?o:s,r=e.quantity>1?"<var class='trsRecentCount'>"+e.quantity+"</var>":"";t.html("<td><span class='trsRecentItem'><span class='trsRecentSlot'><img class='trsRecentIcon' src='"+n.icon+"' />"+r+"</span><span class='trsRecentName'><var class='trsRecentType'>"+i+"</var>: <var class='"+Q.getRarityClass(n.rarity)+"'>"+n.name+"</var></span></span><span><var class='trsRecentTime' title='"+a+"'>"+T.formatMilliseconds(c-new Date(e.purchased).getTime())+"</var><var class='trsRecentPrice'>"+E.formatCoinStringColored(e.quantity*e.price)+"</var></span></td>");var l=t.find(".trsRecentSlot");I.qTip.init(t.find(".trsRecentTime")),Q.scanItem(n,{aElement:l}),Q.bindItemSlotBehavior(l,{aItem:n,aWantClick:!0})})}(e)})},l=function(){a.html("<tr><td class='trsRecentError'>"+D.getPhraseOriginal("No transactions")+".</td></tr>"),i.removeClass("jsSuspended")},u=function(){a.empty().html(I.cThrobber),$.getJSON(A.getURL(A.URL.HistoryBuys),function(n){e=n,$.getJSON(A.getURL(A.URL.HistorySells),function(e){t=e,c()}).fail(function(){l()})}).fail(function(){l()})};u(),i.click(function(){u(),$(this).addClass("jsSuspended")})},serveTrading:function(){var e=$("#accTrading");if(e.data("isloaded"))e.data("token")!==A.TokenCurrent&&(e.data("token",A.TokenCurrent),$("#trsRecentReload").trigger("click"));else{V.generateExchange(),V.generateRecent();var t=e.find("input").click(function(){$(this).select()});I.qTip.init(t),e.data("isloaded",!0)}},serveBuying:function(){B.generateTransactions("Buying",A.URL.CurrentBuys)},serveSelling:function(){B.generateTransactions("Selling",A.URL.CurrentSells)},serveBought:function(){B.generateTransactions("Bought",A.URL.HistoryBuys)},serveSold:function(){B.generateTransactions("Sold",A.URL.HistorySells)}},B={createBank:function(e,t){var n=t||{},a=$("<div class='bnkContainer'><div class='bnkTop'>"+(n.aTitle?"<aside class='bnkTitle'>"+n.aTitle+"</aside>":"")+"<aside class='bnkBankTally'></aside><aside class='bnkPrice'><var class='bnkPriceTitleA'></var><var class='bnkPriceValueA_Coin'></var> &nbsp; <var class='bnkPriceTitleB'></var><var class='bnkPriceValueB_Coin'></var></aside>"+(n.aIsCollection&&n.aWantGem!==!1?"<aside class='bnkGem'><var class='bnkPriceTitleA'></var><var class='bnkPriceValueA_Gem'></var> &nbsp; <var class='bnkPriceTitleB'></var><var class='bnkPriceValueB_Gem'></var></aside>":"")+"</div></div>").appendTo(e),i=$("<div class='bnkBank "+(n.aClass||"")+"'></div>").appendTo(a);if(i.css({width:(n.aSlotsPerRow||A.Metadata.Bank.NumSlotsHorizontal)*B.getBankSlotWidth()+"px"}),n.aIsCollection){var r=D.getWordCapital("unlocked")+": +",o=D.getWordCapital("locked")+": −";a.data("iscollection",!0),a.find(".bnkPriceTitleA").html(r),a.find(".bnkPriceTitleB").html(o),a.find(".bnkPriceValueA_Coin").html(E.formatCoinStringColored(0)),a.find(".bnkPriceValueB_Coin").html(E.formatCoinStringColored(0)),a.find(".bnkPriceValueA_Gem").html(E.formatGemString(0,!0)),a.find(".bnkPriceValueB_Gem").html(E.formatGemString(0,!0))}return a},getBankSlotWidth:function(e){var t=void 0!==e?e:O.Options.bol_condenseBank;return t?A.Metadata.Bank.SlotWidthCondensed:A.Metadata.Bank.SlotWidth},createBankTab:function(e,t){var n=t||{},a=$("<div class='bnkTab'></div>"),i=n.aIcon?n.aIcon:"",r=n.aTitle?"<var class='bnkTabText'>"+n.aTitle+"</var>":"",o=$("<div class='bnkTabSeparator curToggle'><aside class='bnkTabHeader'>"+i+r+"<var class='bnkTabPrice bnkTabPrice_Coin'></var><var class='bnkTabPrice bnkTabPrice_Gem'></var><var class='bnkTabToggle'></var><var class='bnkTabTally'></var></aside></div>").appendTo(a),s=o.find(".bnkTabToggle"),c=$("<div class='bnkTabSlots'></div>").appendTo(a);return o.click(function(e){if(e.which===I.ClickEnum.Left){var t=c.is(":visible");I.toggleToggleIcon(s,!t),c.slideToggle("fast")}}),n.aIsCollapsed&&(I.toggleToggleIcon(s,!1),c.hide()),n.aIsCustomCatalog?B.placeCatalogTab(e,a,n.aWantPrepend):n.aWantPrepend?e.prepend(a):e.append(a),a},getTallyString:function(e,t,n){var a=n?" "+n+I.Symbol.Quantity:"",i=e/t,r=1===i?"accSignificant":"accTrivial",o=1===i?"":"<span class='accTrifle'>"+(t-e)+"+</span>";return o+e+" / "+t+"<span class='"+r+"'> ("+U.convertRatioToPercent(i)+")"+a+"</span>"},updateTabTally:function(e,t,n,a){e.find(".bnkTabTally").html(B.getTallyString(t,n,a))},updateBankTally:function(e,t,n,a){e.find(".bnkBankTally").html(B.getTallyString(t,n,a))},tallyBank:function(e){var t=0,n=0,a=0;e.find(".bnkTabSlots").each(function(){var e=0,i=0,r=0,o=$(this).find(".bnkSlot");o.each(function(){var n=$(this).data("count");n&&(e+=n,t+=n,i++)}),r=o.length,B.updateTabTally($(this).parent(),i,r,e),n+=i,a+=r}),B.updateBankTally(e,n,a,t)},createInventorySidebar:function(e,t){if(void 0!==t){e.addClass("bnkTabInventory");var n=$("<div class='bnkSidebarContainer'></div>").prependTo(e),a=$("<div class='bnkSidebar'></div>").prependTo(n);$("<div class='bnkSidebarBorder'></div>").appendTo(n);var i,r,o=$("<div class='bnkSidebarColumn'></div>").appendTo(a);t.forEach(function(e){if(e){for(var t=0,n=0;n<e.inventory.length;n++)e.inventory[n]&&t++;i=$("<div class='bnkSidebarBagOuter'></div>").appendTo(o),r=$("<span class='bnkSidebarBag'><var class='bnkSidebarBagCount'>"+t+"/"+e.size+"</var></span>").appendTo(i),function(t){Q.getItem(e.id,function(e){t.css({backgroundImage:"url("+e.icon+")"}),Q.scanItem(e,{aElement:t}),Q.bindItemSlotBehavior(t,{aItem:e,aWantClick:!0})})}(r)}else i=$("<div class='bnkSidebarBagOuter'></div>").appendTo(o),r=$("<span class='bnkSidebarBag'><var class='bnkSidebarBagCount'></var></span>").appendTo(i)})}},createBankSlot:function(e,t){var n=document.createElement("span");return n.innerHTML="<var class='bnkSlotBackground "+(t||"")+"'></var><var class='bnkSlotIcon'></var><var class='bnkSlotForeground'></var>",n.className="bnkSlot",e[0].appendChild(n),$(n)},styleBankSlot:function(e,t){var n=t||{};if(t){var a=n.aSlotMeta.count||1,i=null,r={upgrades:!0,infusions:!0,skin:!0,bound_to:!0};for(var o in n.aSlotMeta)if(r[o]){i=n.aSlotMeta;break}Q.scanItem(n.aItem,{aElement:e,aItemMeta:i,aComment:n.aComment,aCallback:function(t){var i=t.oSkin?t.oSkin.icon:n.aItem.icon;e.find(".bnkSlotIcon").css({backgroundImage:"url("+i+")"}).addClass("bnkSlotRarity_"+n.aItem.rarity);var r=($(t.oHTML).text()+" "+D.getString(n.aItem.rarity)).toLowerCase();e.data("keywords",r);var o=n.aWiki||n.aItem.name;if(n.aBind?n.aBind(e,n.aItem):n.aIsCustomCatalog?B.bindCatalogSlot(e):e.click(function(e){if(e.which===I.ClickEnum.Left){var t=n.aWiki?U.getWikiSearchDefault(o):U.getWikiSearchLanguage(o);U.openExternalURL(t)}}),Q.bindItemSlotBehavior(e,{aItem:n.aItem,aTradeableID:n.aTradeableID,aSearch:o}),a>1){var s=a%Q.ItemLimit.StackSize===0?"bnkSlotCountMax":"";e.append("<var class='bnkSlotCount "+s+"'>"+a+"</var>")}else if("Tool"===n.aItem.type){var c=A.Equipment.SalvageCharges;c&&c[n.aItem.id]&&e.append("<var class='bnkSlotCount'>"+c[n.aItem.id]+"</var>")}else if("Gathering"===n.aItem.type){var l=A.Equipment.GatheringCharges;l&&n.aItem.rarity!==Q.RarityEnum.Rare&&e.append("<var class='bnkSlotCount'>"+l[n.aItem.details.type]+"</var>")}if(0===n.aSlotMeta.count?(e.addClass("bnkSlotZero"),e.data("count",n.aSlotMeta.count)):e.data("count",a),n.aPrice>0)B.updateSlotPrice(e,{aPrice:n.aPrice,aCount:n.aSlotMeta.count,aPaymentEnum:E.PaymentEnum.Coin});else if(n.aGem>0)B.updateSlotPrice(e,{aPrice:n.aGem,aCount:n.aSlotMeta.count,aPaymentEnum:E.PaymentEnum.Gem});else if(t.oIsTradeable||n.aTradeableID){e.addClass("bnkSlotTradeable"),e.data("istradeable",!0);var u=n.aTradeableID||n.aItem.id;E.getPrice(u,function(t){B.updateSlotPrice(e,{aPrice:t,aCount:n.aSlotMeta.count,aPaymentEnum:E.PaymentEnum.Coin,aTransactionBuy:n.aTransactionBuy,aTransactionSell:n.aTransactionSell}),n.aPriceCallback&&n.aPriceCallback(t)},!0)}n.aCallback&&n.aCallback()}})}else e.data("keywords","*")},updateSlotPrice:function(e,t){var n=t||{},a=e.parents(".bnkContainer"),i=a.find(".bnkTop"),r=a.data("iscollection"),o=e.parents(".bnkTab").find(".bnkTabPrice_"+n.aPaymentEnum),s=n.aCount||1,c="number"==typeof n.aPrice?n.aPaymentEnum?E.createPricePlain(n.aPrice,s):E.createPrice(n.aPrice,s):E.recountPrice(n.aPrice,s),l=r||n.aPaymentEnum?c.oPriceSell:c.oPriceSellTaxed;n.aTransactionBuy?(c=E.createPrice(n.aTransactionBuy),l=c.oPriceBuy):n.aTransactionSell&&(c=E.createPrice(n.aTransactionSell),l=c.oPriceSellTaxed);var u=function(e,t,a,i){var r=(e.data("priceleft")||0)+t,o=(e.data("priceright")||0)+a;e.data("priceleft",r).data("priceright",o);var s,c,l;switch(n.aPaymentEnum){case E.PaymentEnum.Coin:c=E.formatCoinStringShort(r),l=E.formatCoinStringShort(o),s=i?"+"+c+" −"+l:l+" <span class='accTrivial'>"+c+"</span>";break;case E.PaymentEnum.Gem:c=E.formatGemString(r,!0),l=E.formatGemString(o,!0),s=i?"+"+c+" −"+l:l}e.html(s)};switch(n.aPaymentEnum){case E.PaymentEnum.Coin:if(e.append("<var class='bnkSlotPrice'>"+E.formatCoinStringSlot(l)+"</var>"),e.data("istradeable")){var d="number"==typeof n.aPrice?E.createPrice(n.aPrice,1):E.recountPrice(n.aPrice,1);e.append("<var class='bnkSlotPriceBuy'>"+E.formatCoinStringSlot(d.oPriceBuy)+"</var>"),e.append("<var class='bnkSlotPriceSell'>"+E.formatCoinStringSlot(d.oPriceSell)+"</var>")}break;case E.PaymentEnum.Gem:e.append("<var class='bnkSlotPrice'>"+E.formatGemString(l,!0)+"</var>"),n.aCount>1&&e.append("<var class='bnkSlotPriceBuy'>"+E.formatGemString(n.aPrice,!0)+"</var>")}var p,h;r?(p=c.oPriceBuy,h=c.oPriceSell,0!==n.aCount?(u(o,c.oPriceSell,0,!0),u(i.find(".bnkPriceValueA_"+n.aPaymentEnum),p,h)):(u(o,0,c.oPriceSell,!0),u(i.find(".bnkPriceValueB_"+n.aPaymentEnum),p,h))):(n.aTransactionBuy?(p=c.oPriceBuy,h=c.oPriceBuy):n.aTransactionSell?(p=c.oPriceSell,h=c.oPriceSellTaxed):(p=c.oPriceBuyTaxed,h=c.oPriceSellTaxed),0!==n.aCount&&(u(o,p,h),u(i.find(".bnkPriceValueA_"+n.aPaymentEnum),p,h))),n.aPaymentEnum===E.PaymentEnum.Coin&&(e.data("price",l),e.data("pricebuy",c.oPriceBuy),e.data("pricesell",c.oPriceSell))},updateSlotPayment:function(e,t,n,a){for(var i in t){var r=t[i],o="";0>r&&(o="bnkSlotPriceTrivial",r*=-1),e.append("<var class='"+(a||"bnkSlotPrice")+" "+o+"'>"+E.PaymentFormat[i](r*(n||1))+"</var>")}},createBankMenu:function(e,t){var n=t||{},a=A.getDishName(e),i=A.getDishMenu(a);n.aWantClear&&i.empty();var r=$("<div class='bnkMenu'></div>").prependTo(i),o=e.find(".bnkTabSlots"),s=e.find(".bnkTabToggle"),c=$("<div class='bnkSearch'></div>").prependTo(r),l=$("<input class='bnkSearchInput' type='text' />").appendTo(c);
I.bindInputBarText(l),l.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){$(this).removeClass("cssSearchNone");var t,a,i=e.find(".bnkSlot"),r=$(this).val().toLowerCase(),o=[],s="",c=!1;if(r.length>0){if(t=r.charAt(0),a=r.charAt(1),"<"!==t&&">"!==t||r.length<=1)o=r.split(" "),i.each(function(){s=$(this).data("keywords");var e=!0;if(s)if(n.aWantSearchHighlight){for(var t=0;t<o.length;t++)if(-1===s.indexOf(o[t])){$(this).removeClass("bnkSlotMatch"),e=!1;break}e&&($(this).addClass("bnkSlotMatch"),c=!0)}else{for(var t=0;t<o.length;t++)if(-1===s.indexOf(o[t])){$(this).hide(),e=!1;break}e&&($(this).show(),c=!0)}});else{var l="<"===a||">"===a&&r.length>2,u=l?2:1,d=l?"pricesell":"pricebuy",p=E.parseCoinString(r.substring(u,r.length));i.each(function(){var e=$(this).data(d);e&&(">"===t&&e>=p||"<"===t&&p>=e)?($(this).show(),c=!0):$(this).hide()})}c===!1&&$(this).addClass("cssSearchNone",!c)}else i.each(function(){$(this).removeClass("bnkSlotMatch"),$(this).show()});A.adjustAccountScrollbar()})).click(function(){$(this).select()});var u=$("<aside class='bnkButtons'></aside>").appendTo(r);$("<div class='bnkButtonReload bnkButton curClick' title='<dfn>Reload</dfn> this bank.<br />Press this if the progress bar has frozen.'></div>").appendTo(u).click(function(){n.aReloadElement?n.aReloadElement.trigger("click"):A.regenerateDish(a)});var d=!0;$("<div class='bnkButtonHelp bnkButton curClick' title='Show this bank&apos;s <dfn>help</dfn> message.'></div>").appendTo(u).click(function(){var e=n.aHelpMessage?n.aHelpMessage:"";(d||I.isConsoleShown()===!1)&&I.help(e+$("#accHelpBank").html()),d=!d});var p=0;$("<div class='bnkButtonEmpty bnkButton curToggle' title='Filter:<br />1st click: non-empty/unlocked <dfn>slots</dfn><br />2nd click: "+Q.ItemLimit.StackSize+" stack slots<br />3rd click: empty/locked slots<br />4th click: any slot (reset)'></div>").appendTo(u).click(function(){var t=e.find(".bnkSlot");if(0===p||2===p){var n=0===p;t.each(function(){$(this).toggle($(this).data("count")>0?n:!n)}),$(this).addClass("bnkButtonFocused"),p++}else 1===p?(t.each(function(){$(this).data("count")<Q.ItemLimit.StackSize?$(this).hide():$(this).show()}),p++):(t.show(),$(this).removeClass("bnkButtonFocused"),p=0);A.adjustAccountScrollbar()});var h=!0;$("<div class='bnkButtonTrade bnkButton curToggle' title='Filter: <dfn>tradeable</dfn> items.'></div>").appendTo(u).click(function(){var t=e.find(".bnkSlot");h?t.each(function(){$(this).data("istradeable")?$(this).show():$(this).hide()}):t.show(),e.toggleClass("bnkTradeable",h),$(this).toggleClass("bnkButtonFocused"),h=!h,A.adjustAccountScrollbar()});var g=O.Options.bol_showRarity,m=function(t){e.toggleClass("bnkRarity",g),t.toggleClass("bnkButtonFocused")},f=$("<div class='bnkButtonRarity bnkButton curToggle' title='Show <dfn>rarity</dfn> colored boxes.<br />Change permanently at Options page, Account section.'></div>").appendTo(u).click(function(){g=!g,m($(this))});O.Options.bol_showRarity&&m(f);var C=O.Options.bol_condenseBank,v=function(t){e.toggleClass("bnkCondense",C),t.toggleClass("bnkButtonFocused"),e.css({width:A.Metadata.Bank.NumSlotsHorizontal*B.getBankSlotWidth(C)}),A.adjustAccountScrollbar()},f=$("<div class='bnkButtonCondense bnkButton curToggle' title='Toggle bank <dfn>size</dfn>.<br />Change permanently at Options page, Account section.'></div>").appendTo(u).click(function(){C=!C,v($(this))});O.Options.bol_condenseBank&&v(f);var b=!1;$("<div class='bnkButtonTab bnkButton curToggle' title='Expand/<dfn>Collapse</dfn> all tabs.'></div>").appendTo(u).click(function(){b?o.slideDown("fast",function(){A.adjustAccountScrollbar()}):o.slideUp("fast",function(){A.adjustAccountScrollbar()}),s.each(function(){I.toggleToggleIcon($(this),b)}),$(this).toggleClass("bnkButtonFocused"),b=!b}),$("<div class='bnkButtonWideLess bnkButton curClick' title='<dfn>Decrease</dfn> bank width.'></div>").appendTo(u).click(function(){var t=B.getBankSlotWidth(C),n=4*t,a=e.width();a>n&&(e.css({width:a-t}),A.adjustAccountScrollbar())}),$("<div class='bnkButtonWideMore bnkButton curClick' title='<dfn>Increase</dfn> bank width.'></div>").appendTo(u).click(function(){var t=B.getBankSlotWidth(C),n=$("#accContent").width()-2*t,a=e.width();n>a&&(e.css({width:a+t}),A.adjustAccountScrollbar())}),c.css({width:c.width()-u.width()}),I.qTip.init(u.find(".bnkButton")),A.adjustAccountPanel()},fillTab:function(e,t,n){for(var a,i,r=n||{},o=U.getObjectLength(t),s=0,c=e.find(".bnkTabSlots"),l=0;l<t.length;l++)a=B.createBankSlot(c),i=t[l],B.fillSlot(a,i.i||i,{aUnlockAssoc:r.aUnlockAssoc,aUnlockObj:i,aComment:i.oComment,aIsCatalog:r.aIsCatalog,aIsCustomCatalog:r.aIsCustomCatalog,aCallback:function(){s++,A.setProgressBar(s,o)}});r.aIsCustomCatalog&&B.bindCatalogTab(e)},fillDyeTab:function(e,t,n,a){var i,r,o=e.find(".bnkTabSlots"),s=GW2T_DYES_METADATA,c={};for(var l in s.Translations)c[l]=D.getObjectTranslation(s.Translations[l]);for(var l=0;l<t.length;l++)i=B.createBankSlot(o),r=t[l],function(e,t,r,o,l,u,d,p,h,g){e.find(".bnkSlotIcon").css({background:u[0]}),e.append("<var class='bnkSlotDyeName'>"+g+"</var>");var m=s.Rarities[a]?s.Rarities[a]:s.Rarities.Default;e.find(".bnkSlotIcon").addClass("bnkSlotRarity_"+m);var f=n[r]?1:0;f&&e.data("count",f),o&&(i.addClass("bnkSlotTradeable"),i.data("istradeable",!0),E.getPrice(o,function(t){B.updateSlotPrice(e,{aPrice:t,aCount:f,aPaymentEnum:E.PaymentEnum.Coin}),f&&e.find(".bnkSlotPrice").addClass("accTrivial")}));var C="<div class='bnkDyePreview'><aside class='bnkDyePreviewTitle'><var class='bnkDyePreviewName' style='color:"+u[0]+"'>"+g+"</var> ("+c[d]+" "+c[p]+")</aside><div class='bnkDyePreviewSwatches'><aside class='bnkDyePreviewSwatch' style='background:"+u[0]+"'><var class='bnkDyePreviewMaterial'>"+c.Vibrant+"</var></aside><aside class='bnkDyePreviewSwatch' style='background:"+u[1]+"'><var class='bnkDyePreviewMaterial'>"+c.Leather+"</var></aside><aside class='bnkDyePreviewSwatch' style='background:"+u[2]+"'><var class='bnkDyePreviewMaterial'>"+c.Metal+"</var></aside></div></div>";e.attr("title",C),I.qTip.init(e);var v=(g+" "+c[d]+" "+c[p]).toLowerCase();e.data("keywords",v),e.click(function(e){e.which===I.ClickEnum.Left&&U.openExternalURL(U.getWikiSearchDefault(l))}),Q.bindItemSlotBehavior(e,{aObject:t,aChatlink:h,aTradeableID:o,aSearch:l})}(i,r,r.u,r.i,r.n,r.c,r.h,r.m,r.l,D.getObjectTranslation(r))},fillSlot:function(e,t,n){var a=n||{},i=a.aUnlockAssoc,r=a.aUnlockObj,o="number"==typeof r?t:r.u,s=a.aIsCatalog&&r.u?r.u:null,c=r.n,l=r.p;Q.getItem(t,function(n){a.aIsCustomCatalog&&(e.data("itemid",t),o=t,c=n.name);var r,u,d;l&&(r=l.coin,u=l.gem,void 0!==u&&(0>u?u=0:d=u));var p=i[o],h=p?void 0!==p.oCount?p.oCount:1:0,g=a.aComment;if(p=i[t],a.aIsCatalog&&p){var m=D.getPhrase("found in",U.CaseEnum.Sentence)+": ";h=p.oCount,g="<var class='itmColor_reminder'>"+m+A.formatPossessionLocations(p)+"</var>"}B.styleBankSlot(e,{aItem:n,aTradeableID:s,aPrice:r,aGem:d,aSlotMeta:{count:h},aComment:g,aWiki:c,aIsCustomCatalog:a.aIsCustomCatalog,aCallback:function(){l&&(void 0===r&&void 0===u||0===r||0===u)&&B.updateSlotPayment(e,l,h)}}),a.aCallback&&a.aCallback()})},generateUnlockables:function(e,t){var n=t||{},a={};if(n.aIsCatalog)a=A.Possessions;else if(Array.isArray(n.aUnlockeds))if(isNaN(n.aUnlockeds[0]))for(var i=0;i<n.aUnlockeds.length;i++)a[n.aUnlockeds[i].id]=!0;else for(var i=0;i<n.aUnlockeds.length;i++)a[n.aUnlockeds[i]]=!0;else a=n.aUnlockeds;e.empty();var r,o,s,c,l=e.parents(".bnkContainer"),u={},d={};if(n.aIsCustomCatalog){var p=B.bindCatalog(e,a,n.aHeaders,n.aRecord);u=p.oHeaders,d=p.oRecord}else if(n.aIsLookup){u=n.aHeaders;for(var i in n.aRecord){d[i]=[],o=n.aRecord[i];for(var h=0;h<o.length;h++)a[o[h]]&&d[i].push(o[h])}}else u=n.aHeaders,d=n.aRecord;var g=0,m=0,f=0;for(var i in d){s=u[i],o=d[i],r=n.aTabIterator?n.aTabIterator(i):B.createBankTab(e,{aTitle:D.getObjectName(s),aIsCollapsed:s.iscollapsed,aIsCustomCatalog:s.iscustomtab}),function(e,t,i,r){n.aIsDyes?B.fillDyeTab(e,i,a,r):n.aIsCollapsed||t.iscollapsed?e.find(".bnkTabSeparator").one("click",function(){B.fillTab(e,i,{aUnlockAssoc:a,aIsCatalog:n.aIsCatalog})}):B.fillTab(e,i,{aUnlockAssoc:a,aIsCatalog:n.aIsCatalog,aIsCustomCatalog:t.iscustomtab})}(r,s,o,i);for(var C=0,v=0,h=0;h<o.length;h++)c=(n.aIsCatalog?o[h].i:o[h].u)||o[h],a[c]&&(C++,g++,a[c].oCount&&(v+=a[c].oCount));var b=o.length;m+=b,B.updateTabTally(r,C,b,v),v&&(f+=v)}B.updateBankTally(l,g,m,f);var T=void 0===n.aWantSearchHighlight?!0:n.aWantSearchHighlight,S=n.aWantDefaultHelp===!1?"":$("#accHelpUnlockables").html();B.createBankMenu(e,{aWantSearchHighlight:T,aHelpMessage:(n.aHelpMessage||"")+S,aIsCustomCatalog:n.aIsCustomCatalog})},generateCatalog:function(e,t){var n=$.extend({aIsCatalog:!0,aWantGem:!0,aWantSearchHighlight:!1},t),a=U.toFirstUpperCase(e),i=e.toLowerCase();if(!V.requireCharacters(a)){if(!A.Data.Characters[0].bags)return void A.printError(A.PermissionEnum.Inventories);var r=$("#accDish_"+a);if(A.reinitializeDish(r)!==!1){var o=$("#accHelp"+a);o.length&&(n.aHelpMessage=o.html());var s=B.createBank(r,{aIsCollection:void 0!==n.aIsCollection?n.aIsCollection:!0,aWantGem:n.aWantGem}),c=s.find(".bnkBank").append(I.cThrobber),l=function(){n.aHeaders=U.getRecordHeader(e),n.aRecord=U.getRecordData(e),B.generateUnlockables(c,n);var t=$("#accDishMenu_"+a).find(".bnkSearch .bnkSearchInput").first();Q.bindItemSearch(t,{aFillerText:null,aCallback:function(e){var t="&quot;<a"+U.convertExternalAnchor(U.getWikiLinkLanguage(e.name))+">"+e.name+"</a>&quot;";if(A.Possessions[e.id]){var n=A.formatPossessionLocations(A.Possessions[e.id]);I.print(t+" was found in:<br /><br />"+n)}else I.write("Nowhere in your account has the item "+t)}})};$.getScript(U.URL_DATA[a]).done(function(){Q.loadItemsSubdatabase(i,function(){A.initializePossessions(function(){l()})})})}}},placeCatalogTab:function(e,t,n){var a=e.find(".bnkCatalogTabContainer");a.length||(a=$("<div class='bnkCatalogTabContainer'></div>").prependTo(e)),n?a.prepend(t):a.append(t)},bindCatalogTab:function(e){e.addClass("bnkCatalogTab");var t=$("<kbd class='bnkCatalogTabEdit btnWindow' title='Click to <dfn>edit</dfn> this tab.<br />Click again to stop editing.<br />To edit custom slots, click the slot.'></kbd>").prependTo(e).click(function(){var t=$(this).parents(".bnkBank"),n=$(t.data("currenttab")),a=$(this).parents(".bnkTab").first(),i=t.data("tabeditor"),r=e.find(".bnkTabHeader");if(t.find(".bnkTabHeader").removeClass("bnkCatalogTabHighlight"),a.is(n)&&i.is(":visible"))i.hide(),t.data("currenttab",null),r.removeClass("bnkCatalogTabHighlight");else if(a.is(n)===!1||i.is(":visible")===!1){i.show(),t.data("currenttab",$(this).parents(".bnkTab")),r.addClass("bnkCatalogTabHighlight");var o=e.find(".bnkTabText").text();i.find(".bnkCatalogTabRename").val(o),i.find(".bnkCatalogSlotAdd").select().trigger("focus").trigger("click")}A.adjustAccountPanel()});I.qTip.init(t)},bindCatalogSlot:function(e){e.click(function(){var e=$(this).parents(".bnkBank");e.find(".bnkCatalogSlotHighlight").removeClass("bnkCatalogSlotHighlight");var t=e.data("currentslot"),n=e.data("sloteditor");$(this).is(t)&&n.is(":visible")?(n.hide(),e.data("currentslot",null),$(this).removeClass("bnkCatalogSlotHighlight")):($(this).is(t)===!1||n.is(":visible")===!1)&&(n.css({left:I.posX,top:I.posY}).show(),e.data("currentslot",$(this)),$(this).addClass("bnkCatalogSlotHighlight")),A.adjustAccountPanel()})},saveCatalog:function(e){var t=[];e.find(".bnkCatalogTab").each(function(){var e,n=[],a=$(this).find(".bnkTabSlots").first();a.find(".bnkSlot").each(function(){e=$(this).data("itemid"),e&&n.push(e)}),t.push({name:$(this).find(".bnkTabText").text(),items:n})}),localStorage[O.Utilities.CustomCatalog.key]=JSON.stringify(t)},bindCatalog:function(e,t,n,a){var i,r,o,s,c={},l={},u={},d=[];try{d=JSON.parse(localStorage[O.Utilities.CustomCatalog.key])}catch(p){}for(var h=0;h<d.length;h++){o=d[h];for(var g=0;g<o.items.length;g++)u[o.items[g]]=!0}for(var h in a){r=a[h];for(var g=r.length-1;g>=0;g--)u[r[g].i]&&r.splice(g,1)}for(var h=0;h<d.length;h++){o=d[h],s="Tab_"+h,c[s]={name_en:U.escapeHTML(o.name||""),iscustomtab:!0},l[s]=[];for(var g=0;g<o.items.length;g++)i=o.items[g],i&&l[s].push({i:i,n:null})}for(var h in n)c[h]=n[h];for(var h in a)l[h]=a[h];var m=$("<kbd class='bnkCatalogTabAdd btnWindow' title='<dfn>Add a custom bank tab.</dfn><br />To edit a custom tab or add an item to it, click the<img src=\"img/ui/edit.png\" />icon next to one.'></kbd>").appendTo(e).click(function(){if(e.find(".bnkCatalogTab").length<A.Metadata.Bank.CustomTabsLimit){var n=B.createBankTab(e,{aTitle:D.getPhraseTitle("rename tab"),aIsCustomCatalog:!0,aWantPrepend:!0});B.fillTab(n,[],{aUnlockAssoc:t,aIsCatalog:!0,aIsCustomCatalog:!0}),n.find(".bnkCatalogTabEdit").trigger("click")}else I.write("Custom tabs limit reached.")});I.qTip.init(m);var f=A.getDishName(e),C=A.getDishMenu(f),v=$("<div class='bnkCatalogTabEditor'></div>").appendTo(C).hide();e.data("tabeditor",v),$("<div class='bnkCatalogMenuClose bnkButton curClick' title='<dfn>Close</dfn> the tab editor.'></div>").appendTo(v).click(function(){var t=e.data("currenttab");t&&t.find(".bnkTabHeader").removeClass("bnkCatalogTabHighlight"),e.data("currenttab",null),v.hide(),A.adjustAccountPanel()});var b=$("<input class='bnkCatalogSlotAdd bnkSearchInput' type='text' />").appendTo(v);Q.bindItemSearch(b,{aFillerText:D.getPhraseTitle(D.orderModifier("item","new"))+"...",aCallback:function(n){var a=e.data("currenttab");if(a){var i=a.find(".bnkTabSlots"),r=B.createBankSlot(i);B.fillSlot(r,n.id,{aUnlockAssoc:t,aUnlockObj:n.id,aIsCatalog:!0,aIsCustomCatalog:!0}),B.saveCatalog(e)}}}),$("<input class='bnkCatalogTabRename bnkSearchInput' type='text' />").appendTo(v).change(function(){var t=e.data("currenttab");t&&(t.find(".bnkTabText").text($(this).val()),B.saveCatalog(e))}).click(function(){$(this).select()});var T=$("<aside class='bnkButtons'></aside>").appendTo(v);$("<div class='bnkCatalogTabUp bnkButton curClick' title='Move this tab <dfn>up</dfn>.'></div>").appendTo(T).click(function(){var t=e.data("currenttab");t&&t.prev()&&t.insertBefore(t.prev()),B.saveCatalog(e)}),$("<div class='bnkCatalogTabDown bnkButton curClick' title='Move this tab <dfn>down</dfn>.'></div>").appendTo(T).click(function(){var t=e.data("currenttab");t&&t.next()&&t.insertAfter(t.next()),B.saveCatalog(e)}),$("<div class='bnkCatalogTabDelete bnkButton curClick' title='<dfn>Delete</dfn> this custom bank tab.'></div>").appendTo(T).click(function(){var t=e.data("currenttab"),n=function(){t.remove(),v.hide(),A.adjustAccountPanel(),B.saveCatalog(e)};t&&(t.find(".bnkSlot").length>0?confirm("Delete this custom tab?")&&n():n())});var S=$("<div class='bnkCatalogSlotEditor'></div>").appendTo(C).hide();e.data("sloteditor",S),$("<div class='bnkCatalogMenuClose bnkButton curClick' title='<dfn>Close</dfn> the slot editor.'></div>").appendTo(S).click(function(){var t=e.data("currentslot");t&&t.removeClass("bnkCatalogSlotHighlight"),e.data("currentslot",null),S.hide(),A.adjustAccountPanel()});var y=$("<aside class='bnkButtons'></aside>").appendTo(S);return $("<div class='bnkCatalogSlotLeft bnkButton curClick' title='Move this slot <dfn>left</dfn>.'></div>").appendTo(y).click(function(){var t=e.data("currentslot");t&&t.prev()&&t.insertBefore(t.prev()),B.saveCatalog(e)}),$("<div class='bnkCatalogSlotRight bnkButton curClick' title='Move this slot <dfn>right</dfn>.'></div>").appendTo(y).click(function(){var t=e.data("currentslot");t&&t.next()&&t.insertAfter(t.next()),B.saveCatalog(e)}),$("<div class='bnkCatalogSlotDelete bnkButton curClick' title='<dfn>Delete</dfn> this custom bank slot.'></div>").appendTo(y).click(function(){var t=e.data("currentslot");t&&(t.remove(),S.hide(),A.adjustAccountPanel()),B.saveCatalog(e)}),I.qTip.init(v.find(".bnkButton")),I.qTip.init(S.find(".bnkButton")),{oHeaders:c,oRecord:l}},generateTransactions:function(e,t){var n=U.toFirstUpperCase(e),a=e.toLowerCase(),i=$("#accDish_"+n);if(A.reinitializeDish(i)!==!1){var r,o,s,c,l,u,d,p,h,g=B.createBank(i,{aTitle:D.getWordCapital(a),aClass:"bnkBankTrading",aIsCollection:!1,aWantGem:!1}),m=g.find(".bnkBank").append(I.cThrobber),f=0,C=0,v={},b=!1,S=function(e,t){var n,i=0,r=U.getObjectLength(v[t]),o=e.find(".bnkTabSlots"),s=[];for(var c in v[t])u=v[t][c],n=B.createBankSlot(o),n.data("count",u.oCount),s.push(u),function(e,t){Q.getItem(t.oItemID,function(n){p="buying"===a||"bought"===a?t.oPrice:null,h="selling"===a||"sold"===a?t.oPrice:null,B.styleBankSlot(e,{aItem:n,aComment:"<table class='bnkTransactionsTooltip'>"+t.oStampsTip+"</table>",aTransactionBuy:p,aTransactionSell:h,aSlotMeta:{count:t.oCount},aCallback:function(){b?(i++,A.setProgressBar(i,r)):(f++,A.setProgressBar(f,C))},aPriceCallback:function(n){"buying"===a?n.oPriceBuy===t.oHighest&&e.addClass("bnkSlotMatchAlternate"):"selling"===a&&n.oPriceSell===t.oLowest&&e.addClass("bnkSlotMatchAlternate")},aBind:function(e,t){e.click(function(){E.printListings(t.id)})}})})}(n,u);U.sortObjects(s,{aKeyName:"oLatest"}),e.data("transactions",s);var l=$("<kbd class='bnkTransactionsPrint btnWindow' title='<dfn>Print</dfn> this month of transactions in chronological order.'></kbd>").prependTo(e).click(function(){for(var e=$(this).parents(".bnkTab").first(),t=e.data("transactions"),n="<div class='bnkTransactionsContainer'>",a=t.length-1;a>=0;a--)Q.getItem(t[a].oItemID,function(e){t[a]&&(n+="<div class='bnkTransactionsBox'>"+Q.getItemPreface(e,t[a].oCount)+"<table class='bnkTransactionsTable'>"+t[a].oStamps+"</table></div>")});n+="</div>",I.print(n,!0),I.bindConsoleInput()});I.qTip.init(l)};A.getTransactions(t,{aCallback:function(e){if(m.empty(),null===e)return void m.append("<span class='bnkError'>"+D.getWordCapital("no")+" "+D.getModifiedWord("transactions","current")+".</span>");for(var t=(new Date).getTime(),n=0;n<e.length;n++)l=e[n],r=l.purchased||l.created,o=r.split("-"),s=o[0]+"-"+o[1],void 0===v[s]&&(v[s]={}),c=T.formatMilliseconds(l.purchased?new Date(l.purchased).getTime()-new Date(l.created).getTime():t-new Date(l.created).getTime()),void 0===v[s][l.item_id]&&(v[s][l.item_id]={oLatest:l.purchased||l.created,oHighest:Number.NEGATIVE_INFINITY,oLowest:Number.POSITIVE_INFINITY,oItemID:l.item_id,oNumTransactions:0,oCount:0,oPrice:0,oStamps:"",oStampsTip:""},C++),u=v[s][l.item_id],u.oCount+=l.quantity,u.oPrice+=l.price*l.quantity,u.oNumTransactions+=1,d="<tr><td>"+l.quantity+" "+I.Symbol.Quantity+"&nbsp;</td><td>"+E.formatCoinStringColored(l.price)+" =&nbsp;</td><td>"+E.formatCoinStringColored(l.price*l.quantity)+"</td><td>&nbsp;("+c+")</td><td>&nbsp;@ "+new Date(l.purchased||l.created).toLocaleString()+"</td></tr>",u.oStamps+=d,u.oNumTransactions<Q.ItemLimit.TooltipLines&&(u.oStampsTip+=d),l.price>u.oHighest&&(u.oHighest=l.price),l.price<u.oLowest&&(u.oLowest=l.price);b=C>Q.ItemLimit.FetchAPI;var a,i,p,h,f=0,y=0;for(var n in v){p=0,h=0,s=n.split("-"),i=new Date(Date.UTC(s[0],s[1],1,0,0,0)).toLocaleString(window.navigator.language,{year:"numeric",month:"long"}),a=B.createBankTab(m,{aTitle:i,aIsCollapsed:b}),b?!function(e,t){e.find(".bnkTabSeparator").one("click",function(){S(e,t)})}(a,n):S(a,n);for(var k in v[n])p++,h+=v[n][k].oCount;f+=p,y+=h,B.updateTabTally(a,p,p,h)}B.updateBankTally(g,f,f,y),B.createBankMenu(m,{aHelpMessage:$("#accHelpTransactions").html()})}})}}},Q={Box:{},RetrievedDatabases:{},SearchDatabase:null,RarityEnum:{Junk:"Junk",Basic:"Basic",Fine:"Fine",Masterwork:"Masterwork",Rare:"Rare",Exotic:"Exotic",Ascended:"Ascended",Legendary:"Legendary"},RunePieces:{Masterwork:2,Rare:4,Exotic:6},ItemLimit:{FetchAPI:500,TooltipLines:100,StackSize:250,EctoSalvageLevel:68},cSEARCH_LIMIT:200,Context:{Item:null,ItemName:null,ItemID:null,ItemSearch:null},loadItemsSubdatabase:function(e,t){if(Q.RetrievedDatabases[e])t();else{var n="cache/"+e+"_"+D.getPartiallySupportedLanguage()+I.cJSON;$.getJSON(n,function(t){Q.RetrievedDatabases[e]=!0;for(var n in t)void 0===Q.Box[n]&&(Q.Box[n]={}),Q.Box[n].oItem=t[n]}).always(function(){t()})}},loadItemsSearch:function(e){Q.SearchDatabase?e():$.getJSON("cache/search_"+O.Options.enu_Language+I.cJSON,function(t){Q.SearchDatabase=t,e()})},setRarityClass:function(e,t){for(var n in Q.RarityEnum)e.removeClass("rarity_"+n);void 0!==Q.RarityEnum[t]&&e.addClass("rarity_"+t)},getRarityClass:function(e){return"rarity_"+e},getItemType:function(e){var t=e.details;if(t){var n=e.type,a={Back:1,Consumable:1,Container:1,CraftingMaterial:1,Gathering:1,Gizmo:1,MiniPet:1,Trophy:1,UpgradeComponent:1};if(a[n])return"<br />"+D.getString(n)+"<br />";if(t.type&&"Default"!==t.type)return D.getString(t.type)+"<br />"}return""},getAttributeString:function(e){var t={CritDamage:"Ferocity",Healing:"HealingPower",ConditionDuration:"Expertise",BoonDuration:"Concentration"};return t[e]?t[e]:e},getAttributeTranslation:function(e){return D.getString(Q.getAttributeString(e))},sumItemAttribute:function(e,t){var n=t||{},a=A.Attribute["KeyDescription_"+D.getFullySupportedLanguage()],i=function(t){var i,r,s,c,l=t.length,u=0;if(n.aRuneSets&&n.aRuneSets[n.aItem.id]){if(n.aRuneSets[n.aItem.id].issummed===!0)return;u=n.aRuneSets[n.aItem.id].numslotted,l=u}for(var d=0;l>d;d++)if(i=t[d],r=U.stripToNumbers(i),s=i.replace(/[\s0-9%,.\-+']/g,"").toLowerCase(),a[s]){if(c=a[s],"AgonyResistance"===c&&o.infusion_slots)continue;e[c]+=r}n.aRuneSets&&n.aRuneSets[n.aItem.id]&&(n.aRuneSets[n.aItem.id].issummed=!0)},r=n.aItem;if(r&&r.details){var o=r.details;o.infix_upgrade&&o.infix_upgrade.attributes&&o.infix_upgrade.attributes.forEach(function(t){var n=A.Attribute.KeyAttributes[t.attribute];n&&(e[n]+=t.modifier)}),o.bonuses&&i(o.bonuses),void 0!==o.defense&&(e.Armor+=o.defense)}if(n.aStats){var s=n.aStats.attributes;if(s)for(var c in s)e[Q.getAttributeString(c)]+=s[c]}},sumAttributeObject:function(e,t){for(var n in e)e[n]+=t[n]},calculateAttributes:function(e,t,n){var a={},i=t.level,r=t.oCharProfession,o=A.Attribute.Constants,s=A.Attribute.PrimaryPoints[i-1],c=A.Attribute.PrecisionDivisor[i-1],l=c/A.Attribute.SecondaryDivisorRatio,u=0,d=0,p=A.Metadata.Profession[r].health,h=A.Attribute.HealthGrowth[p],g=0;for(var m in h){if(g=parseInt(m),g>i){u+=(i-d)*h[m];break}u+=(g-d)*h[m],d=g}var f={Power:s+e.Power,Toughness:s+e.Toughness,Armor:s+e.Armor+e.Toughness,Vitality:s+e.Vitality,Health:s/o.VITALITY_IN_HEALTH+u+e.Health+e.Vitality/o.VITALITY_IN_HEALTH,Precision:s+e.Precision,CriticalChance:o.BASE_CRITICALCHANCE+e.CriticalChance+e.Precision/c,Ferocity:e.Ferocity,CriticalDamage:o.BASE_CRITICALDAMAGE+e.CriticalDamage+e.Ferocity/l,ConditionDamage:e.ConditionDamage,HealingPower:e.HealingPower,Expertise:e.Expertise,ConditionDuration:e.ConditionDuration+e.Expertise/l,Concentration:e.Concentration,BoonDuration:e.BoonDuration+e.Concentration/l,AgonyResistance:e.AgonyResistance,MagicFind:e.MagicFind};if(n)return f;for(var m in f)a[m]=A.Attribute.KeyType[m]?U.formatPercentage(f[m],2,1):parseInt(f[m]).toLocaleString();return a},countRuneSets:function(e){var t=e.equipment,n=0;if(t){for(var a={},i=0;i<t.length;i++){if(A.Equipment.ArmorSlots[t[i].slot]&&t[i].upgrades){var r=t[i].upgrades[0];void 0===a[r]&&(a[r]={numslotted:0,issummed:!1}),a[r].numslotted=a[r].numslotted+1,n++}if(n===A.Equipment.NumArmorSlots)break}return a}return null},getRuneBonus:function(e,t){var n="",a=e.details,i=0,r=Q.RunePieces[e.rarity],o=t&&t[e.id]?t[e.id].numslotted:null;"number"==typeof t&&(o=t),o>r&&(o=r);var s="";if(a.bonuses){n+=null!==o?"":"<br />",n+="<span class='itmGrayed'>",null!==o&&(n+="<var class='itmBuff'>"+e.name+" ("+o+"/"+r+")</var><br />");for(var c in a.bonuses)s=o>i?" class='itmBuff'":"",i++,n+="<var"+s+">("+i+"): "+a.bonuses[c]+"</var><br />";n+="</span>"}return n},formatItemDescription:function(e){try{var t="string"==typeof e?e:e.details.infix_upgrade.buff.description;return-1!==t.indexOf("<c=@")&&(t=t.replace(/<c=@abilitytype>/g,"<c class='itmColor_abilitytype'>"),t=t.replace(/<c=@flavor>/g,"<c class='itmColor_flavor'>"),t=t.replace(/<c=@reminder>/g,"<c class='itmColor_reminder'>"),t=t.replace(/<c=@warning>/g,"<c class='itmColor_warning'>")),-1!==t.indexOf("\n")?t.replace(/\n/g,"<br />"):t}catch(n){}return""},isTradeable:function(e){if(void 0===e)return!1;if("number"==typeof e){var t=Q.Box[e];if(t)return t.oIsTradeable===!1?!1:!0}if(e.flags)for(var n,a=0;a<e.flags.length;a++)if(n=e.flags[a],"AccountBound"===n||"SoulbindOnAcquire"===n)return!1;return!0},getItem:function(e,t){var n=Q.Box[e];if(n)return t(n.oItem),{fail:function(){}};var a=$.ajax({dataType:"json",url:U.getAPIItem(e),cache:!0,success:function(e){void 0===Q.Box[e.id]&&(Q.Box[e.id]={},Q.Box[e.id].oItem=e),t(e)}});return a},prefetchItems:function(e,t){for(var n=U.getUnique(e),a=[],i=0;i<n.length;i++)void 0===Q.Box[n[i]]&&a.push(n[i]);a.length?Z.scrapeAPIArray(a,"items",{aIterator:function(e){void 0===Q.Box[e.id]&&(Q.Box[e.id]={},Q.Box[e.id].oItem=e),Q.scanItem(e)},aCallback:function(){I.clear(),t()}}):t()},scanItem:function(e,t){var n=t||{},a=n.aItemMeta||{},i=Q.Box[e.id];if(i&&i.oHTML)if(a.upgrades||a.infusions||a.skin||a.slot||a.bound_to||n.aWantAttr||n.aComment)Q.analyzeItem(e,t);else{if(n.aElement){var r=$(n.aElement);r.attr("title",i.oHTML),I.qTip.init(r)}n.aCallback&&n.aCallback(i)}else Q.analyzeItem(e,t)},analyzeItem:function(e,t){var n=t||{},a=[],i=[],r=null,o=null,s=!1,c=!0;n.aItemMeta&&(s=!0),n.aItemMeta=n.aItemMeta||{},n.aWantAttr&&A.isAccountInitialized&&(o=new A.Attribute.Base);var l=e,u=l.type,d="",p=l.details,h="Weapon"===u,g=h||"Armor"===u||"Trinket"===u||"Back"===u,m="Back"===u,f="Trinket"===u||m,C=l.rarity===Q.RarityEnum.Ascended||l.rarity===Q.RarityEnum.Legendary,v=!1,b=!0,S=!1,y=!1,k=0,_=0;p&&p.type&&(d=p.type,"Weapon"===u&&(v="Greatsword"===d||"Hammer"===d||"LongBow"===d||"ShortBow"===d||"Rifle"===d||"Staff"===d||"Harpoon"===d||"Speargun"===d||"Trident"===d));var P="",L=void 0!==l.rarity?l.rarity:Q.RarityEnum.Basic;P="<aside class='itmName "+Q.getRarityClass(L)+"'><img class='itmIcon itmIconMain' src='"+l.icon+"' />"+U.escapeHTML(l.name)+"</aside>";var M="";p&&void 0!==p.min_power&&void 0!==p.max_power&&(M+="<span class='itmText'>"+D.getString("WeaponStrength")+":</span> <span class='itmAttr'>"+p.min_power.toLocaleString()+" - "+p.max_power.toLocaleString()+"</span><br />");var O="";p&&p.defense>0&&(O+="<span class='itmText'>"+D.getString("Defense")+":</span> <span class='itmAttr'>"+p.defense.toLocaleString()+"</span><br />");var w="",N="";if(p&&p.infix_upgrade){var x=p.infix_upgrade.attributes;w+="<aside class='itmAttr'>",void 0!==p.infix_upgrade&&(g?x.forEach(function(e){w+="+"+parseInt(e.modifier)+" "+Q.getAttributeTranslation(e.attribute)+"<br />"}):p.infix_upgrade.buff?(w+="<span class='itmBuff'>"+Q.formatItemDescription(l)+"</span>",N="<br />"):p.bonuses&&"Rune"===p.type&&(w+=Q.getRuneBonus(l))),w=N+w,w+="</aside>"}else if(n.aItemMeta.stats){var W=n.aItemMeta.stats.attributes;w+="<aside class='itmAttr'>";for(var R in W)w+="+"+W[R]+" "+Q.getAttributeTranslation(R)+"<br />";w+="</aside>"}else if("Consumable"===u)if(w+=D.getString("DoubleClickToConsume")+"<br />",void 0!==p.duration_ms){var B=p.icon||"img/account/item/nourishment"+("Food"===p.type||"Utility"===p.type?"_"+p.type.toLowerCase():"")+I.cPNG,H=p.name||D.getString("Immediate"===p.type?"Boost":"Nourishment"),G=p.duration_ms>0?" ("+T.formatTooltipTimeMS(p.duration_ms,!0)+")":"";w+="<span class='itmConsumableLine'><img class='itmIcon itmConsumableIcon' src='"+B+"' /> <var class='itmGrayed itmConsumableDesc'>"+H+G+": "+Q.formatItemDescription(p.description)+"</var></span>"}else"Booze"===p.type&&(w+=D.getString("ExcessiveAlcohol")+"<br />");o&&Q.sumItemAttribute(o,{aItem:l,aStats:n.aItemMeta.stats});var z="";g&&(z=D.getString(l.rarity)+(m?"":"<br />"));var F="";p&&p.weight_class&&(F=D.getString(p.weight_class)+"<br />");var j=Q.getItemType(l),Z="";l.level>1&&(Z+=D.getString("RequiredLevel")+": "+l.level+"<br />");var K="",q="",X=l.description||"";X=Q.formatItemDescription(X),l.description&&(X="<aside>"+X+"</aside>",g?q=X:K=X);var V="";g&&p&&void 0===p.infix_upgrade&&void 0===n.aItemMeta.stats&&(V=D.getString("DoubleClickToSelectStats")+"<br />");var J="",Y={},et=function(e){J+=D.getString(e)+"<br />"};l.flags&&(l.flags.forEach(function(e){Y[e]=!0}),Y.Unique&&et("Unique"),s&&n.aItemMeta.binding?(c=!1,"Character"===n.aItemMeta.binding&&n.aItemMeta.bound_to?J+="<var class='itmColor_warning'>"+D.getString("SoulboundToCharacter")+": "+n.aItemMeta.bound_to+"</var><br />":"Account"===n.aItemMeta.binding&&et("AccountBound")):(Y.SoulbindOnAcquire?(y=!0,c=!1,et("SoulbindOnAcquire")):Y.SoulBindOnUse&&y===!1&&et("SoulBindOnUse"),Y.AccountBound?(S=!0,c=!1,et("AccountBound")):Y.AccountBindOnUse&&S===!1&&et("AccountBindOnUse")),Y.NoSell&&(b=!1));var tt="";n.aSoulbound&&(tt=D.getString("SoulboundToCharacter")+": "+U.escapeHTML(n.aSoulbound));var nt="";n.aComment&&(nt="<aside>"+n.aComment+"</aside>");var at="",it=0;l.vendor_value>0&&b&&(it=n.aItemMeta.count?n.aItemMeta.count*l.vendor_value:l.vendor_value,at=E.formatCoinString(it,{aWantColor:!0,aWantSpace:!0}));var rt,ot="",st="",ct=[],lt=[],ut=[],dt=[];if(g){if((C||(C&&f)===!1)&&(ot="<br />"),C&&p&&p.infusion_slots)for(var R=0;R<p.infusion_slots.length;R++)rt=p.infusion_slots[R],st="Amulet"===p.type?"Enrichment":"Infusion",lt.push("<img class='itmSlotIcon' src='img/account/item/"+st.toLowerCase()+".png' /> "+D.getString("Unused"+st+"Slot")+"<br /><br />"),void 0!==rt.item_id&&void 0===n.aItemMeta.infusions?(ct.push(rt.item_id),k++):ct.push(null);if((C&&f)===!1){var pt="<img class='itmSlotIcon' src='img/account/item/upgrade.png' /> "+D.getString("UnusedUpgradeSlot")+"<br /><br />";dt.push(pt),dt.push(v?pt:""),p&&p.suffix_item_id&&void 0===n.aItemMeta.upgrades?(ut.push(p.suffix_item_id),k++):(ut.push(null),v&&ut.push(null))}}if(n.aItemMeta.infusions)for(var R=0;R<n.aItemMeta.infusions.length;R++)R<ct.length&&(ct[R]=n.aItemMeta.infusions[R],ct[R]&&k++);if(n.aItemMeta.upgrades)for(var R=0;R<n.aItemMeta.upgrades.length;R++)R<ut.length&&(ut[R]=n.aItemMeta.upgrades[R],ut[R]&&k++);var ht="";n.aItemMeta.skin&&k++;for(var gt=function(){if(_===k){var e="<div class='itmTooltip'>"+P+M+O+w+K+ot+(h?dt.join("")+lt.join(""):lt.join("")+dt.join(""))+ht+z+F+j+Z+q+V+J+tt+at+nt+"</div>";if(n.aElement){var t=$(n.aElement);t.attr("title",e),I.qTip.init(t)}var u={oItem:l,oInfusions:a,oUpgrades:i,oSkin:r,oAttr:o,oHTML:e,oIsTradeable:c};s===!1&&void 0===n.aComment&&(Q.Box[l.id]=u),n.aCallback&&n.aCallback(u)}},R=0;R<ct.length;R++)null!==ct[R]&&!function(e,t){$.getJSON(U.getAPIItem(t),function(t){lt[e]="<span class='itmUpgrade'><img class='itmSlotIcon' src='"+t.icon+"' /> "+t.name+"<br />"+t.details.infix_upgrade.buff.description+"</span><br /><br />",n.aCallback&&a.push(t),o&&Q.sumItemAttribute(o,{aItem:t}),_++,gt()}).fail(function(){k--,gt()})}(R,ct[R]);for(var R=0;R<ut.length;R++)null!==ut[R]&&!function(e,t){$.getJSON(U.getAPIItem(t),function(t){var a="";if("Rune"===t.details.type){var r=0;"HelmAquatic"===p.type?r=n.aRuneSets&&n.aRuneSets[t.id]?1+n.aRuneSets[t.id].numslotted:1:n.aRuneSets&&(r=n.aRuneSets),a=Q.getRuneBonus(t,r),o&&Q.sumItemAttribute(o,{aItem:t,aRuneSets:n.aRuneSets})}else a=t.name+"<br />"+Q.formatItemDescription(t),o&&Q.sumItemAttribute(o,{aItem:t});dt[e]="<aside class='itmUpgrade'><img class='itmSlotIcon' src='"+t.icon+"' /> "+a+"</aside><br />",n.aCallback&&i.push(t),_++,gt()}).fail(function(){k--,gt()})}(R,ut[R]);n.aItemMeta.skin&&$.getJSON(U.getAPISkin(n.aItemMeta.skin),function(e){P="<aside class='itmName "+Q.getRarityClass(L)+"'><img class='itmIcon itmIconMain' src='"+e.icon+"' />"+U.escapeHTML(e.name)+"</aside>",ht="<aside='itmTransmute'>"+D.getString("Transmuted")+"<br />"+U.escapeHTML(l.name)+"</aside><br /><br />",n.aCallback&&(r=e),_++,gt()}).fail(function(){k--,gt()}),_===k&&gt()},formatSkillTrait:function(e){var t=function(e){var t=e.text,n=e.type,a=e.value,i=void 0!==e.target?Q.getAttributeTranslation(e.target):"",r=void 0!==e.source?Q.getAttributeTranslation(e.source):"",o="BuffConversion"===n?D.getString("GainBasedPercentage").replace("{0}",r).replace("{1}",i):"",s="<img class='trtFactIcon' src='"+e.icon+"' />",c=e.prefix&&e.prefix.icon?"<img class='trtFactIcon' src='"+e.prefix.icon+"' />":"",l=e.description,u=e.apply_count>1?"<var class='trtStacks'>"+e.apply_count+"</var>":"",d=void 0!==e.duration?e.duration+" "+D.getWord("seconds"):"",p=void 0!==e.duration?" ("+T.formatTooltipTime(e.duration)+")":"",h=e.status,g=e.field_type,m=e.finisher_type,f=e.percent+"%",C=e.hit_count+"x",v=e.distance,b=function(e,t){return"<var class='trtFactIcons'>"+e+"</var><var class='trtFactText'>"+t+"</var>"
},S={AttributeAdjust:function(){return b(s,"+"+a+" "+i)},Buff:function(){return b(u+s,h+p+": "+l)},BuffConversion:function(){return b(s,o)},ComboField:function(){return b(s,t+": "+g)},ComboFinisher:function(){return b(s,t+": "+m+" ("+f+")")},Damage:function(){return b(s,t+": "+C)},Distance:function(){return b(s,t+": "+v)},Duration:function(){return b(s,t+": "+d)},Heal:function(){return b(s,t+": "+C)},HealingAdjust:function(){return b(s,t+": "+C)},NoData:function(){return b(s,t)},Number:function(){return b(s,t+": "+a)},Percent:function(){return b(s,t+": "+f)},PrefixedBuff:function(){return b(s+c,h+p+": "+l)},Radius:function(){return b(s,t+": "+v)},Range:function(){return b(s,t+": "+a)},Time:function(){return b(s,t+": "+d)},Unblockable:function(){return b(s,t)}};return S[n]?"<span class='trtFactLine'>"+S[n]()+"</span>":""},n="<span class='trtName'>"+e.name+"</span>",a="<span class='trtDesc'>"+Q.formatItemDescription(e.description)+"</span>",i="",r="",o="";return e.facts&&e.facts.length>0&&(r+="<aside class='trtFacts'>",e.facts.forEach(function(e){"Recharge"===e.type?i="<span class='trtRecharge'>"+e.value+"<img class='trtRechargeIcon' src='"+e.icon+"' /></span>":o+=t(e)}),r=""===o?"":r+o+"</aside>"),i+n+a+r},analyzeSkillTrait:function(e,t){var n=t||{},a=Q.formatSkillTrait(e),i=function(e){var t=$("#itemNull").empty(),n=$(e).appendTo(t).height();return t.empty(),n},r="",o=6,s=20;e.skills&&e.skills.forEach(function(e){var t="<div class='qTip'><div class='trtTooltip'>"+Q.formatSkillTrait(e)+"</div></div>";o+=i(t)+s,r+="<div class='trtTooltip trtTooltipExtra' style='margin-top:-"+o+"px'>"+Q.formatSkillTrait(e)+"</div>"});var c="<div class='trtTooltipBorder'>"+I.Symbol.Filler+"</div>"+r+"<div class='trtTooltip'>"+a+"</div>";if(n.aElement){var l=$(n.aElement);l.attr("title",c),I.qTip.init(l),l.click(function(){I.prettyJSON(e)})}},initializeItemContextMenu:function(){I.styleContextMenu("#itmContext"),$("#itmContext").click(function(){$(this).hide()}),$("#itmContextWiki").click(function(){U.openExternalURL(U.getWikiLinkLanguage(Q.Context.ItemName))}),$("#itmContextWikiSearch").click(function(){U.openExternalURL(U.getWikiSearchLanguage(Q.Context.ItemSearch))}),$("#itmContextTrading").click(function(){U.openExternalURL(U.getTradingItemLink(Q.Context.ItemID,Q.Context.ItemName))}),$("#itmContextTradingSearch").click(function(){E.printListings(Q.Context.ItemID)}),$("#itmContextInfo").click(function(){Q.Context.Item?Q.Context.Item.name?Q.printItemInfo(Q.Context.Item):I.prettyJSON(Q.Context.Item):I.print("No information available.")}),I.bindClipboard("#itmContextChatlink")},bindItemSlotBehavior:function(e,t){var n=t||{};e.contextmenu(function(e){e.preventDefault();var t;n.aItem?(Q.Context.Item=n.aItem,Q.Context.ItemName=n.aItem.name,Q.Context.ItemID=n.aTradeableID||n.aItem.id,Q.Context.ItemSearch=n.aSearch||n.aItem.name,t=n.aItem.chat_link+" "+Q.Context.ItemSearch):(Q.Context.Item=n.aObject,Q.Context.ItemName=n.aSearch,Q.Context.ItemID=n.aTradeableID,Q.Context.ItemSearch=n.aSearch,t=n.aChatlink||"No chatlink available."),I.updateClipboard("#itmContextChatlink",t),I.showContextMenu("#itmContext")}),n.aWantClick&&e.click(function(e){e.which===I.ClickEnum.Left&&U.openExternalURL(U.getWikiSearchLanguage(n.aItem.name))})},bindItemSearch:function(e,t){var n,a=t||{},i=$(e).wrap("<span class='itmSearchContainer'></span>"),r=D.isLanguageLogographic()?1:2,o=a.aResultsLimit||O.Options.int_numTradingResults,s=$("<div class='itmSearchResultContainer jsHidable'></div>").insertAfter(i).hide(),c=$("<div class='itmSearchResultScroll cntPopup jsScrollable'></div>").appendTo(s),l=$("<div class='itmSearchResultList'></div>").appendTo(c),u="<var class='itmSearchResultNone'>"+D.getPhraseOriginal("Not found")+".</var>",d=void 0===a.aDatabase;null!==a.aFillerText&&I.bindInputBarText(i,a.aFillerText),a.aResultsClass&&s.addClass(a.aResultsClass),I.bindScrollbar(c);var p=function(e,t){l.empty().removeData("selectedresult"),s.toggle(e),t&&l.html(t),e===!1&&I.qTip.hide()},h="<br />"+(d?"Right click an item for menu.<br />Type a number to search by item ID.":a.aInfo||""),g=$("<ins class='itmSearchClose btnWindow btnClose' title='<dfn>Close the search results.</dfn>"+h+"'></ins>").appendTo(s).click(function(){p(!1)});I.qTip.init(g);var m=function(e,t){if(0===e.length)return void p(!0,u);if(p(!0),d){n=(new Date).getTime();for(var i=0;i<e.length;i++)l.append("<span class='itmSearchResultLine itmSearchResultLine_"+e[i]+"'></span>");for(var i=0;i<e.length;i++)!function(e,i){Q.getItem(e,function(r){if(i===n){var o=$("<dfn class='itmSearchResultEntry "+Q.getRarityClass(r.rarity)+"' data-id='"+r.id+"'><img src='"+r.icon+"'>"+U.highlightSubstring(r.name,t)+"</dfn>").appendTo(l.find(".itmSearchResultLine_"+e));o.click(function(){a.aCallback&&(a.aCallback(r),p(!1)),l.removeData("selectedresult")}),I.updateScrollbar(c),Q.scanItem(r,{aElement:o}),Q.bindItemSlotBehavior(o,{aItem:r}),E.getPrice(e,function(e){if(i===n){var t="<span class='itmSearchResultPrice'>"+E.formatCoinStringSlot(e.oPriceSell)+" <var class='cssFaded'>"+E.formatCoinStringSlot(e.oPriceBuy)+"</var></span>";o.append(t)}},!0)}})}(e[i],n)}else{for(var i=0;i<e.length;i++)!function(e){var n=$("<span class='itmSearchResultLine'><dfn class='itmSearchResultEntry'><img src='"+e.icon+"'>"+U.highlightSubstring(e.name,t)+"</dfn></span>").appendTo(l);n.click(function(){a.aCallback&&a.aCallback(e)})}(e[i]);I.updateScrollbar(c)}e.length===o&&I.qTip.init($("<span class='itmSearchResultEntryFinal' title='More results available. Please refine your search.'>...</span>").appendTo(l))},f=function(e){if(e.length<r)return void p(!1);if(U.isInteger(e))return void m([parseInt(e)],e);for(var t,n,i,s,c,l=[],u=d?Q.SearchDatabase:a.aDatabase,h=0;h<u.length;h++){t=u[h],n=e.split(" "),i=t[0],s=t[1],c=!0;for(var g=0;g<n.length;g++)-1!==s.indexOf(n[g])||(c=!1);if(c&&l.push(i),l.length>=o)return void m(l,e)}m(l,e)},C=function(e){var t=l.data("selectedresult")||l.find(".itmSearchResultEntry").first().parent();if(t&&t.length){var n=e?t.next():t.prev();n&&n.hasClass("itmSearchResultLine")&&(l.find(".itmSearchSelected").removeClass("itmSearchSelected"),l.data("selectedresult",n),n.addClass("itmSearchSelected"),I.scrollToElement(n,{aContainer:c,aOffset:-(c.height()/2)}))}};i.one("click",function(){p(!0),l.append(I.cThrobber);var e=function(){p(!1),i.on("input",$.throttle(E.cSEARCH_LIMIT,function(){f($(this).val().toLowerCase())})).click(function(){f($(this).val().toLowerCase()),$(this).select()}).onEscapeKey(function(){p(!1)}),a.aWantEnter!==!1&&i.onEnterKey(function(){var e=l.data("selectedresult")||l.find(".itmSearchResultEntry").first().parent();e&&e.length&&e.find(".itmSearchResultEntry").trigger("click")}).onArrowDownKey(function(){C(!0)}).onArrowUpKey(function(){C(!1)}),i.trigger("input")};d?Q.loadItemsSearch(function(){e()}):e()})},getItemPreface:function(e,t){var n=t>1?t+" ":"",a=U.escapeHTML(e.name);return"<div class='itmPreface'><aside class='itmPrefaceLeft'><a class='itmPrefaceIcon'"+U.convertExternalAnchor(U.getWikiItemDefault(e))+"'><img class='itmPrefaceIconImage' src='"+e.icon+"' /></a> <var class='itmPrefaceName "+Q.getRarityClass(e.rarity)+"'>"+n+a+"</var></aside><aside class='itmPrefaceRight'><input class='cssInputText' type='text' value='"+a+"' /><br /><input class='cssInputText' type='text' value='"+U.escapeHTML(e.chat_link)+"' /><br /><input class='cssInputText' type='text' value='"+e.id+"' /></aside></div>"},printItemInfo:function(e,t){I.print(Q.getItemPreface(e)),I.prettyJSON(e),Q.isTradeable(e)&&t&&E.printListings(e.id,!1),I.bindConsoleInput()}},E={Exchange:{COPPER_IN_SILVER:100,COPPER_IN_GOLD:1e4,SILVER_IN_GOLD:100,CENTS_IN_DOLLAR:100,GEM_PER_DOLLAR:.8,DOLLAR_PER_GEM:1.25,GEM_SAMPLE:100,COIN_SAMPLE:1e6,TAX_LIST:.05,TAX_SOLD:.1,TAX_TOTAL:.15,TAX_INVERSE:.85,GemInCoin:0,CoinInGem:0},cREFRESH_LIMIT:5e3,cSEARCH_LIMIT:750,cEXCHANGE_LIMIT:250,isTradingCalculatorsInitialized:!1,ItemsArray:[],RefreshTimeout:{},ProgressTimeout:{},ProgressWait:0,ProgressTick:0,SwapIndex:-1,CalculatorHistoryArray:Array(64),CalcHistoryIndex:0,Paylist:{},PaymentFormat:{coin:function(e){return E.formatCoinStringShort(e)},gem:function(e){return E.formatGemString(e,!0)},karma:function(e){return E.formatKarmaString(e,!0)},laurel:function(e){return E.formatLaurelString(e,!0)},token:function(e){return e.toLocaleString()+"<ins class='s16 s16_token'></ins>"},achievement:function(e){return(0===e?"":e.toLocaleString())+"<ins class='s16 s16_achievement'></ins>"},monument:function(e){return e.toLocaleString()+"<ins class='s16 s16_monument'></ins>"},craft:function(){return"<ins class='s16 s16_craft'></ins>"},pvp:function(){return"<ins class='s16 s16_pvp'></ins>"},starting:function(){return"<ins class='s16 s16_starting'></ins>"},spirit:function(e){return e.toLocaleString()+"<ins class='s16 s16_spirit'></ins>"},cob:function(e){return e.toLocaleString()+"<ins class='s16 s16_cob'></ins>"},blticket:function(e){return e.toLocaleString()+"<ins class='s16 s16_blticket'></ins>"},bubble:function(e){return e.toLocaleString()+"<ins class='s16 s16_bubble'></ins>"},badge:function(e){return(0===e?"":e.toLocaleString())+"<ins class='s16 s16_badge'></ins>"},proof:function(e){return e.toLocaleString()+"<ins class='s16 s16_proof'></ins>"},commendation:function(e){return e.toLocaleString()+"<ins class='s16 s16_commendation'></ins>"},provisioner:function(e){return e.toLocaleString()+"<ins class='s16 s16_provisioner'></ins>"},tournament:function(e){return e.toLocaleString()+"<ins class='s16 s16_tournament'></ins>"},league:function(e){return e.toLocaleString()+"<ins class='s16 s16_league'></ins>"},dungeon_ac:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_ac'></ins>"},dungeon_arah:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_arah'></ins>"},dungeon_cm:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_cm'></ins>"},dungeon_se:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_se'></ins>"},dungeon_ta:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_ta'></ins>"},dungeon_hotw:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_hotw'></ins>"},dungeon_cof:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_cof'></ins>"},dungeon_coe:function(e){return e.toLocaleString()+"<ins class='s16 s16_dungeon_coe'></ins>"},fotm_relic:function(e){return e.toLocaleString()+"<ins class='s16 s16_fotm_relic'></ins>"},fotm_pristine:function(e){return e.toLocaleString()+"<ins class='s16 s16_fotm_pristine'></ins>"},raid_ft:function(e){return e.toLocaleString()+"<ins class='s16 s16_raid_ft'></ins>"},map_dt:function(e){return e.toLocaleString()+"<ins class='s16 s16_map_dt'></ins>"},map_sw:function(e){return e.toLocaleString()+"<ins class='s16 s16_map_sw'></ins>"},map_vb:function(e){return e.toLocaleString()+"<ins class='s16 s16_map_vb'></ins>"},map_ab:function(e){return e.toLocaleString()+"<ins class='s16 s16_map_ab'></ins>"},map_td:function(e){return e.toLocaleString()+"<ins class='s16 s16_map_td'></ins>"},map_ds:function(e){return e.toLocaleString()+"<ins class='s16 s16_crystalline'></ins>"},magic:function(e){return e.toLocaleString()+"<ins class='s16 s16_magic'></ins>"},map_bf:function(e){return e.toLocaleString()+"<ins class='s16 s16_blood'></ins>"},map_eb:function(e){return e.toLocaleString()+"<ins class='s16 s16_petrified'></ins>"}},PaymentEnum:{Coin:"Coin",Karma:"Karma",Gem:"Gem"},parseCoinString:function(e){if(void 0===e||null===e)return 0;var t=e.split("."),n=t.length,a=0,i=0,r=0;return 0===n?0:(1===n&&(i=parseInt(t[0])),2>n||(a=parseInt(t[n-1]),i=parseInt(t[n-2])),2===n&&1===t[n-1].length&&(a*=T.cBASE_10),3>n||(r=parseInt(t[n-3])),isFinite(a)||(a=0),isFinite(i)||(i=0),isFinite(r)||(r=0),parseInt(a+i*E.Exchange.COPPER_IN_SILVER+r*E.Exchange.COPPER_IN_GOLD))},parseGemString:function(e){return void 0===e||null===e?0:isFinite(parseInt(e))?parseInt(e):0},parseMoneyString:function(e){if(void 0===e||null===e)return 0;var t=e.split("."),n=t.length,a=0,i=0;return 0===n?0:(1===n&&(i=parseInt(t[0])),2>n||(a=parseInt(t[n-1]),i=parseInt(t[n-2])),2>n||1!==t[n-1].length?2>n||t[n-1].length<2||(a=parseInt((""+a).substring(0,2))):a*=T.cBASE_10,isFinite(a)||(a=0),isFinite(i)||(i=0),parseInt(a+i*E.Exchange.CENTS_IN_DOLLAR))},formatCoinString:function(e,t){var n=void 0===e||isFinite(e)===!1?0:parseInt(e),a=t||{},i=".",r="",o="",s="",c="",l="",u="",d="",p="",h="";a.aWantCopy!==!1&&(d="<abbr class='cssCopyText'>"+D.getString("CoinGold")+"&nbsp;</abbr>",p="<abbr class='cssCopyText'>"+D.getString("CoinSilver")+"&nbsp;</abbr>",h="<abbr class='cssCopyText'>"+D.getString("CoinCopper")+"&nbsp;</abbr>"),a.aWantColor&&(i="",r="<gold>",o="<silver>",s="<copper>",c="</gold>"+d+"<goldcoin></goldcoin>",l="</silver>"+p+"<silvercoin></silvercoin>",u="</copper>"+h+"<coppercoin></coppercoin>"),a.aWantBig&&(i="",r="<gold>",o="<silver>",s="<copper>",c="</gold>"+d+"<img src='img/ui/coin_gold.png' />",l="</silver>"+p+"<img src='img/ui/coin_silver.png' />",u="</copper>"+h+"<img src='img/ui/coin_copper.png' />"),a.aWantSpace&&(i=" ");var g=Math.abs(~~(n/E.Exchange.COPPER_IN_GOLD)),m=Math.abs(~~(n/E.Exchange.SILVER_IN_GOLD)%E.Exchange.COPPER_IN_SILVER),f=Math.abs(n%E.Exchange.COPPER_IN_SILVER),C=g,v=m,b=f,S=0>n?"−":"";return!a.aWantColor&&g>0&&m<T.cBASE_10&&(v="0"+m),!a.aWantColor&&(m>0&&f<T.cBASE_10||f<T.cBASE_10)&&(b="0"+f),a.aWantShort&&((g>0||0===f&&n>0)&&(s="",b="",u=""),0===m&&(o="",v="",l="")),g>0?S+r+C.toLocaleString()+c+i+o+v+l+i+s+b+u:m>0?S+o+v+l+i+s+b+u:a.aWantColor?s+b+u:S+o+"0"+i+l+s+b+u},formatCoinStringColored:function(e){return E.formatCoinString(e,{aWantColor:!0})},formatCoinStringShort:function(e){return E.formatCoinString(e,{aWantColor:!0,aWantShort:!0})},formatCoinStringSlot:function(e){return E.formatCoinString(e,{aWantColor:!0,aWantShort:!0,aWantCopy:!1})},formatMoneyString:function(e,t){if(void 0===e||isFinite(e)===!1)return"0.00";e=parseInt(e);var n=Math.abs(~~(e/E.Exchange.CENTS_IN_DOLLAR)),a=Math.abs(e%E.Exchange.CENTS_IN_DOLLAR),i=0>e?"−":"";a<T.cBASE_10&&(a="0"+a);var r=t?"<money>":"",o=t?"</money>":"";return r+i+"$"+n+"."+a+o},formatCurrencyString:function(e,t,n){if(void 0===t||isFinite(t)===!1)return"0";t=parseInt(t);var a=e,i="",r="",o="<"+a+"unit></"+a+"unit>";return n&&(i="<"+a+">",r="</"+a+">"),i+t.toLocaleString()+r+o},formatKarmaString:function(e,t){return E.formatCurrencyString("karma",e,t)},formatLaurelString:function(e,t){return E.formatCurrencyString("laurel",e,t)},formatGemString:function(e,t){return E.formatCurrencyString("gem",e,t)},animateValue:function(e,t,n){t>n?e.css({color:"#ff2200"}).animate({color:"#ffeebb"},5e3):n>t?e.css({color:"#44dd44"}).animate({color:"#ffeebb"},5e3):e.css({"border-radius":32}).animate({"border-radius":4},1e3)},updateCoinInGem:function(e){$.getJSON(U.URL_API.GemPrice+E.Exchange.COIN_SAMPLE,function(t){void 0!==t.quantity&&(E.Exchange.CoinInGem=E.Exchange.COIN_SAMPLE/t.quantity,e())}).fail(function(){e()})},updateGemInCoin:function(e){$.getJSON(U.URL_API.CoinPrice+E.Exchange.GEM_SAMPLE,function(t){void 0!==t.quantity&&(E.Exchange.GemInCoin=E.Exchange.GEM_SAMPLE/t.quantity,e())}).fail(function(){e()})},updateExchangeRatios:function(e){E.updateCoinInGem(function(){E.updateGemInCoin(function(){e()})})},convertGemToCoin:function(e){return Math.round(e*E.Exchange.CoinInGem)},convertCoinToGem:function(e){return Math.round(e*E.Exchange.GemInCoin)},convertGemToMoney:function(e){return Math.round(e*E.Exchange.DOLLAR_PER_GEM)},convertMoneyToGem:function(e){return Math.floor(e*E.Exchange.GEM_PER_DOLLAR)},formatGemToCoin:function(e){return E.formatCoinStringShort(E.convertGemToCoin(e))},formatCoinToGem:function(e){return E.formatGemString(E.convertCoinToGem(e),!0)},formatGemToMoney:function(e){return E.formatMoneyString(E.convertGemToMoney(e),!0)},formatMoneyToGem:function(e){return E.formatGemString(E.convertMoneyToGem(e),!0)},getGemFromCoin:function(e,t){$.getJSON(U.URL_API.GemPrice+e,function(e){if(void 0!==e.quantity){var n=parseInt(e.quantity);t(n)}}).fail(function(){t(0)})},getGemFromCoinInverse:function(e,t){E.updateGemInCoin(function(){0!==E.Exchange.GemInCoin&&t(E.convertCoinToGem(e))})},getCoinFromGem:function(e,t){$.getJSON(U.URL_API.CoinPrice+e,function(e){if(void 0!==e.quantity){var n=parseInt(e.quantity);t(n)}}).fail(function(){t(0)})},getCoinFromGemInverse:function(e,t){E.updateCoinInGem(function(){t(E.convertGemToCoin(e))})},deductTax:function(e){return Math.floor(e-e*E.Exchange.TAX_TOTAL)},processPrice:function(e,t){var n=void 0===t?1:t,a=Array.isArray(e),i=(a?e[0]:e.buys.unit_price)*n,r=(a?e[1]||e[0]:e.sells.unit_price||e.buys.unit_price)*n;return{oPriceBuy:i,oPriceSell:r,oPriceBuyTaxed:E.deductTax(i),oPriceSellTaxed:E.deductTax(r)}},createPrice:function(e,t){var n=void 0===t?1:t,a=void 0===e?0:e*n;return{oPriceBuy:a,oPriceSell:a,oPriceBuyTaxed:E.deductTax(a),oPriceSellTaxed:E.deductTax(a)}},createPricePlain:function(e,t){var n=void 0===t?1:t,a=void 0===e?0:e*n;return{oPriceBuy:a,oPriceSell:a,oPriceBuyTaxed:a,oPriceSellTaxed:a}},createPriceBound:function(e,t){if(E.isPriceObject(e))return{oPriceBuy:e.oPriceBuy,oPriceSell:e.oPriceSell,oPriceBuyTaxed:0,oPriceSellTaxed:0};var n=void 0===t?1:t,a=void 0===e?0:e*n;return{oPriceBuy:a,oPriceSell:a,oPriceBuyTaxed:0,oPriceSellTaxed:0}},addPrice:function(e,t){return{oPriceBuy:e.oPriceBuy+t.oPriceBuy,oPriceSell:e.oPriceSell+t.oPriceSell,oPriceBuyTaxed:e.oPriceBuyTaxed+t.oPriceBuyTaxed,oPriceSellTaxed:e.oPriceSellTaxed+t.oPriceSellTaxed}},recountPrice:function(e,t){return{oPriceBuy:e.oPriceBuy*t,oPriceSell:e.oPriceSell*t,oPriceBuyTaxed:e.oPriceBuyTaxed*t,oPriceSellTaxed:e.oPriceSellTaxed*t}},isPriceObject:function(e){return void 0!==e.oPriceBuy?!0:!1},getPrice:function(e,t,n){var a=void 0!==n?n:!1;Q.isTradeable(e)&&$.ajax({dataType:"json",url:U.getAPIPrice(e),cache:a,success:function(e){if(t){var n=E.processPrice(e);t(n)}}})},getListings:function(e,t,n){var a=void 0!==n?n:!1;Q.isTradeable(e)?$.ajax({dataType:"json",url:U.getAPIListings(e),cache:a,success:function(e){t&&t(e)},error:function(){I.removeThrobber("#cslContent"),I.print("Item is not on the Trading Post.")}}):(I.clear(),I.write("Item is not tradeable."))},formatListings:function(e,t){var n="",a=D.getWordCapital("price"),i=D.getWord("by"),r="",o="",s=0,c=0,l=0,u=0;t.buys.forEach(function(e){r+="<tr><td>"+e.quantity+" "+D.getWordCapital("ordered")+"</td><td>"+E.formatCoinStringColored(e.unit_price)+"</td></tr>",c+=e.quantity,u+=e.listings}),r+="</tbody></table>",t.sells.forEach(function(e){o+="<tr><td>"+e.quantity+" "+D.getWordCapital("available")+"</td><td>"+E.formatCoinStringColored(e.unit_price)+"</td></tr>",s+=e.quantity,l+=e.listings}),o+="</tbody></table>";var d="<span class='trsListingsDemand'>"+D.getWordCapital("demand")+": "+c.toLocaleString()+" "+i+" "+u.toLocaleString()+"</span>",p="<span class='trsListingsSupply'>"+D.getWordCapital("supply")+": "+s.toLocaleString()+" "+i+" "+l.toLocaleString()+"</span>",h="<table class='trsListingsBuys'><thead><tr><th>"+d+"</th><th>"+a+"</th></tr></thead><tbody>",g="<table class='trsListingsSells'><thead><tr><th>"+p+"</th><th>"+a+"</th></tr></thead><tbody>";return n+="<div class='trsListings'>"+h+r+g+o+"</div>"},printListings:function(e,t){t!==!1&&I.print(I.cThrobber,!0),Q.getItem(e,function(n){E.getListings(e,function(e){t!==!1&&(I.clear(),I.print(Q.getItemPreface(n))),I.print(E.formatListings(n,e)),I.bindConsoleInput()})})},calculateTrading:function(e){var t=E.parseCoinString(e.find(".trdBuy").val()),n=E.parseCoinString(e.find(".trdSell").val()),a=T.parseQuantity(e.find(".trdQuantity").val()),i=e.find(".trdCost"),r=e.find(".trdTax"),o=e.find(".trdRevenue"),s=e.find(".trdProfit"),c=e.find(".trdBreak"),l=e.find(".trdMargin"),u=(n-n*E.Exchange.TAX_TOTAL-t)*a,d=(n-n*E.Exchange.TAX_SOLD)*a,p=t*a,h=n*E.Exchange.TAX_LIST*a,g=n*E.Exchange.TAX_SOLD*a;i.val("−"+E.formatCoinString(Math.round(p))),r.val("−"+E.formatCoinString(Math.round(h))+" + −"+E.formatCoinString(Math.round(g))),c.val(E.formatCoinString(Math.round(t/E.Exchange.TAX_INVERSE))),o.val(E.formatCoinString(Math.round(d))),s.val(E.formatCoinString(Math.round(u))),l.val(U.convertRatioToPercent(d/(p+h)-1,2)),$([s,l]).each(function(){var e=Math.round(u);$(this).removeClass("trdZero trdGain trdLoss"),0===e?$(this).addClass("trdZero"):e>0?$(this).addClass("trdGain"):0>e&&$(this).addClass("trdLoss")})},updateTradingDetails:function(e){var t=e.find(".trdName").val(),n=e.find(".trdItem").val();isFinite(parseInt(n))!==!1&&0!==t.length&&Q.getItem(n,function(t){var n=e.find(".trdIcon");Q.setRarityClass(e.find(".trdName"),t.rarity),e.attr("data-rarity",t.rarity),e.find(".trdLink").val(t.chat_link||""),n.attr("src",t.icon),n.unbind("click").click(function(){Q.printItemInfo(t)}),Q.scanItem(t,{aElement:n,aCallback:function(t){e.data("istradeable",t.oIsTradeable)}})})},updateTradingPrices:function(e){var t=e.find(".trdName").val(),n=e.find(".trdItem").val();if(isFinite(parseInt(n))!==!1&&0!==t.length){var a=0,i=0,r=0,o=0,s=e.find(".trdName"),c=e.find(".trdCurrentBuy"),l=e.find(".trdCurrentSell"),u=e.find(".trdNotifyBuyLow"),d=e.find(".trdNotifyBuyHigh"),p=e.find(".trdNotifySellLow"),h=e.find(".trdNotifySellHigh"),g=E.parseCoinString(u.val()),m=E.parseCoinString(d.val()),f=E.parseCoinString(p.val()),C=E.parseCoinString(h.val());return e.data("istradeable")===!1?(c.val(""),l.val(""),void(X.getChecklistItem(X.Checklists.TradingOverwrite,U.getSubintegerFromHTMLID(e))===X.ChecklistEnum.Checked&&(e.find(".trdBuy").val("").trigger("input"),e.find(".trdSell").val("").trigger("input")))):void $.ajax({dataType:"json",url:U.getAPIPrice(n),cache:!1,success:function(t){a=E.parseCoinString(e.find(".trdCurrentBuy").first().val()),i=E.parseCoinString(e.find(".trdCurrentSell").first().val()),void 0!==t.buys&&(r=parseInt(t.buys.unit_price)),void 0!==t.sells&&(o=parseInt(t.sells.unit_price)),c.val(E.formatCoinString(r)),l.val(E.formatCoinString(o)),X.getChecklistItem(X.Checklists.TradingOverwrite,U.getSubintegerFromHTMLID(e))===X.ChecklistEnum.Checked&&(e.find(".trdBuy").val(c.val()).trigger("input"),e.find(".trdSell").val(l.val()).trigger("input"))}}).done(function(){E.animateValue(c,a,r),E.animateValue(l,i,o),X.isChecked(X.Checklists.TradingNotify,e)&&(s.removeClass("trdMatched"),r>g||0===g||0===r?u.removeClass("trdMatched"):(s.addClass("trdMatched"),u.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy low")+" "+t)),m>r||0===m||0===r?d.removeClass("trdMatched"):(s.addClass("trdMatched"),d.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy high")+" "+t)),o>f||0===f||0===o?p.removeClass("trdMatched"):(s.addClass("trdMatched"),p.addClass("trdMatched"),D.speak(D.getPhraseTitle("sell low")+" "+t)),C>o||0===C||0===o?h.removeClass("trdMatched"):(s.addClass("trdMatched"),h.addClass("trdMatched"),D.speak(D.getPhraseTitle("sell high")+" "+t)))}).fail(function(){c.val(I.Symbol.Ellipsis),l.val(I.Symbol.Ellipsis)})}},updateAllTradingDetails:function(){$("#trdList .trdEntry").each(function(){E.updateTradingDetails($(this))})},updateAllTradingPrices:function(){$("#trdList .trdEntry").each(function(){E.updateTradingPrices($(this))})},clearCalculator:function(e){Q.setRarityClass(e.find(".trdName")),e.find(".trdIcon").attr("src",U.URL_IMG.Placeholder),e.find(".trdItem").val("").trigger("change"),e.find(".trdCurrentBuy").val(""),e.find(".trdCurrentSell").val(""),e.find(".trdLink").val(""),e.find(".trdNotifyBuyLow").val("").trigger("change"),e.find(".trdNotifyBuyHigh").val("").trigger("change"),e.find(".trdNotifySellLow").val("").trigger("change"),e.find(".trdNotifySellHigh").val("").trigger("change"),E.clearMatched(e)},clearMatched:function(e){e.find(".trdName").removeClass("trdMatched"),e.find(".trdNotifyBuyLow").removeClass("trdMatched"),e.find(".trdNotifyBuyHigh").removeClass("trdMatched"),e.find(".trdNotifySellLow").removeClass("trdMatched"),e.find(".trdNotifySellHigh").removeClass("trdMatched")},initializeTrading:function(){var e,t,n,a,i,r="";for(e=0;e<O.Options.int_numTradingCalculators;e++)r="#trdEntry_"+e,$("#trdList").append("<div id='trdEntry_"+e+"' class='trdEntry'><div class='trdAccordion trdAccordionShut'><abbr><img class='trdIcon' src='"+U.URL_IMG.Placeholder+"' /></abbr><div class='trdResultsFocus'><input class='trdName' type='text' /></div><div class='trdButtons'><button class='trdSearch' tabindex='-1'>S</button><button class='trdListings' tabindex='-1'>$</button><br /></div><div class='trdExpand'><abbr>$~O</abbr><input class='trdBuy' type='text' /><abbr>−$~</abbr><input class='trdCost trdOutput' type='text' tabindex='-1' /><br /><abbr>O~$</abbr><input class='trdSell' type='text' /><abbr>$=$</abbr><input class='trdBreak trdOutput' type='text' tabindex='-1' /><br /><abbr>×</abbr><input class='trdQuantity' type='text' /><abbr>−$%</abbr><input class='trdTax trdOutput' type='text' tabindex='-1' /><br /><abbr>+$</abbr><input class='trdProfit trdOutput' type='text' tabindex='-1' /><abbr>=$</abbr><input class='trdRevenue trdOutput' type='text' tabindex='-1' /><br /><abbr>+$%</abbr><input class='trdMargin trdOutput' type='text' tabindex='-1' /><abbr>[]</abbr><input class='trdLink trdOutput' type='text' tabindex='-1' /><input class='trdItem trdOutput' type='text' /><br /><abbr>$~!</abbr><input class='trdNotifyBuyHigh' type='text' /><input class='trdCurrentBuy trdOutput' type='text' tabindex='-1' /><input class='trdNotifyBuyLow' type='text' /><label title='<dfn>"+D.getWordCapital("overwrite")+"</dfn>: Replace your buy and sell prices with the current prices when refreshing.'><input class='trdOverwrite' type='checkbox' tabindex='-1' />"+I.Symbol.Filler+"</label><br /><abbr>!~$</abbr><input class='trdNotifySellHigh' type='text' /><input class='trdCurrentSell trdOutput' type='text' tabindex='-1' /><input class='trdNotifySellLow' type='text' /><label title='<dfn>"+D.getWordCapital("notify")+"</dfn>: Turn on sound notification for this item.'><input class='trdNotify' type='checkbox' tabindex='-1' />"+I.Symbol.Filler+"</label><br /><br /></div></div><div class='trdPreview'><input class='trdCurrentBuy trdOutput' type='text' tabindex='-1' /><input class='trdCurrentSell trdOutput' type='text' tabindex='-1' /><div class='btnSwap'><button class='btnSwapUp' tabindex='-1'></button><button class='btnSwapDown' tabindex='-1'></button></div></div></div>"),I.qTip.init($(r+" .trdOverwrite").parent()),I.qTip.init($(r+" .trdNotify").parent()),t=$(r+" .trdName"),n=$(r+" .trdBuy"),a=$(r+" .trdSell"),i=$(r+" .trdQuantity"),$(r+" input").click(function(){$(this).select()}),$(r+" .trdListings").click(function(){if(I.isConsoleShown()===!1){var e=$(this).parents(".trdEntry").find(".trdItem").val();E.printListings(e)}}).dblclick(function(){var e=$(this).parents(".trdEntry").find(".trdName").val();U.openExternalURL(U.getWikiLinkLanguage(e))}),$(r+" .trdSearch").click(function(){var e=$(this).parents(".trdEntry").find(".trdItem").val(),t=$(this).parents(".trdEntry").find(".trdName").val();U.openExternalURL(0===e.length?U.getTradingSearchLink(t):U.getTradingItemLink(e,t))}),$([n,a,i]).each(function(){$(this).on("input",function(){E.calculateTrading($(this).parent())})}),$(r+" .trdCurrentBuy, "+r+" .trdCurrentSell").each(function(){$(this).dblclick(function(){var e=E.parseCoinString($(this).val());0!==e&&($(this).prev().val(E.formatCoinString(e+1)).trigger("change"),$(this).next().val(E.formatCoinString(e-1)).trigger("change"),E.updateTradingPrices($(this).parents(".trdEntry")),D.stopSpeech())})}),$(r+" .btnSwap").hover(function(){$(this).parents(".trdEntry").find(".trdName").addClass("trdHovered"),E.SwapIndex=U.getSubintegerFromHTMLID($(this).parents(".trdEntry"))},function(){$(".trdName").removeClass("trdHovered")}),$(r+" .btnSwapUp, "+r+" .btnSwapDown").each(function(){$(this).click(function(){var e=E.SwapIndex,t=$(this).hasClass("btnSwapUp")?!0:!1;if((!t||0!==e)&&!t!==$(".trdEntry").length-1){var n=t?e-1:e+1,a=$("#trdEntry_"+e),i=$("#trdEntry_"+n),r=a.find(".trdIcon").attr("src"),o=i.find(".trdIcon").attr("src");a.find(".trdIcon").attr("src",o),i.find(".trdIcon").attr("src",r);var s=[],c=[],l=0,u=0;a.find("input[type='text']").each(function(){s.push($(this).val())}),i.find("input[type='text']").each(function(){c.push($(this).val())}),a.find("input[type='text']").each(function(){$(this).val(c[l]).trigger("change"),l++}),i.find("input[type='text']").each(function(){$(this).val(s[u]).trigger("change"),u++});var d=a.attr("data-rarity"),p=i.attr("data-rarity");a.attr("data-rarity",p),i.attr("data-rarity",d),Q.setRarityClass(a.find(".trdName"),p),Q.setRarityClass(i.find(".trdName"),d),E.clearMatched(a),E.clearMatched(i),a.find(".trdName").removeClass("trdHovered"),i.find(".trdName").addClass("trdHovered"),E.SwapIndex=t?E.SwapIndex-1:E.SwapIndex+1}})}),function(e){Q.bindItemSearch($(t),{aFillerText:null,aWantEnter:!1,aResultsClass:"trdResultsContainer",aCallback:function(t){e.find(".trdItem").val(t.id).trigger("change"),e.find(".trdName").val(t.name).trigger("change"),E.updateTradingDetails(e),E.updateTradingPrices(e)}})}($(r)),$(t).change(function(){var e=$(this).val(),t=$(this).parents(".trdEntry");e.length<1&&E.clearCalculator(t)}).onEnterKey(function(){U.openExternalURL(U.getTradingSearchLink($(this).val()))});r="#trdEntry_0",$(r+" .trdIcon").attr("src","img/ui/question.png"),$(r+" .trdName").val("Kudzu"),$(r+" .trdBuy").val("4500.37.68"),$(r+" .trdSell").val("550037.68"),$(r+" .trdQuantity").val("1"),$(r).css("margin-bottom","6px");var o=function(e,t,n){n=void 0===n?"":": "+n,$(r+" .trd"+e).attr("title","<dfn>"+D.getPhraseTitle(t)+"</dfn>"+n)};o("Name","name"),o("Buy","your buy"),o("Sell","your sell"),o("Quantity","quantity"),o("Cost","cost","Money needed to buy the items."),o("Break","breakpoint","Sell higher than this to make a profit."),o("Tax","tax","Pay 5% fee of sell price to list, and deduct 10% tax of sell price when sold."),o("Profit","profit","Gains after losses from buying and tax."),o("Margin","margin","Revenue over cost and fee."),o("Revenue","revenue","What you will receive at the trader."),o("Link","chatlink","Paste this in game chat to see the item."),o("Item","ID","API item number."),o("NotifyBuyLow","notify if current buy < this buy"),o("NotifyBuyHigh","notify if this buy < current buy"),o("NotifySellLow","notify if current sell < this sell"),o("NotifySellHigh","notify if this sell < current sell"),o("CurrentBuy","current buy","Double click to flank price."),o("CurrentSell","current sell","Double click to flank price."),I.qTip.init($(r+" input")),X.initializeTextlist(X.Textlists.TradingItem,$("#trdList .trdItem"),null,16),X.initializeTextlist(X.Textlists.TradingName,$("#trdList .trdName"),null,64),X.initializeTextlist(X.Textlists.TradingBuy,$("#trdList .trdBuy"),null,16),X.initializeTextlist(X.Textlists.TradingSell,$("#trdList .trdSell"),null,16),X.initializeTextlist(X.Textlists.TradingQuantity,$("#trdList .trdQuantity"),null,16),X.initializeTextlist(X.Textlists.NotifyBuyLow,$("#trdList .trdNotifyBuyLow"),null,16),X.initializeTextlist(X.Textlists.NotifyBuyHigh,$("#trdList .trdNotifyBuyHigh"),null,16),X.initializeTextlist(X.Textlists.NotifySellLow,$("#trdList .trdNotifySellLow"),null,16),X.initializeTextlist(X.Textlists.NotifySellHigh,$("#trdList .trdNotifySellHigh"),null,16),X.initializeCheckboxlist(X.Checklists.TradingOverwrite,$("#trdList .trdOverwrite"),X.ChecklistJob.CheckAll),X.initializeCheckboxlist(X.Checklists.TradingNotify,$("#trdList .trdNotify"),X.ChecklistJob.CheckAll),$("#trdList .trdSell").trigger("input"),E.updateAllTradingDetails(),$("#trdToggle").click(function(){$("#trdEntry_0 .trdBuy").is(":visible")?($(".trdAccordion").addClass("trdAccordionShut").removeClass("trdAccordionOpen"),$(".trdPreview").removeClass("cssHidden")):($(".trdAccordion").removeClass("trdAccordionShut").addClass("trdAccordionOpen"),$(".trdPreview").addClass("cssHidden"))}),D.verifyNativeTTS(),$("#trdRefresh").click($.throttle(E.cREFRESH_LIMIT,function(){E.loopRefresh(!0)})),$("#trdPause").click(function(){E.cancelLoopRefresh()}),$("#trdMute").click(function(){D.stopSpeech()}),$("#trdPrint").click(function(){I.clear();
for(var e=X.Textlists.TradingItem.value.length,t="ItemID,Name,Buy,Sell,Quantity,BuyLow,BuyHigh,SellLow,SellHigh<br />",n=0;e>n;n++)t+=U.escapeHTML(X.Textlists.TradingItem.value[n]+","+X.Textlists.TradingName.value[n]+","+X.Textlists.TradingBuy.value[n]+","+X.Textlists.TradingSell.value[n]+","+X.Textlists.TradingQuantity.value[n]+","+X.Textlists.NotifyBuyLow.value[n]+","+X.Textlists.NotifyBuyHigh.value[n]+","+X.Textlists.NotifySellLow.value[n]+","+X.Textlists.NotifySellHigh.value[n])+"<br />";Z.createFile(t.replace(/<br \/>/g,"\r\n"),"tp.csv"),I.print(t)})},updateCoinTo:function(e){var t=0,n=0,a=0,i=0,r=0,o=0,s=0,c=0,l=$("#trdExchange .trdCoinTo"),u=$("#trdExchange .trdCoinToGem"),d=$("#trdExchange .trdCoinToMoney"),p=$("#trdExchange .trdCoinToGemInverse"),h=$("#trdExchange .trdCoinToMoneyInverse"),g=E.parseCoinString(l.val());0===g||""===l.val()?(u.val(""),d.val(""),p.val(""),h.val("")):(E.getGemFromCoin(g,function(r){t=parseInt(u.val()),a=E.parseMoneyString(d.val()),n=r,i=Math.round(n*E.Exchange.DOLLAR_PER_GEM),u.val(n),d.val(E.formatMoneyString(i)),(void 0===e||e)&&(E.animateValue(u,t,n),E.animateValue(d,a,i)),0===n&&(u.val("0"),d.val("0"))}),E.getGemFromCoinInverse(g,function(t){r=parseInt(p.val()),s=E.parseMoneyString(h.val()),o=t,c=Math.round(o*E.Exchange.DOLLAR_PER_GEM),p.val(o),h.val(E.formatMoneyString(c)),(void 0===e||e)&&(E.animateValue(p,r,o),E.animateValue(h,s,c))}))},updateGemTo:function(e){var t=0,n=0,a=0,i=0,r=0,o=0,s=$("#trdExchange .trdGemTo"),c=$("#trdExchange .trdGemToCoin"),l=$("#trdExchange .trdGemToMoney"),u=$("#trdExchange .trdGemToCoinInverse"),d=s.val();0===d||""===s.val()?(c.val(""),l.val(""),u.val("")):(E.getCoinFromGem(d,function(r){t=E.parseCoinString(c.val()),a=E.parseMoneyString(l.val()),n=r,i=parseInt(d*E.Exchange.DOLLAR_PER_GEM),c.val(E.formatCoinString(n)),l.val(E.formatMoneyString(i)),(void 0===e||e)&&(E.animateValue(c,t,n),E.animateValue(l,a,i)),0===n&&(c.val("0"),l.val("0"))}),E.getCoinFromGemInverse(d,function(t){r=E.parseCoinString(u.val()),o=t,u.val(E.formatCoinString(o)),(void 0===e||e)&&E.animateValue(u,r,o)}))},updateMoneyTo:function(e){var t=0,n=0,a=0,i=0,r=$("#trdExchange .trdMoneyTo"),o=$("#trdExchange .trdMoneyToGem"),s=$("#trdExchange .trdMoneyToCoin"),c=E.parseMoneyString(r.val()),l=c*E.Exchange.GEM_PER_DOLLAR;0===c||""===r.val()?(o.val(""),s.val("")):E.getCoinFromGem(l,function(r){t=parseInt(o.val()),a=E.parseCoinString(s.val()),n=l,i=r,o.val(l),s.val(E.formatCoinString(i)),(void 0===e||e)&&(E.animateValue(o,t,n),E.animateValue(s,a,i)),0===i&&(o.val("0"),s.val("0"))})},updateNotifyCoinTo:function(e){var t=0,n=0,a=$("#trdExchange .trdNotifyCoinTo"),i=$("#trdExchange .trdNotifyCoinToGem"),r=$("#trdExchange .trdNotifyCoinToGemHigh"),o=E.parseGemString(r.val()),s=E.parseCoinString(a.val());0===s||""===a.val()?i.val(""):E.getGemFromCoin(s,function(a){t=parseInt(i.val()),n=a,i.val(n),(void 0===e||e)&&E.animateValue(i,t,n),0===n?i.val("0"):o>n||0===o?r.removeClass("trdMatched"):(r.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy gem high")))})},updateNotifyGemTo:function(e){var t=0,n=0,a=$("#trdExchange .trdNotifyGemTo"),i=$("#trdExchange .trdNotifyGemToCoin"),r=$("#trdExchange .trdNotifyGemToCoinHigh"),o=E.parseCoinString(r.val()),s=a.val();0===s||""===a.val()?i.val(""):E.getCoinFromGem(s,function(a){t=E.parseCoinString(i.val()),n=a,i.val(E.formatCoinString(n)),(void 0===e||e)&&E.animateValue(i,t,n),0===n?i.val("0"):o>n||0===o?r.removeClass("trdMatched"):(r.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy coin high")))})},updateAllExchange:function(){E.updateCoinTo(),E.updateGemTo(),E.updateMoneyTo(),E.updateNotifyCoinTo(),E.updateNotifyGemTo()},initializeExchange:function(){var e=$("#trdExchange .trdCoinTo"),t=$("#trdExchange .trdGemTo"),n=$("#trdExchange .trdMoneyTo"),a=$("#trdExchange .trdNotifyCoinTo"),i=$("#trdExchange .trdNotifyGemTo"),r=$("#trdExchange .trdNotifyCoinToGemHigh"),o=$("#trdExchange .trdNotifyGemToCoinHigh");e.val("200.."),t.val("4000"),n.val("50");var s=function(e,t){$("#trdExchange .trd"+e).attr("title","<dfn>"+D.getPhraseTitle(t)+"</dfn>")};s("CoinTo","your coin"),s("GemTo","your gem"),s("MoneyTo","your dollar"),s("CoinToGem","your coin to gem"),s("GemToCoin","your gem to coin"),s("MoneyToGem","your dollar to gem"),s("CoinToMoney","your coin to dollar"),s("GemToMoney","your gem to dollar"),s("MoneyToCoin","your dollar to coin"),s("CoinToGemInverse","gem to your coin"),s("GemToCoinInverse","coin to your gem"),s("CoinToMoneyInverse","dollar to your coin"),s("NotifyCoinTo","your coin"),s("NotifyGemTo","your gem"),s("NotifyCoinToGem","your coin to current gem"),s("NotifyGemToCoin","your gem to current coin"),s("NotifyCoinToGemHigh","notify if current gem > this gem"),s("NotifyGemToCoinHigh","notify if current coin > this coin"),I.qTip.init($("#trdExchange input")),$("#trdExchange input").click(function(){$(this).select()}),e.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateCoinTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateCoinTo()})),t.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateGemTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateGemTo()})),n.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateMoneyTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateMoneyTo()})),a.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyCoinTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyCoinTo()})),i.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyGemTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyGemTo()})),X.initializeTextlist(X.Textlists.ExchangeUnit,$([e,t,n,a,i,r,o]),null,16),$(".trdProgress").data("width",$(".trdProgress").width()),E.isTradingCalculatorsInitialized=!0,E.loopRefresh()},cancelLoopRefresh:function(){window.clearTimeout(E.ProgressTimeout),window.clearTimeout(E.RefreshTimeout),$(".trdProgress").width($(".trdProgress").data("width"))},animateProgress:function(){var e=$(".trdProgress");E.ProgressTick<E.ProgressWait&&e.width(e.width()-e.data("width")/E.ProgressWait),E.ProgressTick-=1,E.ProgressTimeout=setTimeout(E.animateProgress,T.cMSECONDS_IN_SECOND)},loopRefresh:function(e){if(E.cancelLoopRefresh(),(e===!0||O.Options.bol_refreshPrices)&&(E.updateAllTradingPrices(),E.updateAllExchange(),O.Options.bol_refreshPrices)){var t=O.Options.int_secTradingRefresh*T.cMSECONDS_IN_SECOND;E.ProgressTick=O.Options.int_secTradingRefresh,E.ProgressWait=O.Options.int_secTradingRefresh,E.animateProgress(),E.RefreshTimeout=setTimeout(E.loopRefresh,t)}},initializeCalculator:function(){$("#trdCalculation .trdCalculator").onEnterKey(function(){E.doCalculation($(this))}).click(function(){$(this).select()}),$("#trdCalculation .trdCalcSubmit").click(function(){E.doCalculation($(this).prev())});for(var e in E.CalculatorHistoryArray)E.CalculatorHistoryArray[e]="";$("#trdCalculation .trdCalculator").onArrowUpKey(function(){if(0===E.CalcHistoryIndex){var e=U.stripToCalculation($(this).val());E.CalculatorHistoryArray[0]!==""+$(this).val()&&(E.CalculatorHistoryArray.pop(),E.CalculatorHistoryArray.unshift(e))}E.CalcHistoryIndex+1<E.CalculatorHistoryArray.length&&(E.CalcHistoryIndex++,$(this).val(E.CalculatorHistoryArray[E.CalcHistoryIndex]))}),$("#trdCalculation .trdCalculator").onArrowDownKey(function(){E.CalcHistoryIndex-1<0||(E.CalcHistoryIndex--,$(this).val(E.CalculatorHistoryArray[E.CalcHistoryIndex]))})},doCalculation:function(pCalculator){var expression=U.stripToCalculation(pCalculator.val()),result="";try{result=eval(expression)}catch(e){}pCalculator.val(parseFloat(result)).select(),(""+result).length>0&&(E.CalculatorHistoryArray.pop(),E.CalculatorHistoryArray.unshift(expression),E.CalcHistoryIndex=0)}},D={Dictionary:{s_TEMPLATE:{de:"",es:"",fr:"",cs:"",it:"",pl:"",pt:"",ru:"",zh:""},s_y:{de:"j",es:"a",fr:"a",cs:"r",it:"a",pl:"r",pt:"a",ru:"г",zh:"年"},s_mo:{de:"mo",es:"me",fr:"mo",cs:"mě",it:"me",pl:"mi",pt:"mê",ru:"ме",zh:"月"},s_w:{de:"w",es:"s",fr:"s",cs:"t",it:"s",pl:"t",pt:"s",ru:"н",zh:"週"},s_d:{de:"t",es:"d",fr:"j",cs:"d",it:"g",pl:"d",pt:"d",ru:"д",zh:"日"},s_h:{de:"h",es:"h",fr:"h",cs:"h",it:"o",pl:"g",pt:"h",ru:"ч",zh:"時"},s_m:{de:"m",es:"m",fr:"m",cs:"m",it:"m",pl:"m",pt:"m",ru:"м",zh:"分"},s_s:{de:"s",es:"s",fr:"s",cs:"s",it:"s",pl:"s",pt:"s",ru:"с",zh:"秒"},s_hour:{de:"stunde",es:"hora",fr:"heure",cs:"hodina",it:"ora",pl:"godzinę",pt:"hora",ru:"час",zh:"時"},s_minute:{de:"minute",es:"minuto",fr:"minute",cs:"minuta",it:"minuto",pl:"minuta",pt:"minuto",ru:"минута",zh:"分"},s_second:{de:"sekunde",es:"segundo",fr:"seconde",cs:"sekunda",it:"secondo",pl:"sekund",pt:"segundo",ru:"секунду",zh:"秒"},s_hours:{de:"stunden",es:"horas",fr:"heures",cs:"hodin",it:"secondi",pl:"godzin",pt:"horas",ru:"часов",zh:"時"},s_minutes:{de:"minuten",es:"minutos",fr:"minutes",cs:"minut",it:"minuti",pl:"minut",pt:"minutos",ru:"минут",zh:"分"},s_seconds:{de:"sekunden",es:"segundos",fr:"secondes",cs:"sekund",it:"ore",pl:"sekund",pt:"segundos",ru:"секунд",zh:"秒"},s_half_an_hour:{de:"eine halbe stunde",es:"media hora",fr:"demi-heure",cs:"půl hodiny",it:"mezz&apos;ora",pl:"pół godziny",pt:"meia hora",ru:"полчаса",zh:"半小時"},s_cooldown:{de:"abkühl",es:"recuperación",fr:"recharge",cs:"dobíjení",it:"raffreddamento",pl:"ochładzania",pt:"resfriamento",ru:"перезарядка",zh:"冷卻"},s_remaining:{de:"verbleibend",es:"restante",fr:"restant",cs:"zbývající",it:"rimanente",pl:"pozostały",pt:"restante",ru:"оставшиеся",zh:"剩餘"},s_daylight:{de:"tageszeit",es:"luz de día",fr:"lumière du jour",cs:"denní světlo",it:"luce del giorno",pl:"światło dzienne",pt:"luz do dia",ru:"дневной свет",zh:"白天"},s_nighttime:{de:"nacht",es:"noche",fr:"nuit",cs:"noc",it:"ore notturne",pl:"nocna pora",pt:"período noturno",ru:"ночь",zh:"夜間"},s_dawn:{de:"tagesanbruch",es:"amanecer",fr:"aube",cs:"svítání",it:"alba",pl:"świt",pt:"alvorecer",ru:"рассвет",zh:"黎明"},s_dusk:{de:"dämmerung",es:"crepúsculo",fr:"crépuscule",cs:"soumrak",it:"crepuscolo",pl:"zmierzch",pt:"crepúsculo",ru:"сумрак",zh:"黃昏"},s_approaching:{de:"nähert",es:"acerca",fr:"approchant",cs:"blíží",it:"avvicina",pl:"zbliża",pt:"aproximava",ru:"приближается",zh:"來臨"},s_account:{de:"account",es:"cuenta",fr:"compte",cs:"účet",it:"conto",pl:"konto",pt:"conta",ru:"счёт",zh:"帳戶​​"},s_key:{de:"schlüssel",es:"tecla",fr:"clé",cs:"klávesa",it:"chiave",pl:"klawisz",pt:"chave",ru:"ключ",zh:"索引鍵"},s_info:{de:"info",es:"información",fr:"info",cs:"informace",it:"info",pl:"informacje",pt:"informações",ru:"информация",zh:"資訊"},s_timers:{de:"zeitgeber",es:"temporizadores",fr:"minuteurs",cs:"časovače",it:"timer",pl:"czasomierzy",pt:"temporizadores",ru:"таймеров",zh:"計時器"},s_tools:{de:"extras",es:"herramientas",fr:"outils",cs:"nástroje",it:"strumenti",pl:"narzędzia",pt:"ferramentas",ru:"инструменты",zh:"工具"},s_help:{de:"hilfe",es:"ayuda",fr:"assistance",cs:"pomoci",it:"guida",pl:"pomoc",pt:"ajuda",ru:"помощь",zh:"輔助"},s_options:{de:"optionen",es:"opciónes",fr:"options",cs:"možnosti",it:"opzioni",pl:"opcje",pt:"opções",ru:"параметры",zh:"選項"},s_arrival:{de:"ankunft",es:"llegada",fr:"arrivée",cs:"příjezd",it:"arrivo",pl:"przyjazd",pt:"chegada",ru:"прибытие",zh:"到來"},s_world:{de:"welt",es:"mundo",fr:"monde",cs:"svět",it:"mondo",pl:"świat",pt:"mundo",ru:"босс",zh:"世界"},s_boss:{de:"boss",es:"jefe",fr:"chef",cs:"boss",it:"boss",pl:"szef",pt:"chefe",ru:"босс",zh:"頭目"},s_event:{de:"event",es:"evento",fr:"événement",cs:"událost",it:"evento",pl:"wydarzenie",pt:"evento",ru:"собы́тие",zh:"事件"},s_section:{de:"abschnitt",es:"sección",fr:"section",cs:"oddíl",it:"sezione",pl:"sekcja",pt:"seção",ru:"раздел",zh:"節"},s_map:{de:"karte",es:"mapa",fr:"carte",cs:"mapa",it:"mappa",pl:"mapa",pt:"mapa",ru:"ка́рта",zh:"地圖"},s_center:{de:"zentrum",es:"centro",fr:"centre",cs:"střed",it:"centro",pl:"środek",pt:"centro",ru:"центр",zh:"中心"},s_completion:{de:"abschluss",es:"finalización",fr:"progression",cs:"dokončení",it:"completamento",pl:"ukończenie",pt:"progressão",ru:"завершение",zh:"完成"},s_route:{de:"route",es:"ruta",fr:"route",cs:"trasa",it:"percorso",pl:"trasa",pt:"rota",ru:"маршру́т",zh:"路線"},s_pins:{de:"stecknadel",es:"alfileres",fr:"épingles",cs:"špendlík",it:"spilli",pl:"szpilka",pt:"alfinetes",ru:"була́вка",zh:"大頭針"},s_range:{de:"reichweite",es:"alcance",fr:"portée",cs:"dosah",it:"portata",pl:"zasięg",pt:"alcance",ru:"дальность",zh:"射程"},s_lock:{de:"sperre",es:"bloqueo",fr:"verrou",cs:"zámek",it:"blocco",pl:"zablokuj",pt:"bloqueio",ru:"блокировка",zh:"鎖定"},s_checklist:{de:"prüfliste",es:"lista de comprobación",fr:"liste de contrôle",cs:"kontrolní seznam",it:"elenco di controllo",pl:"lista kontrolna",pt:"lista de verificação",ru:"контрольный список",zh:"檢查清單"},s_subscription:{de:"abonnement",es:"suscripción",fr:"abonnement",cs:"předplatné",it:"sottoscrizione",pl:"abonament",pt:"assinatura",ru:"подписка",zh:"訂閱"},s_alarm:{de:"alarm",es:"alarma",fr:"alarme",cs:"alarmu",it:"allarme",pl:"alarmu",pt:"alarme",ru:"будильника",zh:"鬧鐘"},s_mode:{de:"modus",es:"modo",fr:"mode",cs:"režim",it:"modalità",pl:"tryb",pt:"modo",ru:"режим",zh:"方式"},s_chatlink:{de:"chatlink",es:"vínculo chat",fr:"lien chat",cs:"chat odkaz",it:"collegamento chat",pl:"czat łącze",pt:"link bate-papo",ru:"чат связь",zh:"連結聊天"},s_stopwatch:{de:"stoppuhr",es:"cronómetro",fr:"chronomètre",cs:"stopky",it:"cronografo",pl:"stoper",pt:"cronômetro",ru:"секундомер",zh:"碼錶"},s_guilds:{de:"gilden",es:"clanes",fr:"guildes",cs:"cechy",it:"clan",pl:"klany",pt:"clãs",ru:"гильдий",zh:"戰隊"},s_is:{de:"ist",es:"es",fr:"est",cs:"je",it:"è",pl:"jest",pt:"é",ru:"является",zh:"是"},s_subscribe:{de:"abonnieren",es:"subscribir",fr:"abonner",cs:"předplatit si",it:"sottoscrivere",pl:"abonować",pt:"assinar",ru:"подписаться",zh:"訂閱"},s_will_start:{de:"wird starten",es:"se iniciará",fr:"débutera",cs:"začne",it:"inizierà",pl:"rozpocznie się",pt:"começará",ru:"начнется",zh:"開始"},s_click:{de:"klicken",es:"clic",fr:"cliquer",cs:"kliknout",it:"clic",pl:"klikać",pt:"clicar",ru:"щелкнуть",zh:"按一下"},s_view:{de:"anzeigen",es:"ver",fr:"afficher",cs:"zobrazit",it:"visualizzare",pl:"wyświetlać",pt:"exibir",ru:"представление",zh:"檢視"},s_load:{de:"laden",es:"cargar",fr:"charger",cs:"načíst",it:"caricare",pl:"załaduj",pt:"carregar",ru:"загрузить",zh:"載入"},s_save:{de:"speichern",es:"guardar",fr:"enregistrer",cs:"uložit",it:"salvare",pl:"zapisać",pt:"salvar",ru:"сохранить",zh:"儲存"},s_clear:{de:"löschen",es:"borrar",fr:"effacer",cs:"vymazat",it:"cancella",pl:"wyczyść",pt:"limpar",ru:"очистить",zh:"清除"},s_toggle:{de:"umschalten",es:"alternar",fr:"basculer",cs:"přepnout",it:"alterna",pl:"przełączanie",pt:"alternar",ru:"переключить",zh:"切換"},s_expand:{de:"erweiter",es:"expandir",fr:"développer",cs:"rozbalit",it:"espandere",pl:"rozwinąć",pt:"expandir",ru:"развернуть",zh:"展開"},s_collapse:{de:"verkleiner",es:"contraer",fr:"réduire",cs:"sbalit",it:"comprimere",pl:"zwinąć",pt:"recolher",ru:"свернуть",zh:"摺疊"},s_draw:{de:"zeichnen",es:"dibujar",fr:"dessiner",cs:"kreslit",it:"disegnare",pl:"rysować",pt:"desenhar",ru:"рисова́ть",zh:"画"},s_undo:{de:"rückgängig",es:"deshacer",fr:"annuler",cs:"zpět",it:"annullare",pl:"cofnąć",pt:"desfazer",ru:"отменить",zh:"復原"},s_optimize:{de:"optimieren",es:"optimizar",fr:"optimiser",cs:"optimalizovat",it:"ottimizzare",pl:"optymalizować",pt:"otimizar",ru:"оптимизировать",zh:"最佳化"},s_search:{de:"suchen",es:"buscar",fr:"rechercher",cs:"vyhledat",it:"cerca",pl:"wyszukaj",pt:"pesquisar",ru:"поиск",zh:"搜尋"},s_get:{de:"erhalten",es:"conseguir",fr:"obtenir",cs:"dostat",it:"ottenere",pl:"dostawać",pt:"obter",ru:"достава́ть",zh:"获得"},s_no:{de:"kein",es:"no",fr:"pas de",cs:"žádný",it:"non",pl:"żaden",pt:"nada de",ru:"нет",zh:"沒有"},s_not:{de:"nicht",es:"no",fr:"ne",cs:"ne",it:"non",pl:"nie",pt:"não",ru:"не",zh:"不"},s_ago:{de:"vor",es:"hace",fr:"il ya",cs:"před",it:"fa",pl:"temu",pt:"há",ru:"назад",zh:"前"},s_also:{de:"auch",es:"también",fr:"aussi",cs:"také",it:"anche",pl:"też",pt:"também",ru:"то́же",zh:"也"},s_checked:{de:"abgehakt",es:"visto",fr:"coché",cs:"odškrtnout",it:"controllato",pl:"zakończony",pt:"marcado",ru:"включен",zh:"勾掉"},s_current:{de:"aktuelle",es:"actual",fr:"actuel",cs:"současný",it:"corrente",pl:"bieżący",pt:"corrente",ru:"текущий",zh:"活期"},s_daily:{de:"täglich",es:"diaria",fr:"quotidien",cs:"denní",it:"giornaliero",pl:"dzienny",pt:"diário",ru:"ежедневно",zh:"每天"},s_achievements:{de:"erfolge",es:"logros",fr:"succès",cs:"výsledky",it:"obiettivi",pl:"osiągnięcia",pt:"conquistas",ru:"достижения",zh:"成就"},s_previous:{de:"vorhergehend",es:"previo",fr:"préalable",cs:"předchozí",it:"previo",pl:"poprzedni",pt:"prévio",ru:"предыдущий",zh:"以前的"},s_next:{de:"nächste",es:"siguiente",fr:"prochain",cs:"příští",it:"seguente",pl:"następny",pt:"próximo",ru:"следующий",zh:"下一"},s_off:{de:"aus",es:"desactivado",fr:"désactivé",cs:"vypnuto",it:"disattivato",pl:"wyłączany",pt:"desativado",ru:"выключено",zh:"關"},s_predicted:{de:"vorhergesagt",es:"previsto",fr:"prédit",cs:"předpovídal",it:"previsto",pl:"przewiduje",pt:"predito",ru:"предсказанный",zh:"預測"},s_subscribed:{de:"abonniert",es:"suscrito",fr:"souscrit",cs:"odebírané",it:"sottoscritti",pl:"subskrypcji",pt:"assinado",ru:"подписан",zh:"訂閱"},s_then:{de:"dann",es:"luego",fr:"puis",cs:"pak",it:"poi",pl:"potem",pt:"então",ru:"затем",zh:"接著"},s_found:{de:"gefunden",es:"encontró",fr:"trouvé",cs:"zjištěno",it:"trovato",pl:"stwierdzono",pt:"encontrado",ru:"найден",zh:"發現了"},s_loading:{de:"laden",es:"cargando",fr:"chargement",cs:"načítání",it:"caricamento",pl:"ładowanie",pt:"carregando",ru:"загрузка",zh:"正在載入"},s_at:{de:"um",es:"a",fr:"à",cs:"v",it:"a",pl:"o",pt:"a",ru:"в",zh:"在"},s_and:{de:"und",es:"y",fr:"et",cs:"a",it:"e",pl:"i",pt:"e",ru:"и",zh:"和"},s_by:{de:"von",es:"por",fr:"de",cs:"od",it:"da",pl:"przez",pt:"por",ru:"",zh:"由"},s_if:{de:"wenn",es:"si",fr:"si",cs:"jestliže",it:"se",pl:"jeśli",pt:"se",ru:"если",zh:"如果"},s_in:{de:"in",es:"en",fr:"en",cs:"za",it:"in",pl:"w",pt:"em",ru:"в",zh:"在"},s_to:{de:"zu",es:"a",fr:"contre",cs:"ku",it:"a",pl:"na",pt:"a",ru:"до",zh:"比"},s_Sector:{de:"Sektor",es:"Sector",fr:"Secteur",zh:"扇形"},s_Waypoint:{de:"Wegmarke",es:"Punto de ruta",fr:"Point de passage",zh:"傳送點"},s_Point_of_Interest:{de:"Sehenswürdigkeit",es:"Punto de interés",fr:"Site remarquable",zh:"興趣點"},s_Vista:{de:"Aussichtspunkt",es:"Vista",fr:"Panorama",zh:"鳥瞰點"},s_Hero_Challenge:{de:"Heldenherausforderung",es:"Desafío de héroe",fr:"Défi de héros",zh:"技能點"},s_Heart:{de:"Herzchen-Quest",es:"Corazón de prestigio",fr:"Cœur de renommé",zh:"愛心任務"},s_Scheduled_Bosses:{de:"Geplant",es:"Programado",fr:"Planifié",cs:"Plánované",it:"Pianificata",pl:"Zaplanowane",pt:"Agendado",ru:"Запланирован",zh:"已排程"},s_Special_Bosses:{de:"Speziell",es:"Especial",fr:"Spécial",cs:"Speciální",it:"Speciale",pl:"Specjalny",pt:"Especial",ru:"Особый",zh:"特別的"},s_Dry_Top:{de:"Trockenkuppe",es:"Cima Seca",fr:"Cimesèche",zh:"干涸高地"},s_Legacy_Bosses:{de:"Legacy",es:"Heredado",fr:"Hérité",cs:"Starší",it:"Legacy",pl:"Starsze",pt:"Herdado",ru:"Устаревший",zh:"舊版"},s_Orr_Temples:{de:"Tempel",es:"Templos",fr:"Temples",cs:"Chrámy",it:"Templi",pl:"Świątynie",pt:"Templos",ru:"Храмы",zh:"寺廟"},s_Full_Timetable:{de:"Zeitplan",es:"Horario",fr:"Horaire",cs:"Plán",it:"Programma",pl:"Harmonogram",pt:"Horário",ru:"Расписание",zh:"時間表"},s_promotions:{de:"Aktionen",es:"promociones",fr:"promotions",cs:"propagace",it:"promozioni",pl:"promocje",pt:"promoções",ru:"продвижения",zh:"促銷"},s_menu:{de:"menü",es:"menú",fr:"menu",cs:"nabídka",it:"menu",pl:"menu",pt:"menu",ru:"меню",zh:"功能表"},s_wvw:{de:"WvW",es:"McM",fr:"McM",cs:"SpS",it:"McM",pl:"SkS",pt:"McM",ru:"МпМ",zh:"世界戰場"},s_pve:{de:"SgU",es:"JcE",fr:"JcE",cs:"HpP",it:"GcA",pl:"PvE",pt:"JcA",ru:"ИпО",zh:"玩家對抗環境"},s_display:{de:"anzeige",es:"presentación",fr:"affichage",cs:"zobrazení",it:"visualizzazione",pl:"wyświetlania",pt:"exibição",ru:"отображаемое",zh:"顯示"},s_zone:{de:"gebiet",es:"zona",fr:"zone",cs:"zóna",it:"zona",pl:"zona",pt:"zona",ru:"зона",zh:"區"},s_forum:{de:"forum",es:"foro",fr:"forum",cs:"fórum",it:"forum",pl:"forum",pt:"fórum",ru:"форум",zh:"論壇"},s_catalog:{de:"katalog",es:"catálogo",fr:"catalogue",cs:"katalog",it:"catalogo",pl:"katalog",pt:"catálogo",ru:"каталог",zh:"目錄"},s_audit:{de:"prüfung",es:"auditar",fr:"auditer",cs:"audit",it:"audit",pl:"audyt",pt:"auditar",ru:"аудит",zh:"審計"},s_cleanup:{de:"aufräumen",es:"limpia",fr:"nettoyer",cs:"úklid",it:"ripulire",pl:"oczyszczenie",pt:"limpeza",ru:"уборка",zh:"淨化"},s_simple:{de:"einfach",es:"simple",fr:"simple",cs:"prostý",it:"semplice",pl:"prosty",pt:"simples",ru:"простой",zh:"簡單"},s_mobile:{de:"mobil",es:"móvil",fr:"mobile",cs:"mobilní",it:"mobile",pl:"mobilna",pt:"móvel",ru:"мобильный",zh:"行動"},s_tile:{de:"kacheln",es:"mosaico",fr:"mosaïque",cs:"dlaždice",it:"affianca",pl:"sąsiadująco",pt:"ladrilho",ru:"замостить",zh:"磚"},s_this:{de:"dieses",es:"esto",fr:"ce",cs:"toto",it:"questo",pl:"to",pt:"isto",ru:"это",zh:"這"},s_your:{de:"dein",es:"tu",fr:"ton",cs:"tvůj",it:"tuo",pl:"twój",pt:"teu",ru:"твой",zh:"你的"},s_name:{de:"namen",es:"nombre",fr:"nom",cs:"název",it:"nome",pl:"nazwa",pt:"nome",ru:"имя",zh:"名"},s_ordered:{de:"bestellt",es:"pedidos",fr:"demandée",cs:"objednal",it:"ordinato",pl:"zamówiony",pt:"encomendado",ru:"заказал",zh:"訂了"},s_available:{de:"verfügbar",es:"disponibles",fr:"disponible",cs:"dostupný",it:"disponibile",pl:"dostępny",pt:"disponível",ru:"досту́пный",zh:"可用"},s_supply:{de:"angebot",es:"oferta",fr:"stock",cs:"nabídka",it:"offerta",pl:"podaż",pt:"suprimento",ru:"предложение",zh:"供應"},s_demand:{de:"nachfrage",es:"demanda",fr:"demande",cs:"poptávka",it:"domanda",pl:"popyt",pt:"demanda",ru:"спрос",zh:"需求"},s_price:{de:"preis",es:"precio",fr:"prix",cs:"cena",it:"prezzo",pl:"cena",pt:"preço",ru:"цена",zh:"價格"},s_buy:{de:"kaufen",es:"comprar",fr:"acheter",cs:"koupit",it:"comprare",pl:"kupić",pt:"comprar",ru:"купить",zh:"買"},s_sell:{de:"verkaufen",es:"vender",fr:"vendre",cs:"prodat",it:"vendere",pl:"sprzedać",pt:"vender",ru:"продать",zh:"賣"},s_outbid:{de:"überbieten",es:"sobrepujar",fr:"surenchérir",cs:"přelicitovat",it:"prezzo più alto",pl:"przelicytować",pt:"ultrapassar",ru:"перекупать",zh:"出價高於"},s_quantity:{de:"anzahl",es:"cantidad",fr:"quantité",cs:"množství",it:"quantità",pl:"ilość",pt:"quantidade",ru:"количество",zh:"量"},s_profit:{de:"gewinn",es:"beneficio",fr:"profit",cs:"zisk",it:"profitto",pl:"zysk",pt:"lucro",ru:"прибыль",zh:"利潤"},s_cost:{de:"kosten",es:"costo",fr:"coût",cs:"náklady",it:"costo",pl:"koszt",pt:"custo",ru:"стоимость",zh:"成本"},s_breakpoint:{de:"gewinnschwelle",es:"punto muerto",fr:"seuil de rentabilité",cs:"bod zvratu",it:"punto di pareggio",pl:"próg rentowności",pt:"ponto de equilíbrio",ru:"точка безубыточности",zh:"收支平衡點"},s_tax:{de:"steuer",es:"impuestos",fr:"impôt",cs:"daň",it:"fiscale",pl:"podatek",pt:"fiscal",ru:"налог",zh:"稅"},s_revenue:{de:"einnahmen",es:"ingresos",fr:"revenus",cs:"příjmy",it:"entrate",pl:"dochody",pt:"receita",ru:"доходов",zh:"收入"},s_margin:{de:"gewinnspanne",es:"margen",fr:"marge",cs:"marže",it:"margine",pl:"marża",pt:"margem",ru:"валовая",zh:"邊際"},s_low:{de:"niedrigen",es:"bajo",fr:"bas",cs:"nízký",it:"bassa",pl:"niski",pt:"baixa",ru:"низкая",zh:"低"},s_high:{de:"hohen",es:"alta",fr:"haut",cs:"vysoký",it:"alta",pl:"wysoki",pt:"alta",ru:"высокая",zh:"高"},s_notify:{de:"benachrichtigen",es:"notificar",fr:"notifier",cs:"oznámit",it:"notifica",pl:"powiadom",pt:"notificar",ru:"уведомить",zh:"通知"},s_overwrite:{de:"überschreiben",es:"sobrescribir",fr:"remplacer",cs:"přepsat",it:"sovrascrivi",pl:"zastąp",pt:"substituir",ru:"перезаписать",zh:"覆寫"},s_gem:{de:"edelsteine",es:"gema",fr:"gemme",cs:"klenot",it:"gemma",pl:"klejnot",pt:"gema",ru:"самоцвет",zh:"寶石"},s_coin:{de:"münze",es:"moneda",fr:"monnaie",cs:"mince",it:"moneta",pl:"moneta",pt:"moeda",ru:"монета",zh:"硬幣"},s_dollar:{de:"dollar",es:"dólar",fr:"dollar",cs:"dolar",it:"dollaro",pl:"polar",pt:"dólar",ru:"доллар",zh:"元"}},Codex:{s_TEMPLATE:{en:"",de:"",es:"",fr:""},s_CoinGold:{en:"g",de:"g",es:"o",fr:"o",cs:"z",it:"o",pl:"z",pt:"o",ru:"з",zh:"金"},s_CoinSilver:{en:"s",de:"s",es:"p",fr:"a",cs:"s",it:"a",pl:"s",pt:"p",ru:"с",zh:"銀"},s_CoinCopper:{en:"c",de:"k",es:"c",fr:"c",cs:"m",it:"r",pl:"m",pt:"c",ru:"м",zh:"銅"},s_Back:{en:"Back Item",de:"Rücken-Gegenstand",es:"Objeto para espalda",fr:"Objet de dos"},s_Consumable:{en:"Consumable",de:"Verbrauchsgegenstand",es:"Consumible",fr:"Consommable"},s_Container:{en:"Container",de:"Behälter",es:"Contenedor",fr:"Conteneur"},s_CraftingMaterial:{en:"Crafting Material",de:"Handwerksmaterial",es:"Material de artesanía",fr:"Matériau d&apos;artisanat"},s_Gathering:{en:"Gathering Tool",de:"Sammelwerkzeug",es:"Herramienta de recolección",fr:"Outil de récolte"},s_Salvage:{en:"Salvage Kit",de:"Wiederverwertungskit",es:"Kit de recicla",fr:"Nécessaire de recyclage"},s_Gizmo:{en:"Gizmo",de:"Dingsbums",es:"Aparato",fr:"Machin"},s_MiniPet:{en:"Miniature",de:"Miniatur",es:"Miniatura",fr:"Miniature"},s_Nourishment:{en:"Nourishment",de:"Verbrauchsstoff",es:"Consumible",fr:"Produit consommable"},s_Boost:{en:"Boost",de:"Verstärker",es:"Potenciador",fr:"Augmentation"},s_Trophy:{en:"Trophy",de:"Trophäe",es:"Trofeo",fr:"Trophée"},s_UpgradeComponent:{en:"Upgrade Component",de:"Aufwertung",es:"Componente de mejora",fr:"Composant d&apos;amélioration"},s_Junk:{en:"Junk",de:"Schrott",es:"Basura",fr:"Inutile"},s_Basic:{en:"Basic",de:"Einfach",es:"Básico",fr:"Simple"},s_Fine:{en:"Fine",de:"Edel",es:"Selecto",fr:"Raffiné"},s_Masterwork:{en:"Masterwork",de:"Meisterwerk",es:"Obra de arte",fr:"Chef-d&apos;œuvre"},s_Rare:{en:"Rare",de:"Selten",es:"Excepcional",fr:"Rare"},s_Exotic:{en:"Exotic",de:"Exotisch",es:"Exótico",fr:"Exotique"},s_Ascended:{en:"Ascended",de:"Aufgestiegen",es:"Ascendido",fr:"Élevé"},s_Legendary:{en:"Legendary",de:"Legendär",es:"Legendario",fr:"Légendaire"},s_Light:{en:"Light",de:"Leicht",es:"Ligero",fr:"Légèr"},s_Medium:{en:"Medium",de:"Mittel",es:"Medio",fr:"Intermédiaire"},s_Heavy:{en:"Heavy",de:"Schwer",es:"Pesado",fr:"Lourd"},s_Power:{en:"Power",de:"Kraft",es:"Potencia",fr:"Puissance"},s_Toughness:{en:"Toughness",de:"Zähigkeit",es:"Dureza",fr:"Robustesse"},s_Armor:{en:"Armor",de:"Rüstung",es:"Armadura",fr:"Armure"},s_Vitality:{en:"Vitality",de:"Vitalität",es:"Vitalidad",fr:"Vitalité"},s_Health:{en:"Health",de:"Lebenspunkte",es:"Salud",fr:"Santé"},s_Precision:{en:"Precision",de:"Präzision",es:"Precisión",fr:"Précision"},s_CriticalChance:{en:"Critical Chance",de:"Kritische Trefferchance",es:"Probabilidad de daño crítico",fr:"Chance de coup critique"},s_Ferocity:{en:"Ferocity",de:"Wildheit",es:"Ferocidad",fr:"Férocité"},s_CriticalDamage:{en:"Critical Damage",de:"Kritischer Schaden",es:"Daño crítico",fr:"Dégâts critiques"},s_ConditionDamage:{en:"Condition Damage",de:"Zustandsschaden",es:"Daño de condición",fr:"Dégâts par altération"},s_HealingPower:{en:"Healing Power",de:"Heilkraft",es:"Poder de curación",fr:"Guérison"},s_Expertise:{en:"Expertise",de:"Fachkenntnis",es:"Pericia",fr:"Expertise"},s_ConditionDuration:{en:"Condition Duration",de:"Zustandsdauer",es:"Duración de condición",fr:"Durée d&apos;altération"},s_Concentration:{en:"Concentration",de:"Konzentration",es:"Concentración",fr:"Concentration"},s_BoonDuration:{en:"Boon Duration",de:"Segensdauer",es:"Duración de bendición",fr:"Durée d&apos;avantage"},s_AgonyResistance:{en:"Agony Resistance",de:"Qual-Widerstand",es:"Resistencia a la agonía",fr:"Résistance à l&apos;agonie"},s_MagicFind:{en:"Magic Find",de:"Magisches Gespür",es:"Hallazgo mágico",fr:"Découverte de magie"},s_Axe:{en:"Axe",de:"Axt",es:"Hacha",fr:"Haches"},s_Dagger:{en:"Dagger",de:"Dolch",es:"Daga",fr:"Dague"},s_Mace:{en:"Mace",de:"Streitkolben",es:"Maza",fr:"Masse"},s_Pistol:{en:"Pistol",de:"Pistole",es:"Pistola",fr:"Pistolet"},s_Scepter:{en:"Scepter",de:"Zepter",es:"Cetro",fr:"Sceptre"},s_Sword:{en:"Sword",de:"Schwert",es:"Espada",fr:"Epée"},s_Focus:{en:"Focus",de:"Fokus",es:"Foco",fr:"Focus"},s_Shield:{en:"Shield",de:"Schild",es:"Escudo",fr:"Bouclier"},s_Torch:{en:"Torch",de:"Fackel",es:"Antorcha",fr:"Torche"},s_Warhorn:{en:"Warhorn",de:"Kriegshorn",es:"Cuerno de guerra",fr:"Cor de guerre"},s_Greatsword:{en:"Greatsword",de:"Großschwert",es:"Mandoble",fr:"Espadon"},s_Hammer:{en:"Hammer",de:"Hammer",es:"Martillo",fr:"Marteau"},s_LongBow:{en:"Longbow",de:"Langbogen",es:"Arco largo",fr:"Arc long"},s_Rifle:{en:"Rifle",de:"Gewehr",es:"Rifle",fr:"Fusil"},s_ShortBow:{en:"Shortbow",de:"Kurzbogen",es:"Arco corto",fr:"Arc court"},s_Staff:{en:"Staff",de:"Stab",es:"Báculo",fr:"Bâton"},s_Harpoon:{en:"Harpoon",de:"Speer",es:"Lanza",fr:"Lance"},s_Speargun:{en:"Speargun",de:"Harpunenschleuder",es:"Cañón de arpón",fr:"Fusil-harpon"},s_Trident:{en:"Trident",de:"Dreizack",es:"Tridente",fr:"Trident"},s_HelmAquatic:{en:"Head Armor",de:"Kopf-Rüstung",es:"Armadura de cabeza",fr:"Armure : Couvre-chef"},s_Helm:{en:"Head Armor",de:"Kopf-Rüstung",es:"Armadura de cabeza",fr:"Armure : Couvre-chef"},s_Shoulders:{en:"Shoulder Armor",de:"Schulter-Rüstung",es:"Armadura de hombros",fr:"Armure : Épaulières"},s_Coat:{en:"Chest Armor",de:"Brust-Rüstung",es:"Armadura pectoral",fr:"Armure : Cuirasse"},s_Gloves:{en:"Hand Armor",de:"Hand-Rüstung",es:"Armadura de mano",fr:"Armure : Gants"},s_Leggings:{en:"Leg Armor",de:"Bein-Rüstung",es:"Armadura de pierna",fr:"Armure : Jambières"},s_Boots:{en:"Foot Armor",de:"Fuß-Rüstung",es:"Armadura de pie",fr:"Armure : Bottes"},s_Accessory:{en:"Accessory",de:"Accessoire",es:"Accesorio",fr:"Accessoire"},s_Amulet:{en:"Amulet",de:"Amulett",es:"Amuleto",fr:"Amulette"},s_Ring:{en:"Ring",de:"Ring",es:"Anillo",fr:"Anneau"},s_Defense:{en:"Defense",de:"Verteidigung",es:"Defensa",fr:"Défense"},s_WeaponStrength:{en:"Weapon Strength",de:"Waffenstärke",es:"Fuerza del arma",fr:"Puissance d&apos;arme"},s_Healing:{en:"Healing",de:"Heilung",es:"Curación",fr:"Guérison"},s_RequiredLevel:{en:"Required Level",de:"Erforderliche Stufe",es:"Nivel necesario",fr:"Niveau requis"},s_AccountBindOnUse:{en:"Account Bound on Use",de:"Accountgebunden bei Benutzung",es:"Vinculado a cuenta en uso",fr:"Lié au compte dès l&apos;utilisation"},s_AccountBound:{en:"Account Bound",de:"Accountgebunden",es:"Vinculado a cuenta",fr:"Lié au compte"},s_SoulBindOnUse:{en:"Soulbound on Use",de:"Seelengebunden bei Benutzung",es:"Ligado en uso",fr:"Lié à l&apos;âme dès l&apos;utilisation"},s_SoulbindOnAcquire:{en:"Soulbound",de:"Seelengebunden",es:"Ligado",fr:"Lié à l&apos;âme"},s_SoulboundToCharacter:{en:"Soulbound to another character",de:"An einen anderen Charakter seelengebunden",es:"Ligado a otro personaje",fr:"Lié à l&apos;âme d&apos;un autre personnage"},s_Unique:{en:"Unique",de:"Einzigartig",es:"Equipamiento único",fr:"Unique"},s_Transmuted:{en:"Transmuted",de:"Transmutiert",es:"Transmutado",fr:"Transmuté"},s_UnusedEnrichmentSlot:{en:"Unused Enrichment Slot",de:"Ungenutzter Anreicherungsplatz",es:"Casilla para enriquecimientos sin utilizar",fr:"Emplacement d'enrichissement inutilisé"},s_UnusedInfusionSlot:{en:"Unused Infusion Slot",de:"Freier Infusionsplatz",es:"Casilla de infusión sin utilizar",fr:"Emplacement d&apos;infusion inutilisé"},s_UnusedUpgradeSlot:{en:"Unused Upgrade Slot",de:"Freier Aufwertungsplatz",es:"Casilla para mejoras sin utilizar",fr:"Emplacement d&apos;amélioration inutilisé"},s_DoubleClickToSelectStats:{en:"Double-click to select stats.",de:"Doppelklicken, um Werte auszuwählen.",es:"Haz doble clic para seleccionar estadísticas.",fr:"Double-cliquez pour sélectionner les statistiques."},s_DoubleClickToConsume:{en:"Double-click to consume.",de:"Zum Benutzen doppelklicken.",es:"Haz doble clic para consumir.",fr:"Double-cliquez pour utiliser."},s_ExcessiveAlcohol:{en:"Excessive alcohol consumption will result in intoxication.",de:"Übermäßiger Alkoholkonsum führt zu Rauschzuständen.",es:"El consumo excesivo de alcohol provoca embriaguez.",fr:"Consommer trop d&apos;alcool entraîne une ivresse manifeste."},s_GainBasedPercentage:{en:"Gain {1} Based on a Percentage of {0}",de:"Erhaltener prozentualer Anteil von {0} auf {1}:",es:"Ganas {1} según tu porcentaje de {0}",fr:"Vous bénéficiez d'une augmentation de {1} de {0}%."},s_GuildStash:{en:"Guild Stash",de:"Geheimvorrat",es:"Alijo del clan",fr:"Réserve de guilde"},s_TreasureTrove:{en:"Treasure Trove",de:"Schatzgrube",es:"Tesoro oculto",fr:"Trésor"},s_DeepCave:{en:"Deep Cave",de:"Tiefe Höhle",es:"Cueva profunda",fr:"Grotte profonde"}},getString:function(e){var t=D.Codex["s_"+e];
if(t){var n=t[O.Options.enu_Language];return n?n:t[O.OptionEnum.Language.Default]}return e},addDictionary:function(e){for(var t in e)D.Dictionary[t]=e[t]},getTranslation:function(e){if(D.isLanguageDefault())return e;var t,n=e;-1!==n.indexOf(" ")&&(n=n.replace(/ /g,"_"));var a=D.Dictionary["s_"+n];return a&&(t=a[O.Options.enu_Language])?t:e},getWord:function(e){return D.isLanguageDefault()?e:D.Dictionary["s_"+e][O.Options.enu_Language]},getWordCapital:function(e){return U.toFirstUpperCase(D.getTranslation(e))},getPhrase:function(e,t){void 0===t&&(t=U.CaseEnum.None);var n=e.split(" ");if(t===U.CaseEnum.Original)for(var a in n)n[a]=D.duplicateCase(n[a],D.getTranslation(n[a].toLowerCase()));else for(var a in n)n[a]=D.getTranslation(n[a]);var i=n.join(D.isLanguageLogographic()?"":" ");return t===U.CaseEnum.None||t===U.CaseEnum.Original?i:U.toCase(i,t)},getPhraseTitle:function(e){return D.getPhrase(e,U.CaseEnum.Every)},getPhraseOriginal:function(e){return O.Options.enu_Language!==O.OptionEnum.Language.Default?D.getPhrase(e,U.CaseEnum.Original):e},getModifiedWord:function(e,t,n){return D.getPhrase(D.orderModifier(e,t),n)},orderModifier:function(e,t){return D.isLanguageModifierFirst()?t+" "+e:e+" "+t},duplicateCase:function(e,t){var n=e.charAt(0);if(n===n.toLowerCase())return t;if(e.length>2&&t.length>2){var a=e.charAt(1);if(n===n.toUpperCase()&&a===a.toUpperCase())return t.toUpperCase()}return t.charAt(0).toUpperCase()+t.slice(1)},translateElements:function(){O.Options.enu_Language!==O.OptionEnum.Language.Default&&($(".jsTranslate").each(function(){$(this).text(D.getPhraseOriginal($(this).text())).removeClass("jsTranslate")}),$(".jsTranslateCompound").each(function(){$(this).text(D.getTranslation($(this).text())).removeClass("jsTranslateCompound")}))},translateAfter:function(){O.Options.enu_Language!==O.OptionEnum.Language.Default&&($(".hudButton").each(function(){var e=$(this).attr("title");if(void 0!==e){var t=$("<div>"+e+"</div>"),n=D.getPhraseOriginal(t.find("dfn").text());t.find("dfn").remove(),$(this).attr("title","<dfn>"+n+"</dfn>"+t.html())}}),D.translateElements()),I.qTip.init(".hudButton")},isLanguageFullySupported:function(){return O.Options.enu_Language===O.OptionEnum.Language.English||O.Options.enu_Language===O.OptionEnum.Language.German||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.French?!0:!1},isLanguageDefault:function(){return O.Options.enu_Language===O.OptionEnum.Language.Default},getFullySupportedLanguage:function(){return D.isLanguageFullySupported()?O.Options.enu_Language:O.OptionEnum.Language.Default},getPartiallySupportedLanguage:function(){return D.isLanguageFullySupported()||O.Options.enu_Language===O.OptionEnum.Language.Mandarin?O.Options.enu_Language:O.OptionEnum.Language.Default},getNameKey:function(){return"name_"+D.getFullySupportedLanguage()},getURLKey:function(){return"url_"+D.getFullySupportedLanguage()},getObjectTranslation:function(e){return void 0!==e[O.Options.enu_Language]?e[O.Options.enu_Language]:e[O.OptionEnum.Language.Default]},getObjectName:function(e){return e?void 0!==e["name_"+O.Options.enu_Language]?e["name_"+O.Options.enu_Language]:D.getObjectDefaultName(e):null},getObjectNick:function(e){return void 0!==e["nick_"+O.Options.enu_Language]?e["nick_"+O.Options.enu_Language]:D.getObjectDefaultNick(e)},getObjectDefaultName:function(e){return e["name_"+O.OptionEnum.Language.Default]},getObjectDefaultNick:function(e){return e["nick_"+O.OptionEnum.Language.Default]},getObjectURL:function(e){return e["url_"+D.getFullySupportedLanguage()]},isLanguageSecondary:function(){return O.Options.enu_Language===O.OptionEnum.Language.German||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.French?!0:!1},isLanguageModifierFirst:function(){return O.Options.enu_Language===O.OptionEnum.Language.French||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.Italian||O.Options.enu_Language===O.OptionEnum.Language.Portuguese||O.Options.enu_Language===O.OptionEnum.Language.Mandarin?!1:!0},isLanguageLogographic:function(){return O.Options.enu_Language===O.OptionEnum.Language.Mandarin?!0:!1},getChainTitle:function(e){return D.isLanguageDefault()?e.title:D.getObjectName(e)},getChainAlias:function(e){return D.isLanguageDefault()?C.parseChainAlias(e.alias):D.getChainTitle(e)},verifyNativeTTS:function(e){I.isSpeechNativeEnabled===!1&&I.isProgramEmbedded===!1&&I.ModeCurrent===I.ModeEnum.Overlay&&I.BrowserCurrent!==I.BrowserEnum.IE?(I.isSpeechNativeEnabled=!0,$.getScript(U.URL_API.TextToSpeechNative).done(function(){I.isSpeechNativeLoaded=!0,meSpeak.loadConfig("bin/tts/mespeak_config.json"),meSpeak.loadVoice("bin/tts/voices/"+O.Options.enu_Language+".json"),e&&e()})):e&&e()},speechWait:0,speak:function(e,t){var n=(O.Options.int_setVolume/T.cPERCENT_100).toFixed(2);try{if(I.isSpeechSynthesisEnabled){var a=new SpeechSynthesisUtterance(e);return a.voice=window.speechSynthesis.getVoices().filter(function(e){return e.name===O.VoiceCode[O.Options.enu_Language]})[0],a.volume=n,a.rate=.8,void window.speechSynthesis.speak(a)}}catch(i){I.isSpeechSynthesisEnabled=!1}var r=function(e){D.verifyNativeTTS(function(){if(I.isSpeechNativeLoaded)meSpeak.speak(e,{volume:n,speed:150,variant:"f5"});else{var t=document.getElementById("jsTTSAudio");t.src=U.URL_API.TextToSpeech+"&vol="+n+"&t="+e,t.volume=n,t.load(),t.play()}})};if(void 0===t){var o=D.isLanguageLogographic()?4:12;t=1+Math.round(e.length/o)}var s=t*T.cMSECONDS_IN_SECOND;0===D.speechWait?(D.speechWait+=s,r(e),setTimeout(function(){D.speechWait-=s},s)):(D.speechWait+=s,setTimeout(function(){D.speechWait>0&&(r(e),D.speechWait-=s)},D.speechWait-s));var c=30;D.resetSpeechQueue(c)},isSpeaking:function(){return 0===D.speechWait?!1:!0},stopSpeech:function(){I.isSpeechSynthesisEnabled?window.speechSynthesis.cancel():I.isSpeechNativeLoaded?meSpeak.stop():document.getElementById("jsTTSAudio").src=""},resetSpeechQueue:function(e){void 0===e&&(e=0),D.speechWait>e*T.cMSECONDS_IN_SECOND&&(D.speechWait=0,D.stopSpeech())},getSpeechWord:function(e,t){return t?D.getModifiedWord(e,t):D.getPhrase(e)},getSpeechInitials:function(e,t){var n=e.charAt(e.length-1);if(n===n.toLowerCase())return e;t&&(e=e.replace(/ /g,"")),e=e.toUpperCase();for(var a="",i="",r=0;r<e.length;r++)i=e.charAt(r),a+=" "===i?i:i+" ";return a},getPluralTime:function(e,t){return e>1&&(t+="s")," "+D.getWord("in")+" "+e+" "+D.getWord(t)},getChainPronunciation:function(e){return D.isLanguageDefault()||I.BrowserCurrent!==I.BrowserEnum.Chrome?C.Chains[e.nexus].pronunciation:D.getChainTitle(e)}},C={Chains:GW2T_CHAIN_DATA,ChainAssociation:{},UnscheduledChainsLength:GW2T_CHAIN_ADD_LENGTH,DryTop:{},cIndexSynonym:"nexus",ChainToday:null,ChainTomorrow:null,ChainDummy:{alias:"dummy"},CurrentChainSD:{},NextChainSD1:{},NextChainSD2:{},NextChainSD3:{},NextChainSD4:{},CurrentChainHC:{},NextChainHC1:{},NextChainHC2:{},NextChainHC3:{},NextChainHC4:{},NextChainLS1:{},NextChainLS2:{},NextChainsMS1:[],NextChainsMS2:[],CurrentChains:[],CurrentChainsSD:[],PreviousChains1:[],PreviousChains2:[],NextChains1:[],cEventCharLimit:44,cEventCharLimitLogographic:20,cEventNameWidth:320,TempleChains:[],LegacyChains:[],UnscheduledChains:[],ScheduledChains:[],RegularChains:[],MiscellaneousChains:[],DryTopChains:[],LivingStoryChains:[],ChainSeriesEnum:{Temple:0,Legacy:1,ScheduledCutoff:2,Standard:2,Hardcore:3,WorldBossCuttoff:3,Miscellaneous:4,DryTop:5,LivingStory:6},EventPrimacyEnum:{Optional:0,Normal:1,Primary:2,Boss:3},isUnscheduledChainsLoaded:!1,isDryTopGenerated:!1,isDryTopIconsShown:!1,isTimetableGenerated:!1,getChainByAlias:function(e){return C.Chains[C.ChainAssociation[e.toLowerCase()]]},getChainRegion:function(e){return e&&e.zone?M.getZoneRegion(e.zone):null},viewChainFinale:function(e){if(I.isMapEnabled){var t=e.primaryEvents,n=t[t.length-1].path[0];M.goToView(n,M.ZoomEnum.Ground,M.Pin.Event)}},isChainToday:function(e){return C.ChainToday&&e.nexus===C.ChainToday.nexus?!0:!1},refreshChainDailyIcon:function(){for(var e=0;e<T.cNUM_TIMEFRAMES_IN_HOUR;e++)C.isChainToday(C.CurrentChainsSD[e])?K["WpChain"+e].addClass("clkWaypointDaily"):K["WpChain"+e].removeClass("clkWaypointDaily");$(".chnDaily").hide(),C.ChainToday&&$(".chnDaily_"+C.ChainToday.nexus).show(),C.updateTimetable()},isChainScheduled:function(e){return e.series<C.ChainSeriesEnum.ScheduledCutoff?!1:!0},isChainWorldBoss:function(e){return e.series>C.ChainSeriesEnum.WorldBossCuttoff?!1:!0},isChainRegular:function(e){return e.series===C.ChainSeriesEnum.Standard||e.series===C.ChainSeriesEnum.Hardcore||e.series===C.ChainSeriesEnum.Miscellaneous||e.series===C.ChainSeriesEnum.LivingStory?!0:!1},parseChainAlias:function(e){return-1!==e.indexOf("_")?e.split("_")[0]:e},getEventStepNumber:function(e){if(1===e.length)return e;var t,n="";for(t=0;t<e.length;t++){if(!isFinite(e.charAt(t)))return n;n+=e.charAt(t)}return n},getEventWiki:function(e,t){return e.indexOf(".")===e.length-1&&(e=e.slice(0,-1)),t?U.getWikiLinkDefault(e):U.getWikiLinkLanguage(e)},initializeChain:function(e){var t,n,a,i="",r="",o=U.escapeHTML(D.getObjectName(e));e.waypointText=e.waypoint+" "+o,e.iconSrc="img/chain/"+C.parseChainAlias(e.alias).toLowerCase()+I.cPNG;for(t in e.events)e.events[t].step=parseInt(C.getEventStepNumber(e.events[t].num))-1;if(e.isSorted=!1,e.primaryEvents=[],e.scheduleKeys=[],e.waypoint&&(i="<input id='chnWaypoint_"+e.nexus+"' class='chnWaypoint' type='text' value='"+e.waypointText+"' />  ("+e.level+")<a"+U.convertExternalAnchor(U.getYouTubeLink(D.getObjectDefaultName(e)))+"><ins class='s16 s16_youtube' title='Recommended level. Click for YouTube videos.'></ins></a> "),e.reward)for(t in e.reward)i+="coin"===t?E.formatCoinStringShort(e.reward[t]):e.reward[t]+"<ins class='s16 s16_"+t+"' title='"+t+"'></ins> ";i.length&&(r="<div class='chnDetailsExtra'>"+i+"<kbd id='chnDelete_"+e.nexus+"' class='chnDelete' title='Permanently hide this event chain (can undo in <img src=img/ui/speaker.png /> menu above).'></kbd></div>"),$(e.htmllist).append("<div id='chnBar_"+e.nexus+"' class='chnBar'><div class='chnTitle'><img id='chnIcon_"+e.nexus+"' src='"+e.iconSrc+"' /><kbd id='chnCheck_"+e.nexus+"' class='chnCheck'></kbd><h1 id='chnTitle_"+e.nexus+"'>"+o+"</h1><time id='chnTime_"+e.nexus+"' class='chnTimeFutureFar'></time><aside><img class='chnDaily chnDaily_"+e.nexus+"' src='img/ui/daily.png' /></aside></div><div id='chnDetails_"+e.nexus+"' class='chnDetails'><ol id='chnEvents_"+e.nexus+"' class='chnEvents'></ol>"+r+"</div></div>");var s=function(e,t){var n=t,a="&lt;br /&gt;",i=function(e){return"&lt;dfn&gt;"+e+"&lt;/dfn&gt;"},r="";r=e.series===C.ChainSeriesEnum.DryTop?i("Event Number: ")+n.num+a+i("Start Time: ")+n.lim+a+a+"&amp;quot;"+D.getObjectName(n).replace(/["']/g,"")+"&amp;quot;":i("Event Number: ")+n.num+a+i("If Success Go To: ")+n.sGotoNum+a+i("If Failure Go To: ")+n.fGotoNum+a+i("If Success Wait: ")+n.sInterim+a+i("If Failure Wait: ")+n.fInterim+a+i("Time Limit: ")+n.lim+a+i("Avg to Complete: ")+n.avg+a+i("Min to Complete: ")+n.min+a+i("Max to Complete: ")+n.max+a+a+"&amp;quot;"+D.getObjectName(n).replace(/["']/g,"")+"&amp;quot;";var o="",s=C.cEventCharLimit,c=function(){o="chnSubstep",s=C.cEventCharLimit-4},l=C.getEventStepNumber(n.num);if(l.length!==n.num.length){var u=n.num.slice(l.length);-1!==n.num.indexOf(".")?c():2===n.num.length?-1===u.indexOf("A")&&-1===u.indexOf("a")&&c():-1===u.indexOf("A1")&&-1===u.indexOf("a1")&&c()}$("#chnEvents_"+e.nexus).append("<li id='chnEvent_"+e.nexus+"_"+n.num+"' class='chnStep_"+e.nexus+"_"+n.step+" "+o+"'><ins class='evt_"+n.icon+"' title='"+r+"'></ins><span>"+U.truncateString(D.getObjectName(n),s,"..")+"</span></li>")};for(t in e.events)if(a=e.events[t],a.primacy===C.EventPrimacyEnum.Primary)e.primaryEvents.push(a);else if(a.primacy===C.EventPrimacyEnum.Boss){e.primaryEvents.push(a),e.primaryEvents[0].minSum=0,e.primaryEvents[0].avgSum=0,e.primaryEvents[0].minavgSum=0;break}for(t=1;t<e.primaryEvents.length;t++){var c=T.parseEventTime(e.primaryEvents[t-1].sInterim[0]);e.primaryEvents[t].minSum=T.parseEventTime(e.primaryEvents[t-1].min)+c+e.primaryEvents[t-1].minSum,e.primaryEvents[t].avgSum=T.parseEventTime(e.primaryEvents[t-1].avg)+c+e.primaryEvents[t-1].avgSum,e.primaryEvents[t].minavgSum=e.primaryEvents[t].minSum+~~(Math.abs(e.primaryEvents[t].avgSum-e.primaryEvents[t].minSum)/2)}if(t--,e.minFinish=e.primaryEvents[t].minSum+T.parseEventTime(e.primaryEvents[t].min),e.avgFinish=e.primaryEvents[t].avgSum+T.parseEventTime(e.primaryEvents[t].avg),e.minavgFinish=e.minFinish+~~(Math.abs(e.avgFinish-e.minFinish)/2),n=0,C.isChainScheduled(e)){for(t in e.events)if(e.events[t].primacy!==C.EventPrimacyEnum.Optional&&(C.getEventStepNumber(e.events[t].num)!==C.getEventStepNumber(e.primaryEvents[n].num)&&n++,s(e,e.events[t])),e.events[t].primacy===C.EventPrimacyEnum.Boss)break}else for(t in e.events)s(e,e.events[t]);I.ModeCurrent!==I.ModeEnum.Tile&&($("#chnTitle_"+e.nexus).click(function(e){e.which===I.ClickEnum.Left&&$(this).parent().next().slideToggle(100,function(){I.updateScrollbar($(this))})}),$("#chnDetails_"+e.nexus).hide()),D.isLanguageDefault()&&I.isMapEnabled&&$("#chnBar_"+e.nexus).hover(function(){$("#chnTitle_"+e.nexus).text(D.getChainTitle(e))},function(){$("#chnTitle_"+e.nexus).text(D.getObjectName(e))}),e.flags.isExpansion&&$("#chnTitle_"+e.nexus).addClass("chnTitleMisc"),$("#chnDetails_"+e.nexus+" .chnWaypoint").each(function(){I.bindClipboard($(this),$(this).val())}).click(function(){$(this).select()}),I.qTip.init($("#chnDetails_"+e.nexus+" ins")),I.qTip.init($("#chnDetails_"+e.nexus+" kbd")),X.initializeChainChecklist(e)},initializeScheduledChains:function(){for(var e,t=C.Chains.length,n=0;t>n;n++){switch(e=C.Chains[n],e.nexus=n,C.ChainAssociation[e.alias.toLowerCase()]=e.nexus,e.series){case C.ChainSeriesEnum.Standard:e.htmllist="#sectionChains_Scheduled",C.RegularChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.Hardcore:e.htmllist="#sectionChains_Scheduled",C.RegularChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.DryTop:e.htmllist="#sectionChains_Drytop",C.DryTopChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.Miscellaneous:e.htmllist=e.flags.isSpecial?"#sectionChains_Special":"#sectionChains_Scheduled",C.MiscellaneousChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.LivingStory:if(!H.isStoryEnabled)continue;e.htmllist=H.isStoryDashboard?"#dsbStory":"#sectionChains_Scheduled",C.LivingStoryChains.push(e),C.ScheduledChains.push(e)}C.initializeChain(e)}},initializeUnscheduledChains:function(){C.isUnscheduledChainsLoaded===!1&&$.getScript(U.URL_DATA.Unscheduled).done(function(){if(!C.isUnscheduledChainsLoaded){for(var e=GW2T_CHAIN_UNSCHEDULED,t=C.Chains.length,n=0;n<e.length;n++)C.Chains.push(e[n]);for(var a,i=C.Chains.length,n=t;i>n;n++){switch(a=C.Chains[n],a.nexus=n,a.series){case C.ChainSeriesEnum.Temple:a.htmllist="#sectionChains_Temple",C.TempleChains.push(a),C.UnscheduledChains.push(a);break;case C.ChainSeriesEnum.Legacy:a.htmllist="#sectionChains_Legacy",C.LegacyChains.push(a),C.UnscheduledChains.push(a)}C.initializeChain(a),P.drawChainPaths(a)}C.isUnscheduledChainsLoaded=!0}})},isChainCurrent:function(e){for(var t in C.CurrentChains)if(e.nexus===C.CurrentChains[t].nexus)return!0;return!1},isChainUnchecked:function(e){return X.getChainChecklistState(e)===X.ChecklistEnum.Unchecked?!0:!1},isChainSubscribed:function(e){return X.getChecklistItem(X.Checklists.ChainSubscription,e.nexus)===X.ChecklistEnum.Checked?!0:!1},updateChainsTimeHTML:function(){var e,t,n,a,i,r="<dfn>"+D.getPhraseTitle("click to <br/> subscribe")+"</dfn><br />";for(e in C.ScheduledChains){t=C.ScheduledChains[e],i=t.flags.minuteDelay?t.flags.minuteDelay*T.cSECONDS_IN_MINUTE:0;var o,s="";if(t.series!==C.ChainSeriesEnum.DryTop){for(var c in t.scheduleKeys)o=0===parseInt(c)?r:" <br /> ",s=s+o+T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(t.scheduleKeys[c])+i});$("#chnTime_"+t.nexus).prop("title",s)}C.isChainCurrent(t)===!1&&(n=T.getTimeFormatted({aWantLetters:!0,aWantSeconds:!1,aCustomTimeInSeconds:T.getSecondsUntilChainStarts(t)+i}),a=T.getTimeFormatted({aWantLetters:!1,aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(t.scheduleKeys[0])+i}),$("#chnTime_"+t.nexus).html(n+"<br /><sup>"+a+"</sup>"))}I.qTip.init(".chnTitle time")},updateCurrentChainTimeHTML:function(e){var t,n=T.getCurrentTimeframeElapsedTime(),a=e.countdownToFinish-n,i=e.flags.minuteDelay,r=a,o=I.Symbol.ArrowUp+" ";if(e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated){var s=T.getDryTopMinute(),c=T.getDryTopMinute(1);r=T.getTimeFormatted({aReference:T.ReferenceEnum.UTC,aWant24:!0,aWantHours:!1}),$("#chnTime_"+e.nexus).text("(:"+s+") "+r),C.isDryTopIconsShown&&$("#mapDryTopTimer").html("<var style='color:"+T.getCurrentDryTopColor()+"'>:"+s+"</var> "+r+" <var style='color:"+T.getCurrentDryTopColor(1)+"'>:"+c+"</var>")}else i&&(t=i*T.cSECONDS_IN_MINUTE-n,t>0&&(r=t,o=I.Symbol.Wait+" ")),a>0||(r=T.cSECONDS_IN_TIMEFRAME-n,o=I.Symbol.ArrowDown+" "),$("#chnTime_"+e.nexus).text(o+T.getTimeFormatted({aWantLetters:!0,aCustomTimeInSeconds:r}))},initializeTimetableHTML:function(){if(C.isTimetableGenerated!==!1){$("#sectionChains_Timetable").empty();var e,t,n,a,i;for(e in T.Schedule){n=T.getScheduleSlotChainsByKey(e);for(t in n){if(a=n[t],a.series!==C.ChainSeriesEnum.Standard&&a.series!==C.ChainSeriesEnum.Hardcore&&a.series!==C.ChainSeriesEnum.Miscellaneous||a.flags.isSpecial)break;i=T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(e)}),$("#sectionChains_Timetable").append("<div class='chnSlot chnSlotTime_"+e+" chnSlot_"+a.nexus+"' data-"+C.cIndexSynonym+"='"+a.nexus+"' data-timeframe='"+e+"'><div class='chnTitle'><img src='"+a.iconSrc+"' /><kbd class='chnCheck'></kbd><h1>"+D.getObjectName(a)+"</h1><time>"+i+"</time><aside><img class='chnDaily chnDaily_"+a.nexus+"' src='img/ui/daily.png' /></aside></div></div>")}}for(var e in C.RegularChains){a=C.RegularChains[e];var r=$(".chnSlot_"+a.nexus),o=r.find(".chnCheck"),s=r.find("time");X.reapplyChainBarState(a.nexus,r,o,s)}$(".chnTitle h1").hover(function(){$(".chnSlot_"+$(this).parent().parent().data(C.cIndexSynonym)).addClass("chnBarHover")},function(){$(".chnSlot").removeClass("chnBarHover")}),$(".chnSlot .chnCheck").click(function(){$("#chnCheck_"+C.Chains[$(this).parent().parent().data(C.cIndexSynonym)].nexus).trigger("click")}),$(".chnSlot time").click(function(){$("#chnTime_"+C.Chains[$(this).parent().parent().data(C.cIndexSynonym)].nexus).trigger("click")}),$(".chnSlotTime_0").addClass("chnBarReset"),C.refreshChainDailyIcon()}},updateTimetable:function(){if(C.isTimetableGenerated!==!1){var e=T.getTimeframeKey(-1),t=T.getTimeframeKey(),n=T.getTimeframeKey(1);$(".chnSlotTime_"+e).removeClass("chnBarCurrent"),$(".chnSlotTime_"+t).addClass("chnBarCurrent"),$(".chnSlotTime_"+e+" .chnTitle h1").removeClass("chnTitleCurrent"),$(".chnSlotTime_"+t+" .chnTitle h1").removeClass("chnTitleFuture").addClass("chnTitleCurrent"),$(".chnSlotTime_"+n+" .chnTitle h1").addClass("chnTitleFuture");var a=T.getCurrentTimeframe();$(".chnSlot").each(function(){return T.convertScheduleKeyToUTCMinutes($(this).data("timeframe"))<a?void $(this).appendTo("#sectionChains_Timetable"):!1}),C.ChainToday&&$("#sectionChains_Timetable .chnDaily_"+C.ChainToday.nexus).each(function(){T.convertScheduleKeyToUTCMinutes($(this).closest(".chnSlot").data("timeframe"))<a&&$(this).hide()})}},sortChainsListHTML:function(){for(var e,t,n=0,a=C.ScheduledChains.length,i=0,r=0;a>n;){e=T.getTimeframeChains(i);for(r in e){if(n>=a)break;t=e[r],t.isSorted===!1&&($("#chnBar_"+t.nexus).appendTo(t.htmllist),t.isSorted=!0,t.scheduleKeyImmediate=T.getTimeframeKey(i),n++)}i++}for(i in C.ScheduledChains){t=C.ScheduledChains[i],t.isSorted=!1;for(r in t.scheduleKeys)if(t.scheduleKeys[r]===t.scheduleKeyImmediate){t.scheduleKeys=t.scheduleKeys.slice(r,t.scheduleKeys.length).concat(t.scheduleKeys.slice(0,r));break}}C.updateChainsTimeHTML();var o={};for(i in C.CurrentChains)t=C.CurrentChains[i],o[t.nexus]=t.nexus,$("#chnBar_"+t.nexus).addClass("chnBarCurrent"),C.isChainUnchecked(t)&&O.Options.bol_expandWB&&I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+t.nexus).show("fast",function(){I.updateScrollbar()}),$("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleFuture chnTitleFutureFar").addClass("chnTitleCurrent"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeFuture chnTimeFutureFar").addClass("chnTimeCurrent");for(i in C.PreviousChains1)t=C.PreviousChains1[i],o[t.nexus]!==t.nexus&&($("#chnBar_"+t.nexus).removeClass("chnBarCurrent").addClass("chnBarPrevious"),O.Options.bol_collapseChains&&I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+t.nexus).hide(),$("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleCurrent").addClass("chnTitleFutureFar"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeCurrent").addClass("chnTimeFutureFar"));for(i in C.PreviousChains2)t=C.PreviousChains2[i],o[t.nexus]!==t.nexus&&$("#chnBar_"+t.nexus).removeClass("chnBarPrevious");for(i in C.NextChains1)t=C.NextChains1[i],o[t.nexus]!==t.nexus&&($("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleFutureFar").addClass("chnTitleFuture"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeFutureFar").addClass("chnTimeFuture"))},queueEventsHighlight:function(e){var t,n,a=e,i=T.getCurrentTimeframeElapsedTime(),r=!1;if(i>0){for(t in a.primaryEvents)if(n=C.getSumBasedOnOptions(a,t),n>=i&&t>0){C.highlightEvents(a,parseInt(t-1)),r=!0;break}r===!1&&(n=C.getSumBasedOnOptions(a,-1),i>n?C.highlightEvents(a,-1):C.highlightEvents(a,t))}for(t in a.primaryEvents)n=C.getSumBasedOnOptions(a,t),i>n||(n-=i,setTimeout(function(e,t){return function(){C.highlightEvents(e,t)}}(a,parseInt(t)),n*T.cMSECONDS_IN_SECOND));n=C.getSumBasedOnOptions(a,-1),i>n||(n-=i,setTimeout(function(e){return function(){C.highlightEvents(e,-1)}}(a),n*T.cMSECONDS_IN_SECOND))},highlightEvents:function(e,t){var n,a,i=500,r=C.cEventNameWidth,o=e.primaryEvents.length-1,s=C.isChainRegular(e);if(e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated&&(P.LayerArray.DryTopActive=null,P.LayerArray.DryTopActive=[],C.isDryTopIconsShown))for(n in e.events)a=e.events[n],M.toggleLayer(a.eventicon,!1),M.toggleLayer(a.eventring,!1);if(t>-1){for(e.CurrentPrimaryEvent=e.primaryEvents[t],n=0;t>n;n++)$(".chnStep_"+e.nexus+"_"+n).removeClass("chnEventCurrent");if($(".chnStep_"+e.nexus+"_"+(t-1)).css({opacity:1}).animate({opacity:.5},i,function(){e.series===C.ChainSeriesEnum.DryTop&&$(this).hide()}),$(".chnStep_"+e.nexus+"_"+t).each(function(){$(this).removeClass("chnEventFuture").addClass("chnEventCurrent").show().css({width:0,opacity:.5}).animate({width:r,opacity:1},i).css({width:"auto"}),e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated&&(a=e.events[$(this).attr("data-eventindex")],I.isMapEnabled&&(P.LayerArray.DryTopActive.push(a.eventicon),P.LayerArray.DryTopActive.push(a.eventring),C.isDryTopIconsShown&&M.toggleLayerArray(P.LayerArray.DryTopActive,!0)))}),t<e.primaryEvents.length)for(n=t+1;n<e.primaryEvents.length;n++)$(".chnStep_"+e.nexus+"_"+n).show().removeClass("chnEventCurrent").addClass("chnEventFuture");P.wantTourPrediction()&&M.isMapAJAXDone&&C.isChainUnchecked(e)&&s&&!e.flags.isSpecial&&$("#chnEvent_"+e.nexus+"_"+e.CurrentPrimaryEvent.num).trigger("click"),t===o&&O.Options.bol_alertArrival&&s&&(O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&C.isChainUnchecked(e)&&!e.flags.isSpecial||O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&C.isChainSubscribed(e)&&C.isChainUnchecked(e))&&D.speak(D.getChainPronunciation(e)+" "+D.getSpeechWord("arrival predicted"))}else{if(e.CurrentPrimaryEvent=e.primaryEvents[o],$("#chnEvents_"+e.nexus+" li").show().removeClass("chnEventCurrent"),$(".chnStep_"+e.nexus+"_"+o).css({opacity:1}).animate({opacity:.5},i),O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&O.Options.bol_alertAtEnd&&I.isProgramLoaded&&e.nexus===C.CurrentChainSD.nexus&&s){var c=", "+D.getSpeechWord("checked"),l="",u="",d=U.objToBool(C.NextChainSD1),p=U.objToBool(C.NextChainHC1),h=D.getSpeechWord("next "+D.orderModifier("boss","world")+" is")+" ";C.NextChainSD1&&!C.isChainUnchecked(C.NextChainSD1)&&(l=c),C.NextChainHC1&&!C.isChainUnchecked(C.NextChainHC1)&&(u=c),O.Options.bol_alertChecked===!1&&(l.length>0&&(d=!1),u.length>0&&(p=!1)),d&&p?(D.speak(h+D.getChainPronunciation(C.NextChainSD1)+l,5),D.speak(D.getSpeechWord("also")+", "+D.getChainPronunciation(C.NextChainHC1)+u,3)):d?D.speak(h+D.getChainPronunciation(C.NextChainSD1)+l,5):p&&D.speak(h+D.getChainPronunciation(C.NextChainHC1)+u,5),(d||p)&&D.speak(T.getTimeTillChainFormatted(C.NextChainSD1,"speech"),3)}O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&O.Options.bol_alertUnsubscribe&&I.isProgramLoaded&&C.isChainWorldBoss(e)&&C.isChainSubscribed(e)&&$("#chnTime_"+e.nexus).trigger("click")}},getSumBasedOnOptions:function(e,t){if(C.isChainToday(e))return t>-1?e.primaryEvents[t].minSum:(e.countdownToFinish=e.minFinish,e.minFinish);var n=T.getTimeSinceMidnight(T.ReferenceEnum.Local,T.UnitEnum.Hours);if(t>-1){switch(O.Options.int_setPredictor){case O.IntEnum.Predictor.Auto:if(n>=12&&18>n)return e.primaryEvents[t].minSum;if(n>=18)return e.primaryEvents[t].minavgSum;if(n>=0&&6>n)return e.primaryEvents[t].avgSum;if(n>=6&&12>n)return e.primaryEvents[t].minavgSum;break;case O.IntEnum.Predictor.Min:return e.primaryEvents[t].minSum;case O.IntEnum.Predictor.MinAvg:return e.primaryEvents[t].minavgSum;case O.IntEnum.Predictor.Avg:return e.primaryEvents[t].avgSum}return e.primaryEvents[t].minavgSum}switch(O.Options.int_setPredictor){case O.IntEnum.Predictor.Auto:if(n>=12&&18>n)return e.countdownToFinish=e.minFinish,e.minFinish;if(n>=18)return e.countdownToFinish=e.minavgFinish,e.minavgFinish;if(n>=0&&6>n)return e.countdownToFinish=e.avgFinish,e.avgFinish;if(n>=6&&12>n)return e.countdownToFinish=e.minavgFinish,e.minavgFinish;break;case O.IntEnum.Predictor.Min:return e.countdownToFinish=e.minFinish,e.minFinish;case O.IntEnum.Predictor.MinAvg:return e.countdownToFinish=e.minavgFinish,e.minavgFinish;case O.IntEnum.Predictor.Avg:return e.countdownToFinish=e.avgFinish,e.avgFinish}return e.countdownToFinish=e.minavgFinish,e.minavgFinish}},M={MapEnum:"map",OptionSuffix:"",Zones:GW2T_ZONE_DATA,ZoneAssociation:GW2T_ZONE_ASSOCIATION,Regions:GW2T_REGION_DATA,Submaps:GW2T_SUBMAP_DATA,Weapons:GW2T_RANGE_DATA,cInitialZone:"lion",Map:{},Floors:[],ZoneCurrent:{},numPins:0,cICON_SIZE_STANDARD:32,cRING_SIZE_MAX:256,isMapInitialized:!1,isFloorShown:!0,isMouseOnHUD:!1,isUserDragging:!1,isZoneLocked:!1,isMapAJAXDone:!1,isAPIRetrieved_MAPFLOOR:!1,isItineraryRetrieved:!1,isMappingIconsGenerated:!1,isEventIconsGenerated:!1,ContextLatLng:null,cMAP_NUMFLOORS:4,cMAP_BOUND:32768,cMAP_CENTER:[16384,16384],cMAP_CENTER_INITIAL:[-1024,1024],cMAP_MOUSEMOVE_RATE:100,cInertiaThreshold:100,cZoomFactor:2,ZoomEnum:{Adaptive:-2,Same:-1,Min:0,Overview:3,Default:3,Space:3,Sky:5,Bird:6,Ground:7,Max:7},cZIndexRaise:999999,cZIndexBury:-999999,GPSPreviousZoneID:"",GPSPreviousCoord:[],GPSPreviousAngleCharacter:0,GPSPreviousAngleCamera:0,Layer:{Overview:new L.layerGroup,Pin:new L.layerGroup,PersonalPin:new L.layerGroup,PersonalPath:new L.layerGroup,WeaponIcon:new L.layerGroup,WeaponCircle:new L.layerGroup},Pin:{Program:{},Event:{},Over:{},Character:{},Camera:{}},MappingEnum:{Sector:0,Waypoint:1,Landmark:2,Vista:3,Challenge:4,Heart:5,EventIcon:6,EventRing:7},APIPOIEnum:{Sector:"sectors",Waypoint:"waypoint",Landmark:"landmark",Vista:"vista",Challenge:"skill_challenges",Heart:"tasks"},initializeMap:function(){var e=this,t="#"+this.MapEnum,n=O.Options["int_setInitialZoom"+P.SuffixCurrent];this.Map=L.map(this.MapEnum+"Pane",{minZoom:this.ZoomEnum.Min,maxZoom:this.ZoomEnum.Max,inertiaThreshold:this.cInertiaThreshold,doubleClickZoom:!1,touchZoom:!1,zoomControl:!1,attributionControl:!1,crs:L.CRS.Simple}).setView(this.cMAP_CENTER_INITIAL,n),I.isTouchEnabled&&(this.Map.touchZoom.disable(),this.Map.tap&&this.Map.tap.disable());var a;for(var i in this.Zones)a=this.Zones[i],a.center=this.computeZoneCenter(i),a.nick=i,a.Layers={Path:new L.layerGroup,Waypoint:new L.layerGroup,Landmark:new L.layerGroup,Vista:new L.layerGroup,Challenge:new L.layerGroup,Heart:new L.layerGroup,Sector:new L.layerGroup,EventIcon:new L.layerGroup,EventRing:new L.layerGroup},e.MapEnum===P.MapEnum.Tyria&&P.LayerArray.ChainPath.push(a.Layers.Path);this.ZoneCurrent=this.Zones[this.cInitialZone];var r;switch(this.MapEnum){case P.MapEnum.Tyria:r=1,this.createPins(),P.populateMap(M),P.drawZoneBorders(),P.drawZoneGateways(),C.ScheduledChains.forEach(P.drawChainPaths);break;case P.MapEnum.Mists:r=2,L.tileLayer(U.URL_API.TilesMists,{continuousWorld:!0}).addTo(W.Map),this.createPins(),P.populateMap(W)}for(var i=0;i<this.cMAP_NUMFLOORS;i++)this.Floors.push(L.tileLayer("https://tiles.guildwars2.com/"+r+"/"+i+"/{z}/{x}/{y}.jpg",{continuousWorld:!0}));I.isTouchEnabled?this.createTouchMenu():this.bindMapClicks(),$(t+"CoordinatesCopy").onEnterKey(function(){var t=$(this).val();Z.interpretCommand(t,e,e.ZoomEnum.Ground,e.Pin.Program)}),$(t+"DirectoryButton").click(function(){$("#menuMap").trigger("click")}),$(t+"GPSButton").click(function(){P.updateCharacter(1)}).dblclick(function(){e.Map.setZoom(e.Map.getZoom()!==e.ZoomEnum.Ground?e.ZoomEnum.Ground:e.ZoomEnum.Default)}),$(t+"DisplayButton").click(function(){I.isTouchEnabled===!1&&$("#opt_bol_showPanel").trigger("click")}),$(t+"CompassButton").one("mouseenter",e.bindZoneList(e)).click(function(){e.goToDefault()}).dblclick(function(){e.Map.setZoom(e.Map.getZoom()-1)}),this.isMapInitialized=!0},createPins:function(){if(I.isMapEnabled){var e=this;this.Pin.Program=this.createPin("img/map/pin_blue.png"),this.Pin.Event=this.createPin("img/map/pin_green.png"),this.Pin.Over=this.createPin("img/map/pin_over.png",[128,128]),this.Pin.Character=this.createPin("img/map/pin_character.png",[40,40]),this.Pin.Camera=this.createPin("img/map/pin_camera.png",[256,256],{clickable:!1}),this.Layer.Pin.eachLayer(function(t){e.bindMarkerCoordBehavior(t,"click"),e.bindMarkerZoomBehavior(t,"contextmenu"),t.on("dblclick",function(){e.movePin(this)})}),this.Pin.Character.on("contextmenu",function(){e.movePin(this),e.movePin(e.Pin.Camera)}),this.toggleLayer(this.Layer.Pin,!1)}},createTouchMenu:function(){var e=this,t="#"+e.MapEnum,n=$("<div class='tchMenu'></div>").prependTo(t+"Pane");I.preventMapPropagation(n),$("<kbd class='tchTogglePanel tchButton'></kbd>").appendTo(n).click(function(){$("#opt_bol_showPanel").trigger("click")}),$("<kbd class='tchToggleMap tchButton'></kbd>").appendTo(n).click(function(){$("#mapSwitchButton").trigger("click")}),$("<kbd class='tchZoomIn tchButton'></kbd>").appendTo(n).click(function(){e.Map.zoomIn()}),$("<kbd class='tchZoomOut tchButton'></kbd>").appendTo(n).click(function(){e.Map.zoomOut()}),n.css({top:"calc(50% - "+n.height()+"px)"})},bindMapClicks:function(){var e=this,t="#"+e.MapEnum;switch(this.toggleCoordinatesBar(),$(t+"CoordinatesToggle").click(function(){$("#opt_bol_showCoordinatesBar").trigger("click")}),this.Map.on("click",function(t){if(!e.isMouseOnHUD){var n=e.convertLCtoGC(t.latlng);e.outputCoordinatesCopy(P.formatCoord(n))}}),this.Map.on("dblclick",function(t){e.isMouseOnHUD||(e.saveBackupPins(),e.createPersonalPin(t.latlng,!0,!0))}),this.Map.on("contextmenu",function(n){e.ContextLatLng=n.latlng,I.showContextMenu(t+"Context")}),$(t+"Context").click(function(){$(this).hide()}),$(t+"ContextCenter").click(function(){e.goToDefault()}),$(t+"ContextRange").one("mouseenter",function(){e.initializeWeaponPlacer(e)}),$(t+"ContextPins").one("mouseenter",function(){e.initializePinStorage(e)}),$(t+"ContextUndoPins").click(function(){e.loadBackupPins()}),$(t+"ContextClearPins").click(function(){e.clearPersonalPins()}),$(t+"ContextChatlinkPins").click(function(){e.isPersonalPinsLaid(!0)&&P.printClosestWaypoints()}),$(t+"ContextOptimizePins").click(function(){e.isPersonalPinsLaid(!0)&&e.optimizePersonalPath()
}),$(t+"ContextURLPins").click(function(){if(e.isPersonalPinsLaid(!0)){var t=P.WebsiteCurrentMap===P.MapEnum.Mists?"wvw/":"";I.print(I.cSiteURL+t+e.getPersonalString(),!0),I.selectConsole()}}),$(t+"ContextToggleFloor").click(function(){e.toggleFloor()}),$(t+"ContextToggleLock").click(function(){e.toggleZoneLock()}),$(t+"ContextToggleCompletion").click(function(){$("#opt_bol_showWorldCompletion"+e.OptionSuffix).trigger("click")}),e.MapEnum){case P.MapEnum.Tyria:$(t+"ContextToggleHUD").click(function(){$("#opt_bol_showHUD").trigger("click")}),$(t+"ContextDrawCompletion").click(function(){P.drawCompletionRoute()});break;case P.MapEnum.Mists:}},toggleCoordinatesBar:function(){var e=O.Options.bol_showCoordinatesBar;$(".mapCoordinatesBar input").toggle(e),I.ModeCurrent===I.ModeEnum.Overlay&&$(".mapTime").toggle(e)},outputCoordinatesCopy:function(e){var t="#"+this.MapEnum;$(t+"CoordinatesCopy").val(e).select()},outputCoordinatesName:function(e){var t="#"+this.MapEnum;$(t+"CoordinatesName").val(e)},bindMapVisualChanges:function(){var e=this,t="#"+e.MapEnum;$(t+"HUDPane").hover(function(){e.isMouseOnHUD=!0},function(){e.isMouseOnHUD=!1}),$(t+"Context").hover(function(){e.isMouseOnHUD=!0},function(){e.isMouseOnHUD=!1}),this.Map.on("dragstart",function(){e.isUserDragging=!0}),this.Map.on("dragend",function(){e.isUserDragging=!1}),this.Map.on("mousemove",$.throttle(e.cMAP_MOUSEMOVE_RATE,function(t){e.isMouseOnHUD||e.isUserDragging||e.showCurrentZone(e.convertLCtoGC(t.latlng))})),this.Map.on("zoomend",function(){e.adjustZoomMapping(),e.MapEnum===P.MapEnum.Tyria&&P.adjustZoomDryTop()})},changeFloor:function(e){for(var t=0;t<this.Floors.length;t++)this.Map.removeLayer(this.Floors[t]);this.Floors[e].addTo(this.Map)},toggleFloor:function(){var e="#"+this.MapEnum,t=$(e+"Pane");if(this.isFloorShown=!this.isFloorShown,t.toggleClass("mapPaneBackground",this.isFloorShown),this.isFloorShown)M.changeFloor(O.Options.int_setFloor);else for(var n=0;n<this.Floors.length;n++)this.Map.removeLayer(this.Floors[n])},toggleZoneLock:function(){this.isZoneLocked=!this.isZoneLocked,I.write(this.isZoneLocked?"Map locked to zone: "+D.getObjectName(this.ZoneCurrent):"Map zoning unlocked.")},refreshMap:function(){this.isMapInitialized&&(this.Map.invalidateSize(),this.refreshView())},isZoneValid:function(e){return void 0===this.ZoneAssociation[e]?!1:!0},getZoneFromID:function(e){var t=this.ZoneAssociation[e];return t?this.Zones[t]:null},getZoneName:function(e){var t;if("string"==typeof e&&this.Zones[e])t=this.Zones[e];else{if("object"!=typeof e)return"nozonename";t=e}return D.getObjectName(t)},getZoneNick:function(e){return this.ZoneAssociation[e.id]},getZoneRegion:function(e){var t=this.Zones[e.toLowerCase()];return t?t.region:null},getZoneFromCoord:function(e){for(var t in this.Zones)if(!(e[0]<this.Zones[t].continent_rect[0][0]||e[1]<this.Zones[t].continent_rect[0][1]||e[0]>this.Zones[t].continent_rect[1][0]||e[1]>this.Zones[t].continent_rect[1][1]))return this.Zones[t];return null},showCurrentZone:function(e){var t=this,n=t.MapEnum;if(document.getElementById(n+"CoordinatesMouse").value=e[0]+", "+e[1],(e[0]<this.ZoneCurrent.continent_rect[0][0]||e[1]<this.ZoneCurrent.continent_rect[0][1]||e[0]>this.ZoneCurrent.continent_rect[1][0]||e[1]>this.ZoneCurrent.continent_rect[1][1])&&this.isZoneLocked!==!0){var a,i="",r=this.getZoneFromCoord(e);if(null!==r){a=this.Zones[this.ZoneCurrent.nick];for(var o in a.Layers)this.Map.removeLayer(a.Layers[o]);switch(this.ZoneCurrent=r,i=this.getZoneName(this.ZoneCurrent),document.getElementById(n+"CoordinatesName").value=i,t.MapEnum){case P.MapEnum.Tyria:O.Options.bol_showChainPaths&&I.PageCurrent!==I.PageEnum.Map&&this.ZoneCurrent.Layers.Path.addTo(this.Map),O.Options.bol_displayWaypoints&&this.ZoneCurrent.Layers.Waypoint.addTo(this.Map),O.Options.bol_displayPOIs&&this.ZoneCurrent.Layers.Landmark.addTo(this.Map),O.Options.bol_displayVistas&&this.ZoneCurrent.Layers.Vista.addTo(this.Map),O.Options.bol_displayChallenges&&this.ZoneCurrent.Layers.Challenge.addTo(this.Map),O.Options.bol_displayHearts&&this.ZoneCurrent.Layers.Heart.addTo(this.Map),O.Options.bol_displaySectors&&this.ZoneCurrent.Layers.Sector.addTo(this.Map),O.Options.bol_displayEvents&&(this.ZoneCurrent.Layers.EventIcon.addTo(this.Map),this.ZoneCurrent.Layers.EventRing.addTo(this.Map));break;case P.MapEnum.Mists:O.Options.bol_displayWaypointsWvW&&this.ZoneCurrent.Layers.Waypoint.addTo(this.Map),O.Options.bol_displayPOIsWvW&&this.ZoneCurrent.Layers.Landmark.addTo(this.Map),O.Options.bol_displayVistasWvW&&this.ZoneCurrent.Layers.Vista.addTo(this.Map),O.Options.bol_displayChallengesWvW&&this.ZoneCurrent.Layers.Challenge.addTo(this.Map),O.Options.bol_displaySectorsWvW&&this.ZoneCurrent.Layers.Sector.addTo(this.Map)}I.qTip.init(".leaflet-marker-icon"),this.adjustZoomMapping()}}},refreshCurrentZone:function(){var e=this.ZoneCurrent.center;switch(this.MapEnum){case P.MapEnum.Tyria:this.showCurrentZone(this.getZoneCenter("verdant")),this.showCurrentZone(this.getZoneCenter("auric"));break;case P.MapEnum.Mists:this.showCurrentZone(this.getZoneCenter("edge")),this.showCurrentZone(this.getZoneCenter("eternal"))}this.showCurrentZone(e)},computeZoneCenter:function(e){var t=this.Zones[e].continent_rect,n=t[0][0]+~~((t[1][0]-t[0][0])/2),a=t[0][1]+~~((t[1][1]-t[0][1])/2);return[n,a]},getZoneCenter:function(e){return this.Zones[e]?this.Zones[e].center:[0,0]},getEventCenter:function(e){var t=this.getZoneFromID(e.map_id),n=e.location.center;return this.convertEventCoord(n,t)},scaleDimension:function(e,t){return t=t||this.Map.getZoom(),parseInt(e/Math.pow(this.cZoomFactor,this.ZoomEnum.Max-t))},invertZoomLevel:function(e){return this.ZoomEnum.Max-e},adjustZoomMapping:function(){var e,t,n,a=this,i=this.Map.getZoom(),r=this.invertZoomLevel(i),o={waypoint:[40,32,26,20,16,12,0,0],landmark:[32,24,16,12,0,0,0,0],eventicon:[32,24,16,12,0,0,0,0],eventring:[256,128,64,32,0,0,0,0],sectorfont:[28,20,16,0,0,0,0,0],sectoropacity:[.9,.6,.3,0,0,0,0,0],objicon:[38,38,38,38,32,24,16,0],objtimerfont:[18,17,16,15,14,13,12,0],objinfofont:[14,13,12,11,10,9,0,0],objumbrella:[96,96,96,96,64,32,24,0],spawnfont:[28,24,20,16,12,8,0,0],spawnopacity:[.9,.9,.8,.7,.6,.5,0,0],wallweight:[10,8,6,4,2,0,0,0]},s=function(e){return o[e][r]},c=s("waypoint"),l=s("landmark"),u=s("eventicon"),d=s("eventring"),p=s("sectorfont"),h=s("sectoropacity"),g=s("objicon"),m=s("objtimerfont"),f=s("objinfofont"),C=s("objumbrella"),v=s("spawnfont"),b=s("spawnopacity"),T=s("wallweight");switch(this.MapEnum){case P.MapEnum.Tyria:O.Options.bol_displayEvents&&(this.ZoneCurrent.Layers.EventIcon.eachLayer(function(e){a.resizeMarkerIcon(e,u),e._icon&&(e._icon.style.zIndex=M.cZIndexRaise)}),this.ZoneCurrent.Layers.EventRing.eachLayer(function(e){a.resizeMarkerIcon(e,d),e._icon&&(e._icon.style.zIndex=M.cZIndexBury)})),t=O.Options.bol_showZoneOverview,e=O.Options.bol_showWorldCompletion,n=O.Options.bol_displaySectors;break;case P.MapEnum.Mists:$(".objIcon").css({width:g,height:g}),$(".objProgressBar").css({width:g}),$(".objTimer").css({fontSize:m}),$(".objInfo").css({fontSize:f}),$(".objUmbrella").css({width:C,height:C}),t=O.Options.bol_showZoneOverviewWvW,e=O.Options.bol_showWorldCompletionWvW,n=O.Options.bol_displaySectorsWvW,this.Layer.SpawnLabel.eachLayer(function(e){e._icon.style.fontSize=v+"px",e._icon.style.opacity=b,e._icon.style.zIndex=a.cZIndexBury+1,e._icon.style.display="table"}),this.Layer.Secondaries.eachLayer(function(e){a.resizeMarkerIcon(e,l)}),this.Layer.Destructible.eachLayer(function(e){e.setStyle({weight:T})})}this.Layer.WeaponCircle.eachLayer(function(e){e.setRadius(a.getZoomedDistance(e.options.trueradius))}),e&&t&&i===this.ZoomEnum.Overview?(this.toggleLayer(this.Layer.Overview,!0),this.Layer.Overview.eachLayer(function(e){e._icon.style.display="table"})):this.toggleLayer(this.Layer.Overview,!1),this.ZoneCurrent.Layers.Waypoint.eachLayer(function(e){a.resizeMarkerIcon(e,c)}),this.ZoneCurrent.Layers.Landmark.eachLayer(function(e){a.resizeMarkerIcon(e,l),e._icon&&(e._icon.style.opacity=i<a.ZoomEnum.Max?.6:.8)}),this.ZoneCurrent.Layers.Vista.eachLayer(function(e){a.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Challenge.eachLayer(function(e){a.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Heart.eachLayer(function(e){a.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Sector.eachLayer(function(e){e._icon&&(e._icon.style.fontSize=p+"px",e._icon.style.opacity=h,e._icon.style.zIndex=a.cZIndexBury+1,n&&(e._icon.style.display="table"))}),P.updateCharacter(-1)},getZoomedDistance:function(e){return e/Math.pow(2,this.ZoomEnum.Max-this.Map.getZoom())},createStandardIcon:function(e){return L.icon({iconUrl:e,iconSize:[32,32],iconAnchor:[16,16]})},createPin:function(e,t,n){void 0===t&&(t=[32,32]);var a={icon:L.icon({iconUrl:e,iconSize:t,iconAnchor:[t[0]/2,t[1]/2]}),draggable:!0};if(void 0!==n)for(var i in n)a[i]=n[i];var r=L.marker(this.convertGCtoLC([0,0]),a);return this.Layer.Pin.addLayer(r),r},initializePinStorage:function(e){var t=e,n=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix];n.value=Array(e);var a=n.key;try{n.value=JSON.parse(localStorage[a])}catch(i){}},a=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix],a=t.getPersonalCoords();a.length>0?(n.value[e]=a,localStorage[n.key]=JSON.stringify(n.value)):t.isPersonalPinsLaid(!0)},i=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix];t.redrawPersonalPath(n.value[e])},r="#"+t.MapEnum,o=8,s=D.getWordCapital("load"),c=D.getWordCapital("save");n(o);for(var l=0;o>l;l++)$(r+"ContextLoadPins").append("<li data-index='"+l+"'>"+s+" #"+(l+1)+"</li>"),$(r+"ContextSavePins").append("<li data-index='"+l+"'>"+c+" #"+(l+1)+"</li>");$(r+"ContextLoadPins li").click(function(){i($(this).attr("data-index"))}),$(r+"ContextSavePins li").click(function(){a($(this).attr("data-index"))})},saveBackupPins:function(){var e=O.Utilities["BackupPins"+this.OptionSuffix];localStorage[e.key]=JSON.stringify(this.getPersonalCoords())},loadBackupPins:function(){var e=O.Utilities["BackupPins"+this.OptionSuffix];try{e.value=JSON.parse(localStorage[e.key])}catch(t){}this.redrawPersonalPath(e.value,null)},createPersonalPin:function(e,t){var n=this,a=0===this.numPins?"img/map/pin_red.png":"img/map/pin_white.png",i=L.marker(e,{icon:L.icon({iconUrl:a,iconSize:[32,32],iconAnchor:[16,16]}),draggable:!0,opacity:.9});this.toggleLayer(i,!0),this.Layer.PersonalPin.addLayer(i),this.numPins++,t&&this.drawPersonalPath(),this.bindMarkerCoordBehavior(i,"click"),i.on("click",function(){void 0===this.options.isMarked||this.options.isMarked===!1?(this.options.isMarked=!0,this.setOpacity(.3)):(this.options.isMarked=!1,this.setOpacity(1))}),i.on("dblclick",function(){n.toggleLayer(this,!1),n.Layer.PersonalPin.removeLayer(this),n.drawPersonalPath(),n.numPins--}),i.on("contextmenu",function(e){n.Map.getZoom()===n.ZoomEnum.Max?(n.GPSPreviousCoord.length>0?n.movePin(this,n.GPSPreviousCoord):n.movePin(this,n.Map.getCenter()),n.drawPersonalPath()):n.Map.setView(e.latlng,n.ZoomEnum.Max)}),i.on("dragend",function(){n.drawPersonalPath()})},insertPersonalPin:function(e,t){var n=[],a=0;this.Layer.PersonalPin.eachLayer(function(i){n.push(i.getLatLng()),a===e&&n.push(t),a++}),this.clearPersonalPins();for(a in n)this.createPersonalPin(n[a]);this.drawPersonalPath()},clearPersonalPins:function(){var e=this;this.Layer.PersonalPin.eachLayer(function(t){e.toggleLayer(t,!1)}),this.Layer.PersonalPin.clearLayers(),this.drawPersonalPath(),this.numPins=0},drawPersonalPath:function(){var e=this;if(O.Options.bol_showPersonalPaths){var t,n=[],a=[],i=0;if(this.Layer.PersonalPin.eachLayer(function(e){n.push(e.getLatLng()),a.push(P.getLayerId(e)),i++}),i>1){this.Layer.PersonalPath.clearLayers();for(var r=0;i-1>r;r++)t=L.polyline([n[r],n[r+1]],{color:P.getUserPathColor(),opacity:.4,precede:r}),t.on("click",function(){e.outputCoordinatesCopy(e.getPersonalString()),e.outputPinsRange()}),t.on("dblclick",function(t){e.saveBackupPins(),e.insertPersonalPin(this.options.precede,t.latlng)}),this.Layer.PersonalPath.addLayer(t);this.toggleLayer(this.Layer.PersonalPath,!0),e.outputPinsRange()}else this.toggleLayer(this.Layer.PersonalPath,!1),this.Layer.PersonalPath.clearLayers()}else this.toggleLayer(this.Layer.PersonalPath,!1),this.Layer.PersonalPath.clearLayers()},parsePersonalPath:function(e){var t=this.parseCoordinatesMulti(e);return null!==t?(this.redrawPersonalPath(t),!0):!1},redrawPersonalPath:function(e,t){if(void 0!==e&&null!==e&&e.length>0){this.clearPersonalPins();for(var n in e)this.createPersonalPin(this.convertGCtoLC(e[n]));this.drawPersonalPath(),null!==t&&this.goToArguments(void 0===t?e[0]:t)}else I.write("Path unavailable for this.")},outputPinsRange:function(){for(var e=0,t=this.Layer.PersonalPin.getLayers(),n=t.length-1,a=0;n>a;a++)e+=P.getDistanceBetweenCoords(this.convertLCtoGC(t[a].getLatLng()),this.convertLCtoGC(t[a+1].getLatLng()));var i=~~(e*T.cPOINTS_TO_UNITS),r=T.formatTimeLetter(Math.ceil(i/T.cUNITS_PER_SECOND),!0);this.outputCoordinatesName(i+" "+D.getWord("range")+" ("+r+")")},isPersonalPinsLaid:function(e){return 0===this.numPins?(e&&I.write("No personal pins to work with. Double click on the map to lay pins."),!1):!0},optimizePersonalPath:function(e){this.redrawPersonalPath(P.getGreedyPath(this.getPersonalCoords(),e))},drawRandom:function(e){var t=parseInt(e);if(0!==t&&1e3>=t&&this.numPins<=1e3&&void 0!==t){for(var n,a,i=0;t>i;i++)n=T.getRandomIntRange(0,this.cMAP_BOUND),a=T.getRandomIntRange(0,this.cMAP_BOUND),this.createPersonalPin(this.convertGCtoLC([n,a]));this.drawPersonalPath()}},getPersonalCoords:function(){var e=this,t=[];return this.Layer.PersonalPin.eachLayer(function(n){t.push(e.convertLCtoGC(n.getLatLng()))}),t},getPersonalString:function(){return JSON.stringify(this.getPersonalCoords())},getClosestLocation:function(e,t){var n,a=this,i=Number.POSITIVE_INFINITY,r=null;return t.eachLayer(function(t){n=P.getDistanceBetweenCoords(e,a.convertLCtoGC(t.getLatLng())),i>n&&(i=n,r=t)}),r},initializeWeaponPlacer:function(e){var t=e,n="#"+t.MapEnum,a=5,i=2e4,r=32,o=8192,s=$(n+"ContextRangeList");I.preventMapPropagation(s);var c=0;for(var l in t.Weapons){var u=t.Weapons[l];if(u.isPlaceable!==!1){c++;var d=$("<img src='img/wvw/range/"+u.image+I.cPNG+"' />"),p=void 0!==u.tooltip?u.tooltip:D.getWordCapital("range")+" "+u.range;d.attr("title",p),s.append(d),c%a===0&&s.append("<br />"),function(e){d.click(function(){t.createWeapon(e,t.ContextLatLng)})}(u)}}var h=$("<img src='img/wvw/range/custom.png' title='<dfn>Lay a custom weapon on the map</dfn><br />using the range and color specified below.<br /><br />After laying a weapon on the map:<br />Drag it to move it.<br />Right click to center it.<br />Double click to delete it.' />").click(function(){var e={id:"custom",image:"custom",range:parseInt($(n+"RangeCustomRange").val()),color:U.stripToColorString($(n+"RangeCustomColor").val())};t.createWeapon(e,t.ContextLatLng)});s.append(h),$(n+"ContextClearWeapons").click(function(){t.clearWeapons()}),s.append("<br /><span id='"+t.MapEnum+"RangeCustom' class='mapRangeCustom'><input id='"+t.MapEnum+"RangeCustomRange' type='number' value='1200' min='0' max='"+i+"' step='100' style='width:64px' class='cssInputText' /><input id='"+t.MapEnum+"RangeCustomColor' type='text' value='#ffffff' maxlength='"+r+"' style='width:96px' class='cssInputText' /></span>"),$(n+"RangeCustomRange, "+n+"RangeCustomColor").onEnterKey(function(){h.trigger("click")});var g=$("<img src='img/ui/export.png' title='<dfn>(Export) Prints in data format the weapons</dfn> currently placed on the map.<br />The outputted text can be copied to share your weapons placement.' />").click(function(){t.isWeaponsLaid()&&I.print(U.escapeHTML(JSON.stringify(t.serializeWeapons())),!0)}),m=$("<img src='img/ui/import.png' id='"+t.MapEnum+"RangeImportButton' title='<dfn>(Import) Reads data from the text input box</dfn> on the right.<br />Weapons will be reconstructed from these pasted text data.' />").click(function(){var e=$(n+"RangeImportText").val();try{var a=JSON.parse(e);Array.isArray(a)&&t.redrawWeapons(a)}catch(i){I.write("Invalid data string for importing weapons.")}}),f=$("<input id='"+t.MapEnum+"RangeImportText' type='text' value='' maxlength='"+o+"' style='width:96px' class='cssInputText' />").onEnterKey(function(){$(n+"RangeImportButton").trigger("click")});s.append(g).append(m).append(f),s.find("input").click(function(e){e.stopPropagation(),$(this).select()}),$("#wvwContextDrawWeapons").click(function(){W.redrawDefaultWeapons()}),I.qTip.init(".mapContextRangeList img"),t.initializeWeaponStorage()},initializeWeaponStorage:function(){var e=this,t=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix];n.value=Array(t);var a=n.key;try{n.value=JSON.parse(localStorage[a])}catch(i){}},n=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix],a=e.serializeWeapons();a.length>0?(n.value[t]=a,localStorage[n.key]=JSON.stringify(n.value)):e.isWeaponsLaid()},a=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix];e.redrawWeapons(n.value[t])},i="#"+e.MapEnum,r=8,o=D.getWordCapital("load"),s=D.getWordCapital("save");t(r);for(var c=0;r>c;c++)$(i+"ContextLoadWeapons").append("<li data-index='"+c+"'>"+o+" #"+(c+1)+"</li>"),$(i+"ContextSaveWeapons").append("<li data-index='"+c+"'>"+s+" #"+(c+1)+"</li>");$(i+"ContextLoadWeapons li").click(function(){a($(this).attr("data-index"))}),$(i+"ContextSaveWeapons li").click(function(){n($(this).attr("data-index"))})},serializeWeapons:function(){var e=this,t=[];return e.Layer.WeaponCircle.eachLayer(function(n){var a={id:n.options.weaponid,coord:e.convertLCtoGC(n.getLatLng())};"custom"===n.options.weaponid&&(a.color=n.options.color.toLowerCase(),a.range=parseInt(n.options.weaponrange)),t.push(a)}),U.sortObjects(t,{aKeyName:"id"}),t},redrawWeapons:function(e,t){if(void 0!==e&&null!==e&&e.length>0){this.clearWeapons();for(var n in e){var a=e[n],i=void 0!==t?[a.coord[0]+t[0],a.coord[1]+t[1]]:a.coord,r=null;"custom"===a.id&&void 0!==a.range&&void 0!==a.color&&void 0!==a.coord?r={id:a.id,image:"custom",coord:i,range:parseInt(a.range),color:U.stripToColorString(a.color)}:void 0!==this.Weapons[a.id]&&(r=this.Weapons[a.id]),null!==r?this.createWeapon(r,this.convertGCtoLC(i)):I.write("Failed parsing a weapon.")}}else I.write("Arsenal unavailable for this.")},redrawDefaultWeapons:function(){var e=W.Metadata.PlacementAssociation[W.ZoneCurrent.nick],t=W.Placement[e],n=W.Metadata.Offsets[W.ZoneCurrent.nick];if(void 0!==n&&t){var a=t.Siege;W.redrawWeapons(a,n)}},isWeaponsLaid:function(){return 0===this.Layer.WeaponIcon.getLayers().length?(I.write("No weapons to work with. Lay weapons from the map's &quot;Range&quot; context menu."),!1):!0},createWeapon:function(e,t){var n=this,a=e.range*T.cUNITS_TO_POINTS,i=this.getZoomedDistance(a),r=L.circleMarker(t,{clickable:!1,weaponid:e.id,weaponrange:e.range,trueradius:a,radius:i,color:e.color,weight:2,opacity:e.opacity||.8,fillOpacity:e.fillOpacity||.1});this.Layer.WeaponCircle.addLayer(r),this.toggleLayer(r);var o=L.marker(t,{circle:r,icon:L.icon({className:"mapWeapon",iconUrl:"img/wvw/range/"+e.image+I.cPNG,iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0,opacity:.9});n.bindMarkerCoordBehavior(o,"click"),o.on("drag",function(){this.options.circle.setLatLng(this.getLatLng())}),o.on("dblclick",function(){n.removeWeapon(this)}),o.on("contextmenu",function(){n.GPSPreviousCoord.length>0?n.movePin(this,n.GPSPreviousCoord):n.movePin(this,n.Map.getCenter()),this.options.circle.setLatLng(this.getLatLng())}),this.Layer.WeaponIcon.addLayer(o),this.toggleLayer(o)},removeWeapon:function(e){this.toggleLayer(e.options.circle,!1),this.Layer.WeaponCircle.removeLayer(e.options.circle),this.toggleLayer(e,!1),this.Layer.WeaponIcon.removeLayer(e)},clearWeapons:function(){var e=this;this.Layer.WeaponIcon.eachLayer(function(t){e.removeWeapon(t)}),this.Layer.WeaponCircle.clearLayers(),this.Layer.WeaponIcon.clearLayers()},resizeMarkerIcon:function(e,t){void 0===t&&(t=this.cICON_SIZE_STANDARD),e.setIcon(new L.icon({iconUrl:e.options.icon.options.iconUrl,iconSize:[t,t],iconAnchor:[t/2,t/2]}))},toggleLayer:function(e,t){e&&(void 0===t&&(t=!this.Map.hasLayer(e)),t?e.addTo(this.Map):this.Map.removeLayer(e))},toggleLayerArray:function(e,t){for(var n in e)this.toggleLayer(e[n],t)},toggleSubmap:function(e,t){var n=this.Submaps[e];void 0===n.ImageOverlay?(n.ImageOverlay=L.imageOverlay(n.img,this.convertGCtoLCMulti(n.bounds)),this.toggleSubmap(e,t)):(void 0===t&&(t=!this.Map.hasLayer(n.ImageOverlay)),t?n.ImageOverlay.addTo(this.Map).bringToBack():this.Map.removeLayer(n.ImageOverlay))},toggleSubmapArray:function(e,t){for(var n in e)this.toggleSubmap(e[n],t)},movePin:function(e,t){void 0===t?this.toggleLayer(e,!1):(this.toggleLayer(e,!0),e.setLatLng(Array.isArray(t)?this.convertGCtoLC(t):t),e._icon.style.zIndex=this.cZIndexRaise)},goToView:function(e,t,n){void 0!==n&&this.movePin(n,e),void 0===t?t=this.ZoomEnum.Ground:t===this.ZoomEnum.Same?t=this.Map.getZoom():t===this.ZoomEnum.Adaptive?t=this.getAdaptiveZoom():"object"==typeof t&&void 0!==t.offset&&(t=this.getAdaptiveZoom(t.offset)),this.Map.setView(this.convertGCtoLC(e),t),this.showCurrentZone(e)},refreshView:function(e){var t=e?this.convertGCtoLC(e):this.Map.getCenter();this.Map.setView(M.cMAP_CENTER_INITIAL,this.Map.getZoom()),this.Map.setView(t,this.Map.getZoom())},goToZone:function(e,t){var n=this.getZoneCenter(e);this.showCurrentZone(n),this.goToView(n,t)},getAdaptiveZoom:function(e){void 0===e&&(e=0);var t,n=$(window).width();return t=n<I.ScreenWidth.Huge?n<I.ScreenWidth.Large?n<I.ScreenWidth.Medium?this.ZoomEnum.Default-2:this.ZoomEnum.Default-1:this.ZoomEnum.Default:this.ZoomEnum.Default+1,t+e},goToDefault:function(e){void 0===e&&(e=this.getAdaptiveZoom()),this.Map.setView(this.convertGCtoLC(this.cMAP_CENTER),e)},goToArguments:function(e,t,n){var a,i,r=[];if(e)if(r=this.parseCoordinates(e),2===r.length)isFinite(r[0])&&isFinite(r[1])&&this.goToView(r,t,n);else if(r.length<3){if(i=e.toLowerCase(),"default"===i)this.goToDefault();else for(a in this.Zones)if(-1!==i.indexOf(a)){this.goToView(this.getZoneCenter(a),this.ZoomEnum.Sky);break}}else if(isFinite(r[0])&&isFinite(r[1])&&isFinite(r[2])){var o=this.invertZoomLevel(r[2]);this.goToView([r[0],r[1]],o,n)}},executeURLCommands:function(){var e,t=U.Args[U.KeyEnum.Go],n=U.Args[U.KeyEnum.Draw],a=function(){void 0===U.Args[U.KeyEnum.Page]&&$("#menuMap").trigger("click")};try{e=JSON.parse(t)}catch(i){}e&&Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.parsePersonalPath(t),U.Args[U.KeyEnum.Go]=null,a()):t&&(this.goToArguments(t,this.ZoomEnum.Ground,this.Pin.Program),U.Args[U.KeyEnum.Go]=null,a()),n&&(this.parsePersonalPath(n),U.Args[U.KeyEnum.Draw]=null,a()),I.ModeCurrent===I.ModeEnum.Overlay&&I.isProgramEmbedded===!1&&P.tickGPS()},convertGCtoLC:function(e){return this.Map.unproject(e,this.Map.getMaxZoom())},convertGCtoLCMulti:function(e,t){t=t||0;var n,a=[];for(n=t;n<e.length;n++)a.push(this.convertGCtoLC(e[n]));return a},convertGCtoLCDual:function(e){return[this.convertGCtoLC(e[0]),this.convertGCtoLC(e[1])]},convertLCtoGC:function(e){var t=this.Map.project(e,this.ZoomEnum.Max);return[Math.round(t.x),Math.round(t.y)]},convertLCtoGCMulti:function(e){for(var t=[],n=0;n<e.length;n++)t.push(this.convertLCtoGC(e[n]));return t},convertEventCoord:function(e,t){var n=t.continent_rect,a=t.map_rect;return"988"===t.id&&(n=t.continent_rect_actual),[~~(n[0][0]+(n[1][0]-n[0][0])*(e[0]-a[0][0])/(a[1][0]-a[0][0])),~~(n[0][1]+(n[1][1]-n[0][1])*(1-(e[1]-a[0][1])/(a[1][1]-a[0][1])))]},convertGPSCoord:function(e,t){var n=this.getZoneFromID(t),a=Array(3);return a[0]=e[0]*T.cMETERS_TO_UNITS,a[1]=e[2]*T.cMETERS_TO_UNITS,a[2]=e[1]*T.cMETERS_TO_UNITS,this.convertEventCoord(a,n)},convertGPSAngle:function(e){return Math.atan2(e[2],e[0])*T.cRADIAN_TO_DEGREE},convertDirectionAngle:function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])*T.cRADIAN_TO_DEGREE},parseCoordinates:function(e){var t=(""+e).replace(/[^\d,-.]/g,"");return t.split(",")},parseCoordinatesMulti:function(e){var t,n=13,a=e.replace(/\s/g,""),i=[],r=[];if(a.length>=n&&"["===a.charAt(0)&&"["===a.charAt(1)&&"]"===a.charAt(a.length-1)&&"]"===a.charAt(a.length-2)){a=a.substring(2,a.length-2),i=a.split("],[");for(var o in i)t=i[o].split(","),2===t.length&&(t[0]=Math.round(t[0]),t[1]=Math.round(t[1]),r.push(t));return r}return null},convertLatLngs:function(e){if(Array.isArray(e)){var t=this.convertLCtoGCMulti(e);P.printCoordinates(t)}},getElementCoordinates:function(e){var t=e.attr("data-coord");return this.Zones[t]?this.getZoneCenter(t):this.parseCoordinates(t)},bindMapLinks:function(e,t){if(I.isMapEnabled!==!1){var n=this;$(e+" dfn").each(function(){$(this).text("["+$(this).text()+"]"),n.bindMapLinkBehavior($(this),t,n.Pin.Program)})}},bindMapLinkBehavior:function(e,t,n){if(I.isMapEnabled!==!1&&void 0!==e&&null!==e){var a=this;e.click(function(){var e=$(this).attr("data-coord");Z.interpretCommand(e,a,t,n)}),e.dblclick(function(){var e=a.getElementCoordinates($(this));e.length>1&&(a.Map.getZoom()===a.ZoomEnum.Max?a.goToView(e,a.ZoomEnum.Default,n):a.Map.zoomIn())}),e.contextmenu(function(e){e.preventDefault();var t=a.convertGCtoLC(a.getElementCoordinates($(this)));if(a.Map.getZoom()===a.ZoomEnum.Max){var n=a.Map.getCenter();~~n.lat===~~t.lat&&~~n.lng===~~t.lng?a.Map.setZoom(a.ZoomEnum.Default):a.Map.setView(t,a.Map.getZoom())}else a.Map.setView(t,a.ZoomEnum.Max)}),e.mouseover(function(){var e=a.getElementCoordinates($(this));e.length>1&&a.movePin(a.Pin.Over,e)}),e.mouseout(function(){a.movePin(a.Pin.Over)})}},bindOverviewBehavior:function(e,t){var n=this;e.on(t,function(){n.goToZone(e.options.mappingzone,n.ZoomEnum.Sky)})},bindMarkerZoomBehavior:function(e,t,n){if(!I.isTouchEnabled){var a=this;void 0===n&&(n=a.ZoomEnum.Default),e.on(t,function(e){if(a.Map.getZoom()===a.ZoomEnum.Max){var t=a.Map.getCenter();~~t.lat===~~e.latlng.lat&&~~t.lng===~~e.latlng.lng?a.Map.setZoom(n):a.Map.setView(e.latlng,a.Map.getZoom())}else a.Map.setView(e.latlng,a.ZoomEnum.Max)})}},bindMarkerCoordBehavior:function(e,t){if(!I.isTouchEnabled){var n=this;e.on(t,function(){var e=n.convertLCtoGC(this.getLatLng());n.outputCoordinatesCopy(P.formatCoord(e))})}},bindMarkerWikiBehavior:function(e,t,n){I.isTouchEnabled||e.on(t,function(){U.openExternalURL(C.getEventWiki(this.options.wiki,n))})},bindZoneList:function(e){var t=e,n="#"+t.MapEnum;$(n+"ZoneList li").each(function(){var e=$(this).attr("data-zone");$(this).text(t.getZoneName(e)),$(this).attr("data-coord",""+t.getZoneCenter(e)),t.bindMapLinkBehavior($(this),{offset:1})}),$(n+"ZoneList h2").each(function(){var e=$(this).attr("data-region");$(this).text(D.getObjectName(t.Regions[e]))})}},P={SuffixCurrent:"",WebsiteCurrentMap:"map",GPSCurrentMap:null,MapEnum:{Tyria:"map",Mists:"wvw"},Layer:{ZoneBorder:new L.layerGroup,ZoneGateway:new L.layerGroup,ZoneLaunchpad:new L.layerGroup,DryTopNicks:new L.layerGroup,Chest:new L.layerGroup},NodeArray:{JP:[]},LayerArray:{ChainPath:[],Resource:[],JP:[],Guild_Bounty:[],Guild_Trek:[],Guild_Challenge:[],Guild_Rush:[],Guild_Puzzle:[],DryTopIcons:[],DryTopRings:[],DryTopActive:[]},LocationsDatabase:[],Events:{},DryTopTimer:{},Resources:{},JPs:{},Chests:{},Collectibles:{},Guild:{},GPSTimeout:{},initializeMap:function(){I.isMapEnabled&&M.initializeMap()},addMapLocation:function(e,t,n,a){var i={name:t,icon:n,coord:e},r=(t+" "+a).toLowerCase();P.LocationsDatabase.push([i,r])},populateMap:function(e){if(I.isMapEnabled){var t,n=e,a=O.Options["bol_showWorldCompletion"+n.OptionSuffix];switch(n.MapEnum){case P.MapEnum.Tyria:t=U.URL_API.MapFloorTyria;break;case P.MapEnum.Mists:if(t=U.URL_API.MapFloorMists,a===!1)return}$.getJSON(t,function(e){var t,i,r,o,s,c,l,u,d,p,h,g,m=D.getTranslation("Sector"),f=D.getTranslation("Point of Interest"),C=D.getTranslation("Vista"),v=D.getTranslation("Hero Challenge"),b=D.getTranslation("Heart");for(i in e.regions){r=e.regions[i];for(o in r.maps)if(l=n.getZoneFromID(o),l&&!l.ispopulated){l.ispopulated=!0,s=r.maps[o];var T=D.getObjectName(l),S=0,y=0,k=0,E=0,_=0,A=0;for(u=s.points_of_interest.length,t=0;u>t;t++){switch(c=s.points_of_interest[t],c.type){case n.APIPOIEnum.Waypoint:y++,p=U.URL_IMG.Waypoint,h="mapWp",g=c.name,P.addMapLocation(c.coord,c.name,p,T);break;case n.APIPOIEnum.Landmark:if(a===!1)continue;k++,p=U.URL_IMG.Landmark,h="mapPoi",g=c.name,P.addMapLocation(c.coord,c.name,p,T+" "+f);break;case n.APIPOIEnum.Vista:if(a===!1)continue;_++,p=U.URL_IMG.Vista,h="mapPoi",g=C,P.addMapLocation(c.coord,T+" "+C+" "+_,p,T+" "+C);break;default:continue}switch(d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='"+h+"'>"+g+"</span>",markername:c.name,icon:L.icon({iconUrl:p,iconSize:[16,16],iconAnchor:[8,8]}),id:c.poi_id}),c.type){case n.APIPOIEnum.Waypoint:d.on("mouseout",function(){try{this._icon.src=U.URL_IMG.Waypoint}catch(e){}}),d.on("mouseover",function(){this._icon.src=U.URL_IMG.WaypointOver}),l.Layers.Waypoint.addLayer(d);break;case n.APIPOIEnum.Landmark:d.on("mouseout",function(){try{this._icon.src=U.URL_IMG.Landmark}catch(e){}}),d.on("mouseover",function(){this._icon.src=U.URL_IMG.LandmarkOver}),l.Layers.Landmark.addLayer(d);break;case n.APIPOIEnum.Vista:l.Layers.Vista.addLayer(d)}I.isTouchEnabled===!1&&(c.type===n.APIPOIEnum.Waypoint||c.type===n.APIPOIEnum.Landmark?(d.on("click",function(){n.outputCoordinatesCopy(U.getChatlinkFromPoiID(this.options.id)),n.outputCoordinatesName(this.options.markername)}),d.on("dblclick",function(){U.openExternalURL(U.getWikiLinkLanguage(this.options.markername))}),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky)):(n.bindMarkerZoomBehavior(d,"click",n.ZoomEnum.Sky),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky)))}if(a){for(u=s.skill_challenges.length,E=u,p=U.URL_IMG.Challenge,t=0;u>t;t++)A++,c=s.skill_challenges[t],d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='mapPoi'>"+v+"</span>",icon:L.icon({iconUrl:p,iconSize:[16,16],iconAnchor:[8,8]})}),n.bindMarkerZoomBehavior(d,"click",n.ZoomEnum.Sky),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky),l.Layers.Challenge.addLayer(d),P.addMapLocation(c.coord,T+" "+v+" "+A,p,T+" "+v);for(u=s.tasks.length,S=u,p=U.URL_IMG.Heart,t=0;u>t;t++)c=s.tasks[t],d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='mapPoi'>"+c.objective+" ("+c.level+")</span>",wiki:c.objective,icon:L.icon({iconUrl:p,iconSize:[16,16],iconAnchor:[8,8]})}),M.bindMarkerWikiBehavior(d,"click"),M.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky),l.Layers.Heart.addLayer(d),P.addMapLocation(c.coord,c.objective,p,T+" "+b);for(u=s.sectors.length,p=U.URL_IMG.Sector,t=0;u>t;t++)c=s.sectors[t],d=L.marker(n.convertGCtoLC(c.coord),{clickable:!1,icon:L.divIcon({className:"mapSec",html:"<span class='mapSecIn'>"+c.name+"</span>",iconSize:[512,64],iconAnchor:[256,32]})}),l.Layers.Sector.addLayer(d),P.addMapLocation(c.coord,c.name,p,T+" "+m);n.isMappingIconsGenerated=!0}a&&(d=L.marker(n.convertGCtoLC(l.center),{mappingzone:l.nick,riseOnHover:!0,icon:L.divIcon({className:"mapOverview",html:"<span class='mapOverviewIn'><var class='mapOverviewName'>"+D.getObjectName(l)+"</var>"+(s.min_level>0?"<var class='mapOverviewLevel'>"+(80===s.min_level?s.max_level:s.min_level+" - "+s.max_level)+"</var>":"")+(S>0?"<img src='img/map/heart.png' />"+S+" ":"")+(y>0?"<img src='img/map/waypoint.png' />"+y+" ":"")+(k>0?"<img src='img/map/landmark.png' />"+k+" ":"")+(E>0?"<img src='img/map/challenge.png' />"+E+" ":"")+(_>0?"<img src='img/map/vista.png' />"+_:"")+"</span>",iconSize:[256,64],iconAnchor:[128,32]})}),n.bindOverviewBehavior(d,"click"),n.bindOverviewBehavior(d,"contextmenu"),n.Layer.Overview.addLayer(d),n.toggleLayer(n.Layer.Overview,!0))}}}).done(function(){n.isAPIRetrieved_MAPFLOOR=!0,n.MapEnum===P.MapEnum.Tyria&&O.Options.bol_displayEvents===!1&&P.donePopulation()}).fail(function(){I.ModeCurrent===I.ModeEnum.Website&&I.write("Guild Wars 2 API server is unreachable.<br />Reasons could be:<br />- The ArenaNet server is down for maintenance.<br />- Your browser is too old (if IE then need 11+).<br />- Your computer's time is out of sync.<br />- This website's code encountered a bug.<br />Map features will be limited.<br />",20)
}).always(function(){switch(n.MapEnum){case P.MapEnum.Tyria:O.Options.bol_displayEvents===!0?P.populateEvents():P.finishPopulation();break;case P.MapEnum.Mists:W.finishPopulation()}})}},populateEvents:function(){var e=function(e){for(var t=["scarlet","molten all","overdue emi","aetherblade","queen's cha","mordrem inv","offshoot","vigil eng","haunted","guild","subdue","hero cha"],n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))return!0;return!1},t=function(e){return-1!==e.indexOf("free")?"release":-1!==e.indexOf("rescue")?"release":-1!==e.indexOf("capture")?"flag":-1!==e.indexOf("retake")?"flag":-1!==e.indexOf("reclaim")?"flag":-1!==e.indexOf("liberate")?"flag":-1!==e.indexOf("protect")?"shield":-1!==e.indexOf("defend")?"shield":-1!==e.indexOf("escort")?"shield":-1!==e.indexOf("kill")?"boss":-1!==e.indexOf("slay")?"boss":-1!==e.indexOf("defeat")?"boss":-1!==e.indexOf("collect")?"collect":-1!==e.indexOf("help")?"star":-1!==e.indexOf("destroy")?"cog":-1!==e.indexOf("gather")?"collect":-1!==e.indexOf("bring")?"collect":-1!==e.indexOf("recover")?"collect":-1!==e.indexOf("return")?"collect":-1!==e.indexOf("retrieve")?"collect":-1!==e.indexOf("salvage")?"collect":-1!==e.indexOf("burglar")?"fist":"swords"},n=function(e){var t=e.location.radius;switch(e.location.type){case"sphere":return 2e3>t?"img/ring/c_s.png":"img/ring/c_m.png";case"cylinder":return"img/ring/e_m_h.png";case"poly":return"img/ring/e_l_h.png"}return"img/ring/c_m.png"},a=function(e){var t;for(t in e.events)P.Events[t]={},P.Events[t].name=e.events[t].name},i=function(i){$.getJSON(U.URL_API.EventDetails,function(r){var o,s,c,l,u,d,p,h,g,m;a(i||r);for(o in r.events)s=r.events[o],c=s.name.toLowerCase(),l=void 0!==P.Events[o]?P.Events[o].name:s.name,g=M.getZoneFromID(s.map_id),m=D.getObjectName(g),g&&!e(c)&&50!==s.map_id&&(p=M.getEventCenter(s),h=M.convertGCtoLC(p),u=L.marker(h,{clickable:!1,icon:L.icon({iconUrl:n(s),iconSize:[256,256],iconAnchor:[128,128]})}),g.Layers.EventRing.addLayer(u),d="img/event/"+t(c)+I.cPNG,u=L.marker(h,{title:"<span class='mapPoi'>"+l+" ("+s.level+")</span>",wiki:s.name,coord:p,eventid:o,icon:L.icon({iconUrl:d,iconSize:[48,48],iconAnchor:[24,24]})}),M.bindMarkerWikiBehavior(u,"click",!0),M.bindMarkerZoomBehavior(u,"contextmenu"),g.Layers.EventIcon.addLayer(u),P.addMapLocation(p,s.name,d,m+" "+s.name));M.isEventIconsGenerated=!0}).done(function(){P.donePopulation()}).always(function(){P.finishPopulation()})};D.isLanguageDefault()?i():$.getJSON(U.URL_API.EventDetails+U.URL_API.LangKey,function(e){i(e)}).fail(function(){P.finishPopulation()})},donePopulation:function(){},finishPopulation:function(){M.isMapAJAXDone=!0,M.bindMapVisualChanges(),M.adjustZoomMapping(),P.adjustZoomDryTop(),P.initializeMapSearch(),"wvw"!==I.PageInitial&&M.executeURLCommands()},initializeMapSearch:function(){$("#mapCompassButton").one("mouseenter",function(){I.preventMapPropagation("#mapSearch"),Q.bindItemSearch("#mapSearch",{aDatabase:P.LocationsDatabase,aResultsClass:"mapSearchResults",aResultsLimit:200,aCallback:function(e){M.goToView(e.coord,M.ZoomEnum.Same,M.Pin.Program)}})})},wantTourPrediction:function(){return I.isMapEnabled&&O.Options.bol_tourPrediction&&I.ModeCurrent!==I.ModeEnum.Overlay&&I.PageCurrent===I.PageEnum.Chains&&C.isDryTopIconsShown===!1&&!U.Args[U.KeyEnum.Go]?!0:!1},createNodeArray:function(e){for(var t=Array(e),n=0;e>n;n++)t[n]={oMarker:null,oPath:null};return t},toggleNode:function(e,t,n){e[t]&&(M.toggleLayer(e[t].oMarker,n),M.toggleLayer(e[t].oPath,n))},toggleNodeArray:function(e,t){for(var n=0;n<e.length;n++)M.toggleLayer(e[n].oMarker,t),M.toggleLayer(e[n].oPath,t)},getLayerId:function(e){return e._leaflet_id},getLayerGroup:function(e){return e._layers},sortCoordinates:function(e,t){var n;for(var a in e)n=e[a],n[0]=Math.round(n[0]),n[1]=Math.round(n[1]);if(e.sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),!t)return e;for(var a in e)this.printNumberedCoordinates(e[a],a)},roundCoordinates:function(e,t){var n;for(var a in e)n=e[a],n[0]=Math.round(n[0]),n[1]=Math.round(n[1]);this.printCoordinates(e,t)},printNeedles:function(e){for(var t in e)this.printNumberedCoordinates(e[t].c,t)},printNodes:function(e,t){for(var n=0;n<e.length;n++){var a=t?"n: "+(n+1)+", ":"";I.print("{"+a+"c: ["+e[n][0]+", "+e[n][1]+"]},")}},printNumberedCoordinates:function(e,t){I.print("{n: "+(parseInt(t)+1)+", c: ["+e[0]+", "+e[1]+"]},")},formatCoord:function(e){return"["+e[0]+", "+e[1]+"]"},compileCoordinates:function(e,t){for(var n,a="",i=t?" ":"",r=0;r<e.length;r++)n=r<e.length-1?t&&(r+1)%2===0?"]],<br />":t&&r%2===0?"], ":"],":"]",a+=null===e[r]?"null,":"["+(t&&r%2===0?"[":"")+e[r][0]+","+i+e[r][1]+n;return(t?"[<br />":"[")+a+(t?"]<br />]":"]")},printCoordinates:function(e,t){I.print(this.compileCoordinates(e,t))},printClosestWaypoints:function(){var e,t,n,a,i=12,r=500,o="",s=[""],c=[0,0],l=0;if(M.Layer.PersonalPin.eachLayer(function(i){t=M.convertLCtoGC(i.getLatLng()),n=M.getZoneFromCoord(t),null!==n&&(a=M.getClosestLocation(t,n.Layers.Waypoint),e="",null!==a&&(e=U.getChatlinkFromPoiID(a.options.id),l=P.getDistanceBetweenCoords(t,c),s[s.length-1]!==e&&l>r&&s.push(e),c=t))}),s.shift(),s.length>0){for(var u=Math.ceil(s.length/i),d=0,o="<div id='jsWaypointLinks'>Copy the codes below and<br />paste them in game chat to <br />follow the route:<br />",p=0;u>p;p++){o+="<input type='text'  class='cssInputText' value='";for(var h=i*p;i*(p+1)>h&&d<s.length;h++)o+=" "+(h+1)+"-&gt;"+s[h],d++;o+="' /> Message "+(p+1)+"<br />"}o+="</div>",I.print(o,!0),$("#jsWaypointLinks .cssInputText").click(function(){$(this).select()})}else I.write("Pins must first be placed and be inside zones in order to create chatlinks.");return d},getDistanceBetweenCoords:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},getUnitsBetweenCoords:function(e,t){return~~(P.getDistanceBetweenCoords(e,t)*T.cPOINTS_TO_UNITS)},getGreedyPath:function(e,t){var n=e;if(void 0!==t){var a=n[0];n[0]=n[t],n[t]=a}for(var i=n[0],r=0,o=n.length,s=0;o>s;s++){for(var c=Number.POSITIVE_INFINITY,l=s;o>l;l++){var u=P.getDistanceBetweenCoords(i,n[l]);u>c||(r=l,c=u)}i=n[r],n[r]=n[s],n[s]=i}return n},getUserPathColor:function(){return U.stripToColorString(O.Options.str_colorPersonalPath)},drawDirectedPath:function(e,t,n){void 0===t&&(t=!0);var a=M.convertGCtoLCMulti(e),i=new L.layerGroup,r=8,o=t?0:r-1;n=n||"lime";for(var s=0;s<a.length-1;s++)i.addLayer(L.polyline([a[s],a[s+1]],{color:n,weight:2*(o+2)})),o=t?o+1:o-1,t&&o>=r?o=0:!t&&0>o&&(o=r-1);return i},drawSpots:function(e,t){var n,a=M.convertGCtoLCMulti(e),i=new L.layerGroup,r={radius:10,color:"lime",weight:4};if(void 0!==t)for(var o in t)r[o]=t[o];for(var o in a)n=L.circleMarker(a[o],r),M.bindMarkerZoomBehavior(n,"click"),i.addLayer(n);return i},drawCompletionRoute:function(){M.isItineraryRetrieved?M.redrawPersonalPath(M.ZoneCurrent.path):$.getScript(U.URL_DATA.Itinerary).done(function(){for(var e in GW2T_COMPLETION_DATA)M.Zones[e].path=GW2T_COMPLETION_DATA[e].path;M.isItineraryRetrieved=!0,P.drawCompletionRoute()})},printZoneEvents:function(){if(M.isEventIconsGenerated){var e=[];M.ZoneCurrent.Layers.EventIcon.eachLayer(function(t){t.oSortableCoord=t.options.coord[0],e.push(t)}),U.sortObjects(e,{aKeyName:"oSortableCoord"}),e.forEach(function(e){var t=e.options;I.print("<input type='text' class='cssInputText' value='"+t.eventid+"' /> <input type='text' class='cssInputText' value='["+t.coord+"]' /> <a"+U.convertExternalAnchor(C.getEventWiki(t.wiki))+">[W]</a> <dfn class='cssGameTitle' data-coord='"+t.coord+"'>"+t.wiki+"</dfn>")}),M.bindMapLinks("#itemConsole"),I.bindConsoleInput()}else I.write("Event icons have not been generated.")},drawZoneBorders:function(){if(O.Options.bol_showZoneBorders&&0===P.Layer.ZoneBorder.getLayers().length)for(var e in M.Zones){var t=M.Zones[e];P.Layer.ZoneBorder.addLayer(L.rectangle(M.convertGCtoLCMulti(t.continent_rect),{fill:!1,color:M.Regions[t.region].color,weight:2,clickable:!1}))}M.toggleLayer(P.Layer.ZoneBorder,O.Options.bol_showZoneBorders)},drawZoneGateways:function(){if(O.Options.bol_showZoneGateways&&0===P.Layer.ZoneGateway.getLayers().length){var e,t,n=GW2T_GATEWAY_CONNECTION,a=n.launchpads,i=function(e,t,n,a){var i,r=e;Array.isArray(e[0])&&(r=e[0],i=e[1]);var o={icon:L.icon({iconUrl:t,iconSize:[32,32],iconAnchor:[16,16]}),opacity:n||.6,title:a};i&&(o.rotationAngle=M.convertDirectionAngle(r,i)+T.cCIRCLE_RIGHT_DEGREE);var s=L.marker(M.convertGCtoLC(r),o);return M.bindMarkerZoomBehavior(s,"click"),M.bindMarkerZoomBehavior(s,"contextmenu"),s},r=function(n,a,r){for(var o in n){for(var s in n[o])e=i(n[o][s],"img/map/gateway_"+a+I.cPNG),P.Layer.ZoneGateway.addLayer(e);r&&(t=L.polyline(M.convertGCtoLCDual(n[o]),{color:r,opacity:.2}),P.Layer.ZoneGateway.addLayer(t))}};r(n.interborders,"interborders"),r(n.interzones,"interzones","purple"),r(n.intrazones,"intrazones","white"),a.forEach(function(n){var a=n.i?"<div class='mapLoc'><img src='"+n.i+"' /></div>":null;e=i(n.c,"img/map/launchpad.png",1,a),P.Layer.ZoneLaunchpad.addLayer(e),P.Layer.ZoneGateway.addLayer(e),t=L.polyline(M.convertGCtoLCDual(n.c),{color:"gold",opacity:.2}),P.Layer.ZoneGateway.addLayer(t)}),I.qTip.init(".leaflet-marker-icon")}M.toggleLayer(P.Layer.ZoneGateway,O.Options.bol_showZoneGateways),M.adjustZoomMapping()},drawChainPaths:function(e){if(I.isMapEnabled!==!1){var t,n,a,i,r,o;if(e.series!==C.ChainSeriesEnum.DryTop)for(t=0;t<e.primaryEvents.length;t++){switch(a=e.primaryEvents[t],t){case 0:i="red";break;case 1:i="orange";break;case 2:i="yellow";break;case 3:i="lime";break;case 4:i="cyan";break;case 5:i="blue";break;case 6:i="violet";break;case 7:i="purple";break;default:i="white"}if(a.path[0][0]<0)for(var s=1;s<a.path.length;s++)o=L.circleMarker(M.convertGCtoLC(a.path[s]),{clickable:!1,radius:8,color:"red",weight:2,opacity:.8,fillOpacity:.1}),M.Zones[e.zone].Layers.Path.addLayer(o);else r=M.convertGCtoLCMulti(a.path,1),o=L.polyline(r,{color:i}),M.Zones[e.zone].Layers.Path.addLayer(o)}var c;for(t in e.events)n=e.events[t],c=n.num,-1!==c.indexOf(".")&&(c=c.replace(".","\\.")),$("#chnEvent_"+e.nexus+"_"+c).each(function(){var e=n.path[0],a=e;e[0]<0&&(a=[Math.abs(e[0]),Math.abs(e[1])]),$(this).attr("data-coord",a[0]+","+a[1]),$(this).attr("data-eventindex",t),I.ModeCurrent!==I.ModeEnum.Mobile&&M.bindMapLinkBehavior($(this),M.ZoomEnum.Ground,M.Pin.Event)})}},generateDryTop:function(){$.getScript(U.URL_DATA.DryTop).done(function(){C.DryTop=GW2T_DRYTOP_EVENTS;var e,t,n,a,i;if(I.isMapEnabled){for(e in C.DryTop)a=C.DryTop[e],i=L.marker(M.convertGCtoLC(a.coord),{clickable:!1,icon:L.divIcon({className:"mapNick",html:"<span class='mapNickIn'>"+D.getObjectName(a)+"<br /><ins style='color:"+a.color+"'>"+a.time+"</ins></span>",iconSize:[512,64],iconAnchor:[256,32]})}),P.Layer.DryTopNicks.addLayer(i);M.toggleLayer(P.Layer.DryTopNicks,!0),P.DryTopTimer=L.marker(M.convertGCtoLC(M.getZoneCenter("dry")),{clickable:!1,icon:L.divIcon({className:"mapNick",html:"<div class='mapNickIn' id='mapDryTopInfo'><span id='mapDryTopTimer'></span><br /><input id='mapDryTopClip0' type='text' /> <input id='mapDryTopClip1' type='text' /></div>",iconSize:[512,64],iconAnchor:[256,32]})}),M.toggleLayer(P.DryTopTimer,!0);for(e in C.DryTopChains){n=C.DryTopChains[e];for(t in n.events)a=n.events[t],a.eventring=L.marker(M.convertGCtoLC(a.path[0]),{zIndexOffset:M.cZIndexBury,clickable:!1,icon:L.icon({iconUrl:"img/ring/"+a.ring+I.cPNG,iconSize:[32,32],iconAnchor:[16,16]})}),a.eventicon=L.marker(M.convertGCtoLC(a.path[0]),{title:"<span class='mapEvent'>"+D.getObjectName(a)+"</span>",wiki:D.getObjectName(a),icon:L.icon({iconUrl:"img/event/"+a.icon+I.cPNG,iconSize:[16,16],iconAnchor:[8,8]})}),M.bindMarkerWikiBehavior(a.eventicon,"click"),M.bindMarkerZoomBehavior(a.eventicon,"contextmenu"),$("#chnEvent_"+n.nexus+"_"+a.num).hasClass("chnEventCurrent")&&(P.LayerArray.DryTopActive.push(a.eventicon),P.LayerArray.DryTopActive.push(a.eventring),M.toggleLayer(a.eventring,!0),M.toggleLayer(a.eventicon,!0)),P.LayerArray.DryTopRings.push(a.eventring),P.LayerArray.DryTopIcons.push(a.eventicon)}I.qTip.init(".leaflet-marker-icon")}C.isDryTopGenerated=!0,T.initializeDryTopStrings(),P.toggleDryTopIcons(!0)})},toggleDryTopIcons:function(e){C.isDryTopGenerated&&I.isMapEnabled&&(C.isDryTopIconsShown=e,M.toggleLayer(P.Layer.DryTopNicks,e),M.toggleLayer(P.DryTopTimer,e),e?(M.toggleLayerArray(P.LayerArray.DryTopActive,e),P.adjustZoomDryTop(),I.qTip.init($("#mapDryTopClip0, #mapDryTopClip1").click(function(){$(this).select()}).hover(function(){M.isMouseOnHUD=!0},function(){M.isMouseOnHUD=!1}))):(M.toggleLayerArray(P.LayerArray.DryTopIcons,e),M.toggleLayerArray(P.LayerArray.DryTopRings,e))),K.updateDryTopClipboard()},adjustZoomDryTop:function(){if(C.isDryTopIconsShown){var e,t,n,a,i,r,o=M.Map.getZoom();switch(o){case 7:n=32,i=20,r=.9;break;case 6:n=28,i=16,r=.8;break;case 5:n=24,i=12,r=.8;break;case 4:n=20,i=0,r=0;break;case 3:n=16,i=0,r=0;break;default:n=0,i=0,r=0}a=M.scaleDimension(M.cRING_SIZE_MAX);for(e in P.LayerArray.DryTopIcons)t=P.LayerArray.DryTopIcons[e],M.resizeMarkerIcon(t,n),t=P.LayerArray.DryTopRings[e],M.resizeMarkerIcon(t,a);P.Layer.DryTopNicks.eachLayer(function(e){e._icon&&(e._icon.style.fontSize=i+"px",e._icon.style.opacity=r,e._icon.style.zIndex=M.cZIndexBury+1,e._icon.style.display="table")}),P.DryTopTimer._icon.style.fontSize=2*i+"px",P.DryTopTimer._icon.style.opacity=r,P.DryTopTimer._icon.style.zIndex=M.cZIndexRaise+1,P.DryTopTimer._icon.style.display="table"}},switchMapCheck:function(){if(void 0!==GPSIdentityJSON&&null!==GPSIdentityJSON){var e=P.GPSCurrentMap,t=GPSIdentityJSON.map_id,n="#"+P.WebsiteCurrentMap;void 0!==M.ZoneAssociation[t]?P.GPSCurrentMap=P.MapEnum.Tyria:void 0!==W.ZoneAssociation[t]&&(P.GPSCurrentMap=P.MapEnum.Mists),P.GPSCurrentMap!==e&&P.GPSCurrentMap!==P.WebsiteCurrentMap&&$(n+"SwitchButton").trigger("click")}},updateCharacter:function(e){var t,n=O.Options["int_setFollow"+P.SuffixCurrent],a=O.Options["bol_displayCharacter"+P.SuffixCurrent];switch(P.WebsiteCurrentMap){case P.MapEnum.Tyria:t=M;break;case P.MapEnum.Mists:t=W}if(void 0!==GPSPositionArray&&null!==GPSPositionArray&&3===GPSPositionArray.length&&!t.isUserDragging&&void 0!==GPSIdentityJSON&&null!==GPSIdentityJSON){var i=GPSIdentityJSON.map_id;if(t.isZoneValid(i)===!1)return t.movePin(t.Pin.Character),void t.movePin(t.Pin.Camera);var r=t.convertGPSCoord(GPSPositionArray,i);if(r[0]<=t.cMAP_BOUND&&r[0]>0&&r[1]<=t.cMAP_BOUND&&r[1]>0){var o;if(n===O.IntEnum.Follow.Character&&t.GPSPreviousCoord[0]!==r[0]&&t.GPSPreviousCoord[1]!==r[1]||e>=0?(t.Map.setView(t.convertGCtoLC(r),t.Map.getZoom()),t.showCurrentZone(r),t.GPSPreviousCoord=r,e=-1):n===O.IntEnum.Follow.Zone&&t.GPSPreviousZoneID!==i&&t.ZoneAssociation[i]&&(o=t.getZoneCenter(t.ZoneAssociation[i]),t.refreshView(o),t.showCurrentZone(o),t.GPSPreviousZoneID=i,e=-1),a){var s=-t.convertGPSAngle(GPSDirectionArray),c=-t.convertGPSAngle(GPSCameraArray);t.GPSPreviousAngleCharacter===s&&t.GPSPreviousAngleCamera===c&&e>0||(t.movePin(t.Pin.Character,r),t.movePin(t.Pin.Camera,r),t.Pin.Camera._icon.style.zIndex=t.cZIndexBury,t.Pin.Camera._icon.style.pointerEvents="none",t.Pin.Character.setRotationAngle(s),t.Pin.Camera.setRotationAngle(c),t.GPSPreviousAngleCharacter=s,t.GPSPreviousAngleCamera=c)}}}},tickGPS:function(){(O.Options["int_setFollow"+P.SuffixCurrent]||O.Options["bol_displayCharacter"+P.SuffixCurrent])&&(P.updateCharacter(),window.clearTimeout(P.GPSTimeout),P.GPSTimeout=setTimeout(function(){P.tickGPS()},O.Options.int_msecGPSRefresh))}},G={generateAndInitializeDailies:function(){var e=$("#dlyCalendar"),t=new Date;$("#dlyHeader, #dlyCalendar, #dlyActivity").empty(),I.removeThrobber("#dlyContainer"),$("#dlyHeader").html(T.formatWeektime(t));var n=T.Daily.Activity,a=n.Schedule[t.getUTCDay()],i=D.getObjectName(n.Activities[a]);$("#dlyActivity").html("<h2><img src='img/daily/activities/"+a+I.cPNG+"' /> <a"+U.convertExternalAnchor(U.getWikiLinkLanguage(i))+">"+i+"</a> <ins class='dly dly_pve_activity'></ins></h2>"),G.fillDailyCalendar(e,t)},fillDailyCalendar:function(e,t,n){var a=$(e),i=function(){a.find("div:first").addClass("dlyCurrent").next().addClass("dlyNext"),a.find(".dlyZoom").each(function(){M.bindMapLinkBehavior($(this),M.ZoomEnum.Sky,M.Pin.Program)}),I.bindPseudoCheckbox(a.find("ins")),I.qTip.init(a.find("ins")),I.removeThrobber(a.parent())};a.after(I.cThrobber),T.getDaily().done(function(){G.insertDailyDay(a,T.DailyToday,t,!0,n),T.getDaily({aWantGetTomorrow:!0}).done(function(){G.insertDailyDay(a,T.DailyTomorrow,T.addDaysToDate(t,1),!1,n),i(a)})}).fail(function(){I.write("Unable to retrieve daily API. ArenaNet API server may be down."),I.removeThrobber(a.parent())})},insertDailyDay:function(e,t,n,a,i){var r,o,s,c,l,u,d=$(e),p=t.pve,h=t.pvp,g=t.wvw,m="",f="",v=function(e){return r=e.split(" "),o=e,s=r[0].toLowerCase(),c=r.length>1?r[1].toLowerCase():"",l=r.length>2?r[2].toLowerCase():"",u=r.length>3?r[3].toLowerCase():"",1===r.length?"<ins class='dly dly_pve_"+s+"' title='"+o+"'></ins>":"jp"===s||"adventure"===s?"<ins class='dlyRegion dly_region_"+l+"'><ins class='dly dly_pve_"+s+" dlyZoom curZoom' title='"+o+"' data-coord='"+u+"'></ins></ins>":"vista"===s||"miner"===s||"lumberer"===s||"forager"===s?"<ins class='dlyRegion dly_region_"+c+"'><ins class='dly dly_pve_"+s+" dlyZoom curZoom' title='"+o+"' data-coord='"+l+"'></ins></ins>":"dungeon"===s?"<ins class='dlyRegion dly_region_"+l+"'><ins class='dly dly_pve_dungeon_"+c+" dlyZoom curZoom' title='"+o+"' data-coord='"+u+"'></ins></ins>":"boss"===s?(f="<em class='dlyBossIconContainer dlyMonthday'><img class='dlyBossIcon' src='img/chain/"+c+I.cPNG+"' /></em>","<ins class='dlyRegion dly_region_"+C.getChainRegion(C.getChainByAlias(c))+"'><ins class='dly dly_pve_boss' title='"+o+"'></ins></ins>"):"event"===s?"<ins class='dlyRegion dly_region_"+M.getZoneRegion(c)+"'><ins class='dly dly_pve_event dlyZoom curZoom' title='"+o+"' data-coord='"+c+"'></ins></ins>":""},b=function(e){if(r=e.split(" "),o=e,s=r[0].toLowerCase(),1===r.length)return"<ins class='dly dly_pvp_"+s+"' title='"+o+"'></ins>";var t=r[1].toLowerCase();return"<ins class='dly dly_pvp_profession_"+s+"_0' title='"+o+"'><ins class='dly dly_pvp_profession_"+t+"_1'></ins></ins>"},S=function(e){return"<ins class='dly dly_wvw_"+e.toLowerCase()+"' title='"+e+"'></ins>"},y="",k="",E="";switch(p.forEach(function(e){y+=v(e)}),h.forEach(function(e){k+=b(e)}),g.forEach(function(e){E+=S(e)}),n.getUTCDay()){case T.DayEnum.Sunday:m="dlySunday";break;case T.DayEnum.Saturday:m="dlySaturday"}var _=i?"dlyBoxDashboard":"",P=$("<div class='dlyBox "+_+"'><aside class='dlyMonthdayBackground dlyMonthday'></aside>"+f+"<var class='dlyMonthdayNumber dlyMonthday "+m+"'>"+n.getUTCDate()+"</var><span class='dlyMode'><ins class='dly dly_daily_pve'></ins>"+y+"</span><span class='dlyMode'><ins class='dly dly_daily_pvp'></ins>"+k+"</span><span class='dlyMode'><ins class='dly dly_daily_wvw'></ins>"+E+"</span></div>").appendTo(d),A=function(e,t){P.append("<span class='dlyMode dlyModeFractal'><ins class='dly dly_daily_fractal'></ins><ins class='chl_fractal chl_"+e[0].toLowerCase()+"' title='"+e[0]+"'></ins><ins class='chl_fractal chl_"+e[1].toLowerCase()+"' title='"+e[1]+"'></ins><ins class='chl_fractal chl_"+e[2].toLowerCase()+"' title='"+e[2]+"'></ins>"+(t||"")+"</span>"),I.qTip.init(P.find("ins")),I.qTip.init(".dlyFractalScales")};if(a)$.getJSON(U.URL_API.Fractal,function(e){var t=e.achievements;if(t&&t.length>=T.Daily.Fractal.numFractalDailies){var n=T.Daily.Fractal,a=T.DailyAssociation[t[0]],i=T.DailyAssociation[t[1]],r="";a&&i&&(r="<a class='dlyFractalScales' title='"+D.getObjectName(n.Scale)+"' "+U.convertExternalAnchor(D.getObjectURL(n))+">"+a+" &amp; "+i+"</a>");var o=T.DailyAssociation[t[3]],s=T.DailyAssociation[t[7]],c=T.DailyAssociation[t[11]];o&&s&&c&&A([o,s,c],r)}}).fail(function(){I.write("Unable to retrieve daily fractal API.")});else{var L=T.getDaysSince(n,T.Daily.Fractal.Epoch)%T.cDAYS_IN_BIWEEK;A(T.Daily.Fractal.Schedule[L])}},generateAndInitializeResources:function(){var e,t=.3,n=P.getUserPathColor(),a=function(e){return X.getChecklistItem(X.Checklists["Resource"+e.options.grade],e.options.index)},i=function(e,t){X.setChecklistItem(X.Checklists["Resource"+e.options.grade],e.options.index,t)},r=function(){for(var e in P.LayerArray.Resource)P.LayerArray.Resource[e].eachLayer(function(e){e instanceof L.Marker&&a(e)===X.ChecklistEnum.Checked&&e.setOpacity(t)})},o=function(e){M.bindMarkerZoomBehavior(e,"contextmenu"),M.bindMarkerCoordBehavior(e,"dblclick"),e.on("click",function(){a(e)===X.ChecklistEnum.Checked?(i(e,X.ChecklistEnum.Unchecked),this.setOpacity(1)):(i(e,X.ChecklistEnum.Checked),this.setOpacity(t))})},s=function(){for(var e in P.Resources){var t=P.Resources[e].item;null!==t&&!function(e){$.ajax({dataType:"json",url:U.getAPIPrice(t),cache:!1,success:function(t){var n=E.processPrice(t).oPriceSellTaxed;$("#nodPrice_"+e).html(E.formatCoinStringColored(n)),P.Resources[e].price=n}})}(e)}},c=function(t,n){return e.Yield[t.type][n]},l=function(e){var t,a,i,s,l,u,d=0,p=e,h="Rich"===e?[32,32]:[24,24],g="Rich"===e?[24,24]:[16,16];for(t in P.Resources){i=P.Resources[t],P.Resources[t].price=0;var m=t.toLowerCase(),f=i[p];if(void 0!==f&&f.length>0){s=new L.layerGroup;for(a in f)l=L.marker(M.convertGCtoLC(f[a].c),{grade:p,name:t,quantity:c(i,p),index:d,coord:f[a].c,icon:L.divIcon({className:"nod"+p,html:"<img src='img/node/"+m+I.cPNG+"' />",iconSize:h,iconAnchor:g}),isNode:!0}),o(l),s.addLayer(l),void 0!==f[a].p&&(u=L.polyline(M.convertGCtoLCMulti(f[a].p),{color:n,dashArray:"5,10",opacity:.3}),s.addLayer(u)),d++;M.toggleLayer(s),P.Layer["Resource_"+p+"_"+t]=s,P.LayerArray.Resource.push(s)}}X.initializeChecklist(X.Checklists["Resource"+p],d),r()};$.getScript(U.URL_DATA.Resource).done(function(){var t,n;P.Resources=GW2T_RESOURCE_DATA,e=GW2T_RESOURCE_METADATA,l("Rich"),l("Permanent");for(t in P.Resources)n=P.Resources[t],$("#nodResource_"+n.type).append("<label><input id='nod_"+t+"' type='checkbox' checked='checked' /> <img src='img/node/"+t.toLowerCase()+I.cPNG+"' /> <abbr>"+D.getObjectName(n)+"</abbr><var id='nodPrice_"+t+"'></var></label>");for(t in P.Resources)$("#nod_"+t).change(function(){var e=U.getSubstringFromHTMLID($(this)),t=$(this).prop("checked"),n=$("#nodShowPossible").prop("checked");M.toggleLayer(P.Layer["Resource_Rich_"+e],t),M.toggleLayer(P.Layer["Resource_Permanent_"+e],t),M.toggleLayer(P.Layer["Resource_Regular_"+e],t&&n),M.toggleLayer(P.Layer["Resource_Hotspot_"+e],t&&n)});$("#mapToggle_Resource").data("checked",!0).click(function(){var e=I.toggleButtonState($(this));for(t in P.Resources)$("#nod_"+t).prop("checked",e).trigger("change")}),$("#nodRoute").click(function(){if(M.isPersonalPinsLaid())return void M.clearPersonalPins();var e,t,n=0,i=[],r=Number.POSITIVE_INFINITY,o=$("#nod_int_coinWaypointAverage").val(),s=$("#nod_int_secNodeVisitAverage").val(),c=0,l=0,u=0;M.Map.eachLayer(function(o){o instanceof L.Marker&&o.options.isNode&&a(o)===X.ChecklistEnum.Unchecked&&(u+=P.Resources[o.options.name].price*o.options.quantity,i.push(o.options.coord),e=i[n][0],r>e&&(r=e,t=n),n++)});var d=i.length;if(d>0){M.redrawPersonalPath(P.getGreedyPath(i,t),"default"),c=P.printClosestWaypoints()*o,l=d*s;var p="Gather Profit: <span class='cssRight'>"+E.formatCoinStringColored(u)+"</span><br />Waypoint Cost: <span class='cssRight'>"+E.formatCoinStringColored(c)+"</span><br /></br >Net Profit: <span class='cssRight'>"+E.formatCoinStringColored(u-c)+"</span><br /><br />Nodes to Visit: <span class='cssRight'>"+d+"</span><br />Estimated Time: <span class='cssRight'>"+T.getTimeFormatted({aCustomTimeInSeconds:l,aWantLetters:!0})+"</span>";I.print(p)}}),$("#nodToggle_ResourceMetal").click(function(){$("#nodResource_Metal input").trigger("click")}),$("#nodToggle_ResourcePlant").click(function(){$("#nodResource_Plant input").trigger("click")}),$("#nodToggle_ResourceWood").click(function(){$("#nodResource_Wood input").trigger("click")}),$("#nodShowPossible").one("click",function(){l("Regular"),l("Hotspot")}),$("#nodShowPossible").change(function(){var e=$(this).prop("checked");for(var t in P.Resources){var n=$("#nod_"+t).prop("checked");M.toggleLayer(P.Layer["Resource_Regular_"+t],n&&e),M.toggleLayer(P.Layer["Resource_Hotspot_"+t],n&&e)}}).trigger("change"),$("#nodUncheck").click(function(){for(var e in P.LayerArray.Resource)P.LayerArray.Resource[e].eachLayer(function(e){e instanceof L.Marker&&e.setOpacity(1)});X.clearChecklist(X.Checklists.ResourceRich),X.clearChecklist(X.Checklists.ResourcePermanent),X.clearChecklist(X.Checklists.ResourceRegular),X.clearChecklist(X.Checklists.ResourceHotspot)}),$("#nodRefresh").click(function(){s(),I.write("Prices refreshed.")}),s(),U.verifyArticle("All",function(){$("#nodShowPossible").trigger("click")})})},generateAndInitializeJPs:function(){var e,t=function(t,n){var a=t.oMarker,i=a.options.difficulty,r=n?"jpzDifficulty0":"jpzDifficulty"+i;a.setIcon(new L.icon({className:r,iconUrl:"img/map/"+e[i].name+I.cPNG,iconSize:[32,32],iconAnchor:[16,16]}))};$.getScript(U.URL_DATA.JP).done(function(){e=GW2T_JP_DATA.Type,P.JPs=GW2T_JP_DATA.JP,X.Checklists.JP.length=U.getObjectLength(P.JPs),P.NodeArray.JP=P.createNodeArray(X.Checklists.JP.length);var n,a,i,r,o,s,c=P.getUserPathColor();$(".jpzHeader").each(function(){$(this).text(D.getObjectName(e[$(this).attr("data-difficulty")]))});for(var l in P.JPs)n=P.JPs[l],i=L.marker(M.convertGCtoLC(n.coord),{id:n.id,difficulty:n.difficulty,title:"<div class='mapLoc'><dfn>"+D.getObjectName(e[n.difficulty])+":</dfn> "+D.getObjectName(n)+"<img src='"+n.img+"' /></div>"}),P.NodeArray.JP[n.id].oMarker=i,t(P.NodeArray.JP[n.id]),n.path&&(r=L.polyline(M.convertGCtoLCMulti(n.path),{color:c,dashArray:"5,10",opacity:.3}),P.NodeArray.JP[n.id].oPath=r),o=D.getObjectName(n),s=(o+" "+M.getZoneName(n.zone)).toLowerCase(),$("<aside class='jpzItem'><dt id='jpz_"+n.id+"' data-coord='"+n.coord+"'>"+o+"</dt><label><input type='checkbox' id='jpzCheck_"+n.id+"' /></label>&nbsp;<cite><a href='"+U.getYouTubeLink(o)+"'>[Y]</a> <a href='"+U.getWikiLinkLanguage(o)+"'>[W]</a></cite><dd>"+n.description+"</dd></aside>").data("keywords",s).appendTo("#jpzList_"+n.difficulty),a=$("#jpz_"+n.id),a.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>"),M.bindMapLinkBehavior(a,M.ZoomEnum.Same);P.toggleNodeArray(P.NodeArray.JP,!0),M.bindMapLinks(".jpzList"),U.convertExternalLink(".jpzList a"),I.createSearchBar("#jpzSearch",".jpzItem"),I.qTip.init(".jpzList dt"),$("#jpzToggleJP").change(function(){var e=$(this).prop("checked");if(P.toggleNodeArray(P.NodeArray.JP,e),e)for(var n=0;n<P.NodeArray.JP.length;n++){var a=P.NodeArray.JP[n],e=X.getChecklistItem(X.Checklists.JP,n);e===X.ChecklistEnum.Unchecked?t(a):t(a,!0)}}),$("#mapToggle_JP").data("checked",!0).click(function(){var e=I.toggleButtonState($(this));$("#jpzToggleJP").prop("checked",e).trigger("change"),$("#jpzToggleChest").prop("checked")&&$("#jpzToggleChest").prop("checked",e).trigger("change")}),I.qTip.init(".leaflet-marker-icon"),X.initializeChecklist(X.Checklists.JP,X.Checklists.JP.length);for(var u=function(){var e=X.countChecklist(X.Checklists.JP,X.ChecklistEnum.Checked),t=X.Checklists.JP.length;$("#jpzCounter").text(e+"/"+t)},l=0;l<X.Checklists.JP.length;l++)$("#jpzCheck_"+l).each(function(){var e=X.getChecklistItem(X.Checklists.JP,l,U.TypeEnum.isBoolean);$(this).prop("checked",e),e===!1?$(this).parent().prev().removeClass("jpzListNameChecked"):($(this).parent().prev().addClass("jpzListNameChecked"),t(P.NodeArray.JP[l],!0))}).change(function(){var e=X.getCheckboxEnumState($(this)),n=U.getSubintegerFromHTMLID($(this));e===X.ChecklistEnum.Unchecked?($(this).parent().prev().removeClass("jpzListNameChecked"),t(P.NodeArray.JP[n])):($(this).parent().prev().addClass("jpzListNameChecked"),t(P.NodeArray.JP[n],!0)),X.setChecklistItem(X.Checklists.JP,n,e),u()}).parent().hover(function(){$(this).prev().css({"text-decoration":"underline"}).trigger("mouseenter")},function(){$(this).prev().css({"text-decoration":"none"}).trigger("mouseleave")}),function(e){var t=P.NodeArray.JP[e].oMarker;t.on("click",function(){$("#jpzCheck_"+e).trigger("click"),I.scrollToElement("#jpz_"+this.options.id,{aContainer:"#plateMap"})}),M.bindMarkerZoomBehavior(t,"contextmenu")}(l);$("#jpzUncheckJP").click(function(){for(l=0;l<X.Checklists.JP.length;l++)$("#jpzCheck_"+l).prop("checked",!1).parent().prev().removeClass("jpzListNameChecked"),t(P.NodeArray.JP[l]);X.clearChecklist(X.Checklists.JP),u()}),u(),G.generateAndInitializeChests()})},generateAndInitializeChests:function(){P.Chests=GW2T_JP_DATA.Chest;var e=P.Chests.Basic.length+P.Chests.Splendid.length;X.initializeChecklist(X.Checklists.Chest,e);var t,n,a=0,i=.3,r=function(e){return X.getChecklistItem(X.Checklists.Chest,e.options.index)},o=function(e,t){X.setChecklistItem(X.Checklists.Chest,e.options.index,t)},s=function(){P.Layer.Chest.eachLayer(function(e){e.setOpacity(r(e)===X.ChecklistEnum.Checked?i:1)})},c=function(e,t,n){var a=null;e.t&&(a=e.t);var s=L.marker(M.convertGCtoLC(e.c),{index:n,icon:L.divIcon({className:"mapChest"+t,html:"<img src='img/map/chest.png' />",iconSize:[32,32],iconAnchor:[16,16]}),title:a});s.on("click",function(){r(this)===X.ChecklistEnum.Checked?(o(this,X.ChecklistEnum.Unchecked),this.setOpacity(1)):(o(this,X.ChecklistEnum.Checked),this.setOpacity(i))}),M.bindMarkerZoomBehavior(s,"contextmenu"),P.Layer.Chest.addLayer(s)};for(t in P.Chests)for(n in P.Chests[t])c(P.Chests[t][n],t,a),a++;$("#jpzToggleChest").change(function(){M.toggleLayer(P.Layer.Chest,$(this).prop("checked")),s()}),$("#jpzUncheckChest").click(function(){X.clearChecklist(X.Checklists.Chest),s()})},generateCollectiblesUI:function(){$.getScript(U.URL_DATA.Collectible).done(function(){P.Collectibles=GW2T_COLLECTIBLE_DATA;var e,t,n,a,i;for(e in P.Collectibles)t=P.Collectibles[e],n=D.getObjectName(t),a=D.getObjectDefaultName(t),i=I.cSiteLink+"<dfn>"+X.Collectibles[e].urlkey+"</dfn>",$("<div class='cltBox'><label style='color:"+t.color+"'><ins class='clt_"+e.toLowerCase()+"'></ins><input id='ned_"+e+"' type='checkbox' /> "+n+"</label><span class='cltLinks' title='"+i+"' ><cite><a href='"+U.getYouTubeLink(a)+"'>[Y]</a>&nbsp;<a href='"+t.wiki+"'>[W]</a>&nbsp;<a href='"+t.credit+"'>[C]</a>&nbsp;&nbsp;-&nbsp;&nbsp;</cite><a id='nedUncheck_"+e+"'>Reset</a></span></div>").appendTo("#cltList").data("keywords",n.toLowerCase()),$("#ned_"+e).one("click",function(){var e=U.getSubstringFromHTMLID($(this));G.generateCollectibles(e),M.goToArguments(P.Collectibles[e].view)}),U.verifyArticle(X.Collectibles[e].urlkey,function(){$("#ned_"+e).trigger("click")});U.convertExternalLink("#cltList cite a"),I.qTip.init(".cltLinks"),I.createSearchBar("#cltSearch",".cltBox"),$("#mapToggle_Collectible").data("checked",!1).data("hideonly",!0).click(function(){for(e in P.Collectibles)$("#ned_"+e).prop("checked")&&$("#ned_"+e).trigger("click")}),I.scrollToElement("#headerMap_Collectible",{aContainer:"#plateMap"})})},generateCollectibles:function(e){var t,n,a,i,r,o,s,c,l,u,d=U.Args[X.Collectibles[e].urlkey],p=P.Collectibles[e],h=D.getObjectName(p),g="img/collectible/"+e.toLowerCase()+"/",m=function(e,t){if(p.iconsize){var n=p.ringsize||16;e.setIcon(new L.divIcon({className:"mapNeedle"+t,html:"<span class='mapNeedleIcon' style='color:"+p.color+";background-image: url("+e.options.needleLabel+");background-size: "+p.iconsize+"px'></span>",iconSize:[n,n],iconAnchor:[n/2,n/2]}))}else e.setIcon(new L.divIcon({className:"mapNeedle"+t+" mapNeedleExtreme"+e.options.needleExtreme,html:"<span style='color:"+p.color+"'>"+e.options.needleLabel+"</span>",iconSize:[16,16],iconAnchor:[8,8]}));e.setOpacity(t===X.ChecklistEnum.Found?.2:1)},f=function(t,n){var a=L.marker(M.convertGCtoLC(t),n);m(a,s),a.on("click",function(){var e=X.trackChecklistItem(X.Collectibles[this.options.needleType],this.options.needleIndex),t=this;p.iscushion?P.LayerArray[this.options.needleType].forEach(function(n){n.options.needleIndex===t.options.needleIndex&&m(n,e)}):m(this,e);var n=X.getCheckedIndexes(X.Collectibles[this.options.needleType]);
0===n.length?U.updateQueryString():U.updateAddressBar("?"+this.options.needleKey+"="+n)}),M.bindMarkerZoomBehavior(a,"contextmenu"),P.LayerArray[e].push(a)};for(X.Collectibles[e].length=P.Collectibles[e].needles.length,X.initializeChecklist(X.Collectibles[e],X.Collectibles[e].length,d),P.LayerArray[e]=[],P.Layer[e]=new L.layerGroup,t=0;t<p.needles.length;t++)if(a=t+1,r=p.needles[t],s=X.getChecklistItem(X.Collectibles[e],t),u="<div class='mapLoc'><dfn>"+h+":</dfn> #"+a+(p.iscushion?"<br />"+D.getObjectName(r):""),r.s?u+="<img src='"+r.s+"' />":r.t&&(u+="<br /><span class='mapTip'>"+r.t+"</span>"),u+="</div>",i=0===t||t===p.needles.length-1?0:void 0===r.e?"":r.e,o={needleExtreme:i,needleIndex:t,needleType:e,needleKey:X.Collectibles[e].urlkey,needleLabel:p.iconsize?g+r.i+I.cPNG:void 0===r.l?a:r.l,title:u},p.iscushion)for(n=0;n<r.c.length;n++)f(r.c[n],o);else f(r.c,o),t<p.needles.length-1&&p.wantpath!==!1&&(l=2===r.e?"5,15":"1",c=L.polyline(M.convertGCtoLCDual([r.c,p.needles[t+1].c]),{color:"lime",dashArray:l,opacity:.5}),P.Layer[e].addLayer(c));M.toggleLayerArray(P.LayerArray[e],!0),M.toggleLayer(P.Layer[e],!0),$("#ned_"+e).change(function(){var t=$(this).prop("checked"),n=U.getSubstringFromHTMLID($(this));M.toggleLayerArray(P.LayerArray[n],t),M.toggleLayer(P.Layer[n],t),t?(M.goToArguments(P.Collectibles[n].view),I.qTip.init(".leaflet-marker-icon"),$(this).parent().addClass("cltCheckedLabel")):$(this).parent().removeClass("cltCheckedLabel"),"RangerPets"===e&&G.generatePetsList(p.needles,t)}),$("#nedUncheck_"+e).click(function(){var e=U.getSubstringFromHTMLID($(this)),t=P.LayerArray[e];for(var n in t)m(t[n],X.ChecklistEnum.Unfound);X.clearChecklist(X.Collectibles[e]),U.updateQueryString()})},generatePetsList:function(e,t){var n="RangerPets",a=$("#cltSublist"+n),i=a.find(".cltSublistContainer");if(a.toggle(t),$(".cltPetIcon").removeClass("cltPetIconFocused"),i.is(":empty")===!1)return void I.scrollToElement(a,{aContainer:"#plateMap"});for(var r,o,s,c,l,u,d,p,h,g=D.getWord("s"),m=0;m<e.length;m++){r=e[m],c=D.getObjectName(r),l=U.getWikiLinkDefault("Juvenile "+D.getObjectDefaultName(r)),h="img/collectible/rangerpets/"+r.i+I.cPNG;var f="<div class='cltPetBox'><span class='cltPetIcon curToggle' title='"+c+"' style='background-image:url("+h+")'><var class='cltPetIconBackground'>"+I.Symbol.Filler+"</var></span><aside class='cltPetFacts'>";for(var C in r.a)o=r.a[C],Array.isArray(o)?(p="("+o[1]+g+")",d=o[0]>1?"<var class='cltPetStack'>"+o[0]+"</var>"+p:p):d=o,f+="<span class='cltPetFact'><img class='cltPetFactIcon' src='img/fact/"+C+I.cPNG+"' /><var class='cltPetFactText'>"+d+"</var></span>";f+="</aside></div>",s=$(f).appendTo(i).data("keywords",c.toLowerCase()),function(e,t){s.find(".cltPetIcon").click(function(){var t=$(this).hasClass("cltPetIconFocused");if($(".cltPetIcon").removeClass("cltPetIconFocused"),t)M.toggleLayerArray(P.LayerArray[n],!0);else{for(var a=0;a<P.LayerArray[n].length;a++)u=P.LayerArray[n][a],u.options.needleIndex===e?M.toggleLayer(u,!0):M.toggleLayer(u,!1);$(this).addClass("cltPetIconFocused")}}).dblclick(function(){U.openExternalURL(t)})}(m,l)}I.qTip.init(i.find(".cltPetIcon"));var v=$("<div class='cntSearchContainer'></div>").insertBefore(i);I.createSearchBar(v,$(".cltPetBox")),setTimeout(function(){I.scrollToElement(a,{aContainer:"#plateMap"})},200)},generateGuildUI:function(){var e=function(e){M.toggleLayerArray(P.LayerArray["Guild_"+e],!1),$("#gldBook_"+e+" dfn").each(function(){I.toggleHighlight($(this),!1)}),void 0!==P.Guild[e].usedSubmaps&&M.toggleSubmapArray(P.Guild[e].usedSubmaps,!1)},t=function(e){U.convertExternalLink("#gldBook_"+e+" a"),I.qTip.init("#gldBook_"+e+" dfn"),$("#gldBook_"+e+" .cssWaypoint").each(function(){I.bindClipboard($(this))})};$.getScript(U.URL_DATA.Guild).done(function(){P.Guild=GW2T_GUILD_DATA;var n;for(n in P.Guild){var a=P.Guild[n],i=D.getObjectName(a);$("#gldButtons").append("<div><button class='gldButton curToggle btnTab' id='gldButton_"+n+"' style='background-size:cover; background-image:url(img/guild/"+n.toLowerCase()+I.cPNG+")' title='<dfn>"+i+"</dfn><br />"+I.cSiteLink+"<dfn>guild/"+n.toLowerCase()+"</dfn>'></button><a class='cssButton' href='"+U.getYouTubeLink(i)+"'>Y</a>&nbsp;<a class='cssButton' href='"+D.getObjectURL(a)+"'>W</a></div>"),$("#gldBooks").append("<div class='gldBook' id='gldBook_"+n+"'></div>")}$(".gldBook").hide(),I.qTip.init("#gldButtons button"),U.convertExternalLink("#gldButtons a"),$(".gldButton").click(function(){$(".gldButton").removeClass("btnFocused");var t=U.getSubstringFromHTMLID($(this)),n=!0;$("#gldBook_"+t).is(":visible")&&(e(t),n=!1),$(".gldBook").hide(),n&&($(this).addClass("btnFocused"),$("#gldBook_"+t).show()),I.updateScrollbar()}),$("#mapToggle_Guild").data("hideonly",!0).click(function(){$(".gldButton").removeClass("btnFocused").each(function(){e(U.getSubstringFromHTMLID($(this))),$(".gldBook").hide(),I.updateScrollbar()}),M.movePin(M.Pin.Program)}),$("#gldButton_Bounty").one("click",function(){U.sortObjects(P.Guild.Bounty.data);for(var e in P.Guild.Bounty.data){var n=P.Guild.Bounty.data[e],a=D.getObjectDefaultName(n),i=D.getObjectName(n);$("#gldBook_Bounty").append("<div><img class='cssWaypoint jsClip' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Bounty)+": "+i+"' src='img/ui/placeholder.png' /> <dfn id='gldBounty_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+i+"</dfn> <a href='"+U.getYouTubeLink(a)+"'>[Y]</a> <a href='"+U.getWikiLinkLanguage(i)+"'>[W]</a></div>");var r=new L.layerGroup;if(void 0!==n.paths)for(var o in n.paths)r.addLayer(P.drawDirectedPath(n.paths[o]));void 0!==n.spawn&&r.addLayer(P.drawSpots(n.spawn)),P.LayerArray.Guild_Bounty.push(r);var s=$("#gldBounty_"+e);s.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>").click(function(){I.toggleHighlight($(this)),M.toggleLayer(P.LayerArray.Guild_Bounty[U.getSubintegerFromHTMLID($(this))])}),M.bindMapLinkBehavior(s,M.invertZoomLevel(n.coord[2]))}t("Bounty")}),$("#gldButton_Trek").one("click",function(){U.sortObjects(P.Guild.Trek.data);for(var e in P.Guild.Trek.data){var n=P.Guild.Trek.data[e],a=D.getObjectName(n);$("<div class='gldTrek'><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Trek)+": "+a+"' src='img/ui/placeholder.png' /> <dfn id='gldTrek_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+a+"</dfn></div>").appendTo("#gldBook_Trek").data("keywords",a.toLowerCase());var i=new L.layerGroup;i.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),P.LayerArray.Guild_Trek.push(i);var r=$("#gldTrek_"+e);r.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>").click(function(){I.toggleHighlight($(this)),M.toggleLayer(P.LayerArray.Guild_Trek[U.getSubintegerFromHTMLID($(this))])}),M.bindMapLinkBehavior(r,M.ZoomEnum.Ground,M.Pin.Program)}$("#gldBook_Trek").prepend("<div id='gldTrekSearch' class='cntSearchContainer'><div>"),I.createSearchBar("#gldTrekSearch",".gldTrek"),t("Trek")}),$("#gldButton_Challenge").one("click",function(){P.Guild.Challenge.usedSubmaps=[],U.sortObjects(P.Guild.Challenge.data);for(var e in P.Guild.Challenge.data){var n=P.Guild.Challenge.data[e],a=D.getObjectDefaultName(n),i=D.getObjectName(n);$("#gldBook_Challenge").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Challenge)+": "+i+"' src='img/ui/placeholder.png' /> <dfn id='gldChallenge_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+i+" - "+n.limit+"</dfn> <a href='"+U.getYouTubeLink(a)+"'>[Y]</a> <a href='"+U.getWikiLinkLanguage(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Challenge.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),r.addLayer(P.drawSpots(n.spawn,{color:"gold"})),P.LayerArray.Guild_Challenge.push(r);var o=$("#gldChallenge_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Challenge.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Challenge[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Challenge")}),$("#gldButton_Rush").one("click",function(){P.Guild.Rush.usedSubmaps=[],U.sortObjects(P.Guild.Rush.data);for(var e in P.Guild.Rush.data){var n=P.Guild.Rush.data[e],a=D.getObjectDefaultName(n),i=D.getObjectName(n);$("#gldBook_Rush").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Rush)+": "+i+"' src='img/ui/placeholder.png' /> <dfn id='gldRush_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+i+"</dfn> <a href='"+U.getYouTubeLink(a)+"'>[Y]</a> <a href='"+U.getWikiLinkLanguage(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Rush.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),r.addLayer(L.polyline(M.convertGCtoLCMulti(n.track),{color:"lime",dashArray:"5,10"})),r.addLayer(L.marker(M.convertGCtoLC(n.finish),{icon:M.createStandardIcon("img/map/chest.png")})),void 0!==n.traps0&&r.addLayer(P.drawSpots(n.traps0,{radius:5,color:"red",weight:1,opacity:1})),void 0!==n.traps1&&r.addLayer(P.drawSpots(n.traps1,{radius:10,color:"red",weight:1,opacity:1})),r.addLayer(P.drawSpots(n.flags,{radius:2,color:"gold",weight:2,opacity:1})),P.LayerArray.Guild_Rush.push(r);var o=$("#gldRush_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Rush.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Rush[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Rush")}),$("#gldButton_Puzzle").one("click",function(){P.Guild.Puzzle.usedSubmaps=[],U.sortObjects(P.Guild.Puzzle.data);for(var e in P.Guild.Puzzle.data){var n=P.Guild.Puzzle.data[e],a=D.getObjectDefaultName(n),i=D.getObjectName(n);$("#gldBook_Puzzle").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Puzzle)+": "+i+"' src='img/ui/placeholder.png' /> <dfn id='gldPuzzle_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+i+" - "+n.limit+"</dfn> <a href='"+U.getYouTubeLink(a)+"'>[Y]</a> <a href='"+U.getWikiLinkLanguage(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Puzzle.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(P.drawSpots(n.interactions,{color:"gold"})),r.addLayer(L.marker(M.convertGCtoLC(n.finish),{icon:M.createStandardIcon("img/map/chest.png")})),P.LayerArray.Guild_Puzzle.push(r);var o=$("#gldPuzzle_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Puzzle.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Puzzle[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Puzzle")});for(n in P.Guild)U.verifyArticle(n,function(){$("#gldButton_"+n).trigger("click")})})}},W={MapEnum:"wvw",OptionSuffix:"WvW",ZoneAssociation:GW2T_LAND_ASSOCIATION,cInitialZone:"eternal",cMAP_BOUND:16384,cMAP_CENTER:[10494,12414],cMAP_CENTER_INITIAL:[-193.96875,163.96875],cMAP_CENTER_ACTUAL:[8192,8192],ZoomEnum:{Adaptive:-2,Same:-1,Min:0,Overview:2,Default:3,Space:2,Sky:4,Bird:5,Ground:6,Max:6},Layer:{Overview:new L.layerGroup,Pin:new L.layerGroup,PersonalPin:new L.layerGroup,PersonalPath:new L.layerGroup,WeaponIcon:new L.layerGroup,WeaponCircle:new L.layerGroup,Destructible:new L.layerGroup,Secondaries:new L.layerGroup,Objective:new L.layerGroup,SpawnLabel:new L.layerGroup},LayerArray:{},Pin:{Program:{},Event:{},Over:{},Character:{},Camera:{}},LocaleThreshold:{Range:99,AmericasPrefix:"1",Americas:1e3,Europe:2e3,EuropePrefix:"2",France:2100,Germany:2200,Spain:2300},LocaleEnum:{Americas:"Americas",Europe:"Europe"},LeaderboardURL:{Americas:"https://leaderboards.guildwars2.com/en/na/wvw",Europe:"https://leaderboards.guildwars2.com/en/eu/wvw"},LocaleCurrent:null,Rotation:null,LandPrefix:{},isWvWPrepped:!1,isWvWLoaded:!1,Metadata:{},Servers:{},Matches:null,MatchupCurrent:null,Guilds:{},Objectives:{},ObjectiveTimeout:{},Weapons:{},Placement:{},MapType:{},LandEnum:{},ObjectiveEnum:{},OwnerEnum:{},MatchupIDCurrent:null,isObjectiveTickEnabled:!1,isObjectiveTimerTickEnabled:!1,isAPIFailed:!1,isFallbackEnabled:!1,numFailedAPICalls:0,cOWNERS_PER_TIER:3,cLEADERBOARD_SERVERS_CHAR_LIMIT:32,cTOTAL_PPT_POSSIBLE:0,cSECONDS_IMMUNITY:300,cMSECONDS_IMMUNITY:3e5,cMSECONDS_RESET_GRACE:3e5,MatchStartTimeMS:null,MatchFinishTimeMS:null,MatchFinishTimeISO:null,secTillWvWReset:null,numSiegeSupply:0,initializeBorderlands:function(){W.Rotation=W.Metadata.Rotation;for(var e in W.Rotation){var t=W.Rotation[e];W.Zones[t]=GW2T_LAND_ADD[t],W.LandPrefix[e]=W.Zones[t].id+"-"}$(".wvwZoneListBorderlands").each(function(){var e=W.Rotation[$(this).attr("data-zone")];$(this).attr("data-zone",e)})},initializeWvW:function(){var e=new Date;$.extend(W,$.extend({},M,W)),W.Regions=GW2T_REALM_DATA,W.Zones=GW2T_LAND_DATA,W.Servers=GW2T_SERVER_DATA,W.Weapons=GW2T_WEAPON_DATA,W.Metadata=GW2T_WVW_METADATA,W.Placement=GW2T_PLACEMENT_DATA,W.MapType=W.Metadata.MapType,W.LandEnum=W.Metadata.LandEnum,W.ObjectiveEnum=W.Metadata.ObjectiveEnum,W.OwnerEnum=W.Metadata.OwnerEnum,W.initializeBorderlands(),W.computeObjectivesValue(),W.initializeObjectives(),W.initializeMap(),W.populateWvW(),W.initializeLeaderboard(),W.initializeLog(),W.reinitializeServerChange(),W.generateServerList(),I.styleContextMenu("#wvwContext"),U.convertExternalLink("#wvwHelpLinks a"),$("#wvwToolsButton").one("mouseenter",W.initializeSupplyCalculator),W.isWvWLoaded=!0,U.openSectionFromURL({aButton:"#lboRegion",aSection:"Leaderboard"});var t=GW2T_DASHBOARD_DATA.Announcement;t.wvw.length>0&&T.isTimely(t,e)&&W.addLogEntry(t.wvw)},initializeObjectives:function(){var e=GW2T_OBJECTIVE_DATA;for(var t in W.Rotation){var n=W.Rotation[t],a=e[n];for(var i in a)W.Objectives[i]=a[i]}},populateWvW:function(){var e,t,n;for(var a in W.Objectives)e=W.Objectives[a],n=e.type===W.ObjectiveEnum.Ruins?"objSubobjective":"",t=L.marker(W.convertGCtoLC(e.coord),{clickable:!0,riseOnHover:!0,icon:L.divIcon({className:"",html:"<div id='obj_"+e.id+"' class='objContainer "+n+"'><span class='objUmbrellaContainer'><span class='objUmbrellaOuter'><span id='objUmbrella_"+e.id+"' class='objUmbrella'></span></span></span><time id='objTimer_"+e.id+"' class='objTimer'></time><span class='objProgressContainer'><span id='objProgressBar_"+e.id+"' class='objProgressBar'><var id='objProgress_"+e.id+"' class='objProgress'></var></span></span><span class='objIconContainer'><img id='objIcon_"+e.id+"' class='objIcon' src='img/ui/placeholder.png'/></span><span class='objInfo'><cite id='objClaim_"+e.id+"' class='objClaim'></cite> <cite id='objAge_"+e.id+"' class='objAge'></cite></span></div>",iconSize:[38,38],iconAnchor:[19,19]})}),W.bindMarkerZoomBehavior(t,"contextmenu"),e.Marker=t,W.Layer.Objective.addLayer(t);W.toggleLayer(W.Layer.Objective,!0);var i=W.Metadata.SpawnLabels;for(var a in W.Rotation){var r=W.Rotation[a],o=i[r];for(var s in o){var c=o[s];t=L.marker(W.convertGCtoLC(c),{icon:L.divIcon({className:"mapSec",html:"<span class='mapSecIn wvwSpawnLabel wvwColor"+s+"'><em class='wvwMapBonus'></em><var data-owner='"+s+"'></var></span>",iconSize:[128,64],iconAnchor:[64,32]})}),function(e,n){t.on("click",function(){$("#wvwZoneLink"+("Center"===e?"Center":n)).trigger("click")}),t.on("contextmenu",function(){W.goToDefault()})}(a,s),W.Layer.SpawnLabel.addLayer(t)}}W.toggleLayer(W.Layer.SpawnLabel,!0),W.toggleObjectiveLabels(),O.Options.bol_showWorldCompletionWvW===!1&&W.finishPopulation()},finishPopulation:function(){W.toggleSecondaries(),W.toggleWalls(),W.bindMapVisualChanges(),W.adjustZoomMapping(),W.executeURLCommands()},toggleSecondaries:function(e){if(O.Options.bol_showSecondaries&&0===W.Layer.Secondaries.getLayers().length){var t=function(e,t,n){if(void 0!==e)for(var a in e){var i=W.Metadata.Offsets[n],r=e[a],o=L.marker(W.convertGCtoLC([r[0]+i[0],r[1]+i[1]]),{clickable:!1,icon:L.icon({iconUrl:"img/wvw/secondaries/"+t+I.cPNG,iconSize:[32,32],iconAnchor:[16,16]}),opacity:.9});W.Layer.Secondaries.addLayer(o)}};for(var n in W.Rotation){var a=W.Rotation[n],i=W.Metadata.PlacementAssociation[a],r=W.Placement[i];t(r.ShrineEarth,"shrine_earth",a),t(r.ShrineFire,"shrine_fire",a),t(r.ShrineAir,"shrine_air",a),t(r.Sentry,"sentry",a),t(r.Depot,"depot",a)}e&&W.adjustZoomMapping()}W.toggleLayer(W.Layer.Secondaries,O.Options.bol_showSecondaries)},toggleWalls:function(e){var t="coral",n="orange",a="yellow";if(O.Options.bol_showDestructibles&&0===W.Layer.Destructible.getLayers().length){var i=function(e,t,n){var a=W.Metadata.Offsets[n];for(var i in e){var r=e[i],o=[r[0][0]+a[0],r[0][1]+a[1]],s=[r[1][0]+a[0],r[1][1]+a[1]],c=L.polyline(W.convertGCtoLCDual([o,s]),{clickable:!1,color:t,opacity:.8,weight:10,lineCap:"butt"});W.Layer.Destructible.addLayer(c)}};for(var r in W.Rotation){var o=W.Rotation[r],s=W.Metadata.PlacementAssociation[o],c=W.Placement[s];i(c.Barricade,t,o),i(c.Wall,n,o),i(c.Gate,a,o)}e&&W.adjustZoomMapping()}W.toggleLayer(W.Layer.Destructible,O.Options.bol_showDestructibles)},toggleObjectiveLabels:function(){$(".objInfo, .wvwSpawnLabel").toggle(O.Options.bol_showObjectiveLabels)},getName:function(e){return D.getObjectName(W.Metadata[e])},getNick:function(e){return D.getObjectNick(W.Metadata[e])},formatMatchup:function(e){var t,n,a,i,r,o=2,s=0,c=W.Metadata.Teams.length,l=W.Metadata.Teams,u=Array(c),d=Array(c),p=Array(c),h=Array(c),g=Array(c),m=Array(c),f={};if(f.id=s,e.wvw_match_id){s=e.wvw_match_id;for(var C=0;c>C;C++)t=l[C],a=e[t+"_world_id"],u[C]=[],u[C].push(W.Servers[a]);f.worlds=W.convertWorlds(e)}else{s=e.id;for(var v=e.all_worlds,C=0;c>C;C++){t=l[C],i=v[t],r=e.worlds[t],u[C]=[],u[C].push(W.Servers[r]);for(var b=0;b<i.length;b++)i[b]!==r&&u[C].push(W.Servers[i[b]])}f.worlds=e.worlds}var T=function(e){return U.escapeHTML(D.getObjectName(W.Servers[f.worlds[e]]))},S=W.getName("Borderlands");f.RedHome=D.orderModifier(S,T("red")),f.BlueHome=D.orderModifier(S,T("blue")),f.GreenHome=D.orderModifier(S,T("green")),f.Center=W.getName("Center");for(var C=0;c>C;C++){t=l[C],n=U.toFirstUpperCase(t),d[C]=[],p[C]=[],h[C]=[],g[C]=[],m[C]=D.getObjectName(W.Metadata[n]);for(var b=0;b<u[C].length;b++){var y=u[C][b];y.owner=n;var I=U.escapeHTML(D.getObjectName(y)),k=0===b&&u[C].length>1?"+":"";0===k.length&&u[C].length>=o||u[C].length>o?(d[C]+=D.getObjectNick(y)+k,h[C]+="<a href='?page=WvW&enu_Server="+y.id+"' title='"+I+"'>"+D.getObjectNick(y)+k+"</a>"):(d[C]+=I+k,h[C]+="<a href='?page=WvW&enu_Server="+y.id+"'>"+I+k+"</a>"),p[C]+=I+k,g[C]+=D.getObjectNick(y)+k,u[C].length>1&&b<u[C].length-1&&(d[C]+=" &amp; ",p[C]+="<br />",h[C]+=" &amp; ",g[C]+=" "),y.id===O.Options.enu_Server&&(f.oOwnerCurrent=n)}}for(var C=0;c>C;C++)t=l[C],f[t]={oServers:u[C],oNameStr:d[C],oNameLinesStr:p[C],oNameLinksStr:h[C],oNickStr:g[C],oColor:m[C]};return f},getTeamFromOwner:function(e){return W.MatchupCurrent[e.toLowerCase()]},getBorderlandsString:function(e,t){var n,a,i=t||{},r="string"==typeof e?W.Servers[W.MatchupCurrent.worlds[e]]:e,o=e.map_type;if(void 0!==o){var s=W.MapType[o];if("center"===s)return W.getNick("Center");r=W.Servers[W.MatchupCurrent.worlds[s]]}return n=i.aWantServerNick?D.getObjectNick(r):D.getObjectName(r),a=i.aWantBorderlandsNick?W.getNick("Borderlands"):W.getName("Borderlands"),i.aWantPronoun&&r.owner===W.MatchupCurrent.oOwnerCurrent?W.getName("Our")+" "+a:D.orderModifier(a,n)},getObjectiveNick:function(e,t){if(void 0!==e.direction){var n=t?W.getName(e.direction):W.getNick(e.direction),a=W.getName(e.type);return n+" "+a}return void 0!==e.alias?W.getName(e.alias):D.getObjectNick(e)},getObjectiveImage:function(e,t){var n=t||e.owner;return e.type===W.ObjectiveEnum.Ruins?"img/wvw/ruins/"+(e.direction+"_"+n).toLowerCase()+I.cPNG:"img/wvw/objectives/"+(e.type+"_"+n).toLowerCase()+I.cPNG},computeObjectivesValue:function(){var e,t,n=W.Metadata.ObjectiveType;for(var a in n)e=n[a].Value.Each,n[a].Value.Borderlands=n[a].Quantity.Borderlands*e,n[a].Value.Battlegrounds=n[a].Quantity.Battlegrounds*e,n[a].Value.All=(n[a].Value.Borderlands+n[a].Value.Battlegrounds)*W.cOWNERS_PER_TIER,t=n[a].Quantity.isUnique?e:0,W.cTOTAL_PPT_POSSIBLE+=n[a].Value.All+t},getObjectiveTypeValue:function(e){return W.Metadata.ObjectiveType[e].Value.Each},getMatchupTier:function(e){var t=W.isFallbackEnabled?"match_id":"id";return parseInt(e[t].split("-")[1])},generateServerList:function(){var e=[];for(var t in W.Servers)e.push(W.Servers[t]);U.sortObjects(e);var n,a,i,r=$("#wvwServerList");for(var t in e)n=e[t],a=D.getObjectName(n)+(n.suffix?" "+n.suffix:""),i=n.id===O.Options.enu_Server?"selected":"",r.append("<option value='"+n.id+"' "+i+">"+a+"</option>");r.change(function(){var e=$(this).val();O.Options.enu_Server=e,localStorage.enu_Server=O.Options.enu_Server,U.updateQueryString("enu_Server="+e),W.reinitializeServerChange()}),I.preventMapPropagation(r),I.blinkElement(r,5e3,250)},initializeLeaderboard:function(){$("#lboToggle").click(function(){$("#opt_bol_showLeaderboard").trigger("click")}),$("#lboCondense").click(function(){$("#opt_bol_condenseLeaderboard").trigger("click")}),$("#lboRegion").click(function(){W.toggleRegionLeaderboard()}),$("#lboStats").click(function(){W.generateStats()}),$("#lboOpaque").click(function(){$("#opt_bol_opaqueLeaderboard").trigger("click")}),$("#lboCountdown").click(function(){U.openExternalURL(W.LeaderboardURL[W.LocaleCurrent])}),W.toggleLeaderboard(),W.opaqueLeaderboard(),W.toggleLeaderboardWidth(),I.bindScrollbar("#lboOther")},toggleRegionLeaderboard:function(){var e=$("#lboOther");if(e.is(":empty")===!1||null===W.LocaleCurrent)return void e.animate({height:0},"fast",function(){e.empty().css({height:"auto"})});var t=W.Metadata.MatchIDs[W.LocaleCurrent];for(var n in t){var a=t[n],i=W.isFallbackEnabled?U.URL_API.MatchFallback+a:U.URL_API.Matches+a,r="lboOther_"+a;a!==W.MatchupIDCurrent&&(e.append("<div id='"+r+"'></div>"),function(e,t){$.getJSON(i,function(n){var a=W.formatMatchup(W.isFallbackEnabled?W.Matches[t]:n);W.insertScoreboard(n,a,$("#"+e)),W.readjustLeaderboard(),I.updateScrollbar("#lboOther")})}(r,a))}},insertScoreboard:function(e,t,n){var a,i,r,o,s,c,l,u,d=function(e){return W.isFallbackEnabled?{red:e[0],blue:e[1],green:e[2]}:e},p=t||W.MatchupCurrent,h=W.Metadata.Owners.length,g=W.getMatchupTier(e),m=d(e.scores),f={},C=!0;for(var v in W.Metadata.Owners){var b=W.Metadata.Owners[v];f[b]={},f[b].Total=0,f[b][W.LandEnum.RedHome]=0,f[b][W.LandEnum.BlueHome]=0,f[b][W.LandEnum.GreenHome]=0,f[b][W.LandEnum.Center]=0;for(var S in W.Metadata.Owners)f[b][W.LandEnum.Center+W.Metadata.Owners[S]]=0}for(var v in e.maps){a=e.maps[v],o=W.LandPrefix[a.type];for(var S in a.objectives)r=a.objectives[S],s=W.isFallbackEnabled?o+r.id:r.id,i=W.Objectives[s],b=r.owner,c=i.map_type,l=W.getObjectiveTypeValue(i.type),u=i.nativeowner,b!==W.OwnerEnum.Neutral&&(f[b].Total+=l,f[b][c]+=l,c===W.LandEnum.Center&&(f[b][W.LandEnum.Center+u]+=l))}var y;void 0===n?(y=$("#lboCurrent"),y.empty(),(I.ModeCurrent===I.ModeEnum.Overlay||I.isProgramEmbedded)&&(C=!1)):y=n;for(var k="<section>",v=0;h>v;v++){var b=W.Metadata.Owners[v],E=b.toLowerCase(),_=(g-1)*W.cOWNERS_PER_TIER+(v+1),P=C?"<aside class='lboRank'>"+_+".</aside><aside class='lboName'>&nbsp;"+p[E].oNameLinksStr+"</aside>":"",A=m[E],L=T.getMinMax(m).oMax,M=m[E]/L*T.cPERCENT_100,w=f[b].Total,N=w/W.cTOTAL_PPT_POSSIBLE*T.cPERCENT_100,x="";if(void 0!==e.kills&&W.isFallbackEnabled===!1){var R,B,H=void 0!==e.kills?e.kills[E]:"",G=void 0!==e.deaths?e.deaths[E]:"",z=T.parseRatio(H/G,3),F="",j=T.parseRatio(T.clampCeil(H/G,2)/2)*T.cPERCENT_100;e.maps.forEach(function(e){R=e.kills[E],B=e.deaths[E],F+="<dfn>"+R+" : "+B+" ("+T.parseRatio(R/B,3)+")</dfn> on "+p[e.type]+"<br />"}),x="<aside class='lboKD' title='<dfn>Kills to Deaths ratio: "+z+"</dfn><br />"+F+"'><var class='lboKills'>"+H.toLocaleString()+"</var><samp><s style='width:"+j+"%'><mark></mark></s></samp><var class='lboDeaths'>"+G.toLocaleString()+"</var></aside>"}for(var Z=[],K=[],q=[],S=0;h>S;S++){var X=W.Metadata.Owners[S],V=X.toLowerCase();if(X!==b){var J=f[b][X+"Home"]+f[b][W.LandEnum.Center+X];Z.push(J);var Q=A-m[V];K.push(Q);var Y=W.Servers[p.worlds[V]];q.push(U.escapeHTML(D.getObjectName(Y)))}}var et,tt,nt=Z[0]+Z[1],at="";nt>0?(et=Math.round(Z[0]/nt*T.cPERCENT_100),tt=Math.round(Z[1]/nt*T.cPERCENT_100)):(et=0,tt=0,at="lboFocusZero");var it,rt;for(var S in e.maps){var a=e.maps[S],ot=d(a.scores);switch(a.type){case W.Metadata.Opposites[b][0]+"Home":it=ot[E];break;case W.Metadata.Opposites[b][1]+"Home":rt=ot[E]}}var st,ct,lt=it+rt,ut="";lt>0?(st=Math.round(it/lt*T.cPERCENT_100),ct=Math.round(rt/lt*T.cPERCENT_100)):(st=0,ct=0,ut="lboFocusZero"),k+="<article class='lboServer lboServer"+b+"'>"+P+"<aside class='lboScore' title='<dfn>"+K[0]+" points</dfn> away from "+q[0]+"<br /><dfn>"+K[1]+" points</dfn> away from "+q[1]+"'><var>"+A.toLocaleString()+"</var><samp><s style='width:"+M+"%'></s></samp></aside><aside class='lboPPT' title='<dfn>Points-Per-Tick (PPT)</dfn>'><samp><s style='width:"+N+"%'></s></samp><var>+"+w+"</var></aside><aside class='lboLand' title='<dfn>PPT per borderlands</dfn>'><var class='lboPPTGreen'>+"+f[b][W.LandEnum.GreenHome]+"</var><var class='lboPPTBlue'>+"+f[b][W.LandEnum.BlueHome]+"</var><var class='lboPPTRed'>+"+f[b][W.LandEnum.RedHome]+"</var><var class='lboPPTCenter'>+"+f[b][W.LandEnum.Center]+"</var></aside>"+x+"<aside class='lboFocus lboFocus"+b+"' title='<dfn>Server Focus (PPT Now)</dfn><br /><dfn>"+Z[0]+" PPT</dfn> earnable from "+q[0]+" native objectives<br /><dfn>"+Z[1]+" PPT</dfn> earnable from "+q[1]+" native objectives'><var class='lboFocusA'>"+et+"%</var><samp class='"+at+"'><s style='width:"+et+"%'><mark></mark></s></samp><var class='lboFocusB'>"+tt+"%</var></aside><aside class='lboFocus lboFocus"+b+"' title='<dfn>Server Focus (Points Matchup)</dfn><br /><dfn>"+it+" points</dfn> earned from "+q[0]+" Borderlands<br /><dfn>"+rt+" points</dfn> earned from "+q[1]+" Borderlands'><var class='lboFocusA'>"+st+"%</var><samp class='"+ut+"'><s style='width:"+st+"%'><mark></mark></s></samp><var class='lboFocusB'>"+ct+"%</var></aside></article>"}k+="</section>",y.append(k),I.qTip.init(y.find("aside, a")),O.Options.bol_condenseLeaderboard&&W.toggleLeaderboardWidth()},toggleLeaderboard:function(){O.Options.bol_showLeaderboard?(W.updateObjectives(),$("#lboCurrent, #lboOther").show("fast",function(){$("#lboContainer").css({padding:"8px"})}),$(".lboExtra").show()):($("#lboCurrent, #lboOther").hide("fast",function(){$("#lboContainer").css({padding:0})}),$(".lboExtra").hide())},opaqueLeaderboard:function(){I.toggleHUDOpacity("#lboContainer","lbo",O.Options.bol_opaqueLeaderboard)},toggleLeaderboardWidth:function(e){var t=!O.Options.bol_condenseLeaderboard,n=$(".lboRank, .lboLand, .lboFocus");e?t?n.show("fast"):n.hide("fast"):n.toggle(t)},readjustLeaderboard:function(){$("#lboOther").css({maxHeight:$(window).height()-2*$("#lboCurrent").height()})},generateStats:function(){I.isConsoleShown()||(I.print(I.cThrobber,!0),E.updateCoinInGem(function(){$.getJSON(U.getAPI("worlds?ids=all"),function(e){e.forEach(function(e){e.sortablePopulation=W.Metadata.PopulationPercent[e.population]}),U.sortObjects(e,{aKeyName:"sortablePopulation",aIsDescending:!0});var t="<table id='wvwStats' class='cssStats'>";t+="<thead><tr><th>Server</th><th>ID</th><th>Population</th><th>Transfer</th><th>Conversion</th></tr></thead><tbody>",e.forEach(function(e){if((""+e.id).charAt(0)===W.LocaleThreshold[W.LocaleCurrent+"Prefix"]){var n=U.escapeHTML(D.getObjectName(W.Servers[e.id])),a=W.Metadata.PopulationTransfer[e.population];t+="<tr><td><a class='wvwStatsLink wvwPopulation_"+U.escapeHTML(e.population)+"' href='?page=WvW&enu_Server="+e.id+"'>"+n+"</a></td><td>"+e.id+"</td><td>"+I.getBar(W.Metadata.PopulationPercent[e.population])+"</td><td>"+E.formatGemString(a,!0)+"</td><td>"+E.formatGemToCoin(a)+"</td></tr>"}}),t+="</tbody></table>",I.print(t,!0)})}))},initializeLog:function(){$("#wvwLogContainer").show(),$("#logWindow").data("oldHeight",$("#logWindow").height()),$("#logToggle").click(function(){$("#opt_bol_showLog").trigger("click")}),$("#logExpand").click(function(){$("#opt_bol_maximizeLog").trigger("click")}),$("#logOpaque").click(function(){$("#opt_bol_opaqueLog").trigger("click")}),W.toggleLog(),W.opaqueLog(),W.toggleLogHeight(),I.bindScrollbar("#logWindow"),I.loadImg($("#wvwLog")),O.mimicInput("#wvwZoomInput","int_setInitialZoomWvW");for(var e in W.MapType)!function(e){$("#opt_bol_log"+e).change(function(){O.Options["bol_log"+e]?$(".logEntry"+e).show("fast",function(){I.updateScrollbar("#logWindow")}):$(".logEntry"+e).hide("fast",function(){I.updateScrollbar("#logWindow")})}).parent().dblclick(function(){$("#logFilters input:checkbox").each(function(){X.setCheckboxEnumState($(this),X.ChecklistEnum.Unchecked)}),X.setCheckboxEnumState($("#opt_bol_log"+e),X.ChecklistEnum.Checked)})}(e);var t=W.getName("Borderlands");$("#opt_bol_narrateRedHome").next().html(D.orderModifier(t,W.getName("Red"))),$("#opt_bol_narrateBlueHome").next().html(D.orderModifier(t,W.getName("Blue"))),$("#opt_bol_narrateGreenHome").next().html(D.orderModifier(t,W.getName("Green"))),$("#opt_bol_narrateCenter").next().html(W.getName("Center")),$("#opt_bol_narrateRuins").next().html(W.getName("Ruins")),$("#opt_bol_narrateCamp").next().html(W.getName("Camp")),$("#opt_bol_narrateTower").next().html(W.getName("Tower")),$("#opt_bol_narrateKeep").next().html(W.getName("Keep")),$("#opt_bol_narrateCastle").next().html(W.getName("Castle")),$("#opt_bol_narrateClaimed").next().html(W.getName("Claimed")),I.preventMapPropagation(O.mimicInput("#logNarrateVolume","int_setVolume")),O.Enact.bol_logNarrate(),$("#logTime").click(function(){$("#opt_bol_use24Hour").trigger("click"),$("#logWindow li time").each(function(){var e=T.getTimeFormatted({aCustomTimeInDate:new Date($(this).attr("data-time"))});$(this).html(e)})})},toggleLog:function(){O.Options.bol_showLog?$("#wvwLog, .logExtra").show("fast"):$("#wvwLog, .logExtra").hide("fast")},opaqueLog:function(){I.toggleHUDOpacity("#wvwLog","log",O.Options.bol_opaqueLog)},toggleLogHeight:function(){var e=$("#logWindow"),t=$(window).height(),n=e.data("oldHeight"),a=t-(n+$("#logOptions").height());O.Options.bol_maximizeLog?e.show().animate({height:a},200,function(){I.updateScrollbar(e),O.Options.bol_maximizeLog=!0}):e.show().animate({height:n},200,function(){I.updateScrollbar(e),O.Options.bol_maximizeLog=!1})},readjustLog:function(){$("#wvwLog").height()>$(window).height()&&$("#logExpand").trigger("click").trigger("click")},addLogEntry:function(e,t,n,a){e=e||"",t=t||"";var i="";void 0===n?(i=T.getTimeFormatted(),n=(new Date).toISOString()):i=T.getTimeFormatted({aCustomTimeInDate:new Date(n)});var r=$("<li class='logEntry "+t+"'><time data-time='"+n+"'>"+i+"</time><span>"+e+"</span></li>").prependTo("#logWindow");if(this.bindMapLinkBehavior(r.find("dfn")),a===!1)r.hide();else{var o=r.width();r.css({width:0}).animate({width:o},400,function(){$(this).removeAttr("style")})}var s=$(".logEntry");s.length>O.Options.int_numLogEntries&&s.last().remove(),I.updateScrollbar("#logWindow")},addLogEntryObjective:function(e,t){var n,a="<img src='"+W.getObjectiveImage(e,e.prevowner)+"' />",i="<img src='"+W.getObjectiveImage(e,e.owner)+"' />",r=W.getObjectiveNick(e,!1);t?(a=i,i="<cite>["+e.tag+"]</cite>",n=e.claimed_at):n=e.last_flipped;var o=a+" ⇒ "+i+" <dfn data-coord='"+e.coord+"'>"+r+"</dfn>",s=e.map_type,c="logEntry"+s;t||(e.prevownerhtml=o);var l=!0;(s===W.LandEnum.RedHome&&O.Options.bol_logRedHome===!1||s===W.LandEnum.BlueHome&&O.Options.bol_logGreenHome===!1||s===W.LandEnum.GreenHome&&O.Options.bol_logBlueHome===!1||s===W.LandEnum.Center&&O.Options.bol_logCenter===!1)&&(l=!1),W.addLogEntry(o,c,n,l),O.Options.bol_logNarrate&&W.narrateLog(e,t)},narrateLog:function(e,t){var n=e.map_type,a=e.type;if(!(t&&O.Options.bol_narrateClaimed===!1||n===W.LandEnum.RedHome&&O.Options.bol_narrateRedHome===!1||n===W.LandEnum.BlueHome&&O.Options.bol_narrateBlueHome===!1||n===W.LandEnum.GreenHome&&O.Options.bol_narrateGreenHome===!1||n===W.LandEnum.Center&&O.Options.bol_narrateCenter===!1||a===W.ObjectiveEnum.Ruins&&O.Options.bol_narrateRuins===!1||a===W.ObjectiveEnum.Camp&&O.Options.bol_narrateCamp===!1||a===W.ObjectiveEnum.Tower&&O.Options.bol_narrateTower===!1||a===W.ObjectiveEnum.Keep&&O.Options.bol_narrateKeep===!1||a===W.ObjectiveEnum.Castle&&O.Options.bol_narrateCastle===!1)){var i,r=W.getObjectiveNick(e,!0);
i=t?D.getSpeechInitials(e.tag):e.owner===W.MatchupCurrent.oOwnerCurrent?W.getName("Us"):W.getTeamFromOwner(e.owner).oColor;var o,s=$("#logNarrateLand input:checked").length>1?W.getBorderlandsString(e,{aWantPronoun:!0})+". ":"";o=W.getName(t?"Claimed":e.owner===e.nativeowner?"Retaken":"Captured");var c=s+r,l=o+" "+i;D.speak(c),D.speak(l)}},initializeSupplyCalculator:function(){var e=function(e,t){var n=e.html();if(n=""===n?0:parseInt(n),t>=0||0!==n){var a=0>t?-1:1;W.numSiegeSupply+=t,$("#splNeed").html(W.numSiegeSupply);var i=n+a;0===i?(e.removeClass("splAdded"),i=""):e.addClass("splAdded"),e.html(i)}};I.preventMapPropagation("#wvwSupply");for(var t in W.Metadata.Blueprints)for(var n in W.Weapons)if("field"===W.Weapons[n].type){var a=W.Metadata.Blueprints[t],i=$("<ins class='spl spl_"+a.toLowerCase()+"_"+n+"'></ins>"),r=W.Weapons[n].supply[t];$("#splBlueprints"+a).append(i),function(t){i.click(function(){e($(this),t),$("#splHave").trigger("input")}),i.contextmenu(function(){return e($(this),-1*t),$("#splHave").trigger("input"),!1})}(r)}$("#splReset").click(function(){$("#splBlueprints ins").html("").removeClass("splAdded"),$("#splNeed").html("0"),W.numSiegeSupply=0,$("#splHave").trigger("input")}),$("#splHave").click(function(){$(this).select()}).on("input",function(){var e=T.parseQuantity($(this).val(),0)-W.numSiegeSupply,t=$("#splRemain").html(e);I.colorizeValue(t,e)})},updateParticipants:function(){null!==W.MatchupCurrent&&($("#opt_bol_logRedHome").next().html(W.MatchupCurrent.red.oNameStr),$("#opt_bol_logBlueHome").next().html(W.MatchupCurrent.blue.oNameStr),$("#opt_bol_logGreenHome").next().html(W.MatchupCurrent.green.oNameStr),$("#opt_bol_logCenter").next().html(W.getName("Center")),$("#wvwZoneLinkRed").html(W.MatchupCurrent.red.oNameStr),$("#wvwZoneLinkBlue").html(W.MatchupCurrent.blue.oNameStr),$("#wvwZoneLinkGreen").html(W.MatchupCurrent.green.oNameStr),W.addLogEntry($("#wvwHelpLinks").html()+"<br /><br />"),W.addLogEntry(W.MatchupCurrent.green.oNickStr+" : "+W.MatchupCurrent.blue.oNickStr+" : "+W.MatchupCurrent.red.oNickStr),$(".wvwSpawnLabel").find("var").each(function(){var e=$(this).attr("data-owner").toLowerCase(),t=W.MatchupCurrent[e].oNameLinesStr;$(this).html(t)}))},reinitializeServerChange:function(e){for(var t in W.Objectives){var n=W.Objectives[t];n.isImmune=!1,n.owner=null,n.last_flipped=null,n.last_flipped_msec=null,n.claimed_by="none",n.claimed_at=null,n.prevownerhtml=null}W.LocaleCurrent=O.Options.enu_Server<W.LocaleThreshold.Europe?W.LocaleEnum.Americas:W.LocaleEnum.Europe,W.MatchupIDCurrent=null,W.MatchStartTimeMS=null,W.MatchFinishTimeMS=null,W.MatchFinishTimeISO=null,W.MatchupCurrent=null,$(".objUmbrellaContainer").hide(),$(".objTimer").empty(),$(".objProgressBar").hide(),$("#lboCurrent").empty().append(I.cThrobber),$("#lboOther").empty(),e!==!1&&$("#logWindow").empty(),W.toggleObjectiveTick(!1),W.toggleObjectiveTick(!0)},updateObjectives:function(){var e=3,t=(new Date).getTime(),n=function(){W.numFailedAPICalls=0,W.isAPIFailed=!1,W.isFallbackEnabled=!1,I.write("WvW data connection reestablished at "+T.getTimeFormatted())};W.isFallbackEnabled&&W.updateObjectivesFallback(),$.ajax({dataType:"json",url:U.URL_API.Match+O.Options.enu_Server,cache:!1,success:function(e){if(W.isFallbackEnabled)return n(),void W.reinitializeServerChange(!1);W.MatchFinishTimeISO!==e.end_time&&(W.MatchFinishTimeISO=e.end_time,W.MatchStartTimeMS=new Date(e.start_time).getTime(),W.MatchFinishTimeMS=new Date(e.end_time).getTime(),W.secTillWvWReset=~~((W.MatchFinishTimeMS-t)/T.cMSECONDS_IN_SECOND),W.MatchupIDCurrent=e.id,W.MatchupCurrent=W.formatMatchup(e),W.updateParticipants()),O.Options.bol_showLeaderboard&&W.insertScoreboard(e);var a,i,r,o=0,s=12,c=!1,l=t<W.MatchStartTimeMS+W.cMSECONDS_RESET_GRACE;for(var u in e.maps){a=e.maps[u];for(var d in a.objectives)if(r=a.objectives[d],i=W.Objectives[r.id],i.last_flipped!==r.last_flipped&&(null!==i.last_flipped&&o++,i.last_flipped=r.last_flipped,i.last_flipped_msec=new Date(r.last_flipped).getTime(),i.prevowner=i.owner,i.owner=r.owner,W.updateObjectiveIcon(i),W.updateObjectiveAge(i),W.updateObjectiveTooltip(i),t-i.last_flipped_msec<W.cMSECONDS_IMMUNITY&&i.owner!==W.OwnerEnum.Neutral&&i.type!==W.ObjectiveEnum.Ruins&&!l&&(W.Objectives[i.id].isImmune=!0,$("#objProgressBar_"+i.id).show().find("var").css({width:"0%"}).animate({width:"100%"},800))),i.claimed_by!==r.claimed_by&&(i.prevclaimed_by=i.claimed_by,i.claimed_by=r.claimed_by,i.claimed_at=r.claimed_at,W.updateObjectiveClaim(i)),o>s){c=!0;break}if(o>s){c=!0;break}}c&&(D.stopSpeech(),W.reinitializeServerChange(!1),W.addLogEntry("Restarted due to API error."),I.write("Too many objectives updated. ArenaNet API server may be having problems.")),W.isAPIFailed&&n()}}).fail(function(){if(W.isFallbackEnabled===!1)if(W.numFailedAPICalls++,W.numFailedAPICalls>e)W.isFallbackEnabled=!0,W.updateObjectives(),I.print("Too many failed API retrievals. Switched to backup API server.");else if(W.isAPIFailed===!1){W.isAPIFailed=!0;var t=null!==W.secTillWvWReset&&W.secTillWvWReset<10*T.cSECONDS_IN_MINUTE?"WvW reset is happening soon.":"The map will refresh automatically when ArenaNet servers are back online.";I.print("Unable to retrieve WvW data during "+T.getTimeFormatted()+". Please wait...<br />"+t)}})},convertWorlds:function(e){return{red:e.red_world_id,blue:e.blue_world_id,green:e.green_world_id}},updateObjectivesFallback:function(){var e=new Date,t=e.toISOString(),n=e.getTime();$.ajax(null===W.MatchupIDCurrent||null===W.Matches?{dataType:"json",url:U.URL_API.MatchesFallback,cache:!1,success:function(e){if(W.isFallbackEnabled!==!1){W.Matches={};for(var t in e.wvw_matches){var a=e.wvw_matches[t],i=parseInt(O.Options.enu_Server);W.Matches[a.wvw_match_id]=a,(a.red_world_id===i||a.blue_world_id===i||a.green_world_id===i)&&(W.MatchupIDCurrent=a.wvw_match_id,W.MatchStartTimeMS=new Date(e.start_time).getTime(),W.MatchFinishTimeMS=new Date(e.end_time).getTime(),W.secTillWvWReset=~~((W.MatchFinishTimeMS-n)/T.cMSECONDS_IN_SECOND),W.MatchupCurrent=W.formatMatchup(W.Matches[W.MatchupIDCurrent]),W.updateParticipants(),W.updateObjectivesFallback())}}}}:{dataType:"json",url:U.URL_API.MatchFallback+W.MatchupIDCurrent,cache:!1,success:function(e){if(W.isFallbackEnabled!==!1){var a,i,r,o,s=new Date(n-W.cMSECONDS_IMMUNITY),c=new Date(n-O.Options.int_secWvWRefresh*T.cMSECONDS_IN_SECOND);for(var l in e.maps){a=e.maps[l],o=W.LandPrefix[a.type];for(var u in a.objectives){r=a.objectives[u],i=W.Objectives[o+r.id];var d=null===i.owner?s:c;i.owner!==r.owner&&(i.last_flipped=d.toISOString(),i.last_flipped_msec=d.getTime(),i.prevowner=i.owner,i.owner=r.owner,W.updateObjectiveIcon(i),W.updateObjectiveAge(i),W.updateObjectiveTooltip(i),n-i.last_flipped_msec<W.cMSECONDS_IMMUNITY&&i.owner!==W.OwnerEnum.Neutral&&(W.Objectives[i.id].isImmune=!0,$("#objProgressBar_"+i.id).show().find("var").css({width:"0%"}).animate({width:"100%"},800))),i.claimed_by!==r.owner_guild&&(i.prevclaimed_by=i.claimed_by,i.claimed_by=r.owner_guild,i.claimed_at=t,W.updateObjectiveClaim(i))}}O.Options.bol_showLeaderboard&&W.insertScoreboard(e)}}})},updateObjectiveIcon:function(e){var t=2e3,n=$("#objUmbrella_"+e.id),a=$("#objIcon_"+e.id),i=a.css("width");if(null!==e.prevowner&&e.owner!==W.OwnerEnum.Neutral){var r=W.Metadata[e.prevowner].color,o=W.Metadata[e.owner].color;n.parent().parent().show(),n.css({borderColor:r,boxShadow:"0px 0px 10px "+r}),I.bloatElement(n,1e3,100),function(n,r,o){a.css({width:i}).animate({width:0},t,function(){r.css({borderColor:o,boxShadow:"0px 0px 10px "+o}),$(this).attr("src",W.getObjectiveImage(e)).animate({width:i},t,function(){r.parent().parent().hide(),W.adjustZoomMapping()})})}(e.owner,n,o),W.addLogEntryObjective(e)}else a.attr("src",W.getObjectiveImage(e))},updateObjectiveTimers:function(){var e,t,n,a,i=(new Date).getTime(),r=3e4;for(var o in W.Objectives)e=W.Objectives[o],e.isImmune&&(t=i-e.last_flipped_msec,n=W.cMSECONDS_IMMUNITY-t,a=n/W.cMSECONDS_IMMUNITY*T.cPERCENT_100,n>0&&t+r>0?(document.getElementById("objTimer_"+e.id).innerHTML=T.formatTimeColon(n),document.getElementById("objProgress_"+e.id).style.width=a+"%"):t+r>0?($("#objTimer_"+e.id).html(""),$("#objProgressBar_"+e.id).css({opacity:1}).animate({opacity:0},2e3,function(){$(this).css({opacity:1}).hide()}),$("#objIcon_"+e.id).css({opacity:0}).animate({opacity:1},2e3),e.isImmune=!1,W.updateObjectiveAge(e)):T.isTimeOutOfSync===!1&&(W.addLogEntry("Negative time detected. Your computer's time may be <a"+U.convertExternalAnchor("https://www.google.com/search?q=synchronize+time")+">out of sync!</a>"),T.isTimeOutOfSync=!0))},updateObjectiveAge:function(e){if(e.last_flipped_msec){var t=(new Date).getTime()-e.last_flipped_msec;$("#objAge_"+e.id).html(T.getShorthandTime(t))}},updateAllObjectiveAge:function(){for(var e in W.Objectives)W.updateObjectiveAge(W.Objectives[e])},updateObjectiveClaim:function(e){var t=e.claimed_by,n=function(){var n=W.Guilds[t];e.guild_name=n.guild_name,e.tag=n.tag,W.updateObjectiveTooltip(e);var a=$("#objClaim_"+e.id),i=a.css("color");a.html("["+e.tag+"]"),"none"!==e.prevclaimed_by&&(I.blinkElement(a,2e3,200),a.css({color:"#ffffff"}).animate({color:i},4e3),W.addLogEntryObjective(e,!0))};null===t||void 0===t?(e.guild_name=null,e.tag=null,W.updateObjectiveTooltip(e),$("#objClaim_"+e.id).empty()):void 0!==W.Guilds[t]?n():$.getJSON(U.URL_API.GuildDetails+t,function(e){W.Guilds[t]=e,n()})},updateObjectiveTooltip:function(e){var t=e,n=$("#objIcon_"+t.id),a="";null!==t.claimed_by&&(a="<aside><dfn>Claim:</dfn> "+new Date(t.claimed_at).toLocaleString()+"</aside><aside><dfn>Guild:</dfn> "+U.escapeHTML(t.guild_name+" ["+t.tag+"]")+"</aside><aside class='cssCenter'><img class='objTooltipBanner' src='"+U.getGuildBannerURL(t.guild_name)+"' /></aside>");var i="<div class='objTooltip'><aside><dfn class='objTooltipName'>"+D.getObjectName(t)+"</dfn></aside><aside class='cntDivider objTooltipDivider'></aside><aside><dfn>Owner:</dfn> "+new Date(t.last_flipped).toLocaleString()+"</aside>"+(e.prevownerhtml?"<aside class='cssCenter'>"+e.prevownerhtml+"</aside>":"")+a+"</div>";I.qTip.init(n.attr("title",i))},toggleObjectiveTick:function(e){e?(W.isObjectiveTickEnabled=e,W.tickObjectives(),W.isObjectiveTimerTickEnabled=e):(window.clearTimeout(W.ObjectiveTimeout),W.isObjectiveTickEnabled=e,W.isObjectiveTimerTickEnabled=e)},tickObjectives:function(){W.isObjectiveTickEnabled&&(W.updateObjectives(),window.clearTimeout(W.ObjectiveTimeout),W.ObjectiveTimeout=setTimeout(function(){W.tickObjectives()},O.Options.int_secWvWRefresh*T.cMSECONDS_IN_SECOND))}},T={Daily:GW2T_DAILY_DATA,DailyAssociation:GW2T_DAILY_ASSOCIATION,DailyToday:null,DailyTomorrow:null,Schedule:{},DryTopSets:{},DryTopCodes:{},DST_IN_EFFECT:0,SECONDS_TILL_DAILY:0,SECONDS_TILL_WEEKLY:0,TIMESTAMP_UNIX_SECONDS:0,cUTC_OFFSET_USER:0,cUTC_OFFSET_SERVER:-8,cUTC_OFFSET_HAWAII:-10,cUTC_OFFSET_EASTERN:-4,cMSECONDS_IN_SECOND:1e3,cMSECONDS_IN_MINUTE:6e4,cMSECONDS_IN_DAY:864e5,cSECONDS_IN_MINUTE:60,cSECONDS_IN_HOUR:3600,cSECONDS_IN_DAY:86400,cSECONDS_IN_WEEK:604800,cSECONDS_IN_MONTH:2592e3,cSECONDS_IN_YEAR:31536e3,cMINUTES_IN_HOUR:60,cMINUTES_IN_2_HOURS:120,cMINUTES_IN_DAY:1440,cHOURS_IN_MERIDIEM:12,cHOURS_IN_DAY:24,cDAYS_IN_WEEK:7,cDAYS_IN_BIWEEK:14,cDAYS_IN_MONTH:30,cDAYS_IN_YEAR:365,cSECONDS_IN_TIMEFRAME:900,cMINUTES_IN_TIMEFRAME:15,cMINUTES_IN_MINIFRAME:5,cNUM_TIMEFRAMES_IN_HOUR:4,cSECS_MARK_0:0,cSECS_MARK_1:900,cSECS_MARK_2:1800,cSECS_MARK_3:2700,cSECS_MARK_4:3599,cBASE_10:10,cBASE_16:16,cPERCENT_100:100,cCIRCLE_RIGHT_DEGREE:90,cCIRCLE_HALF_DEGREE:180,cCIRCLE_FULL_DEGREE:360,cRADIAN_TO_DEGREE:180/Math.PI,cUNITS_TO_POINTS:1/24,cPOINTS_TO_UNITS:24,cUNITS_TO_METERS:.0254,cMETERS_TO_UNITS:1/.0254,cUNITS_PER_SECOND:386,cWEEKLY_RESET_SECONDS:113400,cDAYTIME_DAY_MINUTES:80,cDAYTIME_NIGHT_MINUTES:40,cDAYTIME_DAY_START:25,cDAYTIME_NIGHT_START:45,cDAYTIME_TRANSITION_MINUTES:5,ReferenceEnum:{UTC:0,Local:1,Server:2},UnitEnum:{Milliseconds:0,Seconds:1,Minutes:2,Hours:3},DayEnum:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},isTimeOutOfSync:!1,secondsTillResetWeekly:-1,isChecklistCountdownsStarted:!1,getCurrentDryTopEvents:function(e){return T.DryTopCodes[T.getDryTopMinute(e)].chat+I.siteTagCurrent},getCurrentDryTopColor:function(e){return T.DryTopCodes[T.getDryTopMinute(e)].color},getDryTopMinute:function(e){e=e||0;var t=new Date,n=t.getUTCMinutes(),a=~~(n/T.cMINUTES_IN_MINIFRAME)*T.cMINUTES_IN_MINIFRAME+e*T.cMINUTES_IN_MINIFRAME;return a=T.wrapInteger(a,T.cMINUTES_IN_HOUR),a<T.cBASE_10&&(a="0"+a),a},initializeDryTopStrings:function(){var e=function(e){var t=T.DryTopSets[e],n="";for(var a in t)n+=D.getObjectName(t[a])+"@"+t[a].wp+" ";return n.trim()};T.DryTopSets=GW2T_DRYTOP_SETS,T.DryTopCodes=GW2T_DRYTOP_CODES;for(var t in T.DryTopCodes)T.DryTopCodes[t].chat+=e(T.DryTopCodes[t].set);K.updateDryTopClipboard(),$("#itemDryTopClip").show()},initializeScheduleSlot:function(e){void 0===T.Schedule[e]&&(T.Schedule[e]={SchedTime:e,SchedChains:[]})},insertChainToSchedule:function(e){var t=0,n=e.timing;if(Array.isArray(n))for(var a in n)t=T.parseChainTime(n[a]),T.initializeScheduleSlot(t),T.Schedule[t].SchedChains.push(e);else for(t=n.hourInitial*T.cMINUTES_IN_HOUR+n.minuteOffset;t<T.cMINUTES_IN_DAY;t+=n.hourMultiplier*T.cMINUTES_IN_HOUR)T.initializeScheduleSlot(t),T.Schedule[t].SchedChains.push(e)},initializeSchedule:function(){var e,t,n,a;H.Story.isEnabled&&T.isTimely(H.Story,new Date)&&(H.isStoryEnabled=!0,(I.isProgramEmbedded||I.ModeCurrent!==I.ModeEnum.Website||O.Options.bol_showHUD===!1||O.Options.bol_showDashboard===!1)&&(H.isStoryDashboard=!1)),D.isLanguageLogographic()&&(C.cEventCharLimit=C.cEventCharLimitLogographic),X.initializeChecklist(X.Checklists.Chain,C.Chains.length+C.UnscheduledChainsLength),X.initializeChecklist(X.Checklists.ChainSubscription,C.Chains.length+C.UnscheduledChainsLength),C.initializeScheduledChains(),I.initializeChainsUI(),$("#sectionChains_Scheduled .chnBar h1, #sectionChains_Drytop .chnBar h1, #dsbStory .chnBar h1").addClass("chnTitleFutureFar");for(e in C.ScheduledChains)T.insertChainToSchedule(C.ScheduledChains[e]);for(e in T.Schedule){a=T.Schedule[e];for(t in C.ScheduledChains)for(n in a.SchedChains)if(C.ScheduledChains[t].nexus===a.SchedChains[n].nexus){C.ScheduledChains[t].scheduleKeys.push(e);break}}C.CurrentChainSD=T.getStandardChain(),O.Options.bol_showTimeline&&(H.updateTimelineSegments(!0),H.updateTimelineIndicator())},getScheduleSlotTime:function(e){return T.Schedule[e].SchedTime},getScheduleSlotChainsByKey:function(e){return T.Schedule[e].SchedChains},getCurrentTimeframe:function(){var e=T.getTimeSinceMidnight(T.ReferenceEnum.UTC,T.UnitEnum.Minutes);return e-e%T.cMINUTES_IN_TIMEFRAME},getTimeframe:function(e){e=e||0;var t=T.getCurrentTimeframe()+e*T.cMINUTES_IN_TIMEFRAME;return T.wrapInteger(t,T.cMINUTES_IN_DAY)},getTimeframeChains:function(e){return T.Schedule[T.getTimeframe(e)].SchedChains},getTimeframeChainBySeries:function(e,t){var n=T.getTimeframeChains(e);for(var a in n)if(n[a].series===t)return n[a];return null},getTimeframeChainsBySeries:function(e,t){var n=T.getTimeframeChains(e),a=[];for(var i in n)n[i].series===t&&a.push(n[i]);return a},getStandardChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.Standard)},getHardcoreChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.Hardcore)},getLivingStoryChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.LivingStory)},getMiscellaneousChains:function(e){return T.getTimeframeChainsBySeries(e,C.ChainSeriesEnum.Miscellaneous)},getTimeframeKey:function(e){return""+T.getTimeframe(e)},convertScheduleKeyToLocalSeconds:function(e){var t=T.getScheduleSlotTime(e)*T.cSECONDS_IN_MINUTE-(new Date).getTimezoneOffset()*T.cSECONDS_IN_MINUTE;return T.wrapInteger(t,T.cSECONDS_IN_DAY)},convertScheduleKeyToUTCMinutes:function(e){return parseInt(e)},getCurrentTimeframeElapsedTime:function(e){var t=new Date,n=t.getUTCMinutes(),a=t.getUTCSeconds();return e===T.UnitEnum.Minutes?n%T.cMINUTES_IN_TIMEFRAME:n%T.cMINUTES_IN_TIMEFRAME*T.cSECONDS_IN_MINUTE+a},getSecondsUntilChainStarts:function(e){var t=T.convertScheduleKeyToLocalSeconds(e.scheduleKeys[0]),n=T.getTimeSinceMidnight(T.ReferenceEnum.Local,T.UnitEnum.Seconds),a=T.cSECONDS_IN_TIMEFRAME*T.cNUM_TIMEFRAMES_IN_HOUR;return t<T.cSECONDS_IN_DAY-a||n>a?n<T.cSECONDS_IN_DAY-a||t>a?t-n:T.cSECONDS_IN_DAY-n+t:T.cSECONDS_IN_DAY-t+n},getTimeTillChainFormatted:function(e,t){var n=T.getSecondsUntilChainStarts(e),a=~~(n/T.cSECONDS_IN_MINUTE)%T.cSECONDS_IN_MINUTE,i=~~(n/T.cSECONDS_IN_HOUR),r=D.getTranslation("m"),o=D.getTranslation("h");return"speech"===t&&(r=" "+D.getSpeechWord("minute"),o=" "+D.getSpeechWord("hour"),Math.abs(a)>1&&(r=" "+D.getSpeechWord("minutes")),Math.abs(i)>1&&(o=" "+D.getSpeechWord("hours")),0===i&&30===Math.abs(a)&&(a=D.getTranslation("half an hour"),r="",o="")),o+=" ",a+=r,Math.abs(n)<T.cSECONDS_IN_HOUR?i="":i+=o,0>n?" "+i+a+" "+D.getTranslation("ago"):" "+D.getTranslation("in")+" "+i+a},getRandomIntRange:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getMinMax:function(e,t){var n,a=!(void 0===t),i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=null,s=null;for(var c in e)n=a?e[c][t]:e[c],i>n&&(i=n,o=c),n>r&&(r=n,s=c);return{oMin:i,oMax:r,oMinKey:o,oMaxKey:s}},wrapInteger:function(e,t,n){var a=e;return n&&e/t===0?e:(a%=t,0>a&&(a=t+a),a)},clampInteger:function(e,t,n){return t>e?t:e>n?n:e},clampFloor:function(e,t){return T.clampInteger(e,t,Number.POSITIVE_INFINITY)},clampCeil:function(e,t){return T.clampInteger(e,Number.NEGATIVE_INFINITY,t)},stepFunction:function(e,t,n,a,i){var r=~~(e/a)*i+t;return r>n?n:r},parseQuantity:function(e,t){void 0===t&&(t=1);var n=parseInt(e);return isFinite(n)||(n=t),n},parseRatio:function(e,t){return 0===e||isNaN(e)?0:1===e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY?1:void 0!==t?e.toFixed(t):e},parseEventTime:function(e){var t=[];return-1!==e.indexOf("~")?(t=e.split("~"),T.parseEventTime(t[0])+~~(T.parseEventTime(t[1])/2)):"*"===e?0:-1===e.indexOf(":")?parseInt(e,T.cBASE_10):(t=e.split(":"),2===t.length?parseInt(t[0],T.cBASE_10)*T.cSECONDS_IN_MINUTE+parseInt(t[1],T.cBASE_10):3===t.length?parseInt(t[0])*T.cSECONDS_IN_HOUR+parseInt(t[1],T.cBASE_10)*T.cSECONDS_IN_MINUTE+parseInt(t[2],T.cBASE_10):0/0)},parseChainTime:function(e){var t=e.split(":");return parseInt(t[0],T.cBASE_10)*T.cMINUTES_IN_HOUR+parseInt(t[1],T.cBASE_10)},checkDST:function(){Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};var e=new Date;T.DST_IN_EFFECT=e.dst()&&O.Options.bol_detectDST?1:0},getTimeFormatted:function(e){var t,n,a,i=$.extend({aReference:T.ReferenceEnum.Local,aWant24:O.Options.bol_use24Hour,aWantSeconds:!0,aWantHours:!0,aWantLetters:!1},e),r=void 0===i.aCustomTimeInDate?new Date:i.aCustomTimeInDate;if(void 0===i.aCustomTimeInSeconds)switch(i.aReference){case T.ReferenceEnum.Local:t=r.getSeconds(),n=r.getMinutes(),a=r.getHours();break;case T.ReferenceEnum.Server:t=r.getSeconds(),n=r.getMinutes(),a=r.getUTCHours()+T.cUTC_OFFSET_SERVER+T.DST_IN_EFFECT,a=T.wrapInteger(a,T.cHOURS_IN_DAY);break;case T.ReferenceEnum.UTC:t=r.getUTCSeconds(),n=r.getUTCMinutes(),a=r.getUTCHours()}else i.aCustomTimeInSeconds=T.wrapInteger(i.aCustomTimeInSeconds,T.cSECONDS_IN_DAY),t=i.aCustomTimeInSeconds%T.cSECONDS_IN_MINUTE,n=~~(i.aCustomTimeInSeconds/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,a=~~(i.aCustomTimeInSeconds/T.cSECONDS_IN_HOUR);var o="";if(o=i.aWantSeconds?i.aWantLetters?0===a&&0===n?t+D.getWord("s"):n+D.getWord("m")+" "+t+D.getWord("s"):i.aWantHours===!1?n+":"+(t<T.cBASE_10?"0"+t:t):(n<T.cBASE_10?"0"+n:n)+":"+(t<T.cBASE_10?"0"+t:t):i.aWantLetters?n+D.getWord("m"):n<T.cBASE_10?"0"+n:n,i.aWantLetters)return 0===a||i.aWantHours===!1?o:a+D.getWord("h")+" "+o;if(i.aWant24)return i.aWantHours===!1?o:(a<T.cBASE_10?"0"+a:a)+":"+o;var s=" AM";return a<T.cHOURS_IN_MERIDIEM?0===a&&(a=T.cHOURS_IN_MERIDIEM):(a>T.cHOURS_IN_MERIDIEM&&(a%=T.cHOURS_IN_MERIDIEM),s=" PM"),a+":"+o+s},getShorthandTime:function(e){var t=~~(e/T.cMSECONDS_IN_SECOND);return t<T.cSECONDS_IN_MINUTE?0+D.getWord("m"):t<T.cSECONDS_IN_HOUR?~~(t/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR+D.getWord("m"):(t/T.cSECONDS_IN_HOUR).toFixed(1)+D.getWord("h")},formatTimeColon:function(e,t){var n="",a=e;0>a&&(a*=-1,n="−");var i,r,o,s,c=~~(a/T.cMSECONDS_IN_SECOND),l="",u="",d="",p="",h="";if(c<T.cSECONDS_IN_DAY||(i=~~(c/T.cSECONDS_IN_DAY),l=i+"::"),c<T.cSECONDS_IN_HOUR||(r=~~(c/T.cSECONDS_IN_HOUR)%T.cHOURS_IN_DAY,u=r+":",""!==l&&r<T.cBASE_10&&(u="0"+u)),c<T.cSECONDS_IN_MINUTE?d="0:":(o=~~(c/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,d=o+":",""!==u&&o<T.cBASE_10&&(d="0"+d)),s=c%T.cSECONDS_IN_MINUTE,p=""+s,s<T.cBASE_10&&(p="0"+p),t){var g=~~(a%T.cMSECONDS_IN_SECOND/T.cBASE_10);h="."+g,g<T.cBASE_10&&(h=".0"+g)}return n+l+u+d+p+h},formatTimeLetter:function(e,t){var n,a,i,r,o,s,c,l=e,u="",d="",p="",h="",g="",m="",f="",C="",v=T.cDAYS_IN_YEAR;return 0===e?"0"+D.getWord("s"):(0>l&&(l=-1*l,C="−"),l<T.cSECONDS_IN_YEAR?l<T.cSECONDS_IN_MONTH?(l<T.cSECONDS_IN_WEEK||(i=~~(l/T.cSECONDS_IN_WEEK),p=i+D.getWord("w")+" "),v=T.cDAYS_IN_WEEK):(a=~~(l/T.cSECONDS_IN_MONTH),d=a+D.getWord("mo")+" ",v=T.cDAYS_IN_MONTH):(n=~~(l/T.cSECONDS_IN_YEAR),u=n+D.getWord("y")+" "),l<T.cSECONDS_IN_DAY||(r=~~(l/T.cSECONDS_IN_DAY)%v,h=r+D.getWord("d")+(l<T.cSECONDS_IN_YEAR?" ":"")),l<T.cSECONDS_IN_YEAR&&(l<T.cSECONDS_IN_HOUR||(o=~~(l/T.cSECONDS_IN_HOUR)%T.cHOURS_IN_DAY,g=o+D.getWord("h")+" "),l<T.cSECONDS_IN_MINUTE||(s=~~(l/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,m=s+D.getWord("m")+(t||l<T.cSECONDS_IN_MINUTE?" ":"")),(t||l<T.cSECONDS_IN_MINUTE)&&(c=l%T.cSECONDS_IN_MINUTE,f=""+c+D.getWord("s"))),C+u+d+p+h+g+m+f)},formatMilliseconds:function(e){return T.formatTimeLetter(~~(e/T.cMSECONDS_IN_SECOND))},formatMinutes:function(e){return T.formatTimeLetter(e*T.cSECONDS_IN_MINUTE)},formatTooltipTime:function(e,t){var n=e,a=t?" ":"",i=[T.cSECONDS_IN_MINUTE,T.cSECONDS_IN_HOUR,T.cSECONDS_IN_DAY,T.cSECONDS_IN_YEAR],r=["m","h","d"];if(n<T.cSECONDS_IN_MINUTE)return n+a+D.getWord("s");for(var o=0;o<r.length;o++)if(n<i[o+1])return~~(n/i[o])+a+D.getWord(r[o]);return""},formatTooltipTimeMS:function(e,t){return T.formatTooltipTime(~~(e/T.cMSECONDS_IN_SECOND),t)},formatWeektime:function(e,t){var n={year:"numeric",month:"numeric",day:"numeric",weekday:"long"};return t&&(n.hour="numeric"),e.toLocaleString(window.navigator.language,n)},isTimely:function(e,t,n){var a=void 0===n?e.Finish:new Date(e.Finish.getTime()+n*T.cMSECONDS_IN_SECOND);return t<e.Start||t>a?!1:!0},isDaylight:function(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes();if(t%2===0){if(n>=T.cDAYTIME_DAY_START)return!0}else if(n<T.cDAYTIME_NIGHT_START)return!0;return!1},getDayPeriodRemaining:function(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes(),a="";return t%2===0?n<T.cDAYTIME_DAY_START?(a=T.cDAYTIME_DAY_START-n,K.setDimming(0)):(a=T.cDAYTIME_DAY_START+T.cDAYTIME_DAY_MINUTES-n,a>T.cDAYTIME_TRANSITION_MINUTES?a<T.cDAYTIME_DAY_MINUTES-T.cDAYTIME_TRANSITION_MINUTES?K.setDimming(1):K.setDimming((T.cDAYTIME_DAY_MINUTES-a+1)/T.cDAYTIME_TRANSITION_MINUTES,!0):K.setDimming(a/T.cDAYTIME_TRANSITION_MINUTES,!0),n===T.cDAYTIME_DAY_START&&O.Options.bol_alertDaylight&&D.speak(D.getPhrase("approaching daylight"))):n<T.cDAYTIME_NIGHT_START?(a=T.cDAYTIME_NIGHT_START-n,a>T.cDAYTIME_TRANSITION_MINUTES?K.setDimming(1):K.setDimming(a/T.cDAYTIME_TRANSITION_MINUTES,!0)):(a=T.cDAYTIME_NIGHT_START+T.cDAYTIME_NIGHT_MINUTES-n,K.setDimming(0),n===T.cDAYTIME_NIGHT_START&&O.Options.bol_alertDaylight&&D.speak(D.getPhrase("approaching nighttime"))),a+D.getWord("m")},getUTCMidnight:function(){return(new Date).setUTCHours(0,0,0,0)},getTimeSinceMidnight:function(e,t){t=t||T.UnitEnum.Seconds,e=e||T.ReferenceEnum.UTC;var n=new Date,a=n.getUTCHours(),i=n.getUTCMinutes(),r=n.getUTCSeconds();switch(e){case T.ReferenceEnum.UTC:break;case T.ReferenceEnum.Server:a=a+T.cUTC_OFFSET_SERVER+T.DST_IN_EFFECT;break;case T.ReferenceEnum.Local:a=n.getHours(),i=n.getMinutes(),r=n.getSeconds()}return a=T.wrapInteger(a,T.cHOURS_IN_DAY),t===T.UnitEnum.Hours?a:t===T.UnitEnum.Minutes?a*T.cMINUTES_IN_HOUR+i:a*T.cSECONDS_IN_HOUR+i*T.cSECONDS_IN_MINUTE+r},getDaysSince:function(e,t){return~~Math.abs((e.getTime()-t.getTime())/T.cMSECONDS_IN_DAY)},getSecondsSinceWeekstart:function(e){return(new Date).getUTCDay()*T.cSECONDS_IN_DAY+e},getUNIXSeconds:function(){return~~((new Date).getTime()/T.cMSECONDS_IN_SECOND)},addDaysToDate:function(e,t){var n=new Date(e);return n.setDate(e.getDate()+t),n},getCurrentBihourlyMinutesUTC:function(){var e=new Date;return e.getUTCHours()%2*T.cMINUTES_IN_HOUR+e.getUTCMinutes()},getCurrentBihourlyTimestampLocal:function(e){var t=new Date,n=t.getUTCHours(),a=n%2===0?n:n-1,i=a*T.cMINUTES_IN_HOUR-t.getTimezoneOffset();return i=T.wrapInteger(i,T.cMINUTES_IN_DAY),T.getTimeFormatted({aCustomTimeInSeconds:(i+e)*T.cSECONDS_IN_MINUTE,aWantSeconds:!1})},getSecondsTillWeektime:function(e,t){var n=T.getSecondsSinceWeekstart(t);return n>e?T.cSECONDS_IN_WEEK-n+e:e-n},updateChecklistCountdowns:function(){$("#chlCountdownToDaily").text(T.formatTimeLetter(T.SECONDS_TILL_DAILY,!0)),$("#chlCountdownToWeekly").text(T.formatTimeLetter(T.SECONDS_TILL_WEEKLY,!0))},convertDailyObject:function(e){for(var t={},n=T.DailyAssociation,a=[],i=0;i<e.pve.length;i++){var r=e.pve[i];if(r.level.max===I.cLevelMax)for(var o=0;o<r.required_access.length;o++)if(r.required_access[o]===T.Daily.AccessEnum.Max){a.push(r);break}}var s="unknown";return t.pve=[n[a[0].id]||s,n[a[1].id]||s,n[a[2].id]||s,n[a[3].id]||s],t.pvp=[n[e.pvp[0].id]||s,n[e.pvp[1].id]||s,n[e.pvp[2].id]||s,n[e.pvp[3].id]||s],t.wvw=[n[e.wvw[0].id]||s,n[e.wvw[1].id]||s,n[e.wvw[2].id]||s,n[e.wvw[3].id]||s],t},extractDailyChain:function(e){if(e&&e.pve)for(var t in e.pve){var n=e.pve[t].split(" ");if("Boss"===n[0])return C.getChainByAlias(n[1].toLowerCase())}return null},getDaily:function(e){var t=e||{},n=3,a=t.aWantGetTomorrow||t.aWantSetTomorrow?U.URL_API.Tomorrow:U.URL_API.Daily;return $.getJSON(a,function(e){if(t.aWantGetTomorrow)T.DailyTomorrow=T.convertDailyObject(e),C.ChainTomorrow=T.extractDailyChain(T.DailyTomorrow);else{T.DailyToday=T.convertDailyObject(e);var a,i=T.extractDailyChain(T.DailyToday),r=T.getTimeSinceMidnight(T.ReferenceEnum.UTC,T.UnitEnum.Minutes);if(null!==i)if(a=T.convertScheduleKeyToUTCMinutes(i.scheduleKeys[0]),t.aWantSetTomorrow)C.ChainToday=i;else{if(null!==C.ChainToday&&t.aIsReset){var o=C.ChainToday.alias;if(C.ChainToday=null,C.refreshChainDailyIcon(),i.alias===o)return void setTimeout(function(){T.getDaily({aIsReset:!0})},n*T.cMSECONDS_IN_MINUTE)}a+T.cMINUTES_IN_TIMEFRAME<r?T.getDaily({aWantSetTomorrow:!0}):C.ChainToday=i}else C.ChainToday=null;if(C.ChainToday&&(C.refreshChainDailyIcon(),t.aIsReset===!0)){if(O.isServerReset){var s=D.getModifiedWord("boss","daily",U.CaseEnum.Sentence)+" "+D.getObjectName(C.ChainToday)+" "+D.getTranslation("will start")+" "+D.getTranslation("at")+" "+T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(C.ChainToday.scheduleKeys[0])})+" "+D.getTranslation("in")+" "+T.getTimeFormatted({aWantLetters:!0,aWantSeconds:!1,aCustomTimeInSeconds:T.getSecondsUntilChainStarts(C.ChainToday)});I.greet(s,15)}if(O.Options.bol_alertAutosubscribe&&O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription){var c=$("#chnTime_"+C.ChainToday.nexus);c.hasClass("chnTimeSubscribed")||c.trigger("click")}}if(t.aIsReset===!0&&O.isServerReset&&T.DailyToday.pve&&"Forger"===T.DailyToday.pve[1]){var l=U.convertExternalString(H.Announcement.Messages.Forger);I.greet(l,25)}}})}},H={Announcement:GW2T_DASHBOARD_DATA.Announcement,Countdown:GW2T_DASHBOARD_DATA.Countdown,Story:GW2T_DASHBOARD_DATA.Story,Sale:GW2T_DASHBOARD_DATA.Sale,Vendor:GW2T_DASHBOARD_DATA.Vendor,isDashboardEnabled:!0,isAnnouncementEnabled:!1,isCountdownEnabled:!1,isCountdownTickEnabled:!1,isStoryEnabled:!1,isStoryDashboard:!0,isDailyEnabled:!0,isSaleEnabled:!1,isVendorEnabled:!1,Timeline:GW2T_TIMELINE,isTimelineEnabled:!0,isTimelineGenerated:!1,minutesInTimelineSpacing:null,initializeDashboard:function(){for(var e=new Date,t=0;t<H.Countdown.Events.length;t++)if(H.Countdown.Events[t].Finish&&e<H.Countdown.Events[t].Finish){H.isCountdownEnabled=!0;break}if(H.Announcement.pve.length>0&&T.isTimely(H.Announcement,e)&&(U.convertExternalLink($("#dsbAnnouncement").html(H.Announcement.pve).find("a")),M.bindMapLinks("#dsbAnnouncement"),H.isAnnouncementEnabled=!0),H.Sale.Items.length>0&&T.isTimely(H.Sale,e)&&(H.isSaleEnabled=!0),T.isTimely(H.Vendor,e,T.cSECONDS_IN_DAY)&&(H.isVendorEnabled=!0),H.isCountdownEnabled===!1&&H.isAnnouncementEnabled===!1&&H.isSaleEnabled===!1&&H.isVendorEnabled===!1||H.isDashboardEnabled===!1||I.isMapEnabled===!1||O.Options.bol_showDashboard===!1)return void(H.isDashboardEnabled=!1);if(H.toggleDashboard(!0),H.isCountdownTickEnabled=!0,$("#dsbToggle").click(function(){$("#dsbContainer").toggle("fast")}),H.isCountdownEnabled){for(var n,a,i,r=D.getNameKey(),o=D.getURLKey(),t=0;t<H.Countdown.Events.length;t++)n=H.Countdown.Events[t],n.isTimely=!0,n.StartStamp=n.Start.toLocaleString(),n.FinishStamp=n.Finish.toLocaleString(),a=void 0===n.name?n[r]:n.name,i=void 0===n.official?n[o]:U.getGW2OfficialLink(n.official),i=void 0===i?n.url:i,n.Anchor=-1!==i.indexOf(I.cSiteURL)?"<a href='"+i+"'>"+a+"</a>":"<a"+U.convertExternalAnchor(i)+">"+a+"</a>",$("#dsbCountdown").append("<div id='dsbCountdown_"+t+"' class='dsbCountdownEntry'><code>"+I.Symbol.Block+"</code>"+n.Anchor+" <time id='dsbCountdownTime_"+t+"'></time> <span class='dsbCountdownDate'><abbr></abbr> <var></var></span></div>");I.qTip.init("#dsbCountdown"),H.refreshDashboard(e)}if(H.isStoryEnabled&&H.isStoryDashboard){var s=D.getObjectName(H.Story),c=H.Story.url.length?"<a"+U.convertExternalAnchor(H.Story.url)+">"+s+"</a>":s;$("#dsbStory").before("<div id='dsbStoryTitle'>"+c+"</div>").show(),I.bindScrollbar("#dsbStory")}H.isSaleEnabled&&H.generateDashboardSaleHeader(),H.isVendorEnabled&&H.generateDashboardVendorHeader(),H.isDailyEnabled&&H.generateDashboardDailyHeader(e)},generateDashboardSaleHeader:function(){var e=T.getMinMax(H.Sale.Items,"price"),t=e.oMin===e.oMax?e.oMax:e.oMin+"-"+e.oMax;$("#dsbMenuSale").append("<div><kbd id='dsbSaleHeader' class='curToggle' title='<dfn>Gem Store Promotions and Sales</dfn><br />Expires: "+T.formatWeektime(H.Sale.Finish,!0)+"'><img id='dsbSaleSymbol' src='img/ui/placeholder.png' /><img id='dsbSaleToggleIcon' class='dsbToggleIcon' src='img/ui/toggle.png' /><var>"+H.Sale.Items.length+" "+D.getWordCapital("promotions")+"</var> <span class='dsbSalePriceCurrent'>"+t+"<ins class='s16 s16_gem'></ins></span></kbd></div>").addClass("dsbMenuEnabled"),$("#dsbSale").append("<div id='dsbSaleTable' class='jsScrollable'></div>");for(var n,a=!1,i=0,r=0,o=0;o<H.Sale.Items.length;o++)n=H.Sale.Items[o],0===n.col?i++:r++,a===!1&&n.discount&&(isFinite(n.discount)||n.discount.length&&n.discount[0].length>2)&&(a=!0);r>i?(H.Sale.Padding.col=0,H.Sale.Items.unshift(H.Sale.Padding)):i>r&&(H.Sale.Padding.col=1,H.Sale.Items.unshift(H.Sale.Padding)),$("#dsbSaleSymbol").attr("src","img/ui/"+(a?"gemstore_special":"gemstore")+I.cPNG),$("#dsbMenuSale").click(function(){H.generateDashboardSale()}),I.toggleToggleIcon("#dsbSaleToggleIcon",H.Sale.isPreshown),H.Sale.isPreshown===!0&&H.generateDashboardSale()},generateDashboardSale:function(){var e=function(e,t){return"<span class='dsbSalePercent'>"+U.convertRatioToPercent(-1*(1-e/t),0)+"</span> "},t=function(t,n,a){var i=void 0===a?n:a;return e(t,n)+"<span class='dsbSalePriceOld'>"+i+"</span> "},n=200,a=$("#dsbSaleTable");a.is(":empty")===!1?(I.toggleToggleIcon("#dsbSaleToggleIcon",!1),a.animate({height:0},n,function(){$(this).css({height:"auto"}).empty(),$("#dsbSale").hide(),$("#dsbMenuSale").removeClass("dsbMenuItemActive")})):($("#dsbSale").show(),$("#dsbMenuSale").addClass("dsbMenuItemActive"),a.append(I.cThrobber),E.updateCoinInGem(function(){if(I.toggleToggleIcon("#dsbSaleToggleIcon",!0),a.empty(),H.Sale.note.length>0&&a.append("<div class='dsbNote'>Note: "+U.convertExternalString(H.Sale.note)+"</div>"),a.append("<div id='dsbSaleCol0'></div><div id='dsbSaleCol1'></div>"),0!==E.Exchange.CoinInGem)for(var i="<ins class='s16 s16_gem'></ins>",r=0;r<H.Sale.Items.length;r++){var o=H.Sale.Items[r],s=U.getWikiSearchDefault(o.name),c=U.getYouTubeLink(o.name),l=void 0!==o.col?o.col:parseInt(r)%2,u=null;
u=U.isInteger(o.discount)?o.discount:u,u=Array.isArray(o.discount)&&o.discount[0].length>2?o.discount[0][2]:u;var d=null!==u?t(o.price,u):"",p="";if(o.discount&&Array.isArray(o.discount)){p+="<span class='dsbDiscount'>";for(var h=0;h<o.discount.length;h++){var g=o.discount[h],m=Math.ceil(g[1]/g[0]),f=g.length>2?t(m,o.discount[0][2],g[2]):e(m,o.discount[0][1]),C=g[0]>1?"/"+g[0]+" = "+Math.ceil(g[1]/g[0])+i:"";p+=f+"<span class='dsbSalePriceCurrent'>"+g[1]+i+C+"</span> "+I.Symbol.Approx+" "+E.formatGemToCoin(g[1])+"<br />"}p+="</span>"}var v=isNaN(o.id),b=v?"":"data-sale='"+o.id+"'",T=v?o.id:"img/ui/placeholder.png";$("#dsbSaleCol"+l).append("<div class='dsbSaleEntry'><a"+U.convertExternalAnchor(s)+"><img class='dsbSaleIcon' "+b+" src='"+T+"' /></a> <span class='dsbSaleVideo'><a"+U.convertExternalAnchor(c)+"'><ins class='s16 s16_youtube'></ins></a></span> "+d+"<span class='dsbSalePriceCurrent'>"+o.price+i+"</span><span class='dsbSalePriceCoin'> "+I.Symbol.Approx+" "+E.formatGemToCoin(o.price)+"</span><span class='dsbSalePriceMoney'> = "+E.formatGemToMoney(o.price)+"</span>"+p+"</div>")}var S=a.height();a.css({height:0}).animate({height:S},n,function(){$(this).css({height:"auto"}),I.bindScrollbar("#dsbSaleTable"),I.updateScrollbar("#dsbSaleTable")}).on("mouseenter",function(){I.updateScrollbar("#dsbSaleTable")}),$(".dsbSaleIcon").each(function(){$(this).attr("data-sale")&&!function(e){Q.getItem(e.attr("data-sale"),function(t){e.attr("src",t.icon),Q.scanItem(t,{aElement:e})})}($(this))})}))},generateDashboardVendorHeader:function(){var e=H.getDashboardVendorWeekday(),t=D.getObjectName(H.Vendor),n="";for(var a in H.Vendor.Codes)n+=a+"@"+H.Vendor.Codes[a][e]+" ";n+="- "+t,$("#dsbMenuVendor").empty().append("<div><kbd id='dsbVendorHeader' class='curToggle' title='<dfn>Pact Supply Network Agent</dfn><br />Expires: "+T.formatWeektime(H.Vendor.Finish,!0)+"'><img src='img/map/vendor_karma.png' /><img id='dsbVendorToggleIcon' class='dsbToggleIcon' src='img/ui/toggle.png' /><var>"+t+"</var></kbd></div>").addClass("dsbMenuEnabled"),$("#dsbVendor").empty().append("<div id='dsbVendorMenu'><img data-src='img/ui/copy.png' /><input id='dsbVendorCodes' class='cssInputText' type='text' value='"+n+"' title='<dfn>Copy and paste</dfn> this into game chat to follow.' /> <img data-src='img/map/route.png' /><u class='curZoom' id='dsbVendorDraw'>"+D.getPhrase("draw route",U.CaseEnum.Every)+"</u> <img data-src='img/ui/info.png' /><a"+U.convertExternalAnchor("http://wiki.guildwars2.com/wiki/Pact_Supply_Network_Agent")+"title='New items at daily reset.<br />New vendor locations 8 hours after that.<br />Limit 1 purchase per vendor per day.'>"+D.getWordCapital("info")+"</a></div><div id='dsbVendorTable' class='jsScrollable'></div>").hide();var i=$("#dsbVendorCodes");I.bindClipboard(i,n),I.preventMapPropagation(i).click(function(){$(this).select()}),$("#dsbMenuVendor").unbind("click").click(function(){H.generateDashboardVendor()}),$("#dsbVendorDraw").click(function(){if($(this).data("hasDrawn")!==!0){var t=[];for(var n in H.Vendor.Coords){var a=H.Vendor.Coords[n][e];void 0!==a&&t.push(a)}M.redrawPersonalPath(P.getGreedyPath(t),"default"),$(this).data("hasDrawn",!0)}else M.clearPersonalPins(),$(this).data("hasDrawn",!1)}),I.toggleToggleIcon("#dsbVendorToggleIcon",H.Sale.isPreshown)},generateDashboardVendor:function(){var e=200,t=H.getDashboardVendorWeekday(),n=$("#dsbVendorTable"),a=U.getObjectLength(H.Vendor.Offers),i=function(){$(".dsbVendorItem").each(function(){M.bindMapLinkBehavior($(this))});var t=n.height();n.css({height:0}).animate({height:t},e,function(){$(this).css({height:"auto"}),I.bindScrollbar("#dsbVendorTable"),I.updateScrollbar("#dsbVendorTable")}),T.isTimely(H.Vendor,new Date)===!1&&$("#dsbVendorTable").prepend("<div class='dsbNote'>Note: These items have expired.</div>"),I.removeThrobber(n)};if(n.is(":empty")===!1)I.toggleToggleIcon("#dsbVendorToggleIcon",!1),n.animate({height:0},e,function(){$(this).css({height:"auto"}).empty(),$("#dsbVendor").hide(),$("#dsbMenuVendor").removeClass("dsbMenuItemActive")});else{$("#dsbVendor").show(),$("#dsbMenuVendor").addClass("dsbMenuItemActive"),I.loadImg($("#dsbVendorMenu")),I.toggleToggleIcon("#dsbVendorToggleIcon",!0),n.empty(),n.append(I.cThrobber);for(var r in H.Vendor.Offers)!function(e){var r=H.Vendor.Offers[e];Q.getItem(r.id,function(o){var s=D.isLanguageDefault()?o.name:r.id;n.append("<div class='dsbVendorEntry'><a"+U.convertExternalAnchor(U.getWikiSearchDefault(s))+"><img id='dsbVendorIcon_"+e+"' class='dsbVendorIcon' src='img/ui/placeholder.png' /></a> <span id='dsbVendorItem_"+e+"' class='dsbVendorItem curZoom "+Q.getRarityClass(o.rarity)+"' data-coord='"+H.Vendor.Coords[e][t]+"'>"+o.name+"</span> <span class='dsbVendorPriceKarma'>"+E.formatKarmaString(H.Vendor.Prices[r.id]||H.Vendor.PriceDefault)+"</span><span class='dsbVendorPriceCoin' id='dsbVendorPriceCoin_"+e+"'></span></div>"),$.getJSON(U.getAPIPrice(r.id),function(t){$("#dsbVendorPriceCoin_"+e).html(" "+I.Symbol.Approx+" "+E.formatCoinStringColored(E.processPrice(t).oPriceSellTaxed))}).fail(function(){$("#dsbVendorPriceCoin_"+e).html(" = "+E.formatCoinStringColored(0))}),M.bindMapLinkBehavior($("#dsbVendorItem_"+e),M.ZoomEnum.Ground,M.Pin.Program);var c=H.Vendor.Products[r.id]||r.id;Q.getItem(c,function(t){var n=$("#dsbVendorIcon_"+e);n.attr("src",t.icon),Q.scanItem(t,{aElement:n})}),$(".dsbVendorEntry").length===a&&i()}).fail(function(){n.empty(),I.print("Unable to retrieve item: <a"+U.convertExternalAnchor(U.getWikiSearchDefault(r.id))+">"+r.id+"</a>. ArenaNet API server may be down.")})}(r)}},getDashboardVendorWeekday:function(){var e=new Date,t=e.getUTCDay(),n=e.getUTCHours();return n<H.Vendor.resetHour?T.wrapInteger(t-1,T.cDAYS_IN_WEEK):t},generateDashboardDailyHeader:function(e){var t=I.ModeCurrent===I.ModeEnum.Overlay?D.getWordCapital("daily"):D.getModifiedWord("achievements","daily",U.CaseEnum.Every);$("#dsbMenuDaily").empty().append("<div><kbd id='dsbDailyHeader' class='curToggle' title='<dfn>Daily Achievements</dfn><br />"+T.formatWeektime(e)+" and Next'><img src='img/ui/daily.png' /><img id='dsbDailyToggleIcon' class='dsbToggleIcon' src='img/ui/toggle.png' /><var>"+t+"</var></kbd></div>").addClass("dsbMenuEnabled").click(function(){H.generateDashboardDaily()}).one("click",function(){I.loadStylesheet("features")}),I.toggleToggleIcon("#dsbDailyToggleIcon",!1)},generateDashboardDaily:function(){var e=200,t=$("#dsbDaily"),n=new Date;if(t.is(":empty")===!1)I.toggleToggleIcon("#dsbDailyToggleIcon",!1),t.animate({height:0},e,function(){$(this).css({height:"auto"}).empty(),t.hide(),$("#dsbMenuDaily").removeClass("dsbMenuItemActive")});else{t.show(),$("#dsbMenuDaily").addClass("dsbMenuItemActive"),I.loadImg($("#dsbDailyMenu")),I.toggleToggleIcon("#dsbDailyToggleIcon",!0);var a=$("<div class='dlyCalendar'></div>").appendTo(t);G.fillDailyCalendar(a,n,!0)}},updateDashboardCountdown:function(e){for(var t=0;t<H.Countdown.Events.length;t++){var n=H.Countdown.Events[t];if(n.isTimely){var a=T.formatTimeLetter(~~((n.DesiredTime.getTime()-e.getTime())/T.cMSECONDS_IN_SECOND),!0);document.getElementById("dsbCountdownTime_"+t).innerHTML=a}}},refreshDashboard:function(e){var t=e.getUTCHours(),n=e.getUTCMinutes();for(var a in H.Countdown.Events){var i=H.Countdown.Events[a];if(i.isTimely){var r,o,s,c=$("#dsbCountdown_"+a);e<i.Start?(i.DesiredTime=i.Start,r="dsbCountdownDormant",o=I.Symbol.ArrowUp+"@",s=i.StartStamp):e<i.Finish?(i.DesiredTime=i.Finish,r="dsbCountdownActive",o=I.Symbol.ArrowDown+"@",s=i.FinishStamp):(i.isTimely=!1,c.remove()),i.isTimely&&(c.find("code").removeClass().addClass(r),c.find("abbr").text(o),c.find("var").text(s))}}T.isTimely(H.Story,e)===!1&&(H.isStoryEnabled=!1,$("#dsbStory").hide()),T.isTimely(H.Sale,e)===!1&&(H.isSaleEnabled=!1,$("#dsbSale").hide()),T.isTimely(H.Vendor,e)&&t===H.Vendor.resetHour&&0===n&&H.generateDashboardVendorHeader()},toggleDashboard:function(e){void 0===e&&(e=!$("#itemDashboard").is(":visible")),O.Options.bol_showDashboard&&H.isDashboardEnabled&&(e?$("#itemDashboard").show().css({opacity:0}).animate({opacity:1},200):$("#itemDashboard").hide())},generateTimeline:function(){H.isTimelineGenerated=!0,$("#itemTimeline").show();var e=$("#tmlContainer").append("<div class='tmlLine curToggle' id='tmlHeader'></div>");O.Enact.bol_condenseTimelineHeader(!0),$("#tmlHeader").click(function(){$("#opt_bol_condenseTimelineHeader").trigger("click")});for(var t in H.Timeline){var n=H.Timeline[t],a=U.escapeHTML(void 0===n.zone?D.getObjectName(n):M.getZoneName(n.zone)),i=n.isWB?"":"title='<dfn>"+a+"</dfn>'",r=$("<div class='tmlLine' "+i+"></div>").appendTo(e);n.isWB&&r.addClass("tmlLineWB");for(var o=0;o<n.Segments.length;o++){var s=n.Segments[o],c="",l=n.isWB?"tmlTimesliceWB":"",u=n.isWB?"data-offset='"+o+"'":"",d=s.primacy===C.EventPrimacyEnum.Boss?"tmlSegmentNameBoss":"";switch(s.primacy){case C.EventPrimacyEnum.Normal:c=I.Symbol.Ellipsis;break;case C.EventPrimacyEnum.Boss:c=I.Symbol.Star+" "}var p=0!==o||n.isWB?"":"<b class='tmlLineName'>"+a+"</b>";s.duration=T.parseChainTime(s.duration),s.time=T.parseChainTime(s.time);var h=s.duration/T.cMINUTES_IN_2_HOURS*T.cPERCENT_100;r.append("<div class='tmlSegment tmlTimeslice "+l+"' style='width:"+h+"%' data-start='"+s.time+"' data-finish='"+(s.time+s.duration)+"' "+u+"><div class='tmlSegmentContent'>"+p+"<span class='tmlSegmentName "+d+"'>"+c+(D.getObjectName(s)||"")+"</span><span class='tmlSegmentCountdown'></span><var class='tmlSegmentSpecial'></var></div></div>")}}$("#tmlToggle").click(function(){$("#tmlContainer").toggle("fast")}),$("#tmlDelete").click(function(){$("#opt_bol_showTimeline").prop("checked",!1).trigger("change"),H.toggleTimeline(!1),H.isTimelineEnabled=!1}),$("#tmlOpaque").click(function(){$("#opt_bol_opaqueTimeline").trigger("click")}),I.qTip.init(".tmlLine")},updateTimelineIndicator:function(){if(H.isTimelineGenerated!==!1){var e=T.cMINUTES_IN_2_HOURS,t=T.getCurrentBihourlyMinutesUTC(),n=t/e*T.cPERCENT_100;$("#tmlIndicator").css({left:n+"%"}),$(".tmlLineName").css({left:n+"%"}),$(".tmlTimeslice").each(function(){var n=$(this).hasClass("tmlSegmentActive"),a=$(this).find(".tmlSegmentCountdown"),i=n?I.Symbol.Horizontal:"",r=$(this).data("start")-t;r=0===r?e:T.wrapInteger(r,e),a.html($(this).hasClass("tmlTimesliceWB")&&n?"":i+T.formatMinutes(r))}),$(".tmlTimestampActive").find(".tmlSegmentTimestamp").text(T.getTimeFormatted({aWantSeconds:!1}))}},updateTimelineSegments:function(e){if(H.isTimelineGenerated!==!1){var t=T.cMINUTES_IN_2_HOURS/T.cMINUTES_IN_TIMEFRAME,n=0,a=T.getCurrentBihourlyMinutesUTC(),i=a-a%H.minutesInTimelineSpacing;if(0===a)H.updateTimelineHeader();else{var r=a-H.minutesInTimelineSpacing;$("#tmlSegmentTimestamp_"+r).html(T.getCurrentBihourlyTimestampLocal(r+T.cMINUTES_IN_2_HOURS)).removeClass("tmlSegmentTimestampCurrent").addClass("tmlSegmentTimestampFutureFar").parent().css({opacity:0}).animate({opacity:1},1e3).closest(".tmlSegment").removeClass("tmlTimestampActive")}if($("#tmlSegmentTimestamp_"+i).closest(".tmlSegment").addClass("tmlTimestampActive"),$(".tmlTimeslice").each(function(){a>=$(this).data("start")&&a<$(this).data("finish")?($(this).hasClass("tmlSegmentActive")||$(this).addClass("tmlSegmentActive"),$(this).hasClass("tmlTimesliceWB")&&(n=parseInt($(this).attr("data-offset")))):$(this).removeClass("tmlSegmentActive")}),a%T.cMINUTES_IN_TIMEFRAME===0||e){var o=0;$(".tmlTimesliceWB").each(function(){var e,a,i=$(this).find(".tmlSegmentName").empty(),r=$(this).find(".tmlSegmentSpecial").empty(),s=parseInt($(this).attr("data-offset"));n>s?a=t-n+s:(a=o,o++);var c=T.getTimeframeChains(a);for(var l in c)c[l].series!==C.ChainSeriesEnum.DryTop&&!function(t){var n=t.flags.isSpecial?r:i;e=$("<img class='tmlIcon curZoom chnSlot_"+t.nexus+"' src='"+t.iconSrc+"' />").appendTo(n),e.attr("title","<dfn>"+D.getObjectName(t)+"</dfn>").click(function(){C.viewChainFinale(t)}),X.reapplyChainIconState(t,e,!0),I.bindClipboard(e,t.waypointText)}(c[l])}),I.qTip.init(".tmlIcon")}}},updateTimelineHeader:function(){if(H.isTimelineGenerated!==!1)for(var e,t,n=T.getCurrentBihourlyMinutesUTC(),a=$("#tmlHeader").empty(),i=T.cMINUTES_IN_2_HOURS/H.minutesInTimelineSpacing,r=i/2,o=0;i>o;o++){var s=T.cPERCENT_100/i,c=0===o||o===r?"tmlSegmentTimestampHour":"",l=O.Options.bol_condenseTimelineHeader?"tmlSegmentTimestampCondensed":"",u="";e=H.minutesInTimelineSpacing*o,e<n-H.minutesInTimelineSpacing?(t=T.getCurrentBihourlyTimestampLocal(e+T.cMINUTES_IN_2_HOURS),u="tmlSegmentTimestampFutureFar"):t=T.getCurrentBihourlyTimestampLocal(e),a.append("<div class='tmlSegment' style='width:"+s+"%'><div class='tmlSegmentContent'><span id='tmlSegmentTimestamp_"+e+"' class='tmlSegmentTimestamp "+l+" "+c+" "+u+"'>"+t+"</span></div></div>")}},toggleSpecialIcons:function(e){$(".tmlSegmentSpecial").css({visibility:e?"visible":"hidden"}),$(".tmlLineWB").toggleClass("tmlLineSpecial",e)},toggleTimeline:function(e){void 0===e&&(e=!$("#itemTimeline").is(":visible")),O.Options.bol_showTimeline&&H.isTimelineEnabled?e?$("#itemTimeline").show().css({opacity:0}).animate({opacity:1},200):$("#itemTimeline").hide():O.Options.bol_showTimeline===!1&&$("#itemTimeline").hide()}},K={tickerFrequency:250,tickerSecondPrevious:null,stopwatchFrequency:50,awakeTimestampPrevious:0,awakeTimestampTolerance:5,currentFrameOffsetMinutes:0,currentPredictionColor:"",currentDaytimeSymbol:"",oldQuadrantAngle:0,paneSizePrevious:0,handSecond:{},handMinute:{},handHour:{},clockBackground:{},clockCircumference:{},timeProgress0:{},timeProgress1:{},timeDaylight:{},timeLocal:{},timeDaytime:{},timeSimple:{},timeMap:{},timeWvW:{},timeLog:{},countdownWvW:{},timestampUTC:{},timestampLocal:{},timestampServer:{},timestampReset:{},stopwatchUp:{},stopwatchDown:{},WpChain0:{},WpChain1:{},WpChain2:{},WpChain3:{},IconSD0:{},IconSD1:{},IconSD2:{},IconSD3:{},IconHC0:{},IconHC1:{},IconHC2:{},IconHC3:{},IconsStandard:[],IconsHardcore:[],lsClipboards:[],TickerTimeout:{},StopwatchTimeout:{},StopwatchTimestamp:0,StopwatchTimesleep:0,isStopwatchPaused:!1,StopwatchTimerStart:0,StopwatchTimerFinish:0,initializeClock:function(){K.handSecond=$("#clkSecondHand")[0],K.handMinute=$("#clkMinuteHand")[0],K.handHour=$("#clkHourHand")[0],K.clockBackground=$("#paneClockBackground")[0],K.clockCircumference=$("#clkCircumference")[0],K.timeProgress0=$("#chnProgress0")[0],K.timeProgress1=$("#chnProgress1")[0],K.timeLocal=$("#itemTimeLocalActual")[0],K.timeDaytime=$("#itemTimeDayTime")[0],K.timeSimple=$("#itemSimpleTime")[0],K.timeMap=$("#mapTime")[0],K.timeWvW=$("#wvwTime")[0],K.timeLog=$("#logTime")[0],K.countdownWvW=$("#lboCountdown")[0],K.timestampUTC=$("#optTimestampUTC")[0],K.timestampLocal=$("#optTimestampLocalReset")[0],K.timestampServer=$("#optTimestampServerReset")[0],K.timestampReset=$("#optTimeTillReset")[0],K.stopwatchUp=$("#watUp")[0],K.stopwatchDown=$("#watDown")[0],H.initializeDashboard(),K.updateTimeFrame(new Date),T.getDaily(),K.updateDaytimeIcon(),K.tickFrequent(),K.updateDigitalClockMinutely(),K.initializeClipboard(),I.ModeCurrent===I.ModeEnum.Website&&O.Options.int_setClock!==O.IntEnum.Clock.None&&$("#chnProgressBar").hide(),$("#itemTimeLocalActual").click(function(){$("#opt_bol_use24Hour").trigger("click")}),$("#clkToggle").click(function(){O.Options.int_setClock!==O.IntEnum.Clock.None?(K.paneSizePrevious=O.Options.int_setClock,X.setFieldsetState("int_setClock",O.IntEnum.Clock.None)):X.setFieldsetState("int_setClock",K.paneSizePrevious)})},setClock:function(){var e=200,t=0;switch(O.Options.int_setClock){case O.IntEnum.Clock.Compact:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime").show(),I.bulkAnimate([{s:"#itemClock",p:{top:"0px",left:"70px",width:"220px",height:"220px"}},{s:"#paneClockFace",p:{width:"360px",height:"360px",top:"-70px",left:"0px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"32px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"24px"}},{s:"#clkIconSD0",p:{top:"4px",left:"290px"}},{s:"#clkIconSD1",p:{top:"148px",left:"290px"}},{s:"#clkIconSD2",p:{top:"148px",left:"4px"}},{s:"#clkIconSD3",p:{top:"4px",left:"4px"}},{s:"#clkIconHC0",p:{top:"52px",left:"306px"}},{s:"#clkIconHC1",p:{top:"132px",left:"306px"}},{s:"#clkIconHC2",p:{top:"132px",left:"20px"}},{s:"#clkIconHC3",p:{top:"52px",left:"20px"}},{s:"#clkWaypoint0",p:{top:"24px",left:"274px"}},{s:"#clkWaypoint1",p:{top:"164px",left:"274px"}},{s:"#clkWaypoint2",p:{top:"164px",left:"52px"}},{s:"#clkWaypoint3",p:{top:"24px",left:"52px"}}],e),$("#paneClockIcons .iconHC").css({width:"32px",height:"32px"}),$("#itemTimeLocal").css({width:"100%",right:"auto",bottom:"90px","text-align":"center",color:"#eee",opacity:.5}),$("#itemTimeDaytime").css({width:"100%",top:"90px",bottom:"auto",left:"auto","text-align":"center",color:"#eee",opacity:.5}),t=I.cPANE_CLOCK_HEIGHT_COMPACT;break;case O.IntEnum.Clock.Full:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime").show(),I.bulkAnimate([{s:"#itemClock",p:{top:"70px",left:"70px",width:"220px",height:"220px"}},{s:"#paneClockFace",p:{width:"360px",height:"360px",top:"0px",left:"0px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"12px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"12px"}},{s:"#clkIconSD0",p:{top:"4px",left:"148px"}},{s:"#clkIconSD1",p:{top:"148px",left:"290px"}},{s:"#clkIconSD2",p:{top:"290px",left:"148px"}},{s:"#clkIconSD3",p:{top:"148px",left:"4px"}},{s:"#clkIconHC0",p:{top:"12px",left:"212px"}},{s:"#clkIconHC1",p:{top:"212px",left:"298px"}},{s:"#clkIconHC2",p:{top:"298px",left:"100px"}},{s:"#clkIconHC3",p:{top:"100px",left:"12px"}},{s:"#clkWaypoint0",p:{top:"52px",left:"164px"}},{s:"#clkWaypoint1",p:{top:"164px",left:"274px"}},{s:"#clkWaypoint2",p:{top:"274px",left:"164px"}},{s:"#clkWaypoint3",p:{top:"164px",left:"52px"}}],e),$("#paneClockIcons .iconHC").css({width:"48px",height:"48px"}),$("#itemTimeLocal").css({width:"auto",right:"10px",bottom:"10px","text-align":"left",color:"#bbcc77",opacity:1}),$("#itemTimeDaytime").css({width:"auto",top:"auto",bottom:"10px",left:"10px","text-align":"left",color:"#bbcc77",opacity:1}),t=I.cPANE_CLOCK_HEIGHT;break;case O.IntEnum.Clock.Bar:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime").hide(),I.bulkAnimate([{s:"#itemClock",p:{top:"0px",left:"0px",width:"85px",height:"85px"}},{s:"#paneClockFace",p:{width:"132px",height:"132px",top:"-24px",left:"-24px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"32px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"24px"}},{s:"#clkIconSD0",p:{top:"0px",left:"82px"}},{s:"#clkIconSD1",p:{top:"0px",left:"152px"}},{s:"#clkIconSD2",p:{top:"0px",left:"222px"}},{s:"#clkIconSD3",p:{top:"0px",left:"292px"}},{s:"#clkIconHC0",p:{top:"48px",left:"98px"}},{s:"#clkIconHC1",p:{top:"48px",left:"168px"}},{s:"#clkIconHC2",p:{top:"48px",left:"238px"}},{s:"#clkIconHC3",p:{top:"48px",left:"308px"}},{s:"#clkWaypoint0",p:{top:"-8px",left:"98px"}},{s:"#clkWaypoint1",p:{top:"-8px",left:"168px"}},{s:"#clkWaypoint2",p:{top:"-8px",left:"238px"}},{s:"#clkWaypoint3",p:{top:"-8px",left:"308px"}}],e),$("#paneClockIcons .iconHC").css({width:"32px",height:"32px"}),t=I.cPANE_CLOCK_HEIGHT_BAR;break;case O.IntEnum.Clock.None:$("#paneMenu").animate({top:0},e),$("#paneContent").animate({top:I.cPANE_MENU_HEIGHT,"min-height":I.cPANEL_HEIGHT_MIN-I.cPANE_MENU_HEIGHT+"px"},e,function(){$("#paneClock").hide()})}I.CLOCK_AND_MENU_HEIGHT=t+I.cPANE_MENU_HEIGHT,O.Options.int_setClock!==O.IntEnum.Clock.None&&($("#paneMenu").animate({top:t},e),$("#paneClock, #paneClockWall, #paneClockBackground, #paneClockIcons, #paneClockCanvas").animate({height:t},e),$("#paneContent").animate({top:t+I.cPANE_MENU_HEIGHT,"min-height":I.cPANEL_HEIGHT_MIN-(t+I.cPANE_MENU_HEIGHT)+"px"},e))},setDimming:function(e,t){0===O.Options.int_setDimming&&I.ModeCurrent!==I.ModeEnum.Simple&&(t?$(K.clockBackground).animate({opacity:e}):K.clockBackground.style.opacity=e)},setMarkerAngle:function(e,t){$(e).attr("transform","rotate("+t/10+", 50, 50)")},rotateClockElement:function(e,t){e.setAttribute("transform","rotate("+t+", 50, 50)")},reapplyFilters:function(){if(I.BrowserCurrent===I.BrowserEnum.Firefox){var e=$("#clkCircumference"),t=$("#clkHands"),n="url(#clkFilterShadowOuter)",a="url(#clkGradientCircumference)",i="url(#clkFilterShadowHand)";e.removeAttr("filter").attr("filter",n),e.css("stroke",a),t.removeAttr("filter").attr("filter",i)}},initializeClockItems:function(){K.IconsStandard=null,K.IconsHardcore=null,K.IconsStandard=[K.IconSD0,K.IconSD1,K.IconSD2,K.IconSD3],K.IconsHardcore=[K.IconHC0,K.IconHC1,K.IconHC2,K.IconHC3];var e="click",t="dblclick";I.ModeCurrent===I.ModeEnum.Website&&I.isProgramEmbedded===!1&&(e="dblclick",t="click");for(var n=0;n<T.cNUM_TIMEFRAMES_IN_HOUR;n++)$([K.IconsStandard[n],K.IconsHardcore[n]]).each(function(){$(this).unbind(t).on(t,function(){C.viewChainFinale(C.Chains[$(this).data(C.cIndexSynonym)])}).unbind(e).on(e,function(){$("#chnCheck_"+C.Chains[$(this).data(C.cIndexSynonym)].nexus).trigger("click")})})},checkoffChainIcon:function(e){var t,n,a,i=C.Chains[e];if(i.series===C.ChainSeriesEnum.Standard||i.series===C.ChainSeriesEnum.Hardcore)for(t=0;t<T.cNUM_TIMEFRAMES_IN_HOUR;t++){switch(i.series){case C.ChainSeriesEnum.Standard:n=T.getStandardChain(t),a=K.IconsStandard[t];break;case C.ChainSeriesEnum.Hardcore:n=T.getHardcoreChain(t),a=K.IconsHardcore[t]}n&&e===n.nexus&&X.reapplyChainIconState(n,a)}},colorPrediction:function(e){e!==K.currentPredictionColor&&(K.currentPredictionColor=e,K.handMinute.style.stroke=e,K.timeProgress0.style.background="linear-gradient(to right, transparent 0%, "+e+" 100%)")},tickFrequent:function(){var e=new Date,t=e.getSeconds();return K.tickerSecondPrevious===t?void(K.TickerTimeout=setTimeout(K.tickFrequent,K.tickerFrequency)):(K.tickerSecondPrevious=t,void K.tickSecond(e))},tickSecond:function(e){var t=T.getTimeFormatted(),n=e.getSeconds(),a=T.getTimeSinceMidnight();T.TIMESTAMP_UNIX_SECONDS=T.getUNIXSeconds(),T.SECONDS_TILL_DAILY=T.cSECONDS_IN_DAY-a,T.SECONDS_TILL_WEEKLY=T.getSecondsTillWeektime(T.cWEEKLY_RESET_SECONDS,a);var i=e.getMinutes(),r=e.getHours()%T.cHOURS_IN_MERIDIEM,o=i*T.cSECONDS_IN_MINUTE+n,s=6*n,c=6*i+n/10,l=30*r+i/2,u=function(e,t){void 0===t&&(t=0),setTimeout(function(){K.rotateClockElement(K.handSecond,s+e[t]),t<e.length-1&&u(e,t+1)},50)};K.rotateClockElement(K.clockCircumference,c),K.rotateClockElement(K.handMinute,c),K.rotateClockElement(K.handHour,l),O.Options.bol_showSecondHand&&u([-.5,1,-.5,.25,0]);var d=1-(i%T.cMINUTES_IN_TIMEFRAME*60+n)/T.cSECONDS_IN_TIMEFRAME,p=T.cPERCENT_100*d;if(K.timeProgress0.style.width=p+"%",K.timeProgress1.style.width=100-p+"%",i%T.cMINUTES_IN_TIMEFRAME===0&&0===n)$(K.timeProgress0).css({width:"0%"}).animate({width:"100%"},800),$(K.timeProgress1).css({width:"100%"}).animate({width:"0%"},800),K.updateTimeFrame(e);else{var h=T.TIMESTAMP_UNIX_SECONDS;K.awakeTimestampPrevious<h-K.awakeTimestampTolerance&&K.updateTimeFrame(e),K.awakeTimestampPrevious=h}switch(C.CurrentChains.forEach(C.updateCurrentChainTimeHTML),0===n&&(i%T.cMINUTES_IN_MINIFRAME===0&&(K.updateDaytimeIcon(),K.updateDryTopClipboard(),H.updateTimelineSegments(),H.isDashboardEnabled&&H.refreshDashboard(e)),K.updateDigitalClockMinutely(),H.updateTimelineIndicator(),C.updateChainsTimeHTML(),K.updateWaypointsClipboard(),O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&(K.doSubscribedSpeech(O.Options.int_alertSubscribedFirst),K.doSubscribedSpeech(O.Options.int_alertSubscribedSecond))),I.ModeCurrent){case I.ModeEnum.Simple:K.timeSimple.innerHTML=T.getTimeFormatted({aWant24:!0,aWantHours:!1,aWantLetters:!0,aCustomTimeInSeconds:T.cSECONDS_IN_TIMEFRAME-T.getCurrentTimeframeElapsedTime()});break;case I.ModeEnum.Overlay:P.switchMapCheck()}K.timeLocal.innerHTML=t,K.timestampUTC.innerHTML=T.TIMESTAMP_UNIX_SECONDS,K.timestampLocal.innerHTML=O.Utilities.timestampDaily.value,K.timestampServer.innerHTML=T.TIMESTAMP_UNIX_SECONDS+T.SECONDS_TILL_DAILY,K.timestampReset.innerHTML=T.getTimeFormatted({aCustomTimeInSeconds:T.SECONDS_TILL_DAILY,aWant24:!0}),o>=K.currentFrameOffsetMinutes&&o<K.currentFrameOffsetMinutes+C.CurrentChainSD.minFinish?K.colorPrediction("lime"):o>=K.currentFrameOffsetMinutes+C.CurrentChainSD.minFinish&&o<K.currentFrameOffsetMinutes+C.CurrentChainSD.avgFinish?K.colorPrediction("orange"):o<K.currentFrameOffsetMinutes+C.CurrentChainSD.avgFinish||K.colorPrediction("red"),T.isChecklistCountdownsStarted&&T.updateChecklistCountdowns(),H.isCountdownTickEnabled&&H.updateDashboardCountdown(e),0!==K.StopwatchTimerStart&&K.tickStopwatchDown(),W.isObjectiveTimerTickEnabled&&(K.timeLog.innerHTML=t,W.updateObjectiveTimers(),null!==W.MatchFinishTimeMS&&(K.countdownWvW.innerHTML=T.formatTimeLetter(W.secTillWvWReset--,!0)),0===n&&W.updateAllObjectiveAge()),K.TickerTimeout=setTimeout(K.tickFrequent,K.tickerFrequency)},doSubscribedSpeech:function(e){if(e>0){var t=T.cMINUTES_IN_TIMEFRAME-T.getCurrentTimeframeElapsedTime(T.UnitEnum.Minutes),n=C.NextChainSD1,a=C.NextChainHC1,i=C.NextChainLS1,r=!1,o=!1,s=!1,c=!1,l="",u="";if(e>T.cMINUTES_IN_TIMEFRAME&&(n=C.NextChainSD2,a=C.NextChainHC2,i=C.NextChainLS2,t+=T.cMINUTES_IN_TIMEFRAME),e===t){var d=" "+D.getSpeechWord("and")+" ",p=" "+D.getSpeechWord("will start")+D.getPluralTime(t,"minute");l=D.getSpeechWord(D.orderModifier(D.orderModifier("boss","world"),"subscribed"))+" ",r=U.objToBool(n)&&C.isChainSubscribed(n)&&C.isChainUnchecked(n),o=U.objToBool(a)&&C.isChainSubscribed(a)&&C.isChainUnchecked(a),s=U.objToBool(i)&&C.isChainSubscribed(i)&&C.isChainUnchecked(i),(r||o)&&(r&&o?l+=D.getChainPronunciation(n)+d+D.getChainPronunciation(a):r?l+=D.getChainPronunciation(n):o&&(l+=D.getChainPronunciation(a)),D.speak(l),D.speak(p));var h,g=e>T.cMINUTES_IN_TIMEFRAME?C.NextChainsMS2:C.NextChainsMS1;if(g.length>0){u=D.getSpeechWord("event","subscribed")+" ";for(var m=0;m<g.length;m++)h=g[m],U.objToBool(h)&&C.isChainSubscribed(h)&&C.isChainUnchecked(h)&&(u+=D.getChainPronunciation(h),m+1<g.length&&g.length>1&&(u+=d),c=!0);c&&(u+=p,D.speak(u))}H.isStoryEnabled&&s&&(D.speak(D.getSpeechWord("event","subscribed")+" "+D.getChainPronunciation(i)),D.speak(p))}}},updateTimeFrame:function(e){if(O.checkResetTimestamps(e),C.CurrentChainSD=T.getStandardChain(),C.NextChainSD1=T.getStandardChain(1),C.NextChainSD2=T.getStandardChain(2),C.NextChainSD3=T.getStandardChain(3),C.NextChainSD4=T.getStandardChain(4),C.CurrentChainsSD=[C.CurrentChainSD,C.NextChainSD1,C.NextChainSD2,C.NextChainSD3],C.CurrentChainHC=T.getHardcoreChain(),C.NextChainHC1=T.getHardcoreChain(1),C.NextChainHC2=T.getHardcoreChain(2),C.NextChainHC3=T.getHardcoreChain(3),C.NextChainHC4=T.getHardcoreChain(4),H.isStoryEnabled&&(C.NextChainLS1=T.getLivingStoryChain(1),C.NextChainLS2=T.getLivingStoryChain(2)),C.NextChainsMS1=T.getMiscellaneousChains(1),C.NextChainsMS2=T.getMiscellaneousChains(2),C.PreviousChains2=T.getTimeframeChains(-2),C.PreviousChains1=T.getTimeframeChains(-1),C.CurrentChains=T.getTimeframeChains(),C.NextChains1=T.getTimeframeChains(1),C.sortChainsListHTML(),C.CurrentChains.forEach(C.queueEventsHighlight),I.ModeCurrent===I.ModeEnum.Simple&&($("#itemSimpleCurrentSD").text(D.getObjectName(C.CurrentChainSD)),$("#itemSimpleNextSD").text(D.getObjectName(C.NextChainSD1)),$("#itemSimpleCurrentHC").text(""),$("#itemSimpleNextHC").text(""),C.CurrentChainHC||C.NextChainHC1?($("#itemSimpleHC").show(),C.CurrentChainHC&&$("#itemSimpleCurrentHC").text(D.getObjectName(C.CurrentChainHC)),C.NextChainHC1&&$("#itemSimpleNextHC").text(D.getObjectName(C.NextChainHC1))):$("#itemSimpleHC").hide()),O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&O.Options.bol_alertAtEnd){var t=", "+D.getSpeechWord("checked"),n="",a="",i="",r="",o=U.objToBool(C.CurrentChainSD),s=U.objToBool(C.CurrentChainHC),c=U.objToBool(C.NextChainSD1),l=U.objToBool(C.NextChainHC1),u=D.getSpeechWord("world boss","current")+" "+D.getSpeechWord("is")+" ";C.CurrentChainSD&&!C.isChainUnchecked(C.CurrentChainSD)&&(n=t),C.CurrentChainHC&&!C.isChainUnchecked(C.CurrentChainHC)&&(i=t),C.NextChainSD1&&!C.isChainUnchecked(C.NextChainSD1)&&(a=t),C.NextChainHC1&&!C.isChainUnchecked(C.NextChainHC1)&&(r=t),O.Options.bol_alertChecked===!1&&(n.length>0&&(o=!1),i.length>0&&(s=!1),a.length>0&&(c=!1),r.length>0&&(l=!1)),o&&s?(D.speak(u+D.getChainPronunciation(C.CurrentChainSD)+n,5),D.speak(D.getSpeechWord("and")+", "+D.getChainPronunciation(C.CurrentChainHC)+i,4)):o?D.speak(u+D.getChainPronunciation(C.CurrentChainSD)+n,5):s&&D.speak(u+D.getChainPronunciation(C.CurrentChainHC)+i,5),(o||s)&&(c&&l?(D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainSD1)+a,4),D.speak(D.getSpeechWord("and")+", "+D.getChainPronunciation(C.NextChainHC1)+r,4)):c?D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainSD1)+a,4):l&&D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainHC1)+r,4))}var d=e.getSeconds(),p=e.getMinutes(),h=60*p+d;$("#clkMarkers line").each(function(){$(this).attr("stroke","black")}),$("#paneClockIcons .iconSD").removeClass("clkIconCurrent clkIconNext"),$("#paneClockIcons .iconHC").removeClass("clkIconCurrent clkIconNext");var g=function(e,t,n,a,i,r,o,s,c,l,u,d,p,h){$([K.IconSD0,K.IconHC0]).each(function(){$(this).addClass("clkIconCurrent")}),$([K.IconSD1,K.IconHC1]).each(function(){$(this).addClass("clkIconNext")}),K.setMarkerAngle(t,C.CurrentChainSD.minFinish+u),K.setMarkerAngle(n,C.CurrentChainSD.avgFinish+u),K.setMarkerAngle(i,C.NextChainSD1.minFinish+d),K.setMarkerAngle(r,C.NextChainSD1.avgFinish+d),K.setMarkerAngle(o,C.NextChainSD2.minFinish+p),K.setMarkerAngle(s,C.NextChainSD2.avgFinish+p),K.setMarkerAngle(c,C.NextChainSD3.minFinish+h),K.setMarkerAngle(l,C.NextChainSD3.avgFinish+h);var g=function(e,t){e?(t.show(),t.attr("src",e.iconSrc),t.data(C.cIndexSynonym,e.nexus),t.attr("title","<dfn>"+D.getObjectName(e)+"</dfn>"),I.qTip.init(t),X.reapplyChainIconState(e,t)):t.hide()};g(C.CurrentChainSD,K.IconSD0),g(C.NextChainSD1,K.IconSD1),g(C.NextChainSD2,K.IconSD2),g(C.NextChainSD3,K.IconSD3),g(C.CurrentChainHC,K.IconHC0),g(C.NextChainHC1,K.IconHC1),g(C.NextChainHC2,K.IconHC2),g(C.NextChainHC3,K.IconHC3),$(e).attr("stroke","lime"),$(t).attr("stroke","orange"),$(n).attr("stroke","red"),$(a).attr("stroke","green")},m=function(e){var t,n,a,i;switch(e){case T.cSECS_MARK_0:t="0",n="1",a="2",i="3";break;case T.cSECS_MARK_1:t="1",n="2",a="3",i="0";break;case T.cSECS_MARK_2:t="2",n="3",a="0",i="1";break;case T.cSECS_MARK_3:t="3",n="0",a="1",i="2"}K.currentFrameOffsetMinutes=e,K.WpChain0=$("#clkWaypoint"+t),K.IconSD0=$("#clkIconSD"+t),K.WpChain1=$("#clkWaypoint"+n),K.IconSD1=$("#clkIconSD"+n),K.WpChain2=$("#clkWaypoint"+a),K.IconSD2=$("#clkIconSD"+a),K.WpChain3=$("#clkWaypoint"+i),K.IconSD3=$("#clkIconSD"+i),K.IconHC0=$("#clkIconHC"+t),K.IconHC1=$("#clkIconHC"+n),K.IconHC2=$("#clkIconHC"+a),K.IconHC3=$("#clkIconHC"+i),C.refreshChainDailyIcon(),g($("#clkMarker"+t),$("#clkMarker"+t+"A"),$("#clkMarker"+t+"B"),$("#clkMarker"+n),$("#clkMarker"+n+"A"),$("#clkMarker"+n+"B"),$("#clkMarker"+a+"A"),$("#clkMarker"+a+"B"),$("#clkMarker"+i+"A"),$("#clkMarker"+i+"B"),T["cSECS_MARK_"+t],T["cSECS_MARK_"+n],T["cSECS_MARK_"+a],T["cSECS_MARK_"+i]);var r=document.getElementById("clkQuadrant"),o=parseInt(t)*T.cCIRCLE_RIGHT_DEGREE;0===o&&0!==K.oldQuadrantAngle&&(o=T.cCIRCLE_FULL_DEGREE),$({angle:K.oldQuadrantAngle}).animate({angle:o},{duration:600,step:function(){K.rotateClockElement(r,this.angle)},done:function(){K.rotateClockElement(r,o)}}),o===T.cCIRCLE_FULL_DEGREE&&(o=0),K.oldQuadrantAngle=o};h>=T.cSECS_MARK_0&&h<T.cSECS_MARK_1?m(T.cSECS_MARK_0):h>=T.cSECS_MARK_1&&h<T.cSECS_MARK_2?m(T.cSECS_MARK_1):h>=T.cSECS_MARK_2&&h<T.cSECS_MARK_3?m(T.cSECS_MARK_2):h<T.cSECS_MARK_3||h>T.cSECS_MARK_4||m(T.cSECS_MARK_3),K.updateWaypointsClipboard(),K.updateDryTopClipboard(),K.initializeClockItems()},initializeClipboard:function(){for(var e=0;e<T.cNUM_TIMEFRAMES_IN_HOUR;e++)I.bindClipboard("#clkWaypoint"+e);if(C.DryTopChains.length>0)for(var e=0;2>e;e++)I.bindClipboard("#chnDryTopWaypoint"+e)},updateDaytimeIcon:function(){var e=T.isDaylight()?I.Symbol.Day:I.Symbol.Night;K.currentDaytimeSymbol=e,$("#itemTimeDayIcon").text(e)},updateDigitalClockMinutely:function(){var e=T.getDayPeriodRemaining();
K.timeDaytime.innerHTML=e;var t=T.getTimeFormatted({aWantSeconds:!1})+" "+K.currentDaytimeSymbol+e;K.timeMap.innerHTML=t,K.timeWvW.innerHTML=t,K.timeLocal.title=(new Date).toLocaleString()+"<br /><dfn>Anet:</dfn> "+T.getTimeFormatted({aReference:T.ReferenceEnum.Server,aWantSeconds:!1})+"<br /><dfn>UTC:</dfn> "+T.getTimeFormatted({aReference:T.ReferenceEnum.UTC,aWantSeconds:!1,aWant24:!0})+"<br /><dfn>Daily:</dfn> "+T.formatTimeLetter(T.SECONDS_TILL_DAILY,!1)+"<br /><dfn>Weekly:</dfn> "+T.formatTimeLetter(T.SECONDS_TILL_WEEKLY,!1),I.qTip.init(K.timeLocal)},updateWaypointsClipboard:function(){var e=function(e,t,n,a,i){var r="";r+=t.waypoint+" "+D.getChainAlias(t),n&&n.flags.isClipped!==!1?n.flags.isClipped!==!1&&(r+=" "+D.getTranslation("and")+" "+n.waypoint+" "+D.getChainAlias(n)+T.getTimeTillChainFormatted(n)):r+=T.getTimeTillChainFormatted(t),r+=", "+D.getTranslation("then")+" "+a.waypoint+" "+D.getChainAlias(a),i&&i.flags.isClipped!==!1?i.flags.isClipped!==!1&&(r+=" "+D.getTranslation("and")+" "+i.waypoint+" "+D.getChainAlias(i)+T.getTimeTillChainFormatted(i)):r+=T.getTimeTillChainFormatted(a),r+=I.siteTagCurrent,I.updateClipboard(e,r)};e(K.WpChain0,C.CurrentChainSD,C.CurrentChainHC,C.NextChainSD1,C.NextChainHC1),e(K.WpChain1,C.NextChainSD1,C.NextChainHC1,C.NextChainSD2,C.NextChainHC2),e(K.WpChain2,C.NextChainSD2,C.NextChainHC2,C.NextChainSD3,C.NextChainHC3),e(K.WpChain3,C.NextChainSD3,C.NextChainHC3,C.NextChainSD4,C.NextChainHC4)},updateDryTopClipboard:function(){if(C.isDryTopGenerated){var e=T.getCurrentDryTopEvents(),t=T.getCurrentDryTopEvents(1);I.updateClipboard("#chnDryTopWaypoint0",e),I.updateClipboard("#chnDryTopWaypoint1",t),C.isDryTopIconsShown&&($("#mapDryTopClip0").val(e),$("#mapDryTopClip1").val(t))}},initializeStopwatch:function(){$("#watToggle").click(function(){$("#itemStopwatch").toggle("fast")}),$("#watStart").click(function(){$("#watToggle").show(),$("#itemStopwatch").show().css("font-size",O.Options.int_sizeStopwatchFont);var e=(new Date).getTime();if(0===K.StopwatchTimestamp){var t=parseInt($("#watOffsetMinutes").val())*T.cMSECONDS_IN_MINUTE,n=parseInt($("#watOffsetSeconds").val())*T.cMSECONDS_IN_SECOND;K.StopwatchTimestamp=(new Date).getTime()-(t+n),K.tickStopwatchUp()}else K.isStopwatchPaused?(K.isStopwatchPaused=!1,K.StopwatchTimestamp=K.StopwatchTimestamp+(e-K.StopwatchTimesleep),K.tickStopwatchUp()):(window.clearTimeout(K.StopwatchTimeout),K.StopwatchTimesleep=e,K.isStopwatchPaused=!0)}),$("#watStop").click(function(){0===K.StopwatchTimerStart&&$("#watToggle").hide(),window.clearTimeout(K.StopwatchTimeout),K.isStopwatchPaused=!1,K.StopwatchTimestamp=0,K.stopwatchUp.innerHTML=""}),$("#watLap").click(function(){0!==K.StopwatchTimestamp?I.print(K.stopwatchUp.innerHTML):I.write("Stopwatch must be running to lap time.")}),$("#watTimerStart").click(function(){$("#watToggle").show(),$("#itemStopwatch").show().css("font-size",O.Options.int_sizeStopwatchFont);var e=parseInt($("#watOffsetSeconds").val())*T.cMSECONDS_IN_SECOND;K.StopwatchTimerStart=(new Date).getTime(),K.StopwatchTimerFinish=K.StopwatchTimerStart+O.Options.int_minStopwatchAlert*T.cMSECONDS_IN_MINUTE+e,D.verifyNativeTTS(),K.tickStopwatchDown()}),$("#opt_int_minStopwatchAlert").onEnterKey(function(){$(this).trigger("change"),$("#watTimerStart").trigger("click")}),$("#watTimerStop").click(function(){0===K.StopwatchTimestamp&&$("#watToggle").hide(),K.StopwatchTimerStart=0,K.stopwatchDown.innerHTML=""}),$("#chnOptionsStopwatchUp input, #chnOptionsStopwatchDown input").click(function(){$(this).select()})},tickStopwatchUp:function(){var e=(new Date).getTime()-K.StopwatchTimestamp;K.stopwatchUp.innerHTML=T.formatTimeColon(e,!0),K.StopwatchTimeout=setTimeout(function(){K.tickStopwatchUp()},K.stopwatchFrequency)},tickStopwatchDown:function(){var e=new Date,t=K.StopwatchTimerFinish-e.getTime();if(t>0)K.stopwatchDown.innerHTML=T.formatTimeLetter(~~(t/T.cMSECONDS_IN_SECOND),!0);else{$("#watTimerStop").trigger("click");var n=O.Options.str_textStopwatchAlert;I.print(e.toLocaleString()+": "+U.escapeHTML(n)),D.speak(n)}},refreshFestival:function(){var e=144,t=document.getElementById("paneClockCanvas"),n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);for(var a,i,r=0;e>r;r++)a=T.getRandomIntRange(0,t.width),i=T.getRandomIntRange(0,t.height),n.fillStyle="rgba(255,255,255,255)",n.fillRect(a,i,1,1)}},I={cSiteName:"GW2Timer.com",cSiteLink:"gw2timer.com/",cSiteURL:"http://gw2timer.com/",cImageHost:"http://i.imgur.com/",cGameName:"Guild Wars 2",cGameNick:"GW2",cLevelMax:80,cAJAXGlobalTimeout:3e4,cPNG:".png",cJSON:".json",cThrobber:"<div class='itemThrobber'><em></em></div>",cChatcodePrefix:"[&",cChatcodeSuffix:"]",cTextDelimiterChar:"|",cTextDelimiterRegex:/[|]/g,cClipboardAttribute:"data-clipboard-text",cClipboardSuccessText:"Text copied to clipboard :)<br />",cTooltipAttribute:"data-tip",consoleTimeout:{},siteTagDefault:" - gw2timer.com",siteTagCurrent:" - gw2timer.com",Symbol:{Filler:"&zwnj;",Unicode:"中",ArrowUp:"⇑",ArrowDown:"⇓",ArrowLeft:"⇐",ArrowRight:"⇒",ArrowClockwise:"↻",ArrowCounterwise:"↺",Horizontal:"⇄",Vertical:"⇅",TriUp:"▲",TriDown:"▼",TriRight:"►",TriLeft:"◄",Block:"■",Star:"☆",Wait:"⏳",Approx:"≈",Quantity:"×",Ellipsis:"…",Day:"☀",Night:"☽",Expand:"◢",Collapse:"◣",Help:"[?]"},cOUT_OF_VIEW:-9999,cPANEL_WIDTH:360,cPANEL_HEIGHT_MIN:220,cPANE_CLOCK_HEIGHT:360,cPANE_CLOCK_HEIGHT_COMPACT:220,cPANE_CLOCK_HEIGHT_BAR:85,cPANE_MENU_HEIGHT:48,cTOOLTIP_MOUSEMOVE_MS:20,cTOOLTIP_NUM_RERENDER:8,cTOOLTIP_OFFSET_ADD_X:0,cTOOLTIP_OFFSET_ADD_Y:56,cTOOLTIP_OVERFLOW_ADD_X:16,cTOOLTIP_OVERFLOW_ADD_Y:38,cTOOLTIP_PADDING_ADD_Y:12,CLOCK_AND_MENU_HEIGHT:0,posX:0,posY:0,Scrl:{Anchor:{},Interval:{},Container:{},isOn:!1,posX:0,posY:0},isProgramLoaded:!1,isProgramEmbedded:!1,isMapEnabled:!0,isTouchEnabled:!1,isCustomScrollEnabled:!0,isSpeechSynthesisEnabled:!1,isSpeechNativeEnabled:!1,isSpeechNativeLoaded:!1,ModeCurrent:null,ModeEnum:{Website:"Website",Mobile:"Mobile",Simple:"Simple",Tile:"Tile",Overlay:"Overlay"},cPagePrefix:"#plate",cMenuPrefix:"#menu",PageInitial:"",PageCurrent:"",PagePrevious:"",PageEnum:{Chains:"Chains",Map:"Map",Help:"Help",Options:"Options"},SpecialPageEnum:{Account:"Account",Audit:"Audit",WvW:"WvW"},LoadedStylesheets:{},SectionEnum:{Chains:{Scheduled:"Scheduled",Special:"Special",DryTop:"DryTop",Legacy:"Legacy",Temple:"Temple",Timetable:"Timetable"},Map:{Daily:"Daily",Resource:"Resource",JP:"JP",Collectible:"Collectible",Guild:"Guild",TP:"TP",Notepad:"Notepad",Personal:"Personal"},Help:{FAQ:"FAQ",About:"About",Embed:"Embed",Schedules:"Schedules",Legacies:"Legacies",Temples:"Temples",Dungeons:"Dungeons"},Account:{Manager:"Manager",Bank:"Bank",Materials:"Materials",Vault:"Vault",Wardrobe:"Wardrobe",Outfits:"Outfits",Dyes:"Dyes",Minis:"Minis",Finishers:"Finishers",Characters:"Characters",Hero:"Hero",Equipment:"Equipment",Ascended:"Ascended",Inventory:"Inventory",Catalog:"Catalog",Cleanup:"Cleanup",Recipes:"Recipes",Crafting:"Crafting",Trading:"Trading",Buying:"Buying",Selling:"Selling",Bought:"Bought",Sold:"Sold",PVP:"PVP",Guilds:"Guilds",Achievements:"Achievements"}},SectionCurrent:{},ArticleCurrent:null,contentCurrentPlate:"",isContentLoaded_Map:!1,isContentLoaded_Help:!1,isSectionLoaded_Daily:!1,cHeaderPrefix:"#header",BrowserCurrent:-1,BrowserEnum:{Unknown:-1,IE:0,Opera:1,Firefox:2,Chrome:3},ClickEnum:{Left:1,Middle:2,Right:3},ScreenWidth:{Huge:2560,Large:1024,Medium:640},initializeFirst:function(){D.stopSpeech(),window!==window.top&&(I.isProgramEmbedded=!0),U.enforceURLArgumentsFirst(),I.enforceProgramMode(),U.updateLanguageLinks(),T.checkDST(),T.cUTC_OFFSET_USER=-((new Date).getTimezoneOffset()/T.cMINUTES_IN_HOUR),T.cUTC_OFFSET_USER>T.cUTC_OFFSET_EASTERN||T.cUTC_OFFSET_USER<T.cUTC_OFFSET_HAWAII||(O.Options.bol_use24Hour=!1);var e=T.getUNIXSeconds();O.initializeTimestamp(O.Utilities.timestampDaily),O.initializeTimestamp(O.Utilities.timestampWeekly),K.awakeTimestampPrevious=e,O.Options.int_setInitialZoomWvW=screen.height<800?screen.height<480?1:2:3,screen.width<1200&&(O.Options.bol_condenseBank=!0);var t=navigator.userAgent;-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")?I.BrowserCurrent=I.BrowserEnum.IE:-1!==t.indexOf("Chrome")?I.BrowserCurrent=I.BrowserEnum.Chrome:-1!==t.indexOf("Firefox")?I.BrowserCurrent=I.BrowserEnum.Firefox:-1!==t.indexOf("Opera")&&(I.BrowserCurrent=I.BrowserEnum.Opera);try{window.speechSynthesis&&I.ModeCurrent!==I.ModeEnum.Overlay&&(I.isSpeechSynthesisEnabled=!0,window.speechSynthesis.onvoiceschanged=function(){window.speechSynthesis.getVoices()})}catch(n){}$.ajaxSetup({timeout:I.cAJAXGlobalTimeout}),$("#plateMap, #plateWvW, #plateHelp").each(function(){$(this).append(I.cThrobber)}),I.Scrl.Anchor=$("#itemAutoscroll"),I.qTip.start(),I.PageCurrent=I.PageEnum.Chains},initializeLast:function(){I.initializeTooltip(),I.bindHelpButtons("#plateOptions"),I.bindWindowReadjust(),I.initializeUIForMenu(),I.initializeUIForHUD(),I.styleContextMenu("#mapContext"),$("#hudOuter").toggle(O.Options.bol_showHUD),$("#mapSwitchButton").click(function(){I.switchMap()}),$("#wvwSwitchButton").click(function(){I.switchMap()}),$(".mapExpandButton").click(function(){$("#opt_bol_showPanel").trigger("click")}),$("#mapAccountButton, #wvwAccountButton").one("click",function(){A.isAccountInitialized===!1&&(I.loadStylesheet("account"),$("#panelAccount").load(U.getPageSrc("account"),function(){$.getScript(U.URL_DATA.Account).done(function(){A.initializeAccount()})}))}).click(function(){I.toggleAccount()}),U.enforceURLArgumentsLast(),I.PageCurrent===I.PageEnum.Chains&&U.openSectionFromURL(),$("#itemWarning").remove(),$("#cslClose").click(function(){I.clear()}),$("#cslSelect").click(function(){I.selectConsole()}),$("#cslToggle").click(function(){$("#cslContent").toggle("fast")}),$(".hudItem").one("mouseenter",function(){$(this).find("img").each(function(){$(this).attr("src",$(this).attr("data-src"))})}),$("#chnOptions").one("mouseenter",function(){I.loadImg($(this)),K.initializeStopwatch(),$("#optAlarmSpeaker").click(function(){D.speak(D.getWord("alarm"))}),$("#optMute").click(function(){D.stopSpeech()})}),U.convertExternalLink(".linkExternal"),I.BrowserCurrent!==I.BrowserEnum.IE&&$("head").append("<style>.leaflet-clickable{cursor: url('img/cursor/pointer.cur'), pointer;}</style>"),$(document).mouseup(function(e){$(".jsRemovable, .jsHidable").each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||($(this).hasClass("jsHidable")&&$(this).hide(),$(this).hasClass("jsRemovable")&&$(this).remove())})}),I.isCustomScrollEnabled&&$(document).on("ps-scroll-y",function(){I.clearAutoscroll()}),I.isMapEnabled&&I.bindScrollbar("#cslContent, #plateChains, #plateOptions"),O.cleanLocalStorage(),O.enforceProgramVersion(),D.translateAfter(),P.wantTourPrediction()?$("#chnEvent_"+C.CurrentChainSD.nexus+"_"+C.CurrentChainSD.CurrentPrimaryEvent.num).trigger("click"):I.isMapEnabled&&(M.showCurrentZone(M.getZoneCenter(M.cInitialZone)),M.goToDefault(O.Options.int_setInitialZoom)),I.isMapEnabled&&("wvw"===I.PageInitial?$("#wvwSwitchButton").one("click",function(){M.changeFloor(O.Options.int_setFloor)}):M.changeFloor(O.Options.int_setFloor)),I.isProgramLoaded=!0},initializeChainsUI:function(){$("#plateChains header").click(function(){var e=U.getSubstringFromHTMLID($(this));$(this).next().slideToggle("fast",function(){var t=$(this).attr("id");if($(this).is(":visible")){I.updateScrollbar();var n=$(I.cPagePrefix+I.PageEnum.Chains),a=$(this).prev();switch(a.find("kbd").html(I.Symbol.Collapse),I.scrollToElement(a,{aContainer:n,aSpeed:"fast"}),t){case"sectionChains_Drytop":I.isMapEnabled&&(M.goToZone("dry",M.ZoomEnum.Bird),P.toggleDryTopIcons(!0)),$("#hudBoxes").hide();break;case"sectionChains_Special":H.toggleSpecialIcons(!0)}I.SectionCurrent[I.PageEnum.Chains]=e===I.SectionEnum.Chains.Scheduled?"":e}else{switch(I.updateScrollbar(),$(this).prev().find("kbd").html(I.Symbol.Expand),t){case"sectionChains_Drytop":P.toggleDryTopIcons(!1),$("#hudBoxes").show();break;case"sectionChains_Special":H.toggleSpecialIcons(!1)}I.SectionCurrent[I.PageEnum.Chains]=""}U.updateQueryString()})}),$("#plateChains header:not(:first)").each(function(){$(this).next().toggle(0),$(this).find("kbd").html(I.Symbol.Expand)}),$("#plateChains header:first").each(function(){$(this).find("kbd").html(I.Symbol.Collapse)}),I.ModeCurrent===I.ModeEnum.Tile?($("#headerChains_Drytop").hide(),O.Enact.bol_expandWB()):$("#headerChains_Drytop").one("click",function(){P.generateDryTop()}),$("#headerChains_Legacy").one("click",function(){C.initializeUnscheduledChains(C.LegacyChains),I.readjustTile()}),$("#headerChains_Temple").one("click",function(){C.initializeUnscheduledChains(C.TempleChains),I.readjustTile()}),$("#chnToggle").click(function(){$("#opt_bol_expandWB").trigger("click")}),$("#headerChains_Timetable").one("click",function(){C.isTimetableGenerated=!0,C.initializeTimetableHTML(),I.readjustTile()}),I.readjustTile()},write:function(e,t,n){$("#itemConsole").show();var a=$("#cslContent").show(),i=18;e=void 0===e?"undefinedstring":null===e?"nullstring":""+e,void 0===n&&(n=!1),n===!0&&a.empty(),isFinite(t)===!1&&(t=3+parseInt(e.length/i)),a.append(e+"<br />"),I.updateScrollbar(a),window.clearTimeout(I.consoleTimeout),0!==t&&(I.consoleTimeout=setTimeout(function(){a.css({opacity:1}).animate({opacity:0},600,function(){$(this).empty().css({opacity:1}),$("#itemConsole").hide()})},t*T.cMSECONDS_IN_SECOND))},greet:function(e,t,n){I.isProgramEmbedded===!1&&"wvw"!==I.PageInitial&&I.write(e,t,n)},print:function(e,t){t&&I.clear(),window.clearTimeout(I.consoleTimeout);var n=document.getElementById("itemConsole"),a=document.getElementById("cslContent");n.style.display="block",a.insertAdjacentHTML("beforeend",e+"<br />")},help:function(e){I.print("<div class='cslModal cntComposition'>"+e+"</div>",!0),U.convertExternalLink("#cslContent a")},clear:function(){window.clearTimeout(I.consoleTimeout),$("#itemConsole").hide(),$("#cslContent").empty()},selectConsole:function(){I.selectText("#cslContent")},log:function(e,t){"string"==typeof e?I.print(e,t):I.prettyJSON(e,t)},printJSON:function(e){I.print(U.escapeJSON(e))},prettyJSON:function(e){I.print("<pre>"+U.escapeJSON(e)+"</pre>")},isConsoleShown:function(){var e=$("#itemConsole").is(":visible");return e&&I.clear(),e},bindConsoleInput:function(){$("#cslContent").find(".cssInputText").unbind("click").click(function(){$(this).select()})},selectText:function(e){var t=document.querySelector(e),n=window.getSelection(),a=document.createRange();a.selectNodeContents(t),n.removeAllRanges(),n.addRange(a)},scrollToElement:function(e,t){var n,a=t||{},i=$(e);switch(I.ModeCurrent){case I.ModeEnum.Mobile:$("body").scrollTop(i.offset().top);break;case I.ModeEnum.Tile:$("#windowMain").animate({scrollTop:i.offset().top-$("#windowMain").offset().top+$("#windowMain").scrollTop()},a.aSpeed||0);break;default:a.aContainer=a.aContainer||i.closest(".jsScrollable"),a.aContainer?(n=$(a.aContainer),n.animate({scrollTop:i.offset().top-n.offset().top+n.scrollTop()+(a.aOffset||0)},a.aSpeed||0,function(){a.aCallback&&a.aCallback()})):(i.scrollTop(0),a.aCallback&&a.aCallback())}},removeThrobber:function(e){$(e).find(".itemThrobber").remove()},getBar:function(e,t,n){return"<samp><s class='"+(t?"cssRight":"")+"' style='width:"+e+"%'>"+(n?"<mark></mark>":"")+"</s></samp>"},bulkAnimate:function(e,t){for(var n=0;n<e.length;n++){var a=e[n];$(a.s).animate(a.p,{duration:t,queue:!1})}},toggleHUDOpacity:function(e,t,n){var a=$(e);n?(a.addClass(t+"Opaque"),a.removeClass(t+"OpaqueNot")):(a.addClass(t+"OpaqueNot"),a.removeClass(t+"Opaque"))},toggleToggleIcon:function(e,t){t?$(e).animate({rotation:0},200):$(e).animate({rotation:-90},200)},blinkElement:function(e,t,n){var a=parseInt(t/n);a=a%2===0?a:a+1;var i=!0,r=1,o=$(e),s=setInterval(function(){o.css(i?{visibility:"hidden"}:{visibility:"visibile"}),i=!i,r===a&&clearInterval(s),r++},n)},bloatElement:function(e,t,n){var a=parseInt(t/n);a=a%2===0?a:a+1;for(var i=!0,r=0;a>r;r++)i?$(e).hide(n):$(e).show(n),i=!i},animateNumber:function(e,t,n,a){$({value:0}).animate({value:T.cPERCENT_100},{duration:n||3e3,easing:a||"swing",step:function(n){t(e*(n/T.cPERCENT_100))}})},colorizeValue:function(e,t,n){var a=$(e);a.removeClass("cssLimitEqual cssLimitWithin cssLimitExceed");var i;return i=void 0===n?t>0?"cssLimitWithin":0>t?"cssLimitExceed":"cssLimitEqual":t>n?"cssLimitExceed":"cssLimitWithin",a.addClass(i),a},toggleHighlight:function(e,t){return void 0===t?e.hasClass("cssHighlight")?(e.removeClass("cssHighlight"),!1):(e.addClass("cssHighlight"),!0):t?(e.addClass("cssHighlight"),!0):(e.removeClass("cssHighlight"),!1)},suspendElement:function(e,t){void 0===t||t===!0?$(e).addClass("jsSuspended"):$(e).removeClass("jsSuspended")},styleContextMenu:function(e){$(e).addClass("jsHidable").find("li").each(function(){if($(this).hasClass("jsIgnore")===!1){if($(this).hasClass("itemContextSubmenu")===!1)O.Options.enu_Language!==O.OptionEnum.Language.Default&&$(this).text(D.getPhraseOriginal($(this).text()));else{var e=$(this).find("> span");e.html(D.getPhraseOriginal(e.text())).append(" <kbd>"+I.Symbol.TriRight+"</kbd>")}$(this).prepend("<ins class='s16 s16_bullet'></ins> ")}})},createSearchBar:function(e,t){var n=$(e),a=$(t),i=$("<input id='jpzSearch' class='cntSearch' type='text' />").appendTo(n);I.bindInputBarText(i),i.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){var e=$(this).val().toLowerCase(),t=[],n="";e.length>0?(t=e.split(" "),a.each(function(){n=$(this).data("keywords");var e=!0;if(n){for(var a=0;a<t.length;a++)if(-1===n.indexOf(t[a])){$(this).hide(),e=!1;break}e&&$(this).show()}})):a.each(function(){$(this).show()})})).click(function(){$(this).select()})},bindInputBarText:function(e,t){var n="cssSearchActive",a="cssSearchPassive",i=t||D.getWordCapital("search")+"...",r=$(e).val(i).data("isfiller",!0).addClass(a);r.click(function(){$(this).data("isfiller")&&$(this).val("").removeClass(a).addClass(n)}).change(function(){0===$(this).val().length?$(this).val(i).data("isfiller",!0).removeClass(n).addClass(a):$(this).data("isfiller",!1).removeClass(a).addClass(n)}).focusout(function(){0===$(this).val().length&&$(this).val(i).data("isfiller",!0).removeClass(n).addClass(a)})},preventMapPropagation:function(e){return $(e).each(function(){var e=L.DomUtil.get($(this)[0]);L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"mousewheel",L.DomEvent.stopPropagation),L.DomEvent.on(e,"contextmenu",L.DomEvent.stopPropagation))})},bindClipboard:function(e,t){var n=e instanceof jQuery?e[0]:e,a=new Clipboard(n);return a.on("success",function(e){I.write(I.cClipboardSuccessText+e.text,5)}),t&&I.updateClipboard(n,t),a},updateClipboard:function(e,t){$(e).attr(I.cClipboardAttribute,t)},bindScrollbar:function(e,t){if(I.isCustomScrollEnabled)try{var n=$(e).addClass("jsScrollable"),a=1;switch(I.BrowserCurrent){case I.BrowserEnum.Opera:a=5;break;case I.BrowserEnum.Firefox:a=3}n.perfectScrollbar({wheelSpeed:a,suppressScrollX:void 0===t?!0:!t}),I.bindAutoscroll(n)}catch(i){}},updateScrollbar:function(e){if(I.isCustomScrollEnabled){var t=$(e);if(I.isMapEnabled)try{void 0===e?($("#plateMap").perfectScrollbar("update"),$("#plateChains").perfectScrollbar("update"),$("#plateHelp").perfectScrollbar("update"),$("#plateOptions").perfectScrollbar("update")):(t.hasClass("ps-container")===!1&&(t=t.closest(".ps-container")),t&&t.perfectScrollbar("update"))}catch(n){}else $("#windowMain").perfectScrollbar("update")}},bindAutoscroll:function(e){e.mousedown(function(e){e.which===I.ClickEnum.Middle?(clearInterval(I.Scrl.Interval),I.Scrl.isOn?I.clearAutoscroll():(I.Scrl.isOn=!0,I.Scrl.Anchor.css({top:I.posY,left:I.posX,backgroundImage:"url('img/cursor/autoscroll.png')"}).show(),I.Scrl.posX=I.posX,I.Scrl.posY=I.posY,I.Scrl.Container=$(this),I.tickAutoscroll())):(e.which===I.ClickEnum.Left||e.which===I.ClickEnum.Right)&&I.Scrl.isOn&&I.clearAutoscroll()})},clearAutoscroll:function(){clearInterval(I.Scrl.Interval),I.Scrl.isOn=!1,I.Scrl.Anchor.hide()},tickAutoscroll:function(){I.Scrl.isOn&&(I.Scrl.Interval=setInterval(function(){var e=5,t=720,n=I.posY-I.Scrl.posY,a=32,i=32,r=0>n?-1:1;n=Math.abs(n);var o=Math.pow(2,(n+a)/i);o>t&&(o=t),n>e&&I.Scrl.Container.scrollTop(I.Scrl.Container.scrollTop()+r*o)},50))},generateSectionMenu:function(e){if($(e+" header.jsSection").length>0){var t=e.substring(I.cPagePrefix.length,e.length),n="menuBeam_"+t,a=$("<div class='menuBeamContainer'></div>").prependTo(e),i=$("<div class='menuBeam' id='"+n+"'></div>").prependTo(a);$(e+" header.jsSection").each(function(){var n=$(this),a=$(this).children("var").first(),r=a.data(O.Options.enu_Language)||n.text();a.text(r),n.next().hide(),n.wrapInner("<span></span>"),n.append("<sup>"+I.Symbol.Expand+"</sup>"),n.click(function(){var n=!1,a=U.getSubstringFromHTMLID($(this));$(e+" .menuBeamIcon").removeClass("menuBeamIconActive"),$(this).next().is(":visible")?($(this).children("sup").text(I.Symbol.Expand),I.displaySectionMarkers(a,!1),I.SectionCurrent[t]="",$(e+" header.jsSection").show(),$(e+" header.cntHeader").show()):(n=!0,$(this).children("sup").text(I.Symbol.Collapse),$(e+" .menuBeamIcon[data-section='"+a+"']").addClass("menuBeamIconActive"),I.displaySectionMarkers(a,!0),I.SectionCurrent[t]=a,$(this).data("beamclicked")===!0&&($(e+" header.jsSection").not(this).hide(),$(e+" header.cntHeader").hide(),$(this).removeData("beamclicked")),$(this).hasClass("jsMapDefault")&&M.goToDefault()),U.updateQueryString(),$(this).data("donotanimate")!==!0?I.ModeCurrent===I.ModeEnum.Website?$(this).next().toggle("fast",function(){I.updateScrollbar(e)}):($(this).next().toggle(),I.updateScrollbar(e)):$(this).next().toggle(),$(this).removeData("donotanimate"),n&&I.scrollToElement($(this),{aContainer:e,aSpeed:"fast"})}),n.one("click",function(){I.loadImg($(this).next())}),$("<div class='curClick jsSectionDone'><img src='img/ui/close.png' />"+r+"</div>").appendTo(n.next()).click(function(){$(this).parent().prev().trigger("click")});var o=U.getSubstringFromHTMLID(n),s=n.find("img:eq(0)").attr("src");(I.isMapEnabled||n.hasClass("mapOnly")===!1)&&$("<img class='menuBeamIcon' data-section='"+o+"' src='"+s+"' title='&lt;dfn&gt;"+D.getWordCapital("section")+": &lt;/dfn&gt;"+r+"' />").appendTo(i).click(function(){$(e+" header.jsSection").each(function(){$(this).next().is(":visible")&&$(this).attr("id")!==n.attr("id")&&($(this).data("donotanimate",!0),$(this).trigger("click"))}),n.data("beamclicked",!0),n.trigger("click")})}),$("<img class='menuBeamIcon menuBeamIconCollapse' src='img/ui/exit.png' title='&lt;dfn&gt;"+D.getPhraseTitle("collapse section")+"&lt;/dfn&gt;' />").prependTo(i).click(function(){$(e+" header.jsSection").each(function(){$(this).next().is(":visible")&&$(this).trigger("click")}),$(e+" .menuBeamIcon").removeClass("menuBeamIconActive")}),I.qTip.init(e+" .menuBeamIcon")}},displaySectionMarkers:function(e,t){var n,a,i=$("#mapToggle_"+e);i.length&&(n=i.data("checked"),a=i.data("hideonly"),a?t||i.trigger("click"):t?n||(i.trigger("click"),i.data("checked",!0)):n&&(i.trigger("click"),i.data("checked",!1)))},loadStylesheet:function(e){e!==I.ModeEnum.Website&&void 0===I.LoadedStylesheets[e]&&($("head").append("<link rel='stylesheet' type='text/css' href='style/"+e.toLowerCase()+".css' />"),I.LoadedStylesheets[e]=!0)},loadImg:function(e){var t="string"==typeof e?$(e):e.find("img");t.each(function(){$(this).attr("data-src")&&($(this)[0].src=$(this).data("src"))})},bindHelpButtons:function(e){$(e+" .jsHelpCollapsible").each(function(){$(this).text("[?+]").attr("title","<dfn>More Info</dfn>"),$(this).next().hide(),$(this).click(function(){$(this).next().toggle(),$(this).text($(this).next().is(":visible")?"[?-]":"[?+]")})}),$(e+" .jsHelpTooltip").each(function(){var e="<dfn>Info:</dfn> "+$(this).attr("title");$(this).text(I.Symbol.Help).attr("title",e)}),I.qTip.init(e+" .jsHelpCollapsible"),I.qTip.init(e+" .jsHelpTooltip")},toggleButtonState:function(e){var t=!e.data("checked");return e.data("checked",t),t},bindPseudoCheckbox:function(e,t){void 0===t&&(t=.3),$(e).click(function(){$(this).data("checked")!==!0?($(this).css({opacity:t}),$(this).data("checked",!0)):($(this).css({opacity:1}),$(this).data("checked",!1))})},initializeUIForMenu:function(){$(".menuButton").each(function(){$(this).click(function(){var e=$(this).attr("id");switch(I.PageCurrent=e.substring(I.cMenuPrefix.length-1,e.length),I.contentCurrentPlate=I.cPagePrefix+I.PageCurrent,P.WebsiteCurrentMap===P.MapEnum.Mists&&(I.PagePrevious=I.PageCurrent),I.PageCurrent){case I.PageEnum.Chains:O.Options.bol_hideHUD&&$("#hudBoxes").show();break;case I.PageEnum.Map:I.isMapEnabled&&M.movePin(M.Pin.Event)}$("#paneContent article").hide(),I.PageCurrent!==I.PageEnum.Chains&&O.Options.bol_hideHUD&&$("#hudBoxes").hide(),I.isCustomScrollEnabled&&($(I.contentCurrentPlate+" .cntHeader").css({opacity:0}).animate({opacity:1},400),$(I.contentCurrentPlate).animate({width:"show"},200)),$(I.contentCurrentPlate).show(),U.updateQueryString(),I.isMapEnabled&&M.toggleLayer(M.ZoneCurrent.Layers.Path,I.PageCurrent!==I.PageEnum.Map&&O.Options.bol_showChainPaths)})}),$("#menuMap").one("click",I.loadMapPlate),$("#menuHelp").one("click",I.loadHelpPlate)},switchMap:function(){if(P.WebsiteCurrentMap===P.MapEnum.Tyria&&W.isWvWPrepped===!1){W.isWvWPrepped=!0,I.loadStylesheet("wvw"),I.loadImg("#wvwHUDPane .hudButton"),$("#lboCurrent").append(I.cThrobber);var e=setInterval(function(){"absolute"===$("#wvwLeaderboard").css("position")&&(window.clearInterval(e),$.getScript(U.URL_DATA.WvW).done(function(){W.initializeWvW()}))},100)}switch(P.WebsiteCurrentMap){case P.MapEnum.Tyria:$("#mapPane").hide(),$("#wvwPane").show(),W.isMapInitialized&&W.refreshMap(),I.PagePrevious=I.PageCurrent,I.PageCurrent=I.SpecialPageEnum.WvW,P.WebsiteCurrentMap=P.MapEnum.Mists,P.SuffixCurrent=W.OptionSuffix;break;case P.MapEnum.Mists:$("#wvwPane").hide(),$("#mapPane").show(),M.refreshMap(),I.PageCurrent=I.PagePrevious,I.PagePrevious=I.SpecialPageEnum.WvW,P.WebsiteCurrentMap=P.MapEnum.Tyria,P.SuffixCurrent=M.OptionSuffix}U.updateQueryString()},toggleAccount:function(){var e=$("#panelAccount"),t=$("#accContent");e.is(":visible")?(t.hide(),e.css({width:"100%"}).animate({width:0},"fast",function(){if($(this).hide(),I.isMapEnabled&&O.Options.bol_showMap)switch($("#panelMap").show(),P.WebsiteCurrentMap){case P.MapEnum.Tyria:$("#mapPane").show(),M.refreshMap();break;case P.MapEnum.Mists:$("#wvwPane").show(),W.isMapInitialized&&W.refreshMap()}}),I.PageCurrent=I.PagePrevious,I.PagePrevious=I.SpecialPageEnum.Account):(e.show().css({width:0}).animate({width:"100%"},"fast",function(){t.show(),A.adjustAccountPanel()}),I.PagePrevious=I.PageCurrent,I.PageCurrent=I.SpecialPageEnum.Account,$("#panelMap").hide()),U.updateQueryString()},bindAfterAJAXContent:function(e){var t=I.cPagePrefix+e;I.generateSectionMenu(t),I.isMapEnabled&&I.bindScrollbar(t),I.bindHelpButtons(t),M.bindMapLinks(t),U.convertExternalLink(t+" a"),I.qTip.init("button"),U.openSectionFromURL(),D.translateElements()},loadMapPlate:function(){I.loadStylesheet("features"),$("#plateMap").load(U.getPageSrc("map"),function(){I.bindAfterAJAXContent(I.PageEnum.Map),I.ModeCurrent===I.ModeEnum.Mobile&&$(".mapOnly").remove(),$("#headerMap_Daily").one("click",function(){G.generateAndInitializeDailies(),I.isSectionLoaded_Daily=!0}),$("#headerMap_Resource").one("click",function(){G.generateAndInitializeResources()}),$("#headerMap_JP").one("click",function(){G.generateAndInitializeJPs()}),$("#headerMap_Personal").one("click",function(){X.initializePersonalChecklist()}),$("#headerMap_TP").one("click",function(){E.initializeCalculator(),E.initializeTrading(),E.initializeExchange()}),$("#headerMap_Notepad").one("click",function(){X.initializeNotepad()}),$("#headerMap_Collectible").one("click",function(){G.generateCollectiblesUI()}),$("#headerMap_Guild").one("click",function(){G.generateGuildUI()}),I.qTip.init("#plateMap label")})},loadHelpPlate:function(){$("#plateHelp").load(U.getPageSrc("help"),function(){I.bindAfterAJAXContent(I.PageEnum.Help),$(".jsCopyCode").click(function(){$(this).select()})})},initializeUIForHUD:function(){I.ModeCurrent===I.ModeEnum.Overlay&&$(".hudDirectory").find(".linkInternal").each(function(){var e=$(this).attr("href");$(this).attr("href",e+U.getDivider(e)+"mode=Overlay")}),$(".hudPeripheral").css({visibility:"visible"})},showHomeLink:function(){I.qTip.init($("<a title='&lt;dfn&gt;Switch back to full site.&lt;/dfn&gt;' href='./'> <img id='iconSimpleHome' src='img/ui/about.png' /></a>").appendTo("#itemHome"))},enforceProgramMode:function(){switch(I.loadStylesheet(I.ModeCurrent),I.ModeCurrent){case I.ModeEnum.Website:$("head").append("<link rel='alternate' media='only screen and (max-width: 640px)' href='http://gw2timer.com/?mode=Mobile'>");break;case I.ModeEnum.Overlay:I.cPANE_MENU_HEIGHT=32,I.loadImg("#mapGPSIcon"),$("#dsbMenu").appendTo("#dsbContainer");break;case I.ModeEnum.Simple:I.isMapEnabled=!1,I.showHomeLink(),$("#itemTimeline").appendTo("#panelApp"),$("#itemLanguagePopup").appendTo("#itemLanguage"),I.readjustSimple();break;case I.ModeEnum.Mobile:I.isMapEnabled=!1,I.isCustomScrollEnabled=!1,I.showHomeLink(),$("head").append("<meta name='viewport' content='width=device-width, initial-scale=1' />").append("<link rel='canonical' href='http://gw2timer.com' />");break;case I.ModeEnum.Tile:if(I.isMapEnabled=!1,I.showHomeLink(),$("#itemLanguage").prependTo("#plateChains"),$("#itemLanguagePopup").appendTo("#itemLanguage"),I.isProgramEmbedded)$("<style type='text/css'>.chnBar, .chnSlot {margin-bottom:4px !important; margin-right: 4px !important;}</style>").appendTo("head");else{var e=parseInt($("#chnProgressBar").css("margin-top"));$("#itemTimeline").prependTo("#panelApp"),$("#windowMain").scroll(function(){$("#itemTimeline").is(":visible")?$("#chnProgressBar").css("margin-top",Math.max(-$("#itemTimeline").outerHeight(!0)+e,-$("#windowMain").scrollTop())):$("#chnProgressBar").css("margin-top",e)})}I.bindScrollbar("#windowMain")}$("#paneClockIcons img").addClass(I.ModeCurrent===I.ModeEnum.Website&&I.isProgramEmbedded===!1?"curZoom":"curClick"),I.isProgramEmbedded&&($("#itemWarning").remove(),$(".hudLinks").hide()),I.ModeCurrent!==I.ModeEnum.Website&&I.ModeCurrent!==I.ModeEnum.Overlay&&(H.isDashboardEnabled=!1),$("#itemLanguagePopup").click(function(e){e.stopPropagation()})},bindWindowReadjust:function(){$(window).on("resize",$.throttle(200,function(){switch(I.ModeCurrent){case I.ModeEnum.Simple:I.readjustSimple();break;case I.ModeEnum.Tile:I.readjustTile()}W.isWvWLoaded&&(W.readjustLeaderboard(),W.readjustLog()),A.isAccountInitialized&&A.adjustAccountPanel()}))},readjustSimple:function(){var e=$(window).height()/2,t=$(window).width()/2,n=I.cPANE_CLOCK_HEIGHT/2;$("#paneSimple").css({"margin-top":e-n-72}),$("#paneClock").css({"margin-top":e-n,"margin-left":t-n})},readjustTile:function(){if(I.ModeCurrent===I.ModeEnum.Tile){var e=T.stepFunction($(window).width(),14,22,400,3);$(".chnTitle h1, .chnTitle time").css({fontSize:e+"px"})}},showContextMenu:function(e){var t=$(e),n=t.width(),a=t.height(),i=$(window).width(),r=$(window).height(),o=0,s=0,c=4;I.posX+n>i&&(o=I.posX+n+c-i),I.posY+a>r&&(s=I.posY+a+c-r),t.css({top:I.posY-s,left:I.posX-o}).show()},initializeTooltip:function(){I.qTip.init("#chnOptions img, a, ins, kbd, span, time, fieldset, label, input, button")},qTip:{name:"qTip",offsetX:0,offsetY:0,TipElm:null,start:function(){this.TipElm=document.createElement("div"),this.TipElm.setAttribute("id",this.name),document.body.appendChild(this.TipElm),document.onmousemove=$.throttle(I.cTOOLTIP_MOUSEMOVE_MS,function(e){I.qTip.move(e)})},init:function(e){if(!I.isTouchEnabled){var t,n;$(e).each(function(){t=$(this)[0],n=t.getAttribute("title"),t&&n&&(t.setAttribute(I.cTooltipAttribute,n),t.removeAttribute("title"),t.removeAttribute("alt"),t.onmouseenter=function(){I.qTip.show(this.getAttribute(I.cTooltipAttribute))},t.onmouseleave=function(){I.qTip.hide()})})}},move:function(e){e&&(I.posX=e.pageX,I.posY=e.pageY);var t=$("#qTip").width(),n=$("#qTip").height(),a=$(window).width(),i=$(window).height();
this.offsetX=I.cTOOLTIP_OFFSET_ADD_X,this.offsetY=-(n+I.cTOOLTIP_OFFSET_ADD_Y),I.posY+this.offsetY<0&&(this.offsetY=I.posY+n+I.cTOOLTIP_OVERFLOW_ADD_Y<i?I.cTOOLTIP_OVERFLOW_ADD_Y:i-(n+I.posY+I.cTOOLTIP_PADDING_ADD_Y)),(I.posX+t>a||I.posX+I.cPANEL_WIDTH>a)&&(this.offsetX=-(t+I.cTOOLTIP_OVERFLOW_ADD_X)),this.TipElm.style.left=I.posX+this.offsetX+"px",this.TipElm.style.top=I.posY+this.offsetY+"px"},show:function(e){this.TipElm.innerHTML=e,this.TipElm.style.display="block",this.TipElm.classList.add("cssFadeIn");for(var t=0;t<I.cTOOLTIP_NUM_RERENDER;t++)I.qTip.move()},hide:function(){this.TipElm.innerHTML="",this.TipElm.style.display="none",this.TipElm.classList.remove("cssFadeIn")}}},I.initializeFirst(),O.initializeOptions(),T.initializeSchedule(),P.initializeMap(),K.initializeClock(),I.initializeLast()});